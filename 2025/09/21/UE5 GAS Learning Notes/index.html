<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="This is a space where I can share my thoughts and works with freely.">
    

    <!--Author-->
    
        <meta name="author" content="Eugene Hsuan">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="UE5 GAS Learning Notes"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Eugene&#39;s Page"/>

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>UE5 GAS Learning Notes - Eugene&#39;s Page</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="/css/table.css">

    
<link rel="stylesheet" href="/css/image-zoom.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Mermaid Support -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>

    <!-- Google Analytics -->
    


    <!--Favicon-->
    
        <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    

<meta name="generator" content="Hexo 7.3.0"></head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">Eugene's Page</a>
        <div class="subtitle">Filmmaker / Developer</div>
        <div class="description">This is a space where I can share my thoughts and works with freely.</div>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
                <li><a href="https://space.bilibili.com/29291963" class="behance" target="_blank" data-title="Bilibili"></a></li>
            
            
                <li><a href="https://www.instagram.com/yu_chinghsuan?igsh=Mm54ajloc3c1NW5m&utm_source=qr" class="instagram" target="_blank" data-title="Instagram"></a></li>
            
            
                <li><a href="https://www.douban.com/people/Youdrew_Xuan/" class="dribble" target="_blank" data-title="Douban"></a></li>
            
            
                <li><a href="mailto:youdrewxuan@icloud.com" class="google" target="_blank" data-title="Email"></a></li>
            
            
                <li><a href="/atom.xml" class="rss" target="_blank" data-title="RSS"></a></li>
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2025 Eugene Hsuan</p>
            <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p>
            <p>Modified based on <a href="https://github.com/klugjo/hexo-theme-magnetic" target="_blank">Magnetic</a> theme</p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('https://s2.loli.net/2025/09/13/vlTKo196wnDypC2.png');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a class="previous disabled"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2025/09/13/Aximmetry/" class="next" data-title="Aximmetry Learnin..."></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">UE5 GAS Learning Notes</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="Unreal-GAS系统使用学习"><a href="#Unreal-GAS系统使用学习" class="headerlink" title="Unreal GAS系统使用学习"></a>Unreal GAS系统使用学习</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Gameplay Ability System，简称(GAS)是一个健壮的、高度可扩展的、gameplay框架,通常用于构建RPG、MOBA等游戏的完整战斗逻辑框架。通过GAS,可以快速地制作游戏中的主动&#x2F;被动技能、各种效果buff、计算属性伤害、处理玩家各种战斗状态逻辑。</p>
<h3 id="GAS提供了哪些功能"><a href="#GAS提供了哪些功能" class="headerlink" title="GAS提供了哪些功能?"></a>GAS提供了哪些功能?</h3><p>1、实现了带有消耗和冷却功能的角色技能<br>2、处理数值属性(生命、魔法、攻击力、防御力)<br>3、应用状态效果(击飞、着火、眩晕)<br>4、应用游戏标签(GameplayTags)<br>5、生成特效和音效<br>6、完整的网络复制、预测功能</p>
<h3 id="适合使用GAS的项目"><a href="#适合使用GAS的项目" class="headerlink" title="适合使用GAS的项目"></a>适合使用GAS的项目</h3><p>1、C++项目,开发人员有充足的C++开发经验<br>2、使用Dedicated Server专用服务器的联机游戏（单纯的游戏逻辑服务端，与Dedicated Server相对的是Listen Server，其中一位玩家充当服务器，容易出现“主机优势”）<br>3、项目有大量且复杂的技能逻辑设计需求</p>
<h2 id="GAS的组件"><a href="#GAS的组件" class="headerlink" title="GAS的组件"></a>GAS的组件</h2><h3 id="Ability-System-Component：who谁能放技能？"><a href="#Ability-System-Component：who谁能放技能？" class="headerlink" title="Ability System Component：who谁能放技能？"></a><strong>Ability System Component</strong>：who谁能放技能？</h3><p>（ASC）是整个 GAS 的基础组件。ASC 本质上是一个 UActorComponent，用于处理整个框架下的交互逻辑，包括使用技能（GameplayAbility）、包含属性（AttributeSet）、处理各种效果（GameplayEffect）。所有需要应用 GAS 的对象（Actor），都必须拥有 GAS 组件。（即所有有技能交互的角色都是ASC）。</p>
<ul>
<li>ASC是一种角色组件，负责和GA、GE、AS打交道。</li>
<li>一般只放在Character or PlayerState上。</li>
<li>拥有 ASC 的 Actor 被称为 ASC 的 OwnerActor，ASC 实际作用的 Actor 叫做 AvatarActor。</li>
</ul>
<h3 id="Gameplay-Tags：if技能改变的条件？"><a href="#Gameplay-Tags：if技能改变的条件？" class="headerlink" title="Gameplay Tags：if技能改变的条件？"></a><strong>Gameplay Tags：if技能改变的条件？</strong></h3><p>FGameplayTags是一种层级标签，如Parent.Child.GrandChild。通过GameplayTagManager进行注册。替代了原来的Bool，或Enum的结构，可以在玩法设计中更高效的标记对象的行为或状态。<br>我理解是一个在Actor下的Json。方便执行一些复杂的状态。</p>
<ul>
<li>Tag的<strong>层级关系</strong>也需要合理设计，到了后期修改成本比较大。</li>
</ul>
<h3 id="Gameplay-Ability：How-技能的逻辑？"><a href="#Gameplay-Ability：How-技能的逻辑？" class="headerlink" title="Gameplay Ability：How:技能的逻辑？"></a><strong>Gameplay Ability</strong>：How:技能的逻辑？</h3><p>（GA）标识了游戏中一个对象（Actor）可以做的行为或技能。<br>能力（Ability）可以是普通攻击或者吟唱技能，可以是角色被击飞倒地，还可以是使用某种道具，交互某个物件，甚至跳跃、飞行等角色行为也可以是Ability。<br>Ability可以被赋予对象或从对象的ASC中移除，对象同时可以激活多个GameplayAbility。<br>*基本的移动输入、UI交互行为则不能或不建议通过GA来实现。</p>
<div class="mermaid" style="background: white; border: 1px solid #e1e1e1; border-radius: 4px; padding: 20px;">
graph TD
    A[TryActivateAbility] --> B{CanActivateAbility}
    B -->|Yes| C[ActivateAbility]
    B -->|No| D[EndAbility]
    C --> E[Start AbilityTask]
    E -->|Some Time Later| F[CommitAbility]
    F -->|Can't Afford| D
    F --> G[Start AbilityTask]
    G -->|Some Time Later| H[Apply GameplayEffects]
    G --> I[Start AbilityTask]
    I -->|Some Time Later| J[Apply GameplayEffects]
    I -->|Some Time Later| K[End Ability]
    D --> L[OnEndAbility]
    K --> L
    L --> M[Cleanup]
</div>

<h4 id="一个执行流程（成功流程）"><a href="#一个执行流程（成功流程）" class="headerlink" title="一个执行流程（成功流程）"></a>一个执行流程（成功流程）</h4><ol>
<li><span style="color: blue;">TryActivateAbility</span> ：首先判断一下能不能执行。</li>
<li><span style="color: green;">ActivateAbility</span>：执行一套技能（有技能动画，比如发射一个火焰）。</li>
<li><span style="color: #9C27B0;">CommitAbility</span>：技能释放了成功了，要扣蓝。</li>
<li><span style="color: #ffeb3b;">Start AbilityTask</span> * 2:技能执行中…技能执行结束。然后应用对应效果。</li>
</ol>
<h3 id="Gameplay-Effect：Change技能的效果？"><a href="#Gameplay-Effect：Change技能的效果？" class="headerlink" title="Gameplay Effect：Change技能的效果？"></a>Gameplay Effect：Change技能的效果？</h3><p>（GE）是Ability对<strong>自己或他人产生影响的途径</strong>。<br>GE通常可以被理解为我们游戏中的buff。比如增益&#x2F;减益效果（修改属性）。<br>但是GAS中的GE也更加广义，释放技能时候的伤害结算，施加特殊效果的控制、霸体效果（修改GameplayTag）都是通过GE来实现的。</p>
<ul>
<li><u>GE相当于一个可配置的数据表</u>，不可以添加逻辑。开发者创建一个UGameplayEffect的派生蓝图，就可以根据需求制作想要的效果。</li>
<li>GE是纯蓝图</li>
</ul>
<h3 id="Attribute-Set"><a href="#Attribute-Set" class="headerlink" title="Attribute Set"></a>Attribute Set</h3><p>负责定义和持有属性，并且管理属性的<u>变化</u>，包括<u>网络同步</u>。<br>需要在Actor中被添加为成员变量，并注册到ASC（C++）。<br>一个ASC可以拥有一个或多个（不同的）AttributeSet，因此可以角色共享一个很大的Attribute Set，也可以每个角色按需添加Attribute Set。<br>可以在属性变化前（PreAttributeChange）后（PostGameplayEffectExecute）处理相关逻辑，可以通过委托的方式绑定属性变化。</p>
<h3 id="组件总结"><a href="#组件总结" class="headerlink" title="组件总结"></a>组件总结</h3><p>What：技能改变的属性？GameplayEffect</p>
<p>Visual：技能的视觉效果？GameplayCue<br>Async：技能的长时行动？(异步)GameplayTask<br>Send：技能的消息事件？GamePplayEvent<br>What：技能改变的属性？GameplayEffect<br>这俩是同一个东西</p>
<h2 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h2><h3 id="开启插件"><a href="#开启插件" class="headerlink" title="开启插件"></a>开启插件</h3><p><img src="C:\Users\Eugene\AppData\Roaming\Typora\typora-user-images\image-20251027203033649.png" alt="image-20251027203033649" style="zoom: 50%;" /><img src="C:\Users\Eugene\AppData\Roaming\Typora\typora-user-images\image-20251027203540226.png" alt="image-20251027203540226" style="zoom: 25%;" /></p>
<ol>
<li><u>C++项目</u>，安装Gameplay Ability插件。</li>
<li>在Tools菜单下面有GameplayCue Editor有了，就说明开启成功了。</li>
<li>在新建的蓝图的页面可以看到GamePlay相关的东西</li>
</ol>
<h3 id="ASC组件架构"><a href="#ASC组件架构" class="headerlink" title="ASC组件架构"></a>ASC组件架构</h3><div class="mermaid" style="background: white; border: 1px solid #e1e1e1; border-radius: 4px; padding: 20px;">
classDiagram
  class ACharacter
  class ARPGCharacterBase {
    +AbilitySystemComponent
  }
  class BP_Character {
    +公共逻辑
  }
  class BP_PlayerCharacter {
    -组装Camera等组件
    -输入绑定
  }
  class BP_NPCCharacter
  ACharacter <|-- ARPGCharacterBase
  ARPGCharacterBase <|-- BP_Character
  BP_Character <|-- BP_PlayerCharacter
  BP_Character <|-- BP_NPCCharacter
</div>

<p>你需要自己创建一个继承自ACharacter的C++类。</p>
<p>之后想用蓝图，就从这个自定义的C++Character类派生就可以了。</p>
<h3 id="写一个基础GAS-ACharacter文件"><a href="#写一个基础GAS-ACharacter文件" class="headerlink" title="写一个基础GAS ACharacter文件"></a>写一个基础GAS ACharacter文件</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PublicDependencyModuleNames.AddRange(<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Core&quot;</span>, <span class="string">&quot;CoreUObject&quot;</span>, <span class="string">&quot;Engine&quot;</span>, <span class="string">&quot;InputCore&quot;</span>, <span class="string">&quot;EnhancedInput&quot;</span>,</span><br><span class="line">    <span class="string">&quot;GameplayAbilities&quot;</span>,<span class="string">&quot;GameplayTags&quot;</span>,<span class="string">&quot;GameplayTasks&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在Build文件里添加如下的内容GameplayAbilities、GameplayTags、GameplayTasks。</p>
<p>在.cpp中构造函数部分实例化ASC</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例化ASC</span></span><br><span class="line">AbilitySystemComponent = <span class="built_in">CreateDefaultSubobject</span>&lt;UAbilitySystemComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;AbilitySystem&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>角色类继承IAbilitySystemInterface接口，并实现GetASC函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemInterface.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ARPG_UNREAL_API</span> ACharacterBase : <span class="keyword">public</span> ACharacter, <span class="keyword">public</span> IAbilitySystemInterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"><span class="function">UAbilitySystemComponent* <span class="title">GetAbilitySystemComponent</span><span class="params">()</span><span class="type">const</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure>

<p>在CPP中实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UAbilitySystemComponent* <span class="title">ACharacterBase::GetAbilitySystemComponent</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AbilitySystemComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整的GAS-ACharacter代码"><a href="#完整的GAS-ACharacter代码" class="headerlink" title="完整的GAS ACharacter代码"></a>完整的GAS ACharacter代码</h3><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1X5411V7jh/">官方教学视频</a>:我看着这个视频作为最初的入门</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/486808688">知乎GAS系统快速入门</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/gameplay-ability-system-for-unreal-engine">Unreal官方的GAS讲解</a></li>
</ol>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Shader/">Shader</a> <a href="/tags/GLSL/">GLSL</a> <a href="/tags/HLSL/">HLSL</a> <a href="/tags/Unreal-Engine/">Unreal Engine</a> <a href="/tags/Graphics-Programming/">Graphics Programming</a> <a href="/tags/Computer-Graphics/">Computer Graphics</a> <a href="/tags/Game-Development-Shader-001/">Game Development Shader 001</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>

    <!-- Table of Contents will be generated by toc-collapse.js -->

</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->

<script src="/js/jquery.js"></script>


<!-- Custom Code -->

<script src="/js/main.js"></script>


<script src="/js/article-collapse.js"></script>


<script src="/js/toc-collapse.js"></script>


<script src="/js/shadertoy-embed.js"></script>


<script src="/js/image-zoom.js"></script>


<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Code Block Expansion Script -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Initialize code block expansion
    function initCodeBlockExpansion() {
        const codeBlocks = document.querySelectorAll('figure.highlight');
        
        codeBlocks.forEach(function(codeBlock) {
            // Skip if already processed
            if (codeBlock.closest('.code-block-container')) return;
            
            // Remove table structure and keep only code content
            const table = codeBlock.querySelector('table');
            if (table) {
                const codeCell = table.querySelector('td.code');
                if (codeCell) {
                    // Create a new pre element with code content
                    const newPre = document.createElement('pre');
                    newPre.className = 'code';
                    newPre.innerHTML = codeCell.innerHTML;
                    
                    // Replace table with pre element
                    codeBlock.innerHTML = '';
                    codeBlock.appendChild(newPre);
                }
            }
            
            // Get the code content height
            const codeContent = codeBlock.querySelector('pre.code');
            if (!codeContent) return;
            
            const actualHeight = codeContent.scrollHeight;
            const maxHeight = 400; // Same as CSS max-height
            
            // Only add expansion if content is taller than max height
            if (actualHeight > maxHeight) {
                // Wrap the code block in a container
                const container = document.createElement('div');
                container.className = 'code-block-container collapsed';
                codeBlock.parentNode.insertBefore(container, codeBlock);
                container.appendChild(codeBlock);
                
                // Create expand button
                const expandButton = document.createElement('button');
                expandButton.className = 'expand-button';
                expandButton.textContent = '展开代码';
                container.appendChild(expandButton);
                
                // Add click handler
                expandButton.addEventListener('click', function() {
                    if (container.classList.contains('collapsed')) {
                        // Expand to full screen
                        showFullscreenCode(codeBlock, expandButton);
                    }
                });
            }
        });
    }
    
    function showFullscreenCode(codeBlock, button) {
        // Create fullscreen modal
        const modal = document.createElement('div');
        modal.className = 'code-fullscreen-modal active';
        
        const content = document.createElement('div');
        content.className = 'code-fullscreen-content';
        
        // Clone the code block and remove any expansion restrictions
        const clonedBlock = codeBlock.cloneNode(true);
        
        // Remove any size restrictions from cloned block
        clonedBlock.style.maxHeight = 'none';
        clonedBlock.style.overflow = 'visible';
        
        // Find and update the pre.code element in cloned block
        const clonedPre = clonedBlock.querySelector('pre.code');
        if (clonedPre) {
            clonedPre.style.maxHeight = 'none';
            clonedPre.style.height = '100%';
            clonedPre.style.overflowY = 'scroll';
            clonedPre.style.overflowX = 'auto';
            clonedPre.style.minHeight = '0';
            // 确保内容完全可见
            clonedPre.scrollTop = 0;
        }
        
        content.appendChild(clonedBlock);
        
        // Create close button
        const closeButton = document.createElement('button');
        closeButton.className = 'close-fullscreen';
        closeButton.textContent = '关闭';
        content.appendChild(closeButton);
        
        modal.appendChild(content);
        document.body.appendChild(modal);
        
        // Prevent body scrolling
        document.body.style.overflow = 'hidden';
        
        // Close handlers
        function closeModal() {
            document.body.removeChild(modal);
            document.body.style.overflow = '';
        }
        
        closeButton.addEventListener('click', closeModal);
        
        // Close on backdrop click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
        
        // Close on escape key
        function handleKeydown(e) {
            if (e.key === 'Escape') {
                closeModal();
                document.removeEventListener('keydown', handleKeydown);
            }
        }
        document.addEventListener('keydown', handleKeydown);
    }
    
    // Initialize on page load
    initCodeBlockExpansion();
    
    // Re-initialize if new content is loaded (for SPA-like behavior)
    const observer = new MutationObserver(function(mutations) {
        let needsReinit = false;
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (node.matches('figure.highlight') || node.querySelector('figure.highlight'))) {
                        needsReinit = true;
                    }
                });
            }
        });
        if (needsReinit) {
            setTimeout(initCodeBlockExpansion, 100);
        }
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});
</script>

<!-- Mermaid Initialization -->
<script type="text/javascript">
    // Wait for document ready
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof mermaid !== 'undefined') {
            // Initialize with proper configuration
            mermaid.initialize({ 
                startOnLoad: false,
                theme: 'default',
                securityLevel: 'loose'
            });
            
            // Find and process mermaid code blocks
            const codeBlocks = document.querySelectorAll('figure.highlight.plaintext .code');
            
            codeBlocks.forEach((codeElement, index) => {
                let code = codeElement.textContent || codeElement.innerText;
                
                // Check if it's a mermaid diagram
                if (code.trim().match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|journey|pie|gitgraph|erDiagram)/)) {
                    // Critical fix: Remove ALL leading/trailing whitespace and newlines
                    code = code.trim().replace(/^\s+|\s+$/g, '');
                    
                    // Create mermaid div
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    // Set the cleaned code without any extra whitespace
                    mermaidDiv.textContent = code;
                    mermaidDiv.id = 'mermaid-diagram-' + index;
                    
                    // Replace the entire figure element
                    const figureElement = codeElement.closest('figure');
                    if (figureElement) {
                        figureElement.parentNode.replaceChild(mermaidDiv, figureElement);
                    }
                }
            });
            
            // Initialize mermaid diagrams with explicit selector
            setTimeout(() => {
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }, 100);
        }
    });
</script>

<!-- ShaderToy Placeholder Processing -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit for other scripts to load
    setTimeout(function() {
        // Find all elements with shadertoy-placeholder class
        const elements = document.querySelectorAll('.shadertoy-placeholder[data-id]');
        
        console.log('Found shadertoy-placeholder elements:', elements.length);

        elements.forEach(element => {
            const shaderID = element.getAttribute('data-id');
            console.log('Processing shadertoy-placeholder element with ID:', shaderID);
            
            if (shaderID) {
                // Create iframe container
                const container = document.createElement('div');
                container.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 400px;
                    margin: 20px 0;
                    border: 2px solid #bfbbbb;
                    border-radius: 8px;
                    overflow: hidden;
                    background-color: #f6f6f6;
                `;

                // Create iframe
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.shadertoy.com/embed/${shaderID}?gui=true&t=10&paused=false&muted=false`;
                iframe.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    border: none;
                `;
                iframe.allowFullscreen = true;
                iframe.loading = 'lazy';

                container.appendChild(iframe);
                element.parentNode.insertBefore(container, element);
                element.parentNode.removeChild(element);
            }
        });
    }, 1000); // Wait a full second for everything to load
});
</script>

<!-- Disqus Comments -->


</body>

</html>