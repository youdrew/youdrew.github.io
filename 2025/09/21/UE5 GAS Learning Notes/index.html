<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Unreal GASç³»ç»ŸåŠç½‘ç»œä½¿ç”¨å­¦ä¹ å‰ç½®çŸ¥è¯†UEç½‘ç»œæ¶æ„
ç®€ä»‹Gameplay Ability Systemï¼Œç®€ç§°(GAS)æ˜¯ä¸€ä¸ªå¥å£®çš„ã€é«˜åº¦å¯æ‰©å±•çš„ã€gameplayæ¡†æ¶,é€šå¸¸ç”¨äºæ„å»ºRPGã€MOBAç­‰æ¸¸æˆçš„å®Œæ•´æˆ˜æ–—é€»è¾‘æ¡†æ¶ã€‚é€šè¿‡GAS,å¯ä»¥å¿«é€Ÿåœ°åˆ¶ä½œæ¸¸æˆä¸­çš„ä¸»åŠ¨&amp;#x2F;è¢«åŠ¨æŠ€èƒ½ã€å„ç§æ•ˆæœb">
    

    <!--Author-->
    
        <meta name="author" content="Eugene Hsuan">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="UE5 GAS Learning Notes"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Eugene&#39;s Page"/>

    <!--Article Language-->
    
        <meta name="article:lang" content="en"/>
    

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>UE5 GAS Learning Notes - Eugene&#39;s Page</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="/css/table.css">

    
<link rel="stylesheet" href="/css/image-zoom.css">

    
<link rel="stylesheet" href="/css/language-switcher.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Mermaid Support -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>

    <!-- Google Analytics -->
    


    <!--Favicon-->
    
        <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    

    
        <link rel="alternate" type="application/atom+xml" title="Eugene&#39;s Page" href="/atom.xml">
    
        <link rel="alternate" type="application/rss+xml" title="Eugene&#39;s Page" href="/rss.xml">
    

<meta name="generator" content="Hexo 8.1.1"></head>


<body class="layout-post path-2025-09-21-UE5-GAS-Learning-Notes-">

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">Eugene's Page</a>
        <div class="subtitle"></div>
        <div class="description"></div>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/" data-i18n-key="Home">Home</a>
            </li>
            
            <li>
                <a href="/archives" data-i18n-key="Archives">Archives</a>
            </li>
            
            <li>
                <a href="/about" data-i18n-key="About">About</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
                <li><a href="https://space.bilibili.com/29291963" class="behance" target="_blank" data-title="Bilibili"></a></li>
            
            
                <li><a href="https://www.instagram.com/yu_chinghsuan?igsh=Mm54ajloc3c1NW5m&utm_source=qr" class="instagram" target="_blank" data-title="Instagram"></a></li>
            
            
                <li><a href="https://www.douban.com/people/Youdrew_Xuan/" class="dribble" target="_blank" data-title="Douban"></a></li>
            
            
                <li><a href="mailto:youdrewxuan@icloud.com" class="google" target="_blank" data-title="Email"></a></li>
            
            
                <li><a href="/rss.xml" class="rss" target="_blank" data-title="RSS"></a></li>
            
            <li><a href="javascript:void(0);" class="language" id="langSwitch" data-title="Language"></a></li>
        </ul><!-- end social -->

        <div class="rights">
            <p><span data-i18n="Copyright">Copyright</span> Â© 2026 Eugene Hsuan</p>
            <p><span data-i18n="Powered by">Powered by</span> <a href="https://hexo.io/" target="_blank">Hexo</a></p>
            <p><span data-i18n="Modified based on">Modified based on</span> <a href="https://github.com/klugjo/hexo-theme-magnetic" target="_blank">Magnetic</a> <span data-i18n="theme">theme</span></p>
            <p data-i18n="Mainly maintained using AI">Mainly maintained using AI</p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('https://s2.loli.net/2025/11/11/5G9HF8xIluUj7Nt.jpg');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2025/11/21/Unreal%20RemoteControl%20Note/" class="previous" data-title="è™šå¹»5è¿œç¨‹æ§åˆ¶ï¼ˆRemoteControlï¼‰ç¬”è®°"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2025/09/13/Aximmetry/" class="next" data-title="AximmetryåŠä½æˆæœ¬XRæ–¹æ¡ˆ..."></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">UE5 GAS Learning Notes</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="Unreal-GASç³»ç»ŸåŠç½‘ç»œä½¿ç”¨å­¦ä¹ "><a href="#Unreal-GASç³»ç»ŸåŠç½‘ç»œä½¿ç”¨å­¦ä¹ " class="headerlink" title="Unreal GASç³»ç»ŸåŠç½‘ç»œä½¿ç”¨å­¦ä¹ "></a>Unreal GASç³»ç»ŸåŠç½‘ç»œä½¿ç”¨å­¦ä¹ </h1><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ud4y1y7a8/">UEç½‘ç»œæ¶æ„</a></p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Gameplay Ability Systemï¼Œç®€ç§°(GAS)æ˜¯ä¸€ä¸ªå¥å£®çš„ã€é«˜åº¦å¯æ‰©å±•çš„ã€gameplayæ¡†æ¶,é€šå¸¸ç”¨äºæ„å»ºRPGã€MOBAç­‰æ¸¸æˆçš„å®Œæ•´æˆ˜æ–—é€»è¾‘æ¡†æ¶ã€‚é€šè¿‡GAS,å¯ä»¥å¿«é€Ÿåœ°åˆ¶ä½œæ¸¸æˆä¸­çš„ä¸»åŠ¨&#x2F;è¢«åŠ¨æŠ€èƒ½ã€å„ç§æ•ˆæœbuffã€è®¡ç®—å±æ€§ä¼¤å®³ã€å¤„ç†ç©å®¶å„ç§æˆ˜æ–—çŠ¶æ€é€»è¾‘ã€‚</p>
<p>GASè¯•å›¾<u>å°†æœºåˆ¶æå–ä¸ºé€šç”¨çš„æ¸¸æˆè®¾è®¡æ¨¡å¼</u>ï¼Œå¹¶æä¾›æ¡†æ¶æ¥è§£å†³å¸¸è§çš„Gameplayå®ç°é—®é¢˜ï¼ŒåŒæ—¶ä½¿ä¸Šä¸‹æ–‡å› é¡¹ç›®è€Œå¼‚ã€‚</p>
<h3 id="GASæä¾›äº†å“ªäº›åŠŸèƒ½"><a href="#GASæä¾›äº†å“ªäº›åŠŸèƒ½" class="headerlink" title="GASæä¾›äº†å“ªäº›åŠŸèƒ½?"></a>GASæä¾›äº†å“ªäº›åŠŸèƒ½?</h3><ol>
<li>å®ç°äº†å¸¦æœ‰æ¶ˆè€—å’Œå†·å´åŠŸèƒ½çš„è§’è‰²æŠ€èƒ½</li>
<li>å¤„ç†æ•°å€¼å±æ€§(ç”Ÿå‘½ã€é­”æ³•ã€æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›)</li>
<li>åº”ç”¨çŠ¶æ€æ•ˆæœ(å‡»é£ã€ç€ç«ã€çœ©æ™•)</li>
<li>åº”ç”¨æ¸¸æˆæ ‡ç­¾(GameplayTags)</li>
<li>ç”Ÿæˆç‰¹æ•ˆå’ŒéŸ³æ•ˆ</li>
<li>å®Œæ•´çš„ç½‘ç»œå¤åˆ¶ã€é¢„æµ‹åŠŸèƒ½</li>
</ol>
<h3 id="é€‚åˆä½¿ç”¨GASçš„é¡¹ç›®"><a href="#é€‚åˆä½¿ç”¨GASçš„é¡¹ç›®" class="headerlink" title="é€‚åˆä½¿ç”¨GASçš„é¡¹ç›®"></a>é€‚åˆä½¿ç”¨GASçš„é¡¹ç›®</h3><ol>
<li><p>C++é¡¹ç›®,å¼€å‘äººå‘˜æœ‰å……è¶³çš„C++å¼€å‘ç»éªŒ</p>
</li>
<li><p>ä½¿ç”¨Dedicated Serverä¸“ç”¨æœåŠ¡å™¨çš„è”æœºæ¸¸æˆï¼ˆå•çº¯çš„æ¸¸æˆé€»è¾‘æœåŠ¡ç«¯ï¼Œä¸Dedicated Serverç›¸å¯¹çš„æ˜¯Listen Serverï¼Œå…¶ä¸­ä¸€ä½ç©å®¶å……å½“æœåŠ¡å™¨ï¼Œå®¹æ˜“å‡ºç°â€œä¸»æœºä¼˜åŠ¿â€ï¼‰</p>
</li>
<li><p>é¡¹ç›®æœ‰å¤§é‡ä¸”å¤æ‚çš„æŠ€èƒ½é€»è¾‘è®¾è®¡éœ€æ±‚</p>
</li>
</ol>
<h3 id="GASçš„ä¸»è¦ä¼˜åŠ¿"><a href="#GASçš„ä¸»è¦ä¼˜åŠ¿" class="headerlink" title="GASçš„ä¸»è¦ä¼˜åŠ¿"></a>GASçš„ä¸»è¦ä¼˜åŠ¿</h3><ul>
<li><strong>ç½‘ç»œå¤åˆ¶ï¼ˆNetwork Replicationï¼‰ï¼š</strong> ä¸å¿…æ‹…å¿ƒä½ çš„å±æ€§æˆ–å‡ç›Šæ•ˆæœå¾—ä¸åˆ°å¦¥å–„åœ°åº”ç”¨æˆ–å¤åˆ¶ã€‚GASä¼šä¸ºä½ å¤„ç†å†…éƒ¨é€»è¾‘ã€‚</li>
<li><strong>æ¨¡å—åŒ–ï¼ˆModularityï¼‰ï¼š</strong> æ·»åŠ æˆ–æ›´æ”¹æ¸¸æˆæœºåˆ¶é€šå¸¸ä¸å®ç°å’Œèµ‹äºˆæ–°æŠ€èƒ½ä¸€æ ·ç®€å•ã€‚é€šè¿‡å°†GameplayåŠŸèƒ½åˆ†è§£ä¸ºå•ç‹¬çš„èµ„äº§ï¼ŒæŠ€èƒ½ç³»ç»Ÿå¯ä»¥åœ¨å®Œå…¨ä¸åŒçš„æ¸¸æˆå¯¹è±¡æˆ–æœºåˆ¶ä¹‹é—´æä¾›é€šç”¨çš„é€šä¿¡å±‚ã€‚ä¾‹å¦‚ï¼Œç”Ÿå‘½å€¼ï¼ˆHealthï¼‰å¯ä»¥åˆ’åˆ†åˆ°è‡ªå·±çš„å±æ€§é›†ï¼Œå¹¶é€šè¿‡æ¥è‡ªå„ç§ç³»ç»Ÿçš„Gameplayæ•ˆæœè¿›è¡Œäº¤äº’ã€‚</li>
<li><strong>å¿«é€Ÿè¿­ä»£ï¼ˆFast iterationï¼‰ï¼š</strong> GASå¯ä»¥è½»æ¾æ›´æ”¹å•ä¸ªæ¸¸æˆè§„åˆ™ï¼Œè€Œæ— éœ€ä¿®æ”¹æ•´ä¸ªç³»ç»Ÿã€‚ç”¨äºè®¡ç®—æ¸¸æˆçš„æ•°æ®æºå¯ä»¥è½»æ¾äº¤æ¢ï¼Œå¹¶ä¸”å¯ä»¥ä»ç›¸åº”çš„Gameplayæ•ˆæœä¸­ä¿®æ”¹åŠ¨ä½œæ•ˆæœã€‚</li>
</ul>
<h3 id="æˆ‘ä¸ºä»€ä¹ˆå­¦ä¹ GAS"><a href="#æˆ‘ä¸ºä»€ä¹ˆå­¦ä¹ GAS" class="headerlink" title="æˆ‘ä¸ºä»€ä¹ˆå­¦ä¹ GAS"></a>æˆ‘ä¸ºä»€ä¹ˆå­¦ä¹ GAS</h3><p>ç¼–å†™æ ·æ¿ä»£ç é€šå¸¸æ˜“å‡ºé”™ä¸”è€—æ—¶ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤šäººæ¸¸æˆè€Œè¨€ã€‚ä¾‹å¦‚ï¼Œä½ ä¸å¸Œæœ›èŠ±è´¹å¤§é‡æ—¶é—´æ¥ç¡®ä¿ä½ çš„ç”Ÿå‘½ï¼ˆHealthï¼‰å€¼æ­£ç¡®å¤åˆ¶ï¼Œæˆ–è€…åœ¨ä½ å†³å®šå…·æœ‰ç›¸åŒè¡Œä¸ºçš„èƒ½é‡ï¼ˆEnergyï¼‰å€¼æ—¶ï¼Œå¤åˆ¶ç›¸åŒçš„ä»£ç è¡Œã€‚</p>
<p>GASé€šè¿‡æä¾›å°½å¯èƒ½å®ç°å¸¸è§GameplayåŠŸèƒ½çš„åŸºç¡€æ¥è§£å†³è¿™äº›é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒæœºåˆ¶ä¸­ç«‹ã€‚GASå¹¶éå¼ºåˆ¶ä½¿ç”¨è¯¸å¦‚ç”Ÿå‘½å€¼ï¼ˆHealthï¼‰ã€å¼¹è¯ï¼ˆAmmoï¼‰ã€è¿‘æˆ˜æ”»å‡»ï¼ˆMelee Attackï¼‰æˆ–æ¯’è¯å‡ç›Šï¼ˆPoison Debuffï¼‰ä¹‹ç±»çš„æ¦‚å¿µï¼Œè€Œæ˜¯æä¾›äº†èƒ½å¤Ÿå®šä¹‰ã€å¤åˆ¶å’Œä½¿ç”¨ <strong>å±æ€§ï¼ˆAttributesï¼‰</strong> ã€ <strong>æŠ€èƒ½ï¼ˆAbilitiesï¼‰</strong> å’Œ <strong>æ•ˆæœï¼ˆEffectsï¼‰</strong> çš„å·¥å…·ï¼Œç„¶åä½ å¯ä»¥å°†è¿™äº›å·¥å…·ä¸“ç”¨äºæ»¡è¶³ç»™å®šGameplayæœºåˆ¶çš„éœ€æ±‚ã€‚</p>
<p><u>äºæˆ‘è€Œè¨€</u>ï¼šå…¬å¸çš„é¡¹ç›®éœ€è¦ä½¿ç”¨åˆ°è”ç½‘çš„æ¸¸æˆæœåŠ¡ã€‚æ‰€ä»¥ä½ ä¼šåœ¨æˆ‘çš„ç¬”è®°ä¸­çœ‹åˆ°ä¸€äº›æ–œä½“çš„å¤‡æ³¨ï¼Œè¿™äº›å¤‡æ³¨æ„å‘³ç€å¯¹æˆ‘è‡ªå·±é¡¹ç›®çš„å¤‡æ³¨ã€‚å¯ä»¥å¿½ç•¥ã€‚</p>
<h2 id="GASçš„ç»„ä»¶"><a href="#GASçš„ç»„ä»¶" class="headerlink" title="GASçš„ç»„ä»¶"></a>GASçš„ç»„ä»¶</h2><h3 id="ASCï¼šwhoè°èƒ½æ”¾æŠ€èƒ½ï¼Ÿ"><a href="#ASCï¼šwhoè°èƒ½æ”¾æŠ€èƒ½ï¼Ÿ" class="headerlink" title="ASCï¼šwhoè°èƒ½æ”¾æŠ€èƒ½ï¼Ÿ"></a>ASCï¼šwhoè°èƒ½æ”¾æŠ€èƒ½ï¼Ÿ</h3><p>Ability System Componentï¼ˆASCï¼‰æ˜¯æ•´ä¸ª GAS çš„åŸºç¡€ç»„ä»¶ã€‚ASC æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª UActorComponentï¼Œç”¨äºå¤„ç†æ•´ä¸ªæ¡†æ¶ä¸‹çš„äº¤äº’é€»è¾‘ï¼ŒåŒ…æ‹¬ä½¿ç”¨æŠ€èƒ½ï¼ˆGameplayAbilityï¼‰ã€åŒ…å«å±æ€§ï¼ˆAttributeSetï¼‰ã€å¤„ç†å„ç§æ•ˆæœï¼ˆGameplayEffectï¼‰ã€‚æ‰€æœ‰éœ€è¦åº”ç”¨ GAS çš„å¯¹è±¡ï¼ˆActorï¼‰ï¼Œéƒ½å¿…é¡»æ‹¥æœ‰ GAS ç»„ä»¶ã€‚ï¼ˆå³æ‰€æœ‰æœ‰æŠ€èƒ½äº¤äº’çš„è§’è‰²éƒ½æ˜¯ASCï¼‰ã€‚</p>
<ul>
<li>ASCæ˜¯ä¸€ç§è§’è‰²ç»„ä»¶ï¼Œè´Ÿè´£å’ŒGAã€GEã€ASæ‰“äº¤é“ã€‚</li>
<li>ä¸€èˆ¬åªæ”¾åœ¨Character or PlayerStateä¸Šã€‚</li>
<li>æ‹¥æœ‰ ASC çš„ Actor è¢«ç§°ä¸º ASC çš„ OwnerActorï¼ŒASC å®é™…ä½œç”¨çš„ Actor å«åš AvatarActorã€‚</li>
</ul>
<h3 id="GAï¼šHow-æŠ€èƒ½çš„é€»è¾‘ï¼Ÿ"><a href="#GAï¼šHow-æŠ€èƒ½çš„é€»è¾‘ï¼Ÿ" class="headerlink" title="GAï¼šHow:æŠ€èƒ½çš„é€»è¾‘ï¼Ÿ"></a><strong>GA</strong>ï¼šHow:æŠ€èƒ½çš„é€»è¾‘ï¼Ÿ</h3><p>Gameplay Abilityï¼ˆGAï¼‰<u>æ ‡è¯†äº†æ¸¸æˆä¸­ä¸€ä¸ªå¯¹è±¡ï¼ˆActorï¼‰å¯ä»¥åšçš„è¡Œä¸ºæˆ–æŠ€èƒ½</u>ã€‚å®ƒä»£è¡¨è§’è‰²å¯ä»¥æ‰§è¡Œçš„ä»»ä½•æŠ€èƒ½æˆ–è¡Œä¸ºã€‚<br>èƒ½åŠ›ï¼ˆAbilityï¼‰å¯ä»¥æ˜¯æ™®é€šæ”»å‡»æˆ–è€…åŸå”±æŠ€èƒ½ï¼Œå¯ä»¥æ˜¯è§’è‰²è¢«å‡»é£å€’åœ°ï¼Œè¿˜å¯ä»¥æ˜¯ä½¿ç”¨æŸç§é“å…·ï¼Œäº¤äº’æŸä¸ªç‰©ä»¶ï¼Œç”šè‡³è·³è·ƒã€é£è¡Œç­‰è§’è‰²è¡Œä¸ºä¹Ÿå¯ä»¥æ˜¯Abilityã€‚<br>Abilityå¯ä»¥è¢«èµ‹äºˆå¯¹è±¡æˆ–ä»å¯¹è±¡çš„ASCä¸­ç§»é™¤ï¼Œå¯¹è±¡åŒæ—¶å¯ä»¥æ¿€æ´»å¤šä¸ªGameplayAbilityã€‚</p>
<ul>
<li>åŸºæœ¬çš„ç§»åŠ¨è¾“å…¥ã€UIäº¤äº’è¡Œä¸ºåˆ™ä¸èƒ½æˆ–ä¸å»ºè®®é€šè¿‡GAæ¥å®ç°ã€‚</li>
<li>é€šè¿‡è“å›¾ç»§æ‰¿GamePlay Abilityæ¥å®ç°</li>
</ul>
<h4 id="GAçš„æ‰§è¡Œæµç¨‹"><a href="#GAçš„æ‰§è¡Œæµç¨‹" class="headerlink" title="GAçš„æ‰§è¡Œæµç¨‹"></a>GAçš„æ‰§è¡Œæµç¨‹</h4><div class="mermaid" style="background: white; border: 1px solid #e1e1e1; border-radius: 4px; padding: 20px;">
graph TD
    A[TryActivateAbility] --> B{CanActivateAbility}
    B -->|Yes| C[ActivateAbility]
    B -->|No| D[EndAbility]
    C --> E[Start AbilityTask]
    E -->|Some Time Later| F[CommitAbility]
    F -->|Can't Afford| D
    F --> G[Start AbilityTask]
    G -->|Some Time Later| H[Apply GameplayEffects]
    G --> I[Start AbilityTask]
    I -->|Some Time Later| J[Apply GameplayEffects]
    I -->|Some Time Later| K[End Ability]
    D --> L[OnEndAbility]
    K --> L
    L --> M[Cleanup]
</div>

<ol>
<li><span style="color: blue;">TryActivateAbility</span> ï¼šé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹èƒ½ä¸èƒ½æ‰§è¡Œã€‚</li>
<li><span style="color: green;">ActivateAbility</span>ï¼šæ‰§è¡Œä¸€å¥—æŠ€èƒ½ï¼ˆæœ‰æŠ€èƒ½åŠ¨ç”»ï¼Œæ¯”å¦‚å‘å°„ä¸€ä¸ªç«ç„°ï¼‰ã€‚</li>
<li><span style="color: #9C27B0;">CommitAbility</span>ï¼šæŠ€èƒ½é‡Šæ”¾äº†æˆåŠŸäº†ï¼Œè¦æ‰£è“ã€‚</li>
<li><span style="color: #ffeb3b;">Start AbilityTask</span> * 2:æŠ€èƒ½æ‰§è¡Œä¸­â€¦æŠ€èƒ½æ‰§è¡Œç»“æŸã€‚ç„¶ååº”ç”¨å¯¹åº”æ•ˆæœã€‚</li>
</ol>
<p>å…¶ä¸­ActivateAbilityå’ŒEnd Abilityæ˜¯ç±»ä¼¼äºBeginPlayå’ŒEndPlayè¿™æ ·çš„å‡½æ•°ï¼Œåœ¨è“å›¾ä¸­è°ƒç”¨ã€‚</p>
<h4 id="è“å›¾ä¸­çš„è®¾ç½®"><a href="#è“å›¾ä¸­çš„è®¾ç½®" class="headerlink" title="è“å›¾ä¸­çš„è®¾ç½®"></a>è“å›¾ä¸­çš„è®¾ç½®</h4><h4 id="ä¸»è¦é€‰é¡¹è§£é‡Š"><a href="#ä¸»è¦é€‰é¡¹è§£é‡Š" class="headerlink" title="ä¸»è¦é€‰é¡¹è§£é‡Š"></a>ä¸»è¦é€‰é¡¹è§£é‡Š</h4><h5 id="å¸¸è§è“å›¾"><a href="#å¸¸è§è“å›¾" class="headerlink" title="å¸¸è§è“å›¾"></a>å¸¸è§è“å›¾</h5><ul>
<li>EndAbility ç»“æŸè¿™ä¸ªèƒ½åŠ›</li>
</ul>
<h5 id="é«˜çº§è®¾ç½®"><a href="#é«˜çº§è®¾ç½®" class="headerlink" title="é«˜çº§è®¾ç½®"></a>é«˜çº§è®¾ç½®</h5><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/Ndl5QoW8hUkyKrw.png" alt="image-20251028173049722" width="50%" />
</div>

<ul>
<li><p><strong>Replication Policy</strong>ï¼ˆå¤åˆ¶ç­–ç•¥ï¼‰ï¼š å†³å®šè¯¥Abilityçš„æ¿€æ´»ã€æ‰§è¡Œç­‰ä¿¡æ¯æ˜¯å¦åœ¨ç½‘ç»œä¸Šä¼ æ’­ã€‚å¸¸è§é€‰é¡¹æœ‰ï¼š</p>
<ul>
<li>Not Replicatedï¼šä»…æœ¬åœ°æ‰§è¡Œï¼Œä¸åŒæ­¥åˆ°å…¶ä»–å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨ã€‚</li>
<li>Replicatedï¼šåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´åŒæ­¥ã€‚</li>
</ul>
</li>
<li><p><strong>Instancing Policy</strong>ï¼ˆå®ä¾‹åŒ–ç­–ç•¥ï¼‰ï¼š å†³å®šAbilityçš„å®ä¾‹åŒ–æ–¹å¼ã€‚</p>
<ul>
<li>Non-Instancedï¼šæ‰€æœ‰æ¿€æ´»è€…å…±äº«åŒä¸€ä¸ªAbilityå¯¹è±¡ï¼Œé€‚åˆæ— çŠ¶æ€é€»è¾‘ã€‚</li>
<li>Instanced Per Actorï¼šæ¯ä¸ªæ‹¥æœ‰è€…æœ‰ç‹¬ç«‹å®ä¾‹ï¼Œé€‚åˆæœ‰çŠ¶æ€é€»è¾‘ã€‚</li>
<li>Instanced Per Executionï¼šæ¯æ¬¡æ¿€æ´»éƒ½æ–°å»ºå®ä¾‹ï¼Œé€‚åˆéœ€è¦éš”ç¦»çŠ¶æ€çš„å¤æ‚æŠ€èƒ½ã€‚</li>
</ul>
</li>
<li><p><strong>Server Respects Remote Ability Cancellation</strong>ï¼ˆæœåŠ¡å™¨å°Šé‡è¿œç«¯å–æ¶ˆï¼‰ï¼šå‹¾é€‰åï¼ŒæœåŠ¡å™¨ä¼šå“åº”å®¢æˆ·ç«¯è¯·æ±‚å–æ¶ˆAbilityçš„æ“ä½œã€‚é€‚åˆéœ€è¦å®¢æˆ·ç«¯ä¸»åŠ¨å–æ¶ˆæŠ€èƒ½çš„åœºæ™¯ã€‚</p>
</li>
<li><p><strong>Retrigger Instanced Ability</strong>ï¼ˆå¯é‡å¤è§¦å‘å®ä¾‹åŒ–Abilityï¼‰ï¼šå…è®¸Abilityåœ¨å·²æ¿€æ´»æ—¶å†æ¬¡è¢«æ¿€æ´»ï¼ˆä¼šé‡æ–°å®ä¾‹åŒ–ï¼‰ï¼Œé€‚åˆå¯å åŠ æˆ–å¯é‡å¤é‡Šæ”¾çš„æŠ€èƒ½ã€‚</p>
</li>
<li><p><strong>Net Execution Policy</strong>ï¼ˆç½‘ç»œæ‰§è¡Œç­–ç•¥ï¼‰ï¼šå†³å®šAbilityçš„æ¿€æ´»å’Œæ‰§è¡Œåœ¨å“ªç«¯è¿›è¡Œã€‚</p>
<ul>
<li>Local Predictedï¼šå®¢æˆ·ç«¯é¢„æµ‹æ‰§è¡Œï¼ŒæœåŠ¡å™¨æ ¡éªŒã€‚</li>
<li>Local Onlyï¼šä»…æœ¬åœ°æ‰§è¡Œã€‚</li>
<li>Server Onlyï¼šä»…æœåŠ¡å™¨æ‰§è¡Œã€‚</li>
<li>Server Initiatedï¼šæœåŠ¡å™¨å‘èµ·ï¼Œå®¢æˆ·ç«¯å¯å‚ä¸ã€‚</li>
</ul>
</li>
<li><p><strong>Net Security Policy</strong>ï¼ˆç½‘ç»œå®‰å…¨ç­–ç•¥ï¼‰ï¼šæ§åˆ¶Abilityçš„å®‰å…¨ç­‰çº§ï¼Œé˜²æ­¢è¢«æ¶æ„å®¢æˆ·ç«¯æ»¥ç”¨ã€‚</p>
<ul>
<li>Client Or Serverï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯æ¿€æ´»ã€‚</li>
<li>Server Only Executionï¼šåªæœ‰æœåŠ¡å™¨å¯æ¿€æ´»ã€‚</li>
<li>Server Only Execution and Dataï¼šåªæœ‰æœåŠ¡å™¨å¯æ¿€æ´»ä¸”æ•°æ®ä»…åœ¨æœåŠ¡å™¨ã€‚</li>
</ul>
</li>
</ul>
<h4 id="GAè¦åšçš„äº‹æƒ…"><a href="#GAè¦åšçš„äº‹æƒ…" class="headerlink" title="GAè¦åšçš„äº‹æƒ…"></a>GAè¦åšçš„äº‹æƒ…</h4><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/jaloAZzDKkq5fx2.png" alt="image-20251028200009953" width="50%" />
</div>

<p>ä¸€èˆ¬GAè¦åšçš„äº‹æœ‰ï¼š</p>
<ul>
<li>è®¾ç½®GAçš„Tagã€CDã€Costç­‰å±æ€§ã€‚</li>
<li>è·å–å¿…è¦ä¿¡æ¯ï¼Œä¸»è¦é€šè¿‡Get Actor Infoã€‚å¦‚æœæ˜¯é€šè¿‡Eventè°ƒç”¨çš„GAï¼ˆä½¿ç”¨Activate Ability From EventèŠ‚ç‚¹ä½œä¸ºè¾“å…¥ï¼‰ï¼Œè¿˜å¯ä»¥é€šè¿‡Gameplay Event Dataè·å–ã€‚</li>
<li>ç¼–å†™é€»è¾‘ï¼Œå¦‚æ’­æ”¾åŠ¨ç”»ã€åº”ç”¨GEã€åº”ç”¨å†²é‡ç­‰ã€‚</li>
<li>ä¸€å®šä¸è¦å¿˜äº†EndAbilityã€‚</li>
</ul>
<h4 id="GAçš„è°ƒç”¨"><a href="#GAçš„è°ƒç”¨" class="headerlink" title="GAçš„è°ƒç”¨"></a>GAçš„è°ƒç”¨</h4><p>GAçš„è°ƒç”¨åˆ†æˆäº†ä¸»åŠ¨è°ƒç”¨ï¼ˆé‡Šæ”¾æŠ€èƒ½ï¼‰å’Œè¢«åŠ¨è°ƒç”¨ï¼ˆæŒ¨æ‰“ï¼‰ä¸¤ç±»ï¼Œä¸‹é¢ä¾æ¬¡ä»‹ç»ä¸åŒçš„è°ƒç”¨æ–¹æ³•ã€‚</p>
<h5 id="ä¸»åŠ¨è°ƒç”¨"><a href="#ä¸»åŠ¨è°ƒç”¨" class="headerlink" title="ä¸»åŠ¨è°ƒç”¨"></a>ä¸»åŠ¨è°ƒç”¨</h5><p>åœ¨è“å›¾ä¸­ä¸»è¦æœ‰by Classå’Œby Tag ä¸¤ç§è°ƒç”¨æ–¹æ³•ã€‚</p>
<div style="text-align: center;">
  <img src="https://pic4.zhimg.com/v2-0671623b3bf57f42b92903bfc3acb667_1440w.jpg" alt="img" width="50%" />
</div>

<p>byClassä¸€æ¬¡åªèƒ½Activateä¸€ä¸ªGAï¼ŒbyTagå¯ä»¥Activateä»»æ„å¤šä¸ªGAï¼Œé…åˆTagå®¹å™¨ä½¿ç”¨ã€‚</p>
<p>å¦‚æœä½¿ç”¨EnhancedInputActionæ’ä»¶æ¥ç®¡ç†è¾“å…¥ï¼Œè¦æ³¨æ„åœ¨æŸäº›è®¾ç½®ä¸‹triggerä¼šæ¯å¸§éƒ½è¿›è¡Œè¾“å‡ºã€‚</p>
<p>åªè¦èƒ½è·å–ASCï¼Œå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨GAï¼Œæ¯”å¦‚è¡Œä¸ºæ ‘Taskè“å›¾ï¼Œç”šè‡³åœ¨GAè“å›¾ä¸­è°ƒç”¨å…¶ä»–GAã€‚</p>
<h5 id="è¢«åŠ¨è°ƒç”¨"><a href="#è¢«åŠ¨è°ƒç”¨" class="headerlink" title="è¢«åŠ¨è°ƒç”¨"></a>è¢«åŠ¨è°ƒç”¨</h5><p>Triggerå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªTagï¼Œå½“ASCç»„ä»¶æ”¶åˆ°ä¸€ä¸ªTriggeræ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨æ‰€æœ‰æ‹¥æœ‰è¯¥Triggerçš„GAã€‚</p>
<p>Triggerçš„Tagåœ¨GAçš„detailsé¢æ¿ä¸­è®¾ç½®ã€‚</p>
<div style="text-align: center;">
  <img src="https://pic2.zhimg.com/v2-9fdb393dae4753b3539245b335c3a531_1440w.jpg" alt="img" width="50%" />
</div>

<p>Triggerçš„è§¦å‘æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>Gameplay Event: å½“Owneræ”¶åˆ°ä¸€ä¸ªå¸¦æœ‰Tagçš„Gameplay Eventï¼ˆ<strong>ä¸æ˜¯Gameplay Effectçš„GEï¼</strong>ï¼‰æ—¶<strong>è°ƒç”¨ä¸€æ¬¡</strong>GAï¼Œæ­¤æ—¶Owner<strong>ä¸ä¼šæ‹¥æœ‰å¯¹åº”çš„Tag</strong>ã€‚</li>
<li>Owner Tag Added: å½“Owner<strong>è·å–å¯¹åº”Tag</strong>çš„æ—¶å€™<strong>è°ƒç”¨ä¸€æ¬¡</strong>GAã€‚</li>
<li>Owner Tag Present: å½“Owner<strong>æ‹¥æœ‰Tag</strong>æ—¶è°ƒç”¨GAï¼Œå¤±å»Tagæ—¶ç§»é™¤ã€‚</li>
</ul>
<p>ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå¹¶é…åˆSendGameplayEventToActorèŠ‚ç‚¹ä½¿ç”¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ï¼ˆè¿™å¼ å›¾æ˜¯å¾ˆä¹…ä»¥å‰æˆªçš„ï¼ŒTagå»ºè®®ä»¥Eventå¼€å¤´ï¼‰</p>
<div style="text-align: center;">
<img src="https://pica.zhimg.com/v2-0759f3f09591c5a808113d8841733b38_1440w.jpg" alt="img" style="zoom: 50%;" / width="50%" />
</div>

<p>å—å‡»æ•ˆæœçš„ä¾‹å­ï¼Œå‘é€ä¸€ä¸ªTagä¸ºHitçš„Eventç»™ç¢°æ’æ£€æµ‹åˆ°çš„Actor</p>
<p>ä½¿ç”¨Gameplay Eventè°ƒç”¨çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ä¼ å…¥æ•°æ®ï¼ˆPayloadï¼‰ï¼Œæ˜¯é™¤äº†Get Actor Infoå¤–çš„å¦ä¸€ç§ä¿¡æ¯ä¼ é€’æ–¹æ³•ã€‚</p>
<p>æ­¤æ—¶åº”è¯¥åˆ é™¤ActiveAbilityèŠ‚ç‚¹ï¼Œè½¬è€Œä½¿ç”¨ActivateAbilityFromEventäº‹ä»¶ã€‚ï¼ˆ<strong>ä¸è¦é€šè¿‡åœ¨å·¦ä¸Šè§’é‡è½½å‡½æ•°çš„æ–¹å¼ï¼Œå³é”®ç©ºç™½å¤„æœç´¢æ‰æ˜¯å¯¹çš„</strong>ï¼‰</p>
<h3 id="GEï¼šWhatæŠ€èƒ½æ”¹å˜çš„å±æ€§ï¼Ÿ"><a href="#GEï¼šWhatæŠ€èƒ½æ”¹å˜çš„å±æ€§ï¼Ÿ" class="headerlink" title="GEï¼šWhatæŠ€èƒ½æ”¹å˜çš„å±æ€§ï¼Ÿ"></a>GEï¼šWhatæŠ€èƒ½æ”¹å˜çš„å±æ€§ï¼Ÿ</h3><p>Gameplay Effectï¼ˆGEï¼‰æ˜¯Abilityå¯¹<strong>è‡ªå·±æˆ–ä»–äººäº§ç”Ÿå½±å“çš„é€”å¾„</strong>ã€‚<br>GEé€šå¸¸å¯ä»¥è¢«ç†è§£ä¸ºæˆ‘ä»¬æ¸¸æˆä¸­çš„buffã€‚æ¯”å¦‚å¢ç›Š&#x2F;å‡ç›Šæ•ˆæœï¼ˆä¿®æ”¹å±æ€§ï¼‰ã€‚<br>ä½†æ˜¯GASä¸­çš„GEä¹Ÿæ›´åŠ å¹¿ä¹‰ï¼Œé‡Šæ”¾æŠ€èƒ½æ—¶å€™çš„ä¼¤å®³ç»“ç®—ï¼Œæ–½åŠ ç‰¹æ®Šæ•ˆæœçš„æ§åˆ¶ã€éœ¸ä½“æ•ˆæœï¼ˆä¿®æ”¹GameplayTagï¼‰éƒ½æ˜¯é€šè¿‡GEæ¥å®ç°çš„ã€‚</p>
<ul>
<li><u>GEåªæ˜¯ä¸€ä¸ªå¯é…ç½®çš„*<em>æ•°æ®è¡¨</em> *</u>ï¼Œä¸å¯ä»¥æ·»åŠ é€»è¾‘ã€‚å¼€å‘è€…åˆ›å»ºä¸€ä¸ªUGameplayEffectçš„æ´¾ç”Ÿè“å›¾ï¼Œå°±å¯ä»¥æ ¹æ®éœ€æ±‚åˆ¶ä½œæƒ³è¦çš„æ•ˆæœã€‚</li>
<li>GEæ˜¯çº¯è“å›¾</li>
</ul>
<h3 id="GTï¼šifæŠ€èƒ½æ”¹å˜çš„æ¡ä»¶ï¼Ÿ"><a href="#GTï¼šifæŠ€èƒ½æ”¹å˜çš„æ¡ä»¶ï¼Ÿ" class="headerlink" title="GTï¼šifæŠ€èƒ½æ”¹å˜çš„æ¡ä»¶ï¼Ÿ"></a>GTï¼šifæŠ€èƒ½æ”¹å˜çš„æ¡ä»¶ï¼Ÿ</h3><p>FGameplayTagsæ˜¯ä¸€ç§å±‚çº§æ ‡ç­¾ï¼Œå¦‚Parent.Child.GrandChildã€‚<br>é€šè¿‡GameplayTagManagerè¿›è¡Œæ³¨å†Œã€‚<br>æ›¿ä»£äº†åŸæ¥çš„Boolï¼Œæˆ–Enumçš„ç»“æ„ï¼Œå¯ä»¥åœ¨ç©æ³•è®¾è®¡ä¸­æ›´é«˜æ•ˆçš„<strong>æ ‡è®°å¯¹è±¡çš„è¡Œä¸ºæˆ–çŠ¶æ€</strong>ï¼ˆæ¯”å¦‚ä¸€ä¸ªç¼çƒ§æ•ˆæœï¼ŒGEå®Œæˆä¹‹åï¼Œä¾¿å¯ä»¥å–æ¶ˆæ ‡ç­¾ï¼‰ã€‚<br>æˆ‘ç†è§£æ˜¯ä¸€ä¸ªåœ¨Actorä¸‹çš„Jsonã€‚</p>
<ul>
<li>Tagçš„<strong>å±‚çº§å…³ç³»</strong>ä¹Ÿéœ€è¦åˆç†è®¾è®¡ï¼Œåˆ°äº†åæœŸä¿®æ”¹æˆæœ¬æ¯”è¾ƒå¤§ã€‚</li>
</ul>
<h3 id="Attribute-Set"><a href="#Attribute-Set" class="headerlink" title="Attribute Set"></a>Attribute Set</h3><p>è´Ÿè´£å®šä¹‰å’ŒæŒæœ‰å±æ€§ï¼Œå¹¶ä¸”ç®¡ç†å±æ€§çš„<u>å˜åŒ–</u>ï¼ŒåŒ…æ‹¬<u>ç½‘ç»œåŒæ­¥</u>ã€‚<br>éœ€è¦åœ¨Actorä¸­è¢«æ·»åŠ ä¸ºæˆå‘˜å˜é‡ï¼Œå¹¶æ³¨å†Œåˆ°ASCï¼ˆC++ï¼‰ã€‚<br>ä¸€ä¸ªASCå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä¸åŒçš„ï¼‰AttributeSetï¼Œå› æ­¤å¯ä»¥è§’è‰²å…±äº«ä¸€ä¸ªå¾ˆå¤§çš„Attribute Setï¼Œä¹Ÿå¯ä»¥æ¯ä¸ªè§’è‰²æŒ‰éœ€æ·»åŠ Attribute Setã€‚<br>å¯ä»¥åœ¨å±æ€§å˜åŒ–å‰ï¼ˆPreAttributeChangeï¼‰åï¼ˆPostGameplayEffectExecuteï¼‰å¤„ç†ç›¸å…³é€»è¾‘ï¼Œå¯ä»¥é€šè¿‡å§”æ‰˜çš„æ–¹å¼ç»‘å®šå±æ€§å˜åŒ–ã€‚</p>
<h3 id="Player-State"><a href="#Player-State" class="headerlink" title="Player State"></a>Player State</h3><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/11/21/N17ULdln2Ako5cI.png" alt="Player State æ¶æ„ç¤ºæ„å›¾" width="50%" />
</div>
PlayerState æ˜¯ Unreal Engine ä¸­ç”¨äºå­˜å‚¨ç©å®¶ç›¸å…³ä¿¡æ¯çš„ç‰¹æ®Š Actor ç±»ã€‚åœ¨å¤šäººæ¸¸æˆä¸­ï¼ŒPlayerState ä¼šè‡ªåŠ¨åœ¨æœåŠ¡å™¨å’Œæ‰€æœ‰å®¢æˆ·ç«¯ä¹‹é—´å¤åˆ¶ï¼Œéå¸¸é€‚åˆå­˜å‚¨éœ€è¦è·¨ç½‘ç»œåŒæ­¥çš„ç©å®¶æ•°æ®ã€‚

<p>åœ¨ GAS ç³»ç»Ÿä¸­ï¼Œ<u>ASC å¯ä»¥é€‰æ‹©æŒ‚è½½åœ¨ PlayerState ä¸Šè€Œä¸æ˜¯ Character ä¸Š</u>ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li><strong>æŒä¹…æ€§</strong>ï¼šå½“è§’è‰²æ­»äº¡æˆ–é‡ç”Ÿæ—¶ï¼ŒPlayerState ä¾ç„¶å­˜åœ¨ï¼ŒæŠ€èƒ½å’Œå±æ€§æ•°æ®ä¸ä¼šä¸¢å¤±</li>
<li><strong>ç½‘ç»œå¤åˆ¶</strong>ï¼šPlayerState å¤©ç„¶æ”¯æŒç½‘ç»œå¤åˆ¶ï¼Œé€‚åˆå¤šäººæ¸¸æˆåœºæ™¯</li>
<li><strong>UI è®¿é—®</strong>ï¼šUI å¯ä»¥æ›´æ–¹ä¾¿åœ°è®¿é—®ç©å®¶çš„æŠ€èƒ½å’Œå±æ€§ä¿¡æ¯ï¼Œæ— éœ€ä¾èµ–å…·ä½“çš„ Character å®ä¾‹</li>
<li><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼šå³ä½¿ç©å®¶å¤„äºè§‚å¯Ÿè€…çŠ¶æ€ï¼ˆæ²¡æœ‰ Characterï¼‰ï¼Œä¹Ÿèƒ½ä¿æŒæŠ€èƒ½ç³»ç»Ÿçš„çŠ¶æ€</li>
</ul>
<p>å¸¸è§çš„åšæ³•æ˜¯ï¼š</p>
<ul>
<li><strong>ç©å®¶æ§åˆ¶çš„è§’è‰²</strong>ï¼šASC æ”¾åœ¨ PlayerState ä¸Š</li>
<li><strong>AI æ§åˆ¶çš„è§’è‰²</strong>ï¼šASC ç›´æ¥æ”¾åœ¨ Character ä¸Š</li>
</ul>
<h3 id="ç»„ä»¶æ€»ç»“"><a href="#ç»„ä»¶æ€»ç»“" class="headerlink" title="ç»„ä»¶æ€»ç»“"></a>ç»„ä»¶æ€»ç»“</h3><p>Visualï¼šæŠ€èƒ½çš„è§†è§‰æ•ˆæœï¼ŸGameplayCue<br>Asyncï¼šæŠ€èƒ½çš„é•¿æ—¶è¡ŒåŠ¨ï¼Ÿ(å¼‚æ­¥)GameplayTask<br>Sendï¼šæŠ€èƒ½çš„æ¶ˆæ¯äº‹ä»¶ï¼ŸGamePplayEvent<br>è¿™ä¿©æ˜¯åŒä¸€ä¸ªä¸œè¥¿</p>
<h3 id="å…¶ä»–èƒŒæ™¯æ¦‚å¿µ"><a href="#å…¶ä»–èƒŒæ™¯æ¦‚å¿µ" class="headerlink" title="å…¶ä»–èƒŒæ™¯æ¦‚å¿µ"></a>å…¶ä»–èƒŒæ™¯æ¦‚å¿µ</h3><h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h4><p>RPC &#x3D; Remote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚</p>
<p>åœ¨ UE ç½‘ç»œé‡Œï¼Œå®ƒçš„æ„æ€æ˜¯ï¼š</p>
<ul>
<li>ä½ åœ¨å®¢æˆ·ç«¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°çš„å®ç°ä¼šåœ¨æœåŠ¡å™¨æ‰§è¡Œï¼ˆServer RPCï¼‰ï¼›</li>
<li>æˆ–è€…åœ¨æœåŠ¡å™¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä½†å®ƒä¼šåœ¨æŸäº›&#x2F;æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œï¼ˆClient&#x2F;NetMulticast RPCï¼‰ã€‚</li>
</ul>
<p><strong>å®ƒæœ¬è´¨æ˜¯ï¼š</strong></p>
<ol>
<li>æŠŠâ€œå‡½æ•°å + å‚æ•°â€æ‰“åŒ…æˆä¸€æ®µç½‘ç»œæ¶ˆæ¯ï¼ˆé€šè¿‡ actor channelï¼‰</li>
<li>å‘é€åˆ°ç½‘ç»œå¯¹ç«¯</li>
<li>å¯¹ç«¯æ”¶åˆ°åï¼Œå†å»è°ƒç”¨å¯¹åº”çš„ _Implementation å‡½æ•°</li>
</ol>
<p><strong>RPC æˆåŠŸéœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š</strong></p>
<ul>
<li>ä½ è°ƒç”¨çš„å¯¹è±¡åœ¨ç½‘ç»œä¸Šâ€œæœ‰é€šé“&#x2F;å¯å‘é€â€ï¼ˆé€šå¸¸æ˜¯ Actor æˆ–æŒ‚åœ¨ Actor ä¸Šçš„ä¸œè¥¿ï¼‰</li>
<li>å¼•æ“çŸ¥é“è¿™æ¡ç½‘ç»œæ¶ˆæ¯åº”è¯¥å‘ç»™è°ï¼ˆæœåŠ¡å™¨ or æŸä¸ªå®¢æˆ·ç«¯ï¼‰</li>
</ul>
<h4 id="â€œè·¯ç”±â€-routing"><a href="#â€œè·¯ç”±â€-routing" class="headerlink" title="â€œè·¯ç”±â€(routing)"></a>â€œè·¯ç”±â€(routing)</h4><p>ä½ å¯ä»¥æŠŠâ€œè·¯ç”±â€ç†è§£æˆä¸€å¥è¯ï¼šè¿™æ¡ RPC æ¶ˆæ¯åˆ°åº•é€šè¿‡å“ªä¸ªç½‘ç»œè¿æ¥å‘å‡ºå»ï¼Ÿå‘ç»™è°ï¼Ÿå¼•æ“æ€ä¹ˆçŸ¥é“ï¼Ÿ<br>åœ¨ UE é‡Œï¼ŒRPC æœ€ç»ˆæ˜¯é  Actor çš„ç½‘ç»œè¿æ¥&#x2F;é€šé“å‘é€çš„ï¼ˆactor channel + owning connectionï¼‰ã€‚<br>è€Œ UTCGGameplayAbilityè¿™ç§ UObjectï¼ˆä¸æ˜¯ Actorï¼‰å®ƒè‡ªå·±æ²¡æœ‰ç½‘ç»œè¿æ¥ï¼Œå®ƒçš„ RPC éœ€è¦â€œå€Ÿé“â€</p>
<p>å€Ÿè°çš„é“ï¼Ÿ<br>ç­”æ¡ˆï¼šå€Ÿå®ƒæ‰€å±çš„&#x2F;å¯è¿½æº¯åˆ°çš„ Actor é€šé“ï¼ˆé€šå¸¸æ˜¯ ASC çš„ OwnerActor &#x2F; AvatarActor &#x2F; PlayerController è¿™æ¡é“¾ï¼‰ã€‚</p>
<p>æœ€å…¸å‹çš„å½’å±é“¾ï¼ˆå®¢æˆ·ç«¯ç©å®¶ï¼‰åº”è¯¥æ˜¯ï¼š<br>PlayerControllerï¼ˆæ‹¥æœ‰ç½‘ç»œè¿æ¥ owning connectionï¼‰<br>	ğŸ‘†owns Pawn&#x2F;Character<br>				ğŸ‘†Pawn ä¸Šæœ‰ ASCï¼ˆæˆ–è€… ASC çš„ OwnerActor æ˜¯ Pawn&#x2F;PlayerStateï¼‰<br>							ğŸ‘†Ability ä» ASC æ‹¿ ActorInfo</p>
<p>æ‰€ä»¥å½“ä½ åœ¨ Abilityï¼ˆUObjectï¼‰é‡Œè°ƒç”¨ Server RPC æ—¶ï¼ŒUE ä¼šå°è¯•æ²¿ç€ Ability çš„ ActorInfo æ‰¾åˆ°ï¼š<br>å“ªä¸ª Actor æœ‰ owning connectionï¼ˆé€šå¸¸æ˜¯ PlayerController æˆ–è¢«å®ƒæ‹¥æœ‰çš„ Pawnï¼‰å†é€šè¿‡é‚£æ¡è¿æ¥æŠŠ RPC å‘åˆ°æœåŠ¡å™¨ã€‚</p>
<h2 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h2><h3 id="å¼€å¯æ’ä»¶"><a href="#å¼€å¯æ’ä»¶" class="headerlink" title="å¼€å¯æ’ä»¶"></a>å¼€å¯æ’ä»¶</h3><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/PxXeVshqdbliFYQ.png" alt="image-20251027203033649" width="50%" />
  <img src="https://s2.loli.net/2025/10/29/TmQHkou6jg5PzSN.png" alt="image-20251027203540226" width="50%" />
</div>





<ol>
<li><u>C++é¡¹ç›®</u>ï¼Œå®‰è£…Gameplay Abilityæ’ä»¶ã€‚</li>
<li>åœ¨Toolsèœå•ä¸‹é¢æœ‰GameplayCue Editoræœ‰äº†ï¼Œå°±è¯´æ˜å¼€å¯æˆåŠŸäº†ã€‚</li>
<li>åœ¨æ–°å»ºçš„è“å›¾çš„é¡µé¢å¯ä»¥çœ‹åˆ°GamePlayç›¸å…³çš„ä¸œè¥¿</li>
</ol>
<h3 id="ä½¿ç”¨Riderå¿«é€Ÿæ·»åŠ Unrealç±»"><a href="#ä½¿ç”¨Riderå¿«é€Ÿæ·»åŠ Unrealç±»" class="headerlink" title="ä½¿ç”¨Riderå¿«é€Ÿæ·»åŠ Unrealç±»"></a>ä½¿ç”¨Riderå¿«é€Ÿæ·»åŠ Unrealç±»</h3><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/kqL2KOeURij69dr.png" alt="image-20251027215401030" width="50%" />
</div>

<p>é€šè¿‡è¿™é‡Œåˆ›å»ºä¸€ä¸ªCharacterã€‚å¯ä»¥å¿«é€Ÿæ‹¥æœ‰ä¸€äº›å¤´æ–‡ä»¶ã€‚</p>
<h3 id="ASCç»„ä»¶æ¶æ„"><a href="#ASCç»„ä»¶æ¶æ„" class="headerlink" title="ASCç»„ä»¶æ¶æ„"></a>ASCç»„ä»¶æ¶æ„</h3><div class="mermaid" style="background: white; border: 1px solid #e1e1e1; border-radius: 4px; padding: 20px;">
classDiagram
  class ACharacter
  class ARPGCharacterBase {
    +AbilitySystemComponent
  }
  class BP_Character {
    +å…¬å…±é€»è¾‘
  }
  class BP_PlayerCharacter {
    -ç»„è£…Cameraç­‰ç»„ä»¶
    -è¾“å…¥ç»‘å®š
  }
  class BP_NPCCharacter
  ACharacter <|-- ARPGCharacterBase
  ARPGCharacterBase <|-- BP_Character
  BP_Character <|-- BP_PlayerCharacter
  BP_Character <|-- BP_NPCCharacter
</div>

<p>ä½ éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªACharacterçš„C++ç±»ã€‚</p>
<p>ä¹‹åæƒ³ç”¨è“å›¾ï¼Œå°±ä»è¿™ä¸ªè‡ªå®šä¹‰çš„C++Characterç±»æ´¾ç”Ÿå°±å¯ä»¥äº†ã€‚ </p>
<h3 id="å†™ä¸€ä¸ªBase-GAS-ACharacteræ–‡ä»¶"><a href="#å†™ä¸€ä¸ªBase-GAS-ACharacteræ–‡ä»¶" class="headerlink" title="å†™ä¸€ä¸ªBase GAS ACharacteræ–‡ä»¶"></a>å†™ä¸€ä¸ªBase GAS ACharacteræ–‡ä»¶</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PublicDependencyModuleNames.AddRange(<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Core&quot;</span>, <span class="string">&quot;CoreUObject&quot;</span>, <span class="string">&quot;Engine&quot;</span>, <span class="string">&quot;InputCore&quot;</span>, <span class="string">&quot;EnhancedInput&quot;</span>,</span><br><span class="line">    <span class="string">&quot;GameplayAbilities&quot;</span>,<span class="string">&quot;GameplayTags&quot;</span>,<span class="string">&quot;GameplayTasks&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨Buildæ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹çš„å†…å®¹GameplayAbilitiesã€GameplayTagsã€GameplayTasksã€‚</p>
<p>åœ¨å¤´æ–‡ä»¶é‡Œé¢æ·»åŠ ä¸€ä¸ªAbilitySystemComponentï¼Œç›´æ¥åœ¨è§’è‰²ä¸ŠæŒ‚è½½ AbilitySystemComponentï¼ˆASCï¼‰ï¼Œå¯ä»¥é€‚é…å¤šäººæ¸¸æˆã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TObjectPtr&lt;UTCGAbilitySystemComponent&gt; AbilitySystemComponent;</span><br></pre></td></tr></table></figure>

<p>åœ¨.cppä¸­æ„é€ å‡½æ•°éƒ¨åˆ†å®ä¾‹åŒ–AbilitySystemComponentï¼ˆASCï¼‰ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹åŒ–ASC</span></span><br><span class="line">AbilitySystemComponent = <span class="built_in">CreateDefaultSubobject</span>&lt;UAbilitySystemComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;AbilitySystem&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>è§’è‰²ç±»ç»§æ‰¿IAbilitySystemInterfaceæ¥å£ï¼Œå¹¶å®ç°GetASCå‡½æ•°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemInterface.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ARPG_UNREAL_API</span> ACharacterBase : <span class="keyword">public</span> ACharacter, <span class="keyword">public</span> IAbilitySystemInterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">UAbilitySystemComponent* <span class="title">GetAbilitySystemComponent</span><span class="params">()</span><span class="type">const</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨CPPä¸­å®ç°</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UAbilitySystemComponent* <span class="title">ACharacterBase::GetAbilitySystemComponent</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AbilitySystemComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ‘†è¿™é‡Œçš„returnå³ä½¿å†™ä¸ºnullï¼Œä¹Ÿå¯èƒ½å¯èƒ½è°ƒç”¨</p>
<p><em>è¿™ä¸ªåœ¨é¡¹ç›®ä¸­çš„è·¯å¾„åœ¨ï¼šSource&#x2F;TCG_AwesomeLive&#x2F;CharacterSystem&#x2F;TCGCharacterBase.h</em></p>
<h3 id="æŠŠGAæ•°ç»„åŠ å…¥åˆ°Actorä¸­"><a href="#æŠŠGAæ•°ç»„åŠ å…¥åˆ°Actorä¸­" class="headerlink" title="æŠŠGAæ•°ç»„åŠ å…¥åˆ°Actorä¸­"></a>æŠŠGAæ•°ç»„åŠ å…¥åˆ°Actorä¸­</h3><p>å¯ä»¥å°†UEåŸç”Ÿçš„UGameplayAbilityç›´æ¥åŠ å…¥åˆ°éœ€è¦Abilityçš„Actorä¸­ï¼ˆä¹Ÿæ˜¯åŠ åˆ°è¿™ä¸ªBase GAS ACharacteræ–‡ä»¶ä¸­ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(BlueprintReadOnly, EditAnywhere, Category = <span class="string">&quot;Test|Abilities&quot;</span>)</span><br><span class="line">TArray&lt;TSubclassOf&lt;UGameplayAbility&gt;&gt; CharacterAbilities;</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨C++ä¸­èµ‹äºˆGA</strong>ï¼šæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬æ‰€æœ‰çš„æŠ€èƒ½å‚¨å­˜åœ¨ä¸€å¼ DAè¡¨ä¹‹ä¸­ï¼Œç„¶åä»DAè¡¨é‡Œè¯»å–æ•°æ®ï¼Œå¹¶ä½¿ç”¨AbilitySystemComponent-&gt;GiveAbilityå°†æ•°æ®èµ‹äºˆASCã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ èƒ½åŠ›</span></span><br><span class="line"><span class="keyword">for</span>(FTCGAblityInfo&amp; Info : AllAbilitiesInfo)&#123;</span><br><span class="line">    <span class="keyword">if</span> (Info.AbilityClass == <span class="literal">nullptr</span>)</span><br><span class="line">       <span class="keyword">continue</span>;</span><br><span class="line">    CharacterAbilities.<span class="built_in">Add</span>(Info.AbilityClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> StartupAbility : CharacterAbilities)</span><br><span class="line">&#123;</span><br><span class="line">    AbilitySystemComponent-&gt;<span class="built_in">GiveAbility</span>(</span><br><span class="line">       <span class="built_in">FGameplayAbilitySpec</span>(StartupAbility, <span class="number">1</span>, INDEX_NONE, <span class="keyword">this</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç»§æ‰¿äº†Base Characterçš„å­ç±»ä¸­ï¼Œçœ‹åˆ°Abilityçš„é€‰é¡¹äº†ã€‚</p>
<div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/KYsEzGVCQ1Ibwre.png" alt="image-20251028184812916" width="50%" />
</div>
èµ‹äºˆGAçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åœ¨éœ€è¦çš„è“å›¾ä¸­è°ƒç”¨<u>Give Ability</u>èŠ‚ç‚¹ã€‚è¿˜å¯ä»¥ä½¿ç”¨GEèµ‹äºˆGAã€‚

<p>åœ¨å®˜æ–¹çš„Lyraæ¡ˆä¾‹é‡Œé¢ä½¿ç”¨AbilitySetæ¥å‚¨å­˜ä¸€ç±»Abilityï¼Œé€šè¿‡åŠ è½½æ¥å®ç°èµ‹äºˆã€‚å‚çœ‹ä¸‹æ–‡Unrealå®˜æ–¹æ¡ˆä¾‹â€œèµ‹äºˆGAâ€éƒ¨åˆ†ã€‚</p>
<h2 id="Unrealå®˜æ–¹æ¡ˆä¾‹"><a href="#Unrealå®˜æ–¹æ¡ˆä¾‹" class="headerlink" title="Unrealå®˜æ–¹æ¡ˆä¾‹"></a>Unrealå®˜æ–¹æ¡ˆä¾‹</h2><p>UEä¸­æœ‰ä¸€ä¸ªéå¸¸ä¸é”™çš„å®˜æ–¹ç¤ºä¾‹<a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/lyra-sample-game-in-unreal-engine?application_version=5.0">Lyra</a>é‡Œé¢å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„GASç³»ç»Ÿã€‚</p>
<h3 id="é¡¹ç›®é‡Œçš„è®¾ç½®"><a href="#é¡¹ç›®é‡Œçš„è®¾ç½®" class="headerlink" title="é¡¹ç›®é‡Œçš„è®¾ç½®"></a>é¡¹ç›®é‡Œçš„è®¾ç½®</h3><div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/zWIduBsAxTriGkX.png" alt="image-20251111183652281" width="50%" />
</div>

<p>è¿™ä¸ªé¡¹ç›®é‡Œå¼€å‘è€…è®¾ç½®äº†ä¸€äº›è°ƒæ•´é€‰é¡¹ï¼Œå¯ä»¥è®¾å®šä¸€äº›debugçš„å‚æ•°ã€‚</p>
<p>æ¯”å¦‚å­å¼¹å°„å‡»åœç•™æ—¶é—´ï¼Œç”Ÿæˆçš„botçš„æ•°é‡ã€‚</p>
<h3 id="é¡¹ç›®è“å›¾å¸¸è§å‰ç¼€æ ‡è¯†"><a href="#é¡¹ç›®è“å›¾å¸¸è§å‰ç¼€æ ‡è¯†" class="headerlink" title="é¡¹ç›®è“å›¾å¸¸è§å‰ç¼€æ ‡è¯†"></a>é¡¹ç›®è“å›¾å¸¸è§å‰ç¼€æ ‡è¯†</h3><p><strong>WID_</strong><br>å…¨ç§°å¯ç†è§£ä¸º Weapon Item Definitionã€‚<br>ç”¨é€”ï¼šæ­¦å™¨ç±»çš„â€œç‰©å“å®šä¹‰â€è“å›¾èµ„äº§ï¼Œç»§æ‰¿è‡ª ULyraInventoryItemDefinitionï¼ˆä½ åœ¨ä»£ç é‡Œçœ‹åˆ°çš„åŸºç±»ï¼‰ã€‚<br><strong>ID_</strong><br>å¯ç†è§£ä¸ºï¼ˆGenericï¼‰Item Definitionã€‚<br>ç”¨é€”ï¼šéæ­¦å™¨çš„ä¸€èˆ¬ç‰©å“å®šä¹‰ï¼ˆæ¯”å¦‚æ¶ˆè€—å“ã€å¼¹è¯ã€åŒ…è£¹ã€å¯å †å èµ„æºç­‰ï¼‰ä¹Ÿç»§æ‰¿ ULyraInventoryItemDefinitionï¼Œç”¨ ID_ å‰ç¼€åŒºåˆ†ä¸ WID_ï¼ˆæ­¦å™¨ä¸“ç”¨ï¼‰èµ„äº§ã€‚<br><strong>B</strong>_<br>B_ å‰ç¼€åœ¨ Lyra ä¸­é€šå¸¸ä»£è¡¨ä¸€ä¸ª Blueprint ç±»èµ„äº§ï¼ˆç­‰åŒå¾ˆå¤šå›¢é˜Ÿå¸¸ç”¨çš„ BP_ï¼ŒLyra é¡¹ç›®é‡Œå–äº†æ›´çŸ­çš„ B_ï¼‰ã€‚</p>
<h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><ul>
<li>è¿™ä¸€éƒ¨åˆ†æˆ‘ä¸»è¦å‚è€ƒçš„æ˜¯<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1934717850632823338">è¿™é‡Œ</a>åŠ ä¸Šäº†ä¸€äº›æˆ‘è‡ªå·±çš„è¡¥å……ã€‚æ•´ä½“ç»“æ„é‡‡ç”¨äº†åŸæœ¬çš„ç»“æ„ï¼Œä½†æ˜¯æœ‰æˆ‘è‡ªå·±çš„åˆ å‡ï¼Œå¯ä»¥å¯¹ç…§åœ°çœ‹ã€‚</li>
</ul>
<h4 id="åˆå§‹åŒ–Ability-System"><a href="#åˆå§‹åŒ–Ability-System" class="headerlink" title="åˆå§‹åŒ–Ability System"></a>åˆå§‹åŒ–Ability System</h4><h5 id="åˆ›å»ºASC"><a href="#åˆ›å»ºASC" class="headerlink" title="åˆ›å»ºASC"></a>åˆ›å»ºASC</h5><p>ASCç”¨äºæ€»ä½“æ§åˆ¶GASåŠŸèƒ½ï¼Œå¯ä»¥æŒ‚åœ¨Characterä¸Šæˆ–è€…PlayerStateä¸Šï¼Œå¯¹äºè§’è‰²ä¼šæ­»äº¡é‡ç”Ÿçš„åœºæ™¯ï¼ŒæŒ‚åœ¨PlayerStateä¸Šæ›´åˆé€‚ï¼Œä¸ä¼šå› Characteré”€æ¯è€Œä¸¢å¤±æ•°æ®ã€‚å› æ­¤Lyraé€‰æ‹©æŠŠASCæŒ‚åœ¨äº†PlayerStateä¸Šï¼Œè¿™æ ·è¿˜æœ‰é¢å¤–ä½œç”¨ï¼Œå°±æ˜¯æŒ‰Tabé”®æ˜¾ç¤ºè®¡åˆ†æ¿è¿™ç§æˆ˜æ–—æ— å…³çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç”¨GAå®ç°ï¼Œä»¥å¾€çš„ä¹ æƒ¯éƒ½æ˜¯ç¡¬ç¼–ç ã€‚</p>
<p>ULyraAbilitySystemComponentæœ¬èº«æ˜¯ä¸€ä¸ªManagerï¼Œä¸æ•°æ®æ— å…³ï¼Œæ‰€ä»¥PlayerStateç›´æ¥Newäº†ä¸€ä¸ªå¯¹è±¡å³å¯ï¼š</p>
<blockquote>
<p>Source&#x2F;LyraGame&#x2F;GameModes&#x2F;LyraGameState.h&#x2F;cpp</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å£°æ˜</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(VisibleAnywhere, Category = <span class="string">&quot;Lyra|PlayerState&quot;</span>)</span><br><span class="line">TObjectPtr&lt;ULyraAbilitySystemComponent&gt; AbilitySystemComponent;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»º</span></span><br><span class="line">AbilitySystemComponent = ObjectInitializer.<span class="built_in">CreateDefaultSubobject</span>&lt;ULyraAbilitySystemComponent&gt;(<span class="keyword">this</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;AbilitySystemComponent&quot;</span>));</span><br><span class="line">AbilitySystemComponent-&gt;<span class="built_in">SetIsReplicated</span>(<span class="literal">true</span>);</span><br><span class="line">AbilitySystemComponent-&gt;<span class="built_in">SetReplicationMode</span>(EGameplayEffectReplicationMode::Mixed);</span><br></pre></td></tr></table></figure>

<h5 id="ASCé‡Œé¢ä¹Ÿä¼šè®°å½•Actor"><a href="#ASCé‡Œé¢ä¹Ÿä¼šè®°å½•Actor" class="headerlink" title="ASCé‡Œé¢ä¹Ÿä¼šè®°å½•Actor"></a>ASCé‡Œé¢ä¹Ÿä¼šè®°å½•Actor</h5><blockquote>
<p>Plugins&#x2F;Runtime&#x2F;GameplayAbilities&#x2F;Source&#x2F;GameplayAbilities&#x2F;Public&#x2F;AbilitySystemComponent.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The actor that owns this component logically */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_OwningActor)</span><br><span class="line">    TObjectPtr&lt;AActor&gt; OwnerActor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The actor that is the physical representation used for abilities. Can be NULL */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_OwningActor)</span><br><span class="line">    TObjectPtr&lt;AActor&gt; AvatarActor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Cached off data about the owning actor that abilities will need to frequently access (movement component, mesh component, anim instance, etc) */</span></span><br><span class="line">    TSharedPtr&lt;FGameplayAbilityActorInfo&gt;  AbilityActorInfo;</span><br></pre></td></tr></table></figure>

<p>ASCä¹Ÿä¼šè®°å½•å…³è”Actorçš„ä¿¡æ¯ï¼š</p>
<p><strong>OwnerActor</strong>æŒ‚åœ¨å“ªä¸ªActorä¸Šï¼Œè¿™é‡Œæ˜¯PlayerStateï¼›</p>
<p><strong>AvatarActor</strong>æ˜¯ä½¿ç”¨Abilityå®ä½“ï¼Œè¿™é‡Œæ˜¯Characterã€‚</p>
<p>è¿™ä¸¤ä¸ªå±æ€§æ˜¯ASCç»å¸¸è¦è·å–çš„å˜é‡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¤šä¸ªä¸Actorå…³è”çš„å±æ€§ä¼šè¢«é«˜é¢‘è¯»å–ï¼Œä¸ºäº†æé«˜è¯»å–æ€§èƒ½ï¼ŒASCç´¢æ€§æŠŠå®ƒä»¬å¤åˆ¶äº†ä¸€ä»½ï¼Œé›†ä¸­å­˜å‚¨åœ¨<strong>AbilityActorInfo</strong>å˜é‡ä¸­ï¼ŒåŒ…æ‹¬äº†PlayerControllerï¼ŒSkeletalMeshComponentï¼ŒAnimInstanceï¼ŒMovementComponentï¼ŒAffectedAnimInstanceTagã€‚</p>
<h5 id="èµ‹äºˆGAï¼ˆå‰å»ºç«‹Experienceåšæ•°æ®è¡”æ¥ï¼‰"><a href="#èµ‹äºˆGAï¼ˆå‰å»ºç«‹Experienceåšæ•°æ®è¡”æ¥ï¼‰" class="headerlink" title="èµ‹äºˆGAï¼ˆå‰å»ºç«‹Experienceåšæ•°æ®è¡”æ¥ï¼‰"></a>èµ‹äºˆGAï¼ˆå‰å»ºç«‹Experienceåšæ•°æ®è¡”æ¥ï¼‰</h5><p>åˆ›å»ºå®ŒASCåï¼Œè¦å¾€è¿™ä¸ªå®¹å™¨é‡Œèµ‹äºˆGAäº†ï¼Œè¡¨ç¤ºActoræœ‰è¿™äº›èƒ½åŠ›ã€‚</p>
<p>Lyraå·¥ç¨‹é«˜åº¦æ¨¡å—åŒ–ï¼Œé…ç½®æ¯”è¾ƒåˆ†æ•£ï¼Œä½¿ç”¨AbilitySetæ¥å‚¨å­˜ä¸€ç±»Abilityï¼Œé€šè¿‡åŠ è½½æ¥å®ç°è‡ªåŠ¨åŒ–é…ç½®å’Œèµ‹äºˆGAã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªExperienceï¼Œ<u>é¦–å…ˆä»€ä¹ˆæ˜¯Experienceï¼Ÿ</u></p>
<ul>
<li><p>å®šä¹‰è§’è‰²ï¼š Experienceï¼ˆé€šè¿‡ ULyraExperienceDefinitionï¼‰æŠŠä¸€ç»„è¿è¡Œæ—¶è¡Œä¸ºã€èµ„æºå’Œè§„åˆ™æ‰“åŒ…æˆä¸€ä¸ªå¯åˆ‡æ¢çš„ä½“éªŒï¼ˆä¾‹å¦‚ä¸åŒæ¨¡å¼ã€åœ°å›¾æˆ–ç©æ³•é…ç½®ï¼‰ã€‚</p>
</li>
<li><p>ä¸»è¦ç”¨é€”ï¼šåœ¨æ¸¸æˆå¯åŠ¨æˆ–åˆ‡æ¢ä½“éªŒæ—¶å‘Šè¯‰å¼•æ“â€œè¦å¯ç”¨å“ªäº› GameFeaturesã€é»˜è®¤çš„ Pawn æ•°æ®ã€ä»¥åŠéœ€è¦æ‰§è¡Œå“ªäº›åŠ¨ä½œ&#x2F;èµ‹èƒ½â€</p>
</li>
<li><p>åŸå› </p>
<ul>
<li>ç»Ÿä¸€é…ç½®ä¸å¯åˆ‡æ¢æ€§ï¼šæŠŠè°ƒè¡¨ï¼ˆæŠ€èƒ½ã€æ•ˆæœã€é»˜è®¤ pawn ç­‰ï¼‰æ”¾åˆ° Experience é‡Œï¼Œä¾¿äºåœ¨ä¸åŒç©æ³•&#x2F;æ¨¡å¼é—´åˆ‡æ¢å’Œå¤ç”¨ï¼Œä¸ç”¨æŠŠèƒ½åŠ›å†™æ­»åœ¨ä»£ç é‡Œã€‚</li>
<li>æ•°æ®é©±åŠ¨ä¸å»¶è¿ŸåŠ è½½ï¼šExperience å¯ä»¥åœ¨è¿è¡Œæ—¶å¯&#x2F;åœ GameFeaturesã€æ³¨å…¥èµ„æºï¼Œå†æŠŠéœ€è¦çš„èƒ½åŠ›&#x2F;æ•ˆæœæ‰¹é‡ä¸‹å‘ã€‚</li>
<li>ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸå¯æ§ï¼šé€šè¿‡ Experience å¯ä»¥åœ¨å¯ç”¨æ—¶æˆäºˆã€åœç”¨æ—¶æ’¤é”€ï¼Œæ–¹ä¾¿æ•´ä½“ç®¡ç†å’Œçƒ­åŠ è½½ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>(BlueprintType, Const)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ULyraExperienceDefinition</span> : <span class="keyword">public</span> UPrimaryDataAsset</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category = Gameplay)</span><br><span class="line">    TArray&lt;FString&gt; GameFeaturesToEnable;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category=Gameplay)</span><br><span class="line">    TObjectPtr&lt;<span class="type">const</span> ULyraPawnData&gt; DefaultPawnData;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Instanced, Category=<span class="string">&quot;Actions&quot;</span>)</span><br><span class="line">    TArray&lt;TObjectPtr&lt;UGameFeatureAction&gt;&gt; Actions;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category=Gameplay)</span><br><span class="line">    TArray&lt;TObjectPtr&lt;ULyraExperienceActionSet&gt;&gt; ActionSets;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¦‚å›¾Lyraçš„ç»“æ„ã€‚</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/jlbEy7vf4z2D6xF.png" alt="image-20251111172739503" width="50%" />
</div>

<p>ç»§æ‰¿è‡ªULyraExperienceDefinitionçš„ï¼šB_BasicShooterTestB_BasicShooterTestè¿™ä¸ªæ•°æ®ç±»é‡Œçš„Actionåˆ†ç»„é‡Œé¢ï¼Œæœ‰éœ€è¦æˆäºˆçš„GAçš„DAè¡¨ã€‚</p>
<p>æ¯”å¦‚ï¼š**AbilitySet_<strong>Eliminationï¼ˆä¸‹é¢é‚£ä¸ªï¼‰ å’Œ HeroData_ShooterGameé‡Œé¢çš„</strong>AbilitySet_**ShooterHeroã€‚</p>
<ul>
<li>é¦–å…ˆçœ‹AbilitySet_Elimination  DAè¡¨ï¼ˆå®ƒç»§æ‰¿è‡ªLyraAbilitySetï¼‰ã€‚</li>
</ul>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/khSfJeNB3I5Fvcq.png" alt="image-20251111171556976" width="50%" />
</div>

<p>  æ‰“å¼€è¿™ä¸ªAbilitySet_Eliminationï¼Œé‡Œé¢åŒ…å«ä¸¤ä¸ªGAã€‚<br>  GA_ShowLeaderboard_TDMç”¨äºæŒ‰Tabæ˜¾ç¤ºè®¡åˆ†æ¿ã€‚<br>  GA_AutoRespawnç”¨äºæ­»äº¡å¤æ´»ï¼Œè¿™ä¸¤ä¸ªGAä¸Characteræˆ˜æ–—æ— å…³ï¼Œåœ¨æ²¡ç”¨Characteræ—¶ä¹Ÿèƒ½æ‰§è¡Œã€‚</p>
<ul>
<li>ç„¶åçœ‹AbilitySet_ShooterPistol DAè¡¨ï¼ˆå‚¨å­˜åœ¨æ€»è¡¨çš„HeroData_ShooterGameé‡Œé¢ å®ƒç»§æ‰¿è‡ªULyraPawnDataï¼‰</li>
</ul>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/abXfUKiehOG3lHs.png" alt="image-20251111174500121" width="50%" />
</div>

<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/4Zt68goQNHmdsOk.png" alt="AbilitySet_ShooterHero" width="50%" />
</div>

<p>  åŒ…å«Characterç›¸å…³çš„GAï¼Œæ•°é‡è¾ƒå¤šã€‚æ¯”å¦‚GA_Hero_Jumpå®ç°äº†è·³è·ƒï¼ŒGA_Emoteå®ç°äº†è·³èˆã€‚</p>
<ul>
<li>ç„¶åè¿˜æœ‰ä¸€ä¸ªAbilitySet_ShooterPisto</li>
</ul>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/ls8hrwJVOjfkMZF.png" alt="image-20251111181356512" width="50%" />
</div>

<p>  å®ƒä¸æ˜¯å®šä¹‰åœ¨B_BasicShooterTestB_BasicShooterTestè¿™å¼ å¤§è¡¨é‡Œé¢çš„ã€‚</p>
<p>  è€Œæ˜¯é€šè¿‡WID_Pistolè¢«å…·ä½“çš„è“å›¾è°ƒç”¨ã€‚</p>
<p>ç„¶åå¯¹æ¯ä¸ªGAï¼Œè°ƒç”¨UAbilitySystemComponent::GiveAbilityå‡½æ•°è¿›è¡Œèµ‹äºˆã€‚</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/Je2w7BSxbQEapTV.png" alt="image-20251111185235151" style="zoom:25%;" / width="50%" />
</div>

<p>ä¼šåœ¨å¾ˆå¤šåœ°æ–¹è°ƒç”¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FGameplayAbilitySpecHandle <span class="title">UAbilitySystemComponent::GiveAbility</span><span class="params">(<span class="type">const</span> FGameplayAbilitySpec&amp; Spec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ABILITYLIST_SCOPE_LOCK</span>();</span><br><span class="line">    FGameplayAbilitySpec&amp; OwnedSpec = ActivatableAbilities.Items[ActivatableAbilities.Items.<span class="built_in">Add</span>(Spec)];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (OwnedSpec.Ability-&gt;<span class="built_in">GetInstancingPolicy</span>() == EGameplayAbilityInstancingPolicy::InstancedPerActor)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment">// Create the instance at creation time</span></span><br><span class="line">       <span class="built_in">CreateNewInstanceOfAbility</span>(OwnedSpec, Spec.Ability);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">OnGiveAbility</span>(OwnedSpec);</span><br><span class="line">    <span class="built_in">MarkAbilitySpecDirty</span>(OwnedSpec, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UE_LOG</span>(LogAbilitySystem, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: GiveAbility %s [%s] Level: %d Source: %s&quot;</span>), *<span class="built_in">GetNameSafe</span>(<span class="built_in">GetOwner</span>()), *<span class="built_in">GetNameSafe</span>(Spec.Ability), *Spec.Handle.<span class="built_in">ToString</span>(), Spec.Level, *<span class="built_in">GetNameSafe</span>(Spec.SourceObject.<span class="built_in">Get</span>()));</span><br><span class="line">    <span class="built_in">UE_VLOG</span>(<span class="built_in">GetOwner</span>(), VLogAbilitySystem, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;GiveAbility %s [%s] Level: %d Source: %s&quot;</span>), *<span class="built_in">GetNameSafe</span>(Spec.Ability), *Spec.Handle.<span class="built_in">ToString</span>(), Spec.Level, *<span class="built_in">GetNameSafe</span>(Spec.SourceObject.<span class="built_in">Get</span>()));</span><br><span class="line">    <span class="keyword">return</span> OwnedSpec.Handle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å‚æ•°ä¸ºFGameplayAbilitySpecï¼Œè¡¨ç¤ºâ€œè¿™æ¬¡èµ‹äºˆâ€çš„æè¿°ä¿¡æ¯ã€‚</p>
<p>ä¸ä»…åŒ…å«è¿™æ¬¡èµ‹äºˆçš„æè¿°ä¿¡æ¯ï¼Œæ¯”å¦‚GAçš„Classï¼ŒæŒ‡å®šGAçš„ç­‰çº§ï¼ŒGAç»‘å®šçš„è¾“å…¥Tagã€‚è€Œä¸”ä¹Ÿæ˜¯GAåœ¨ASCä¸Šçš„runtimeè¡¨ç¤ºï¼Œæœ‰å¾ˆå¤šruntimeä¿¡æ¯ã€‚æ¯ä¸ªSpecéƒ½æœ‰å”¯ä¸€çš„IDï¼Œç§°ä¸ºHandleï¼Œé€šè¿‡è‡ªå¢èµ‹äºˆï¼Œå„ç³»ç»Ÿé—´Specçš„ä¼ é€’éƒ½é€šè¿‡Handleå®ç°ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯Spec.SourceObjectå±æ€§ï¼Œè¡¨ç¤ºè¿™ä¸ªGAæ‰€å…³è”çš„æœ€â€œå¯†åˆ‡â€çš„Objectï¼Œåœ¨åˆ›å»ºæ—¶ç”±æˆ‘ä»¬æŒ‡å®šã€‚<br>æ¯”å¦‚GA_Weapon_Fire_Pistolï¼Œæ˜¯æªå¼€ç«çš„GAï¼ŒSourceObjectå°±æ˜¯æ­¦å™¨B_WeaponInstance_Pistolï¼›<br>GA_Hero_Jumpæ˜¯è§’è‰²è·³è·ƒçš„GAï¼ŒSourceObejctå°±æ˜¯Characterï¼›<br>GA_ShowLeaderboard_TDMåˆ™æ˜¯ä¸æˆ˜æ–—æ— å…³çš„æ‰“å¼€è®¡åˆ†æ¿çš„GAï¼ŒOurceObjectå°±æ˜¯PlayerStatã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">USTRUCT(BlueprintType)</span><br><span class="line">struct GAMEPLAYABILITIES_API FGameplayAbilitySpec : public FFastArraySerializerItem</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_USTRUCT_BODY()</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    UPROPERTY(NotReplicated)</span><br><span class="line">    TArray&lt;TObjectPtr&lt;UGameplayAbility&gt;&gt; NonReplicatedInstances;</span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">    TArray&lt;TObjectPtr&lt;UGameplayAbility&gt;&gt; ReplicatedInstances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ—¶ï¼Œé¦–å…ˆæŠŠSpecåŠ å…¥åˆ°ActivatableAbilitiesæ•°ç»„ä¸­ï¼Œç„¶åæ ¹æ®Policyåˆ›å»ºä¸€ä¸ªGAçš„å®ä¾‹ï¼Œé»˜è®¤çš„InstancedPerActoræ˜¯è¦åˆ›å»ºçš„ã€‚åˆ›å»ºå®Œæˆåï¼Œå¦‚æœGAè®¾ç½®ä¸ºç½‘ç»œåŒæ­¥ï¼Œå°±åŠ å…¥åˆ°Spec.ReplicatedInstancesä¸­ï¼Œå¦åˆ™åŠ å…¥Spec.NonReplicatedInstancesã€‚</p>
<h5 id="æ³¨å†ŒTrigger"><a href="#æ³¨å†ŒTrigger" class="headerlink" title="æ³¨å†ŒTrigger"></a>æ³¨å†ŒTrigger</h5><p>GAå¯ä»¥ç»‘å®šä¸€äº›Triggerï¼Œå®é™…æ˜¯Tagï¼Œå½“å‘å‡ºGamePlayEventï¼Œå¹¶æŒ‡å®šå¯¹åº”Tagåï¼Œå°±èƒ½æ¿€æ´»GAäº†ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œçš„Tagä¸ºäº†æ›´æ–¹ä¾¿åšåˆ¤æ–­å…·ä½“çš„GAã€‚</p>
<ul>
<li>é¦–å…ˆæ˜¯InputTagï¼Œå®ƒæœ¬èº«éGASæ¡†æ¶å†…çš„ï¼Œæ˜¯Lyraè‡ªå·±åšçš„ä¸€å¥—è¾“å…¥å’ŒGAçš„æ˜ å°„ã€‚InputTagåœ¨AbilitySetä¸­æŒ‡å®š</li>
</ul>
<p><img src="https://s2.loli.net/2025/11/21/DQgqibLETr14JHR.png" alt="image-20251111191635777">AbilitySet_ShooterPisto</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/FAmWtpUSy94lQez.png" alt="image-20251111191708052" width="50%" />
</div>

<p>AbilitySet_ShooterPistol </p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/1yWC6gVZHb38UPz.png" alt="image-20251111191718509" width="50%" />
</div>

<p>AbilitySet_ShooterPisto</p>
<p>åˆ›å»ºSpecæ—¶ä¼šæŠŠInputTagæ·»åŠ åˆ°å…¶DynamicSpecSourceTagsï¼ŒDynamicSpecSourceTagsæ˜¯ä¸€ä¸ªé€šç”¨Tagå®¹å™¨ã€‚<br>è¯¥Tagsåœ¨ç»“æ„ä½“FGameplayAbilitySpecé‡Œé¢ï¼Œ<u>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªFGameplayAbilitySpecä»£è¡¨çš„æ˜¯ä¼ é€’çš„ä¸€ä¸ªAbilityçš„èƒ½åŠ›ï¼Œç„¶åé‡Œé¢æœ‰å¾ˆå¤šDynamicAbilityTags</u>ã€‚</p>
<p>æ³¨å†Œçš„è·¯å¾„å¦‚ä¸‹ï¼š</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/AzSXP7UNWFsfot1.png" alt="image-20251111205815528" width="50%" />
</div>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ULyraAbilitySet::GiveToAbilitySystem</span><span class="params">(ULyraAbilitySystemComponent* LyraASC, FLyraAbilitySet_GrantedHandles* OutGrantedHandles, UObject* SourceObject)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Grant the attribute sets.</span></span><br><span class="line">    <span class="keyword">for</span> (int32 SetIndex = <span class="number">0</span>; SetIndex &lt; GrantedAttributes.<span class="built_in">Num</span>(); ++SetIndex)</span><br><span class="line">    &#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grant the gameplay abilities.</span></span><br><span class="line">    <span class="keyword">for</span> (int32 AbilityIndex = <span class="number">0</span>; AbilityIndex &lt; GrantedGameplayAbilities.<span class="built_in">Num</span>(); ++AbilityIndex)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="type">const</span> FLyraAbilitySet_GameplayAbility&amp; AbilityToGrant = GrantedGameplayAbilities[AbilityIndex];</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!<span class="built_in">IsValid</span>(AbilityToGrant.Ability))</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="built_in">UE_LOG</span>(LogLyraAbilitySystem, Error, <span class="built_in">TEXT</span>(<span class="string">&quot;GrantedGameplayAbilities[%d] on ability set [%s] is not valid.&quot;</span>), AbilityIndex, *<span class="built_in">GetNameSafe</span>(<span class="keyword">this</span>));</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       ULyraGameplayAbility* AbilityCDO = AbilityToGrant.Ability-&gt;<span class="built_in">GetDefaultObject</span>&lt;ULyraGameplayAbility&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="function">FGameplayAbilitySpec <span class="title">AbilitySpec</span><span class="params">(AbilityCDO, AbilityToGrant.AbilityLevel)</span></span>;</span><br><span class="line">       AbilitySpec.SourceObject = SourceObject;</span><br><span class="line">       AbilitySpec.<span class="built_in">GetDynamicSpecSourceTags</span>().<span class="built_in">AddTag</span>(AbilityToGrant.InputTag);</span><br><span class="line"></span><br><span class="line">       <span class="type">const</span> FGameplayAbilitySpecHandle AbilitySpecHandle = LyraASC-&gt;<span class="built_in">GiveAbility</span>(AbilitySpec);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (OutGrantedHandles)</span><br><span class="line">       &#123;</span><br><span class="line">          OutGrantedHandles-&gt;<span class="built_in">AddAbilitySpecHandle</span>(AbilitySpecHandle);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grant the gameplay effects.</span></span><br><span class="line">    <span class="keyword">for</span> (int32 EffectIndex = <span class="number">0</span>; EffectIndex &lt; GrantedGameplayEffects.<span class="built_in">Num</span>(); ++EffectIndex)</span><br><span class="line">    &#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆäºˆASC Abilityçš„æ—¶å€™ï¼Œå°†Tags Effectç­‰ä¿¡æ¯ä¸€å¹¶ä¼ å…¥ã€‚</p>
<p>æˆäºˆGAçš„é€»è¾‘ï¼Œä»¥ä¸Šå°±æ˜¯æœåŠ¡å™¨åˆå§‹åŒ–ASCå¹¶èµ‹äºˆGAçš„å…¨éƒ¨è¿‡ç¨‹ã€‚</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/4H9xKOcQBbezAFY.png" alt="image-20251111210326498" width="50%" />
</div>



<h4 id="åŒæ­¥å®¢æˆ·ç«¯"><a href="#åŒæ­¥å®¢æˆ·ç«¯" class="headerlink" title="åŒæ­¥å®¢æˆ·ç«¯"></a>åŒæ­¥å®¢æˆ·ç«¯</h4><h5 id="ASC"><a href="#ASC" class="headerlink" title="ASC"></a>ASC</h5><p>é¦–å…ˆï¼ŒASCä½œä¸ºä¸€ä¸ªComponentæŒ‚åœ¨PlayerStateä¸Šï¼Œæ˜¯å¯ä»¥åŒæ­¥çš„ã€‚</p>
<p>ç”±äºAvatarActoræ˜¯Characterï¼Œå› æ­¤OwnerActorå’ŒAvatarActorçš„æœ€ç»ˆè®¾ç½®ï¼Œéœ€è¦å®¢æˆ·ç«¯çš„Characteråˆ›å»ºåæ‰èƒ½æ‰§è¡Œã€‚</p>
<p>å…·ä½“ä¸ºCharacteråˆ›å»ºåï¼Œè§¦å‘LyraHeroComponentçš„åŠ è½½èµ„æºæµç¨‹ï¼Œå½“åŠ è½½å®Œæˆå¹¶ä¸”å®¢æˆ·ç«¯è·å–åˆ°PlayerStateåï¼Œå°±æŠŠå½“å‰é˜¶æ®µè®¾ç½®ä¸ºDataAvailabeï¼Œå¹¶æœ€ç»ˆè®¾ç½®OwnerActorå’ŒAvatarActorã€‚</p>
<h5 id="GASpec"><a href="#GASpec" class="headerlink" title="GASpec"></a>GASpec</h5><p>Specå­˜äºActivatableAbilitieså®¹å™¨ä¸­ï¼Œæœ¬èº«æ˜¯FastArrayï¼Œæ ‡è®°äº†Replicatedï¼Œå¯æ­£å¸¸ç½‘ç»œåŒæ­¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_ActivateAbilities, BlueprintReadOnly, Transient, Category = <span class="string">&quot;Abilities&quot;</span>)</span><br><span class="line">FGameplayAbilitySpecContainer ActivatableAbilities;</span><br></pre></td></tr></table></figure>

<p>SpecåŒæ­¥åˆ°å®¢æˆ·ç«¯åï¼ŒFastArrayä¼šè§¦å‘FGameplayAbilitySpec::PostReplicatedAdd()æ–¹æ³•ï¼Œé‡Œé¢å†å’ŒæœåŠ¡å™¨åŒæ ·çš„UAbilitySystemComponent::OnGiveAbility()æ–¹æ³•æ¥æ³¨å†ŒSpecã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FGameplayAbilitySpec::PostReplicatedAdd</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> FGameplayAbilitySpecContainer&amp; InArraySerializer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (InArraySerializer.Owner)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        InArraySerializer.Owner-&gt;<span class="built_in">OnGiveAbility</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸åŒæ­¥ä½†InstancedPerActorçš„GAï¼Œä¼šåœ¨æ­¤æ—¶åˆ›å»ºå®ä¾‹ï¼ŒåŠ å…¥åˆ°NonReplicatedInstancesæ•°ç»„ï¼Œç„¶åå†æ³¨å†ŒAbilityTriggersã€‚</p>
<h5 id="Specçš„GAå®ä¾‹"><a href="#Specçš„GAå®ä¾‹" class="headerlink" title="Specçš„GAå®ä¾‹"></a>Specçš„GAå®ä¾‹</h5><p>é¦–å…ˆï¼ŒGAå®ä¾‹åªåŒæ­¥ç»™Autonomouså®¢æˆ·ç«¯ï¼Œä¸ä¼šåŒæ­¥ç»™SimulateProxyã€‚ç„¶åï¼Œä¼šæŠŠGAå®ä¾‹ä½œä¸ºASCçš„SubObjectè¿›è¡ŒåŒæ­¥ï¼Œè¿™æ˜¯SubObjectåŒæ­¥æ˜¯UEè‡ªèº«æ”¯æŒçš„æœºåˆ¶ã€‚</p>
<p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒæ­¥GA</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAbilitySystemComponent::AddReplicatedInstancedAbility</span><span class="params">(UGameplayAbility* GameplayAbility)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="type">const</span> ELifetimeCondition LifetimeCondition = bReplicateAbilitiesToSimulatedProxies ? COND_None : COND_ReplayOrOwner;</span><br><span class="line">    <span class="built_in">AddReplicatedSubObject</span>(GameplayAbility, LifetimeCondition);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//SubObjectåŒæ­¥</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UActorComponent::AddReplicatedSubObject</span><span class="params">(UObject* SubObject, ELifetimeCondition NetCondition)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (AActor* MyOwner=<span class="built_in">GetOwner</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        MyOwner-&gt;<span class="built_in">AddActorComponentReplicatedSubObject</span>(<span class="keyword">this</span>, SubObject, NetCondition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ­¥åˆ°å®¢æˆ·ç«¯åè¡¨ç°å¦‚ä¸‹ï¼š</p>
<div style="text-align: center;">
<img src="https://pic2.zhimg.com/v2-64548e8ebc3b26b89cb095f2c552d39d_1440w.jpg" alt="img" width="50%" />
</div>



<h2 id="å¸¸ç”¨è°ƒæ•´å‘½ä»¤è¡Œ"><a href="#å¸¸ç”¨è°ƒæ•´å‘½ä»¤è¡Œ" class="headerlink" title="å¸¸ç”¨è°ƒæ•´å‘½ä»¤è¡Œ"></a>å¸¸ç”¨è°ƒæ•´å‘½ä»¤è¡Œ</h2><p>ShowDebug AbilitySystem å±•ç¤ºAbilityç›¸å…³çš„å†…å®¹</p>
<h2 id="è‡ªå·±å®ç°æ–¹æ¡ˆ"><a href="#è‡ªå·±å®ç°æ–¹æ¡ˆ" class="headerlink" title="è‡ªå·±å®ç°æ–¹æ¡ˆ"></a>è‡ªå·±å®ç°æ–¹æ¡ˆ</h2><h3 id="é€šè¿‡è‡ªå®šä¹‰GAå®ç°å¤æ‚å‚æ•°GASä¼ é€’"><a href="#é€šè¿‡è‡ªå®šä¹‰GAå®ç°å¤æ‚å‚æ•°GASä¼ é€’" class="headerlink" title="é€šè¿‡è‡ªå®šä¹‰GAå®ç°å¤æ‚å‚æ•°GASä¼ é€’"></a>é€šè¿‡è‡ªå®šä¹‰GAå®ç°å¤æ‚å‚æ•°GASä¼ é€’</h3><h4 id="æ¨¡å—ä¸åˆ†å±‚ï¼ˆç»“æ„å›¾ï¼‰"><a href="#æ¨¡å—ä¸åˆ†å±‚ï¼ˆç»“æ„å›¾ï¼‰" class="headerlink" title="æ¨¡å—ä¸åˆ†å±‚ï¼ˆç»“æ„å›¾ï¼‰"></a>æ¨¡å—ä¸åˆ†å±‚ï¼ˆç»“æ„å›¾ï¼‰</h4><p>å®ƒå¯ä»¥ç›´æ¥ä»UIå±‚è°ƒç”¨ã€‚ä¸”ä¸€ä¸ªGAå¯ä»¥åšå¤šä¸ªäº‹æƒ…ã€‚æœ‰å›è°ƒå›UIã€‚</p>
<p>ä¸»è¦å…³é”®å­—ï¼šGASçš„é€»è¾‘ é€šè¿‡åˆ›å»ºå­GAè“å›¾ é€šè¿‡è“å›¾è¢«experienceç®¡ç† ç„¶åè¢«GASè§¦å‘ é€šè¿‡RPCä¼ é€’å¤æ‚çš„è®¾ç½®å‚æ•° ServerOnlyåˆ›å»ºActor ç„¶åé€šè¿‡Replicatedèµ‹å€¼å±æ€§å›å®¢æˆ·ç«¯ï¼‰</p>
<p><img src="C:\Users\Eugene\AppData\Roaming\Typora\typora-user-images\image-20260121160114457.png" alt="image-20260121160114457"></p>
<h4 id="é€šç”¨å±‚ï¼ˆå¯å¤ç”¨ï¼‰"><a href="#é€šç”¨å±‚ï¼ˆå¯å¤ç”¨ï¼‰" class="headerlink" title="é€šç”¨å±‚ï¼ˆå¯å¤ç”¨ï¼‰"></a><strong>é€šç”¨å±‚ï¼ˆå¯å¤ç”¨ï¼‰</strong></h4><ul>
<li><ul>
<li><code>SubGameAbility/RequestBridge/UTCGRequestCallbackSubsystem</code>ï¼šå®¢æˆ·ç«¯è¯·æ±‚å›è°ƒæ¡¥æ¥å™¨ï¼ˆ<code>RequestId</code> ç²¾ç¡®åŒ¹é…ï¼‰</li>
</ul>
</li>
<li><strong>3DText ç‰¹æœ‰å±‚</strong><ul>
<li><code>UTCG3DTextModifierLibrary</code>ï¼šå¯¹å¤–æ¥å£ï¼ˆè“å›¾&#x2F;UMG è°ƒç”¨å…¥å£ï¼‰</li>
<li><code>UTCGAbility_Create3DText</code>ï¼šæœåŠ¡å™¨åˆ›å»º&#x2F;ä¿®æ”¹å…¥å£ï¼ˆGAS Abilityï¼‰</li>
<li><code>ATCGReplicatedText3DActor</code>ï¼šå¤åˆ¶â€œæ˜¾ç¤ºå‚æ•°â€å¹¶åœ¨å®¢æˆ·ç«¯åº”ç”¨</li>
</ul>
</li>
</ul>
<hr>
<h4 id="æ ¸å¿ƒæ•°æ®ä¸å…³é”®å­—æ®µ"><a href="#æ ¸å¿ƒæ•°æ®ä¸å…³é”®å­—æ®µ" class="headerlink" title="æ ¸å¿ƒæ•°æ®ä¸å…³é”®å­—æ®µ"></a>æ ¸å¿ƒæ•°æ®ä¸å…³é”®å­—æ®µ</h4><h5 id="2-1-FTCG3DTextParams"><a href="#2-1-FTCG3DTextParams" class="headerlink" title="2.1 FTCG3DTextParams"></a>2.1 <code>FTCG3DTextParams</code></h5><p>ç”¨äº Create&#x2F;Modify çš„ç»Ÿä¸€å‚æ•°ç»“æ„ï¼š</p>
<ul>
<li><code>Header.RequestId</code>ï¼šä¸€æ¬¡è¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ï¼ˆå®¢æˆ·ç«¯å‘èµ·æ—¶ç”Ÿæˆï¼‰</li>
<li><code>Header.RequestingActor</code>ï¼šè¯·æ±‚æ¥æºï¼ˆé€šå¸¸æ˜¯ PCï¼‰</li>
<li><code>bIsModify</code>ï¼š<code>false=Create</code>ï¼Œ<code>true=Modify</code></li>
<li><code>TargetActor</code>ï¼šModify æ—¶ç›®æ ‡ Actor</li>
<li>æ–‡æœ¬æ˜¾ç¤ºå‚æ•°ï¼š<code>bVisible / SpawnLocation / SpawnRotation / InitialText / TextSize / bOutLine / ...</code></li>
</ul>
<h5 id="2-2-ATCGReplicatedText3DActor-ReplicatedParams"><a href="#2-2-ATCGReplicatedText3DActor-ReplicatedParams" class="headerlink" title="2.2 ATCGReplicatedText3DActor::ReplicatedParams"></a>2.2 <code>ATCGReplicatedText3DActor::ReplicatedParams</code></h5><ul>
<li><code>ReplicatedUsing=OnRep_TextParams</code></li>
<li>æœåŠ¡å™¨å†™å…¥ â†’ å®¢æˆ·ç«¯æ”¶åˆ°åè§¦å‘ <code>OnRep_TextParams()</code></li>
</ul>
<hr>
<h4 id="Createï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆæ—¶åºå›¾ï¼‰"><a href="#Createï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆæ—¶åºå›¾ï¼‰" class="headerlink" title="Createï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆæ—¶åºå›¾ï¼‰"></a>Createï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆæ—¶åºå›¾ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Client                                             Server                                          Client</span><br><span class="line">  |                                                  |                                               |</span><br><span class="line">  | UI è°ƒç”¨ `UTCG3DTextModifierLibrary`               |                                               |</span><br><span class="line">  | ç”Ÿæˆ Params.Header.RequestId                      |                                               |</span><br><span class="line">  | åœ¨ `UTCGRequestCallbackSubsystem` æ³¨å†Œå›è°ƒ          |                                               |</span><br><span class="line">  | TryActivateAbility                                |                                               |</span><br><span class="line">  |--------------------------------------------------&gt;| (GAS è§¦å‘ Ability æ¿€æ´»)                         |</span><br><span class="line">  |                                                  | `UTCGAbility_Create3DText::ActivateAbility()`  |</span><br><span class="line">  |                                                  |  1) CommitAbility                               |</span><br><span class="line">  |                                                  |  2) ServerOnly: æœåŠ¡å™¨ä¾§æ‰§è¡Œ Spawn              |</span><br><span class="line">  |                                                  |  3) Spawn `ATCGReplicatedText3DActor`           |</span><br><span class="line">  |                                                  |  4) `InitializeFromParams_Server(Params)`       |</span><br><span class="line">  |                                                  |     - ReplicatedParams = Params                 |</span><br><span class="line">  |                                                  |     - ApplyParamsToComponents(æœåŠ¡å™¨æœ¬åœ°)        |</span><br><span class="line">  |                                                  |     - ForceNetUpdate()                          |</span><br><span class="line">  |                                                  |-------------------------- Replicate -----------&gt;|</span><br><span class="line">  |                                                  |                                               | `OnRep_TextParams()`</span><br><span class="line">  |                                                  |                                               |  ApplyParamsToComponents(å®¢æˆ·ç«¯)</span><br><span class="line">  |                                                  |                                               |  `NotifyClientCompleted(RequestId, Actor)`</span><br><span class="line">  |                                                  |                                               |  å›è°ƒè§¦å‘ï¼šæŠŠ Actor ä¼ ç»™ UI</span><br></pre></td></tr></table></figure>

<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>æœåŠ¡å™¨ç«¯è´Ÿè´£ <strong>Spawn Actor</strong>ã€‚</li>
<li>å®¢æˆ·ç«¯çœ‹åˆ°â€œå®Œæ•´æ˜¾ç¤ºæ•ˆæœâ€ä¸»è¦ä¾èµ–ï¼š<ul>
<li><code>ReplicatedParams</code> å¤åˆ¶ + <code>OnRep_TextParams()</code> åº”ç”¨</li>
<li><code>ForceNetUpdate()</code> ç”¨äºåŠ é€ŸæŠŠæ–°å‚æ•°æ¨é€å‡ºå»ï¼ˆä¸æ˜¯â€œåº”ç”¨å‚æ•°â€æœ¬èº«ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<h4 id="Modifyï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆç®€å›¾ï¼‰"><a href="#Modifyï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆç®€å›¾ï¼‰" class="headerlink" title="Modifyï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆç®€å›¾ï¼‰"></a>Modifyï¼šå®Œæ•´ç½‘ç»œæ—¶åºï¼ˆç®€å›¾ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client                     Server                                  Client</span><br><span class="line">  |                          |                                       |</span><br><span class="line">  | ç»„ Params(bIsModify=true)|                                       |</span><br><span class="line">  |  TargetActor=è¦ä¿®æ”¹çš„Actor|                                       |</span><br><span class="line">  |-------------------------&gt;| `ServerText3DActor(Params)`            |</span><br><span class="line">  |                          | `UpdateFromParams_Server(Params)`      |</span><br><span class="line">  |                          |  -&gt; ReplicatedParams = Params          |</span><br><span class="line">  |                          |  -&gt; ForceNetUpdate()                   |</span><br><span class="line">  |                          |-------------------- Replicate --------&gt;|</span><br><span class="line">  |                          |                                       | `OnRep_TextParams()` Apply</span><br></pre></td></tr></table></figure>

<h4 id="ç›¸å…³ä»£ç "><a href="#ç›¸å…³ä»£ç " class="headerlink" title="ç›¸å…³ä»£ç "></a>ç›¸å…³ä»£ç </h4><h5 id="FTcg3dTextParams-h"><a href="#FTcg3dTextParams-h" class="headerlink" title="FTcg3dTextParams.h"></a>FTcg3dTextParams.h</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\Struct\FTcg3dTextParams.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/SubGameAbility/RequestBridge/TCGRequestBridgeTypes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Materials/MaterialInterface.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Extensions/Text3DDefaultMaterialExtension.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FTcg3dTextParams.generated.h&quot;</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»º3DTextçš„Gameplay Ability</span></span><br><span class="line"><span class="comment"> * åœ¨Abilityæ¿€æ´»æ—¶åŠ¨æ€åˆ›å»ºText3D Actorï¼Œå¹¶è‡ªåŠ¨ç½‘ç»œåŒæ­¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º/ä¿®æ”¹ 3DText çš„å‚æ•°ï¼ˆç»Ÿä¸€ç»“æ„ï¼‰</span></span><br><span class="line">USTRUCT(BlueprintType)</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FTcg3dTextParams</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** é€šç”¨è¯·æ±‚å¤´ï¼šæ‰¿è½½ RequestId / RequestType / RequestingActor */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FTCGRequestHeaderBase Header;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Modify æ—¶ç›®æ ‡ Actorï¼›Create æ—¶å¯ä¸ºç©º */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TObjectPtr&lt;AActor&gt; TargetActor = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æ˜¯å¦ä¸ºä¿®æ”¹è¯·æ±‚ï¼ˆtrue=Modify, false=Createï¼‰ è¯¥ç»“æ„ä½“å‚æ•°åœ¨GAçš„ä¿®æ”¹å’Œåˆ›å»ºçš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ æ‰€ä»¥ä»¥æ­¤æ¥åˆ¤æ–­ç®¡é“*/</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">bool</span> bIsModify = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ˜¯å¦æ˜¾ç¤º</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">bool</span> bVisible = <span class="literal">true</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// åˆ›å»ºä½ç½®</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FVector SpawnLocation = FVector::ZeroVector;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ›å»ºæ—‹è½¬</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FRotator SpawnRotation = FRotator::ZeroRotator;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ–‡å­—å†…å®¹</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FText InitialText = FText::FromString(TEXT(<span class="string">&quot;New Text&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ–‡å­—å¤§å°</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">float</span> TextSize = <span class="number">50.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ˜¯å¦ä½¿ç”¨çº¿æ¡†</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">bool</span> bOutLine = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å­—ä½“çš„4ä¸ªæè´¨å‚æ•°</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; FrontMaterial = nullptr;</span><br><span class="line"></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; BevelMaterial = nullptr;</span><br><span class="line"></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; ExtrudeMaterial = nullptr;</span><br><span class="line"></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; BackMaterial = nullptr;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è¦ä½¿ç”¨çš„3DText Actorç±»ï¼ˆå¦‚æœä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤AActor+TextRenderComponentï¼‰</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TSubclassOf&lt;AActor&gt; Text3DActorClass = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯é€‰ï¼šæŒ‡å®šè¯¥3DTextçš„Ownerï¼ˆé€šå¸¸ä¼ å…¥ PlayerController æˆ– Pawnï¼‰ã€‚</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TObjectPtr&lt;AActor&gt; OwnerActor = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯é€‰ï¼šæŒ‡å®šInstigatorï¼ˆé€šå¸¸æ˜¯ Pawnï¼‰ã€‚</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TObjectPtr&lt;APawn&gt; InstigatorPawn = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å°†å½“å‰å‚æ•°åº”ç”¨åˆ° `UText3DComponent`ã€‚</span></span><br><span class="line"><span class="comment">	 * å¤‡æ³¨ï¼šè¿™æ˜¯çº¯å·¥å…·å‡½æ•°ï¼Œä¸ä¾èµ– Actor/Worldï¼Œæ–¹ä¾¿åœ¨æœåŠ¡å™¨/å®¢æˆ·ç«¯å¤ç”¨ã€‚</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">ApplyToComponent</span><span class="params">(UText3DComponent* Text3DComponent, <span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!Text3DComponent)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		Text3DComponent-&gt;SetVisibility(InParams.bVisible);</span><br><span class="line">		Text3DComponent-&gt;SetText(InParams.InitialText);</span><br><span class="line">		Text3DComponent-&gt;SetWorldScale3D(FVector(InParams.TextSize, InParams.TextSize, InParams.TextSize));</span><br><span class="line">		Text3DComponent-&gt;SetHasOutline(InParams.bOutLine);</span><br><span class="line">		Text3DComponent-&gt;SetWorldLocation(InParams.SpawnLocation);</span><br><span class="line">		Text3DComponent-&gt;SetWorldRotation(InParams.SpawnRotation);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// è‹¥ä½¿ç”¨è‡ªå®šä¹‰æè´¨ï¼Œéœ€å°† Text3D æè´¨æ ·å¼åˆ‡åˆ° Customï¼ˆUE5.6 Text3D æ’ä»¶ï¼‰</span></span><br><span class="line">		<span class="keyword">if</span> (InParams.FrontMaterial || InParams.BevelMaterial || InParams.ExtrudeMaterial || InParams.BackMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (UText3DDefaultMaterialExtension* DefaultMaterialExt = Cast&lt;UText3DDefaultMaterialExtension&gt;(Text3DComponent-&gt;GetMaterialExtension()))</span><br><span class="line">			&#123;</span><br><span class="line">				DefaultMaterialExt-&gt;SetStyle(EText3DMaterialStyle::Custom);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æè´¨åº”ç”¨ï¼šText3D æ’ä»¶æä¾›å…·å APIï¼ˆUE5.6ï¼‰</span></span><br><span class="line">		<span class="keyword">if</span> (InParams.FrontMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetFrontMaterial(InParams.FrontMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (InParams.BevelMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetBevelMaterial(InParams.BevelMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (InParams.ExtrudeMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetExtrudeMaterial(InParams.ExtrudeMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (InParams.BackMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetBackMaterial(InParams.BackMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ„é€ å‡½æ•° - åˆ›å»ºå‚æ•°</span></span><br><span class="line">	FTcg3dTextParams() &#123;&#125;;</span><br><span class="line">	FTcg3dTextParams(</span><br><span class="line">		AActor* RequestingActor,</span><br><span class="line">		<span class="type">const</span> <span class="type">bool</span>&amp; bIsModify,</span><br><span class="line">		<span class="type">const</span> <span class="type">bool</span>&amp; bInVisible,</span><br><span class="line">		<span class="type">const</span> FVector&amp; InSpawnLocation,</span><br><span class="line">		<span class="type">const</span> FRotator&amp; InSpawnRotation,</span><br><span class="line">		<span class="type">const</span> FText&amp; InInitialText,</span><br><span class="line">		<span class="type">float</span> InTextSize,</span><br><span class="line">		<span class="type">bool</span> bInOutLine,</span><br><span class="line">		AActor* InOwnerActor,</span><br><span class="line">		APawn* InInstigatorPawn,</span><br><span class="line">		UMaterialInterface* InFrontMaterial,</span><br><span class="line">		UMaterialInterface* InBevelMaterial,</span><br><span class="line">		UMaterialInterface* InExtrudeMaterial,</span><br><span class="line">		UMaterialInterface* InBackMaterial,</span><br><span class="line">		AActor* TargetActor = nullptr)</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;Header.RequestingActor = RequestingActor;</span><br><span class="line"></span><br><span class="line">		this-&gt;bIsModify = bIsModify;</span><br><span class="line">		this-&gt;bVisible = bInVisible;</span><br><span class="line">		this-&gt;SpawnLocation = InSpawnLocation;</span><br><span class="line">		this-&gt;SpawnRotation = InSpawnRotation;</span><br><span class="line">		this-&gt;InitialText = InInitialText;</span><br><span class="line">		this-&gt;TextSize = InTextSize;</span><br><span class="line">		this-&gt;bOutLine = bInOutLine;</span><br><span class="line"></span><br><span class="line">		this-&gt;FrontMaterial = InFrontMaterial;</span><br><span class="line">		this-&gt;BevelMaterial = InBevelMaterial;</span><br><span class="line">		this-&gt;ExtrudeMaterial = InExtrudeMaterial;</span><br><span class="line">		this-&gt;BackMaterial = InBackMaterial;</span><br><span class="line"></span><br><span class="line">		this-&gt;OwnerActor = InOwnerActor;</span><br><span class="line">		this-&gt;InstigatorPawn = InInstigatorPawn;</span><br><span class="line">		this-&gt;TargetActor = TargetActor;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCG3DTextModifierLibrary-cpp"><a href="#TCG3DTextModifierLibrary-cpp" class="headerlink" title="TCG3DTextModifierLibrary.cpp"></a>TCG3DTextModifierLibrary.cpp</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\TCG3DTextModifierLibrary.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCG3DTextModifierLibrary.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/SubGameAbility/RequestBridge/TCGRequestCallbackSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">TMap&lt;FGuid, TWeakObjectPtr&lt;AActor&gt;&gt; GPendingModifyTargets;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::ValidateASCAndPC</span><span class="params">(UAbilitySystemComponent* ASC, APlayerController* OwningPC, <span class="type">const</span> TCHAR* Context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!ASC)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: ASC is null!&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!OwningPC)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: OwningPC is null!&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> TAbility&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::FindAbilitySpec</span><span class="params">(UAbilitySystemComponent* ASC, FGameplayAbilitySpec*&amp; OutSpec, TAbility*&amp; OutInstance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	OutSpec = <span class="literal">nullptr</span>;</span><br><span class="line">	OutInstance = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (FGameplayAbilitySpec&amp; AbilitySpec : ASC-&gt;<span class="built_in">GetActivatableAbilities</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (AbilitySpec.Ability &amp;&amp; AbilitySpec.Ability-&gt;<span class="built_in">IsA</span>(TAbility::<span class="built_in">StaticClass</span>()))</span><br><span class="line">		&#123;</span><br><span class="line">			OutSpec = &amp;AbilitySpec;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!OutSpec)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OutInstance = <span class="built_in">Cast</span>&lt;TAbility&gt;(OutSpec-&gt;<span class="built_in">GetPrimaryInstance</span>());</span><br><span class="line">	<span class="keyword">if</span> (!OutInstance)</span><br><span class="line">	&#123;</span><br><span class="line">		OutInstance = <span class="built_in">Cast</span>&lt;TAbility&gt;(OutSpec-&gt;Ability);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> OutInstance != <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::RegisterRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId, UObject* CallbackObject, FName CallbackFunctionName, <span class="type">const</span> TCHAR* Context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!CallbackObject || CallbackFunctionName.<span class="built_in">IsNone</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: CallbackObject/CallbackFunctionName invalid. Request will still be sent but no callback will be executed.&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UFunction* CallbackFunc = CallbackObject-&gt;<span class="built_in">FindFunction</span>(CallbackFunctionName);</span><br><span class="line">	<span class="keyword">if</span> (!CallbackFunc)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Callback function &#x27;%s&#x27; not found on object &#x27;%s&#x27;. Request will still be sent but no callback will be executed.&quot;</span>),</span><br><span class="line">			Context, *CallbackFunctionName.<span class="built_in">ToString</span>(), *<span class="built_in">GetNameSafe</span>(CallbackObject));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FProperty* FirstParam = <span class="literal">nullptr</span>;</span><br><span class="line">	FProperty* SecondParam = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">for</span> (TFieldIterator&lt;FProperty&gt; <span class="built_in">It</span>(CallbackFunc); It &amp;&amp; (It-&gt;PropertyFlags &amp; CPF_Parm); ++It)</span><br><span class="line">	&#123;</span><br><span class="line">		FProperty* Prop = *It;</span><br><span class="line">		<span class="keyword">if</span> (Prop-&gt;<span class="built_in">HasAnyPropertyFlags</span>(CPF_ReturnParm))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!FirstParam)</span><br><span class="line">		&#123;</span><br><span class="line">			FirstParam = Prop;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			SecondParam = Prop;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> bSignatureOk = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">if</span> (FirstParam &amp;&amp; !SecondParam)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="type">const</span> FObjectPropertyBase* ObjProp = <span class="built_in">CastField</span>&lt;FObjectPropertyBase&gt;(FirstParam))</span><br><span class="line">		&#123;</span><br><span class="line">			UClass* ParamClass = ObjProp-&gt;PropertyClass;</span><br><span class="line">			bSignatureOk = ParamClass &amp;&amp; ParamClass-&gt;<span class="built_in">IsChildOf</span>(AActor::<span class="built_in">StaticClass</span>());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!bSignatureOk)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Callback function &#x27;%s&#x27; on &#x27;%s&#x27; has invalid signature. Expected exactly one param: (AActor*). Request will still be sent but no callback will be executed.&quot;</span>),</span><br><span class="line">			Context, *CallbackFunctionName.<span class="built_in">ToString</span>(), *<span class="built_in">GetNameSafe</span>(CallbackObject));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (UWorld* World = ASC-&gt;<span class="built_in">GetWorld</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UGameInstance* GI = World-&gt;<span class="built_in">GetGameInstance</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (UTCGRequestCallbackSubsystem* RequestCallbackSubsystem = GI-&gt;<span class="built_in">GetSubsystem</span>&lt;UTCGRequestCallbackSubsystem&gt;())</span><br><span class="line">			&#123;</span><br><span class="line">				UTCGRequestCallbackSubsystem::FTCGOnRequestCompleted Wrapper;</span><br><span class="line">				Wrapper.<span class="built_in">BindUFunction</span>(CallbackObject, CallbackFunctionName);</span><br><span class="line">				RequestCallbackSubsystem-&gt;<span class="built_in">RegisterPendingCallback</span>(RequestId, Wrapper);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCG3DTextModifierLibrary::CancelRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (UWorld* World = ASC ? ASC-&gt;<span class="built_in">GetWorld</span>() : <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UGameInstance* GI = World-&gt;<span class="built_in">GetGameInstance</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (UTCGRequestCallbackSubsystem* RequestCallbackSubsystem = GI-&gt;<span class="built_in">GetSubsystem</span>&lt;UTCGRequestCallbackSubsystem&gt;())</span><br><span class="line">			&#123;</span><br><span class="line">				RequestCallbackSubsystem-&gt;<span class="built_in">Cancel</span>(RequestId);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::Create3DTextAsyncWithPC</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	UAbilitySystemComponent* ASC,</span></span></span><br><span class="line"><span class="params"><span class="function">	APlayerController* OwningPC,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FVector&amp; SpawnLocation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FText&amp; InitialText,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">float</span>&amp; TextSize,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bOutLine,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* FrontMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BevelMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* ExtrudeMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BackMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UObject* CallbackObject,</span></span></span><br><span class="line"><span class="params"><span class="function">	FName CallbackFunctionName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> TCHAR* Context = <span class="built_in">TEXT</span>(<span class="string">&quot;RequestCreate3DTextAsyncWithPC&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">ValidateASCAndPC</span>(ASC, OwningPC, Context))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FGameplayAbilitySpec* Spec = <span class="literal">nullptr</span>;</span><br><span class="line">	UTCGAbility_Create3DText* AbilityInstance = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">FindAbilitySpec</span>&lt;UTCGAbility_Create3DText&gt;(ASC, Spec, AbilityInstance))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Player does not have Create3DText Ability! Please grant it first.&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	AbilityInstance-&gt;LastCreatedActor = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> FTcg3dTextParams Params = <span class="built_in">FTcg3dTextParams</span>(</span><br><span class="line">		OwningPC,</span><br><span class="line">		<span class="literal">false</span>,</span><br><span class="line">		bVisible,</span><br><span class="line">		SpawnLocation,</span><br><span class="line">		SpawnRotation,</span><br><span class="line">		InitialText,</span><br><span class="line">		TextSize,</span><br><span class="line">		bOutLine,</span><br><span class="line">		OwningPC,</span><br><span class="line">		OwningPC-&gt;<span class="built_in">GetPawn</span>(),</span><br><span class="line">		FrontMaterial,</span><br><span class="line">		BevelMaterial,</span><br><span class="line">		ExtrudeMaterial,</span><br><span class="line">		BackMaterial,</span><br><span class="line">		<span class="literal">nullptr</span>);</span><br><span class="line">	</span><br><span class="line">	AbilityInstance-&gt;CurrentParams = Params;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">RegisterRequestCallback</span>(ASC, Params.Header.RequestId, CallbackObject, CallbackFunctionName, Context);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">bool</span> bSuccess = ASC-&gt;<span class="built_in">TryActivateAbility</span>(Spec-&gt;Handle);</span><br><span class="line">	<span class="keyword">if</span> (!bSuccess)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Failed to activate ability!&quot;</span>), Context);</span><br><span class="line">		<span class="built_in">CancelRequestCallback</span>(ASC, Params.Header.RequestId);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bSuccess;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::Modify3DTextAsyncWithPC</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	UAbilitySystemComponent* ASC,</span></span></span><br><span class="line"><span class="params"><span class="function">	APlayerController* OwningPC,</span></span></span><br><span class="line"><span class="params"><span class="function">	AActor* TargetText3DActor,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FVector&amp; SpawnLocation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FText&amp; NewText,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">float</span>&amp; NewTextSize,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bNewOutLine,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* FrontMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BevelMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* ExtrudeMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BackMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UObject* CallbackObject,</span></span></span><br><span class="line"><span class="params"><span class="function">	FName CallbackFunctionName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> TCHAR* Context = <span class="built_in">TEXT</span>(<span class="string">&quot;Modify3DTextAsyncWithPC&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">ValidateASCAndPC</span>(ASC, OwningPC, Context))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!TargetText3DActor)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: TargetText3DActor is null!&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FGameplayAbilitySpec* Spec = <span class="literal">nullptr</span>;</span><br><span class="line">	UTCGAbility_Create3DText* AbilityInstance = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">FindAbilitySpec</span>&lt;UTCGAbility_Create3DText&gt;(ASC, Spec, AbilityInstance))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Player does not have 3DText Ability! Please grant it first.&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> FTcg3dTextParams Params = <span class="built_in">FTcg3dTextParams</span>(</span><br><span class="line">		OwningPC,</span><br><span class="line">		<span class="literal">true</span>,</span><br><span class="line">		bVisible,</span><br><span class="line">		SpawnLocation,</span><br><span class="line">		SpawnRotation,</span><br><span class="line">		NewText,</span><br><span class="line">		NewTextSize,</span><br><span class="line">		bNewOutLine,</span><br><span class="line">		OwningPC,</span><br><span class="line">		OwningPC-&gt;<span class="built_in">GetPawn</span>(),</span><br><span class="line">		FrontMaterial,</span><br><span class="line">		BevelMaterial,</span><br><span class="line">		ExtrudeMaterial,</span><br><span class="line">		BackMaterial,</span><br><span class="line">		TargetText3DActor);</span><br><span class="line">	</span><br><span class="line">	AbilityInstance-&gt;CurrentParams = Params;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">RegisterRequestCallback</span>(ASC, Params.Header.RequestId, CallbackObject, CallbackFunctionName, Context);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">bool</span> bSuccess = ASC-&gt;<span class="built_in">TryActivateAbility</span>(Spec-&gt;Handle);</span><br><span class="line">	<span class="keyword">if</span> (!bSuccess)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Failed to activate ability!&quot;</span>), Context);</span><br><span class="line">		<span class="built_in">CancelRequestCallback</span>(ASC, Params.Header.RequestId);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bSuccess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="TCG3DTextModifierLibrary-h"><a href="#TCG3DTextModifierLibrary-h" class="headerlink" title="TCG3DTextModifierLibrary.h"></a>TCG3DTextModifierLibrary.h</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\TCG3DTextModifierLibrary.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Kismet/BlueprintFunctionLibrary.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCG3DTextModifierLibrary.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UMaterialInterface</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å§”æ‰˜ï¼šå½“3DText Actoråˆ›å»ºå®Œæˆæ—¶å›è°ƒ</span></span><br><span class="line">DECLARE_DYNAMIC_DELEGATE_OneParam(FOnText3DCreatedCallback, AActor*, CreatedActor);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è“å›¾å‡½æ•°åº“ - ç®€åŒ–UIè°ƒç”¨3DTextåˆ›å»ºAbilityçš„æ¥å£</span></span><br><span class="line"><span class="comment"> * æä¾›åŠ¨æ€åˆ›å»º3DText Actorçš„åŠŸèƒ½ ã€ä¸å…·æœ‰å¤ç”¨æ€§ã€‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">UTCG3DTextModifierLibrary</span> :</span> public UBlueprintFunctionLibrary</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	<span class="comment">// åˆ›å»º</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>, meta = (AutoCreateRefTerm = <span class="string">&quot;SpawnLocation,SpawnRotation,InitialText&quot;</span>))</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">Create3DTextAsyncWithPC</span><span class="params">(</span></span><br><span class="line"><span class="params">		UAbilitySystemComponent* ASC,</span></span><br><span class="line"><span class="params">		APlayerController* OwningPC,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FVector&amp; SpawnLocation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FText&amp; InitialText,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">float</span>&amp; TextSize,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bOutLine,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span><br><span class="line"><span class="params">		UMaterialInterface* FrontMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BevelMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* ExtrudeMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BackMaterial,</span></span><br><span class="line"><span class="params">		UObject* CallbackObject,</span></span><br><span class="line"><span class="params">		FName CallbackFunctionName)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¿®æ”¹</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>, meta = (AutoCreateRefTerm = <span class="string">&quot;SpawnLocation,SpawnRotation,NewText&quot;</span>))</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">Modify3DTextAsyncWithPC</span><span class="params">(</span></span><br><span class="line"><span class="params">		UAbilitySystemComponent* ASC,</span></span><br><span class="line"><span class="params">		APlayerController* OwningPC,</span></span><br><span class="line"><span class="params">		AActor* TargetText3DActor,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FVector&amp; SpawnLocation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FText&amp; NewText,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">float</span>&amp; NewTextSize,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bNewOutLine,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span><br><span class="line"><span class="params">		UMaterialInterface* FrontMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BevelMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* ExtrudeMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BackMaterial,</span></span><br><span class="line"><span class="params">		UObject* CallbackObject,</span></span><br><span class="line"><span class="params">		FName CallbackFunctionName)</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">ValidateASCAndPC</span><span class="params">(UAbilitySystemComponent* ASC, APlayerController* OwningPC, <span class="type">const</span> TCHAR* Context)</span>;</span><br><span class="line">	template&lt;typename TAbility&gt;</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">FindAbilitySpec</span><span class="params">(UAbilitySystemComponent* ASC, FGameplayAbilitySpec*&amp; OutSpec, TAbility*&amp; OutInstance)</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">RegisterRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId, UObject* CallbackObject, FName CallbackFunctionName, <span class="type">const</span> TCHAR* Context)</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">CancelRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId)</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGAbility-Create3DText-cpp"><a href="#TCGAbility-Create3DText-cpp" class="headerlink" title="TCGAbility_Create3DText.cpp"></a>TCGAbility_Create3DText.cpp</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\TCGAbility_Create3DText.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine/World.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TimerManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, off)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGAbility_Create3DText::ActivateAbility</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayAbilitySpecHandle Handle,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayAbilityActorInfo* ActorInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayAbilityActivationInfo ActivationInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayEventData* TriggerEventData)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">ActivateAbility</span>(Handle, ActorInfo, ActivationInfo, TriggerEventData);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// GASé€»è¾‘æ£€æµ‹</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">CommitAbility</span>(Handle, ActorInfo, ActivationInfo))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">EndAbility</span>(Handle, ActorInfo, ActivationInfo, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æŸ¥æ˜¯å¦åœ¨æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">GetOwningActorFromActorInfo</span>()-&gt;<span class="built_in">HasAuthority</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// å®¢æˆ·ç«¯ï¼šå‘é€åˆ°æœåŠ¡å™¨</span></span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][ActivateAbility] Calling ServerCreateText3DActor (Client side). RequestId=%s Params: Text=&#x27;%s&#x27; Loc=%s OwnerActor=%s InstigatorPawn=%s&quot;</span>),</span><br><span class="line">			*CurrentParams.Header.RequestId.<span class="built_in">ToString</span>(),</span><br><span class="line">			*CurrentParams.InitialText.<span class="built_in">ToString</span>(), *CurrentParams.SpawnLocation.<span class="built_in">ToString</span>(),</span><br><span class="line">			*<span class="built_in">GetNameSafe</span>(CurrentParams.OwnerActor.<span class="built_in">Get</span>()), *<span class="built_in">GetNameSafe</span>(CurrentParams.InstigatorPawn.<span class="built_in">Get</span>()));</span><br><span class="line">		<span class="built_in">ServerText3DActor</span>(CurrentParams);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// æœåŠ¡å™¨ï¼šç›´æ¥åˆ›å»º</span></span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][ActivateAbility] Spawning directly on server (Authority side).&quot;</span>));</span><br><span class="line">		<span class="keyword">if</span> (AActor* CreatedActor = <span class="built_in">SpawnText3DActor</span>(CurrentParams))</span><br><span class="line">		&#123;</span><br><span class="line">			LastCreatedActor = CreatedActor;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// è§¦å‘åˆ›å»ºæ—¶å€™çš„å›è°ƒå§”æ‰˜</span></span><br><span class="line">			OnText3DActorCreated.<span class="built_in">Broadcast</span>(CreatedActor);</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">UE_LOG</span>(LogTemp, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Successfully created Text3D Actor on server: %s&quot;</span>), </span><br><span class="line">				*CreatedActor-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">EndAbility</span>(Handle, ActorInfo, ActivationInfo, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGAbility_Create3DText::ServerText3DActor_Implementation</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ç»Ÿä¸€å…¥å£ï¼šCreate/Modify éƒ½èµ°åŒä¸€ä¸ª Server RPC</span></span><br><span class="line">	<span class="keyword">if</span> (Params.bIsModify)</span><br><span class="line">	&#123;</span><br><span class="line">		ATCGReplicatedText3DActor* RepTextActor = <span class="built_in">Cast</span>&lt;ATCGReplicatedText3DActor&gt;(Params.TargetActor);</span><br><span class="line">		<span class="keyword">if</span> (RepTextActor &amp;&amp; RepTextActor-&gt;<span class="built_in">HasAuthority</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			RepTextActor-&gt;<span class="built_in">UpdateFromParams_Server</span>(Params);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create</span></span><br><span class="line">	<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][ServerRPC] Enter ServerCreateText3DActor_Implementation. RequestId=%s This=%s OwningActor=%s Avatar=%s PC=%s Params: Text=&#x27;%s&#x27; Loc=%s OwnerActor=%s InstigatorPawn=%s&quot;</span>),</span><br><span class="line">		*Params.Header.RequestId.<span class="built_in">ToString</span>(),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="keyword">this</span>),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetOwningActorFromActorInfo</span>()),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetAvatarActorFromActorInfo</span>()),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(CurrentActorInfo ? CurrentActorInfo-&gt;PlayerController.<span class="built_in">Get</span>() : <span class="literal">nullptr</span>),</span><br><span class="line">		*Params.InitialText.<span class="built_in">ToString</span>(), *Params.SpawnLocation.<span class="built_in">ToString</span>(),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(Params.OwnerActor.<span class="built_in">Get</span>()), *<span class="built_in">GetNameSafe</span>(Params.InstigatorPawn.<span class="built_in">Get</span>()));</span><br><span class="line"></span><br><span class="line">	AActor* CreatedActor = <span class="built_in">SpawnText3DActor</span>(Params);</span><br><span class="line">	<span class="keyword">if</span> (CreatedActor)</span><br><span class="line">	&#123;</span><br><span class="line">		LastCreatedActor = CreatedActor;</span><br><span class="line">		OnText3DActorCreated.<span class="built_in">Broadcast</span>(CreatedActor);</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Successfully created Text3D Actor via RPC: %s&quot;</span>), *CreatedActor-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">AActor* <span class="title">UTCGAbility_Create3DText::SpawnText3DActor</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][SpawnOnServer] Enter. RequestId=%s Avatar=%s (Auth=%d, Role=%d) Owning=%s (Auth=%d, Role=%d) Params.OwnerActor=%s Params.InstigatorPawn=%s&quot;</span>),</span><br><span class="line">		*Params.Header.RequestId.<span class="built_in">ToString</span>(),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetAvatarActorFromActorInfo</span>()),</span><br><span class="line">		<span class="built_in">GetAvatarActorFromActorInfo</span>() ? (<span class="built_in">GetAvatarActorFromActorInfo</span>()-&gt;<span class="built_in">HasAuthority</span>() ? <span class="number">1</span> : <span class="number">0</span>) : <span class="number">-1</span>,</span><br><span class="line">		<span class="built_in">GetAvatarActorFromActorInfo</span>() ? (int32)<span class="built_in">GetAvatarActorFromActorInfo</span>()-&gt;<span class="built_in">GetLocalRole</span>() : <span class="number">-1</span>,</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetOwningActorFromActorInfo</span>()),</span><br><span class="line">		<span class="built_in">GetOwningActorFromActorInfo</span>() ? (<span class="built_in">GetOwningActorFromActorInfo</span>()-&gt;<span class="built_in">HasAuthority</span>() ? <span class="number">1</span> : <span class="number">0</span>) : <span class="number">-1</span>,</span><br><span class="line">		<span class="built_in">GetOwningActorFromActorInfo</span>() ? (int32)<span class="built_in">GetOwningActorFromActorInfo</span>()-&gt;<span class="built_in">GetLocalRole</span>() : <span class="number">-1</span>,</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(Params.OwnerActor.<span class="built_in">Get</span>()),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(Params.InstigatorPawn.<span class="built_in">Get</span>()));</span><br><span class="line"></span><br><span class="line">	AActor* AvatarActor = <span class="built_in">GetAvatarActorFromActorInfo</span>();</span><br><span class="line">	<span class="keyword">if</span> (!AvatarActor)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Avatar Actor is null!&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UWorld* World = <span class="built_in">GetWorld</span>();</span><br><span class="line">	<span class="keyword">if</span> (!World)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: World is null!&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åªåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line">	<span class="keyword">if</span> (!AvatarActor-&gt;<span class="built_in">HasAuthority</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Not on server!&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å‡†å¤‡ç”Ÿæˆå‚æ•°</span></span><br><span class="line">	FActorSpawnParameters SpawnParams;</span><br><span class="line">	SpawnParams.Owner = AvatarActor;</span><br><span class="line">	SpawnParams.Instigator = <span class="built_in">Cast</span>&lt;APawn&gt;(AvatarActor);</span><br><span class="line">	SpawnParams.SpawnCollisionHandlingOverride = ESpawnActorCollisionHandlingMethod::AlwaysSpawn;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœè°ƒç”¨ä¾§æ˜¾å¼æä¾›äº†Owner/Instigatorï¼ˆé€šå¸¸æ¥è‡ª PlayerControllerï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨å®ƒ</span></span><br><span class="line">	<span class="keyword">if</span> (Params.OwnerActor)</span><br><span class="line">	&#123;</span><br><span class="line">		SpawnParams.Owner = Params.OwnerActor;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (Params.InstigatorPawn)</span><br><span class="line">	&#123;</span><br><span class="line">		SpawnParams.Instigator = Params.InstigatorPawn;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šç±»ï¼Œä½¿ç”¨å¸¦RepNotifyåŒæ­¥çš„é»˜è®¤å®ç°</span></span><br><span class="line">	TSubclassOf&lt;AActor&gt; ActorClassToSpawn = Params.Text3DActorClass;</span><br><span class="line">	<span class="keyword">if</span> (!ActorClassToSpawn)</span><br><span class="line">	&#123;</span><br><span class="line">		ActorClassToSpawn = ATCGReplicatedText3DActor::<span class="built_in">StaticClass</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæŒ‡å®šäº†Actorç±»ï¼Œä½¿ç”¨æŒ‡å®šçš„ç±»</span></span><br><span class="line">	AActor* SpawnedActor = World-&gt;<span class="built_in">SpawnActor</span>&lt;AActor&gt;(</span><br><span class="line">		ActorClassToSpawn,</span><br><span class="line">		Params.SpawnLocation,</span><br><span class="line">		Params.SpawnRotation,</span><br><span class="line">		SpawnParams</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¾ç½®Replicateï¼ˆå…³é”®ï¼ï¼‰</span></span><br><span class="line">	SpawnedActor-&gt;<span class="built_in">SetReplicates</span>(<span class="literal">true</span>);</span><br><span class="line">	SpawnedActor-&gt;<span class="built_in">SetReplicateMovement</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæœ‰Ownerï¼Œä½¿ç”¨Ownerç›¸å…³æ€§ï¼ˆæ›´çœå¸¦å®½ï¼Œä¹Ÿæ›´ç¬¦åˆâ€œå½’å±åˆ°æŸä¸ªç©å®¶â€çš„è¯­ä¹‰ï¼‰</span></span><br><span class="line">	<span class="keyword">if</span> (SpawnParams.Owner)</span><br><span class="line">	&#123;</span><br><span class="line">		SpawnedActor-&gt;<span class="built_in">SetOwner</span>(SpawnParams.Owner);</span><br><span class="line">		SpawnedActor-&gt;bNetUseOwnerRelevancy = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å¯å¤åˆ¶Text3D Actorï¼ŒæŠŠå‚æ•°å†™è¿›RepNotifyå˜é‡ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¹Ÿåº”ç”¨ä¸€é</span></span><br><span class="line">	<span class="keyword">if</span> (ATCGReplicatedText3DActor* RepTextActor = <span class="built_in">Cast</span>&lt;ATCGReplicatedText3DActor&gt;(SpawnedActor))</span><br><span class="line">	&#123;</span><br><span class="line">		RepTextActor-&gt;<span class="built_in">InitializeFromParams_Server</span>(Params);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> SpawnedActor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, on)</span></span><br></pre></td></tr></table></figure>

<h5 id="TCGAbility-Create3DText-h"><a href="#TCGAbility-Create3DText-h" class="headerlink" title="TCGAbility_Create3DText.h"></a>TCGAbility_Create3DText.h</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\TCGAbility_Create3DText.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/TCGGameplayAbility.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Struct/FTcg3dTextParams.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UText3DComponent</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºå¹¶ç®¡ç†åŠ¨æ€3DText Actorçš„Ability</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å·¥ä½œæµç¨‹ï¼š</span></span><br><span class="line"><span class="comment"> * 1. å®¢æˆ·ç«¯UIè°ƒç”¨ â†’ æ¿€æ´»Ability</span></span><br><span class="line"><span class="comment"> * 2. Abilityåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºActor</span></span><br><span class="line"><span class="comment"> * 3. Actorè‡ªåŠ¨Replicateåˆ°æ‰€æœ‰å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> * 4. è¿”å›åˆ›å»ºçš„Actorå¼•ç”¨ç»™è°ƒç”¨è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">UTCGAbility_Create3DText</span> :</span> public UTCGGameplayAbility</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	<span class="comment">/* è°ƒç”¨é“¾æ¡ï¼š</span></span><br><span class="line"><span class="comment">	 * ActivateAbility -&gt; ServerText3DActor -&gt; SpawnText3DActorOnServer(å®é™…åˆ›å»º)</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">ActivateAbility</span><span class="params">(</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayAbilitySpecHandle Handle,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayAbilityActorInfo* ActorInfo,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayAbilityActivationInfo ActivationInfo,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayEventData* TriggerEventData)</span> override;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Server RPC - åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºActor</span></span><br><span class="line">	UFUNCTION(Server, Reliable)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">ServerText3DActor</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨æœåŠ¡å™¨ä¸Šå®é™…åˆ›å»ºActorçš„å‡½æ•°ï¼ˆåªåœ¨æœåŠ¡å™¨ä¸Šè°ƒç”¨ï¼‰</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	AActor* <span class="title function_">SpawnText3DActor</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span>;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	<span class="comment">// å½“å‰åˆ›å»ºå‚æ•°</span></span><br><span class="line">	UPROPERTY()</span><br><span class="line">	FTcg3dTextParams CurrentParams;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æœ€è¿‘åˆ›å»ºçš„Actorå¼•ç”¨ï¼ˆç”¨äºè¿”å›ç»™è°ƒç”¨è€…ï¼‰</span></span><br><span class="line">	UPROPERTY()</span><br><span class="line">	AActor* LastCreatedActor;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å§”æ‰˜ï¼šå½“Actoråˆ›å»ºå®Œæˆæ—¶è§¦å‘ï¼ˆå¯åœ¨è“å›¾ä¸­ç»‘å®šï¼‰</span></span><br><span class="line">	DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FOnText3DActorCreated, AActor*, CreatedActor);</span><br><span class="line">	</span><br><span class="line">	UPROPERTY(BlueprintAssignable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	FOnText3DActorCreated OnText3DActorCreated;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGReplicatedText3DActor-cpp"><a href="#TCGReplicatedText3DActor-cpp" class="headerlink" title="TCGReplicatedText3DActor.cpp"></a>TCGReplicatedText3DActor.cpp</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\TCGReplicatedText3DActor.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Net/UnrealNetwork.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine/GameInstance.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/SubGameAbility/RequestBridge/TCGRequestCallbackSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, off)</span></span><br><span class="line">ATCGReplicatedText3DActor::<span class="built_in">ATCGReplicatedText3DActor</span>()</span><br><span class="line">&#123;</span><br><span class="line">	bReplicates = <span class="literal">true</span>;</span><br><span class="line">	<span class="built_in">SetReplicateMovement</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// é»˜è®¤å°±å…è®¸ç”¨Ownerç›¸å…³æ€§ï¼ˆå¦‚æœAbilityé‚£è¾¹è®¾ç½®äº†Ownerçš„è¯ï¼‰</span></span><br><span class="line">	bNetUseOwnerRelevancy = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::InitializeFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">HasAuthority</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ReplicatedParams = InParams;</span><br><span class="line">	<span class="built_in">ApplyParamsToComponents</span>(ReplicatedParams);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®©æœ¬å¸§å°±å°è¯•æŠŠæ–°å‚æ•°æ¨ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">	<span class="built_in">ForceNetUpdate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::OnRep_TextParams</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">ApplyParamsToComponents</span>(ReplicatedParams);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å®¢æˆ·ç«¯ï¼šå‚æ•°å·²å°±ç»ªå¹¶åº”ç”¨ï¼Œé€šçŸ¥ç›‘å¬è€…</span></span><br><span class="line">	OnText3DInitialized.<span class="built_in">Broadcast</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (UWorld* World = <span class="built_in">GetWorld</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UGameInstance* GI = World-&gt;<span class="built_in">GetGameInstance</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// æ–°ï¼šé€šç”¨è¯·æ±‚å›è°ƒï¼ˆRequestId ç²¾ç¡®åŒ¹é…ï¼‰</span></span><br><span class="line">			<span class="keyword">if</span> (ReplicatedParams.Header.RequestId.<span class="built_in">IsValid</span>())</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (UTCGRequestCallbackSubsystem* RequestCallbackSubsystem = GI-&gt;<span class="built_in">GetSubsystem</span>&lt;UTCGRequestCallbackSubsystem&gt;())</span><br><span class="line">				&#123;</span><br><span class="line">					RequestCallbackSubsystem-&gt;<span class="built_in">NotifyClientCompleted</span>(ReplicatedParams.Header.RequestId, <span class="keyword">this</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::UpdateFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">InitializeFromParams_Server</span>(InParams);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::ApplyParamsToComponents</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (UText3DComponent* LocalText3DComponent = <span class="built_in">GetText3DComponent</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		FTcg3dTextParams::<span class="built_in">ApplyToComponent</span>(LocalText3DComponent, InParams);</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span> é¢œè‰²/æè´¨ï¼šå°† InParams çš„å­—æ®µåœ¨è¿™é‡Œå®Œæ•´åº”ç”¨ï¼Œç¡®ä¿å›è°ƒè¯­ä¹‰æˆç«‹</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::GetLifetimeReplicatedProps</span><span class="params">(TArray&lt;FLifetimeProperty&gt;&amp; OutLifetimeProps)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">GetLifetimeReplicatedProps</span>(OutLifetimeProps);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DOREPLIFETIME</span>(ATCGReplicatedText3DActor, ReplicatedParams);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, on)</span></span><br></pre></td></tr></table></figure>

<h5 id="TCGReplicatedText3DActor-h"><a href="#TCGReplicatedText3DActor-h" class="headerlink" title="TCGReplicatedText3DActor.h"></a>TCGReplicatedText3DActor.h</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>3DText\TCGReplicatedText3DActor.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span> <span class="comment">// for FTCG3DTextParams</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸€ä¸ªå¯å¤åˆ¶â€œæ˜¾ç¤ºå‚æ•°â€çš„Text3D Actorã€‚</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼šUEé»˜è®¤åªå¤åˆ¶Actor/ç»„ä»¶çš„Transformä¸Movementï¼Œ</span></span><br><span class="line"><span class="comment"> * Text3DComponent çš„æ–‡æœ¬/æè´¨ç­‰é€šå¸¸ä¸ä¼šè‡ªåŠ¨å¤åˆ¶ã€‚</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œç”¨ RepNotify æŠŠæœåŠ¡å™¨ä¸Šçš„å‚æ•°åŒæ­¥åˆ°å®¢æˆ·ç«¯ï¼Œå†åœ¨å®¢æˆ·ç«¯åº”ç”¨åˆ°ç»„ä»¶ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FTCGOnText3DInitialized, AActor*, Text3DActor);</span><br><span class="line"></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">ATCGReplicatedText3DActor</span> :</span> public AText3DActor</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	ATCGReplicatedText3DActor();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å½“å®¢æˆ·ç«¯é€šè¿‡OnRepæ”¶åˆ°å‚æ•°å¹¶å®ŒæˆApplyåï¼Œä¼šå¹¿æ’­è¯¥äº‹ä»¶</span></span><br><span class="line">	UPROPERTY(BlueprintAssignable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	FTCGOnText3DInitialized OnText3DInitialized;   </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æœåŠ¡å™¨è°ƒç”¨ï¼šè®¾ç½®åˆå§‹å‚æ•°å¹¶ç«‹å³åº”ç”¨ä¸€æ¬¡ï¼Œéšåé€šè¿‡å¤åˆ¶åŒæ­¥ç»™å®¢æˆ·ç«¯ã€‚</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">InitializeFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** æœåŠ¡å™¨ï¼šåœ¨å·²å­˜åœ¨ Actor ä¸Šæ›´æ–°å¤åˆ¶å‚æ•°ï¼Œå¹¶ ForceNetUpdate ä¸å®¢æˆ·ç«¯å›è°ƒ */</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">UpdateFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** è¯»å–å½“å‰å¤åˆ¶å‚æ•°ï¼ˆåªè¯»ï¼‰ */</span></span><br><span class="line">	<span class="type">const</span> FTcg3dTextParams&amp; <span class="title function_">GetReplicatedParams</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> ReplicatedParams; &#125;</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	UPROPERTY(ReplicatedUsing = OnRep_TextParams)</span><br><span class="line">	FTcg3dTextParams ReplicatedParams;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** RepNotify å›è°ƒï¼šå½“ ReplicatedParams å˜åŒ–æ—¶è°ƒç”¨ ğŸ‘†æœ‰å®åœ¨UEç½‘ç»œæ¡†æ¶ä¸­å®ç°è°ƒç”¨*/</span></span><br><span class="line">	UFUNCTION()</span><br><span class="line">	<span class="type">void</span> <span class="title function_">OnRep_TextParams</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span> <span class="title function_">ApplyParamsToComponents</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span>;</span><br><span class="line"></span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">GetLifetimeReplicatedProps</span><span class="params">(TArray&lt;FLifetimeProperty&gt;&amp; OutLifetimeProps)</span> <span class="type">const</span> override;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGRequestBridgeTypes-h"><a href="#TCGRequestBridgeTypes-h" class="headerlink" title="TCGRequestBridgeTypes.h"></a>TCGRequestBridgeTypes.h</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>RequestBridge\TCGRequestBridgeTypes.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayTagContainer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestBridgeTypes.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šç”¨è¯·æ±‚å¤´ï¼ˆBaseï¼‰ï¼šç”¨äºæŠŠä¸€æ¬¡â€œè¯·æ±‚â€å’Œæœªæ¥çš„å›è°ƒç²¾ç¡®å…³è”ã€‚</span></span><br><span class="line"><span class="comment"> * å»ºè®®å„ä¸šåŠ¡ Params å†…åŒ…å«ä¸€ä¸ª `Header` å­—æ®µæ¥ç»Ÿä¸€æ‰¿è½½ RequestId / RequestType / RequestingActorã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">USTRUCT(BlueprintType)</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">FTCGRequestHeaderBase</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å”¯ä¸€è¯·æ±‚IDï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆï¼‰ */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	FGuid RequestId = FGuid::NewGuid();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** å¯é€‰ï¼šå‘èµ·è€…ï¼ˆé€šå¸¸æ˜¯ PlayerController æˆ– Pawnï¼‰ */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;AActor&gt; RequestingActor = nullptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGRequestCallbackSubsystem-cpp"><a href="#TCGRequestCallbackSubsystem-cpp" class="headerlink" title="TCGRequestCallbackSubsystem.cpp"></a>TCGRequestCallbackSubsystem.cpp</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>RequestBridge\TCGRequestCallbackSubsystem.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestCallbackSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGRequestCallbackSubsystem::RegisterPendingCallback</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, <span class="type">const</span> FTCGOnRequestCompleted&amp; Callback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!RequestId.<span class="built_in">IsValid</span>() || !Callback.<span class="built_in">IsBound</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PendingCallbacks.<span class="built_in">Add</span>(RequestId, Callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGRequestCallbackSubsystem::NotifyClientCompleted</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, AActor* ResultActor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!RequestId.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FTCGOnRequestCompleted* Callback = PendingCallbacks.<span class="built_in">Find</span>(RequestId);</span><br><span class="line">	<span class="keyword">if</span> (!Callback)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FTCGOnRequestCompleted Copy = *Callback;</span><br><span class="line">	PendingCallbacks.<span class="built_in">Remove</span>(RequestId);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Copy.<span class="built_in">IsBound</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		Copy.<span class="built_in">Execute</span>(ResultActor);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGRequestCallbackSubsystem::Cancel</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!RequestId.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PendingCallbacks.<span class="built_in">Remove</span>(RequestId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="TCGRequestCallbackSubsystem-h"><a href="#TCGRequestCallbackSubsystem-h" class="headerlink" title="TCGRequestCallbackSubsystem.h"></a>TCGRequestCallbackSubsystem.h</h5><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>RequestBridge\TCGRequestCallbackSubsystem.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Subsystems/GameInstanceSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestBridgeTypes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestCallbackSubsystem.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">UTCGRequestCallbackSubsystem</span> :</span> public UGameInstanceSubsystem</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	DECLARE_DYNAMIC_DELEGATE_OneParam(FTCGOnRequestCompleted, AActor*, ResultActor);</span><br><span class="line"></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">RegisterPendingCallback</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, <span class="type">const</span> FTCGOnRequestCompleted&amp; Callback)</span>;</span><br><span class="line"></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">NotifyClientCompleted</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, AActor* ResultActor)</span>;</span><br><span class="line"></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">Cancel</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId)</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	UPROPERTY()</span><br><span class="line">	TMap&lt;FGuid, FTCGOnRequestCompleted&gt; PendingCallbacks;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>







<h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><h3 id="GASç½‘ç»œç”Ÿæˆçš„BPéœ€è¦è€ƒè™‘æ‰€æœ‰è€…"><a href="#GASç½‘ç»œç”Ÿæˆçš„BPéœ€è¦è€ƒè™‘æ‰€æœ‰è€…" class="headerlink" title="GASç½‘ç»œç”Ÿæˆçš„BPéœ€è¦è€ƒè™‘æ‰€æœ‰è€…"></a>GASç½‘ç»œç”Ÿæˆçš„BPéœ€è¦è€ƒè™‘æ‰€æœ‰è€…</h3><p><img src="https://s2.loli.net/2025/11/21/YdyXqrBw7hKoGuT.png" alt="image-20251114160307855" style="zoom:25%;" /><img src="https://s2.loli.net/2025/11/21/KmIpqniL5s7ESuj.png" alt="image-20251114160401410" style="zoom: 33%;" /></p>
<p>å¦‚æœæ˜¯åœ¨Serverç«¯ç”Ÿæˆçš„BPï¼Œä¸€å®šè¦æŒ‡å®šâ€œOwnerâ€ï¼Œå®ƒæ„å‘³ç€æ˜¯è¿™ä¸ªç”Ÿæˆçš„ä¸œè¥¿åœ¨å„ç½‘ç»œè®¾å¤‡ä¹‹é—´æŒ‡å®šçš„æ‰€æœ‰è€…ã€‚<br>å½“è¿™ä¸ªæ‰€æœ‰è€…å†…éƒ¨éœ€è¦æ‰§è¡Œä¸€ä¸ªç½‘ç»œçš„Eventçš„æ—¶å€™ï¼Œå®ƒéœ€è¦é€šçŸ¥ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¦‚æœæ²¡æœ‰Ownerï¼Œè¿™ä¸ªEventä¼šè¢«æ‹’ç»æ‰§è¡Œã€‚</p>
<h3 id="éšæœºæ•°é—®é¢˜"><a href="#éšæœºæ•°é—®é¢˜" class="headerlink" title="éšæœºæ•°é—®é¢˜"></a>éšæœºæ•°é—®é¢˜</h3><p>æ³¨æ„ç½‘ç»œç«¯å’ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœºæ•°ä¼šä¸ä¸€æ ·ã€‚</p>
<h3 id="åœ¨GEé‡Œæ‹¿åˆ°â€œäº‹ä»¶è§¦å‘è€…â€å’Œâ€œäº‹ä»¶è¢«å½±å“è€…â€"><a href="#åœ¨GEé‡Œæ‹¿åˆ°â€œäº‹ä»¶è§¦å‘è€…â€å’Œâ€œäº‹ä»¶è¢«å½±å“è€…â€" class="headerlink" title="åœ¨GEé‡Œæ‹¿åˆ°â€œäº‹ä»¶è§¦å‘è€…â€å’Œâ€œäº‹ä»¶è¢«å½±å“è€…â€"></a>åœ¨GEé‡Œæ‹¿åˆ°â€œäº‹ä»¶è§¦å‘è€…â€å’Œâ€œäº‹ä»¶è¢«å½±å“è€…â€</h3><div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/D9VA2s5EpevFXxL.png" alt="image-20251120172105945" width="50%" />
</div>

<p>å¦‚ä¸Šå›¾ï¼Œæˆ‘æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒæŠ•æ·ç‰©ã€‚<br>éœ€è¦ç»™GEä¼ é€’â€œæŠ•æ·ç‰©è¿™ä¸ªç‰©ä½“â€å’Œâ€œè¢«æ’çš„äººâ€ã€‚<br>å…¶ä¸­ï¼Œåœ¨æˆ‘è¿™é‡Œï¼Œâ€œè¢«æ’çš„äººâ€æ˜¯è¦æ‰§è¡Œçš„ASCçš„æ‰€æœ‰è€…ï¼ˆå³è¿™é‡Œçš„Instigatorï¼‰ï¼Œåœ¨åº”ç”¨GEçš„æ—¶å€™å¿…é¡»æä¾›ã€‚</p>
<p>è°ƒç”¨ BP_ApplyGameplayEffectToTarget æ—¶ï¼Œå®ƒå†…éƒ¨ä¼šï¼š</p>
<ul>
<li>ç”¨ã€Œä½œä¸º Target çš„ ASC çš„ Owner &#x2F; Avatar Actorã€æ¥æ„é€  FGameplayEffectContextHandleï¼›</li>
<li>åœ¨è¿™ä¸ª EffectContext é‡Œè‡ªåŠ¨å¡«å¥½ Instigatorã€EffectCauser ç­‰å­—æ®µï¼›</li>
<li>æŠŠè¿™ä¸ª EffectContext æ”¾è¿› FGameplayEffectSpecï¼Œæœ€ååº”ç”¨åˆ° Targetï¼›</li>
</ul>
<p>ï¼ˆæ­£å¦‚å›¾ä¸Šæ‰€ç¤ºï¼Œå®ƒå…¶å®æœ‰ä¸¤ä¸ªTargetèŠ‚ç‚¹ï¼Œä¸Šé¢é‚£ä¸ªæ˜¯è°ƒç”¨è¿™ä¸ªäº‹ä»¶çš„Targetï¼ˆè“å›¾ä¸­å¸¸è§ï¼‰ï¼Œä¸‹é¢é‚£ä¸ªæ˜¯è¢«å‘½ä¸­çš„â€œè¢«æ’çš„äººâ€ï¼Œå› ä¸ºç¢°å·§éƒ½å«Targetæ‰€ä»¥åœ¨è¿™é‡Œé‡å¤äº†ï¼‰</p>
<p>è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ã€‚ä½†ï¼Œå®é™…ä¸ŠGCä¸€ä¸ªå†…éƒ¨ç»“æ„é‡Œï¼Œæœ‰ä¸‰ä¸ªå‚¨å­˜ç”¨æ¥è¡¨è¾¾â€œäº‹ä»¶è´£ä»»ç›¸å…³äººâ€çš„å˜é‡ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType, meta = (HasNativeBreak = <span class="string">&quot;/Script/GameplayAbilities.AbilitySystemBlueprintLibrary.BreakGameplayCueParameters&quot;</span>, HasNativeMake = <span class="string">&quot;/Script/GameplayAbilities.AbilitySystemBlueprintLibrary.MakeGameplayCueParameters&quot;</span>))</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FGameplayCueParameters</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_USTRUCT_BODY</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Instigator actor, the actor that owns the ability system component */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadWrite, Category=GameplayCue)</span><br><span class="line">    TWeakObjectPtr&lt;AActor&gt; Instigator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The physical actor that actually did the damage, can be a weapon or projectile */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadWrite, Category=GameplayCue)</span><br><span class="line">    TWeakObjectPtr&lt;AActor&gt; EffectCauser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Object this effect was created from, can be an actor or static object. Useful to bind an effect to a gameplay object */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadWrite, Category=GameplayCue)</span><br><span class="line">    TWeakObjectPtr&lt;<span class="type">const</span> UObject&gt; SourceObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶UE_5.6\Engine\Plugins\Runtime\GameplayAbilities\Source\GameplayAbilities\Public\GameplayEffectTypes.hä¸­</p>
<p>è¿™ä¸‰ä¸ªåˆ†åˆ«æ˜¯ï¼šInstigatorã€EffectCauserã€SourceObjectã€‚</p>
<p>æŒ‰ç…§è¯´æ˜ï¼Œä»–ä»¬â€œè´£ä»»â€åˆ†åˆ«çš„ä½œç”¨æ˜¯</p>
<ul>
<li>Instigatorï¼šè°æ˜¯ã€Œæ–½åŠ è¿™ä¸ªæ•ˆæœçš„æ§åˆ¶è€…ã€ï¼Œé€šå¸¸æ˜¯ Pawn&#x2F;Characterã€‚</li>
<li>EffectCauserï¼šæ˜¯å“ªä¸€ä¸ª Actor&#x2F;Componentã€Œå…·ä½“é€ æˆäº†è¿™æ¬¡æ•ˆæœã€ï¼Œæ¯”å¦‚æ­¦å™¨ã€æŠ•æ·ç‰©ã€‚</li>
<li>SourceObjectï¼šä¸€ä¸ªå®Œå…¨å¼€æ”¾ç»™ä½ ç”¨çš„ UObject*ï¼Œå¯ä»¥æ˜¯æ­¦å™¨å®ä¾‹ã€æŠ€èƒ½å®ä¾‹ã€DataAssetã€æŠ•æ·ç‰©ç­‰ã€‚</li>
</ul>
<p>è¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä¸ä¸€å®šéƒ½æœ‰ï¼Œæ˜¯å¦è‡ªåŠ¨å¡«ï¼Œå–å†³äºä½ èµ°çš„ GAS è°ƒç”¨è·¯å¾„ã€‚é€šå¸¸åº”ç”¨çš„è·¯å¾„ä¸Šï¼ŒInstigatorå’ŒEffectCauseréƒ½æ˜¯åŒä¸€ä¸ªå€¼ï¼Œéƒ½æ˜¯è¿™ä¸ªASCçš„æ‹¥æœ‰è€…ã€‚ä½†æ˜¯SourceObjecté€šå¸¸æ˜¯ç©ºçš„ï¼ˆé€šè¿‡GAä¸»åŠ¨å’Œè§¦å‘çš„GEæœ‰æœºä¼šæŠŠGAçš„SourceObejctä¼ å…¥è¿›å»ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥è‡ªå·±æŒ‡å®šï¼Œç”¨ä½œè‡ªå·±çš„å‚æ•°ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1X5411V7jh/">å®˜æ–¹æ•™å­¦è§†é¢‘</a>:æˆ‘çœ‹ç€è¿™ä¸ªè§†é¢‘ä½œä¸ºæœ€åˆçš„å…¥é—¨</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/486808688">çŸ¥ä¹GASç³»ç»Ÿå¿«é€Ÿå…¥é—¨</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/gameplay-ability-system-for-unreal-engine">Unrealå®˜æ–¹çš„GASè®²è§£</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1vj4vzkELp?spm_id_from=333.788.player.switch&vd_source=60b376a57ab956cf81ad81ef20747a92&p=14">å…³äºGAçš„è®²è§£</a>ï¼šåˆ«å¿˜äº†å¯ä»¥ç‚¹å¼€Bç«™çš„AIç¿»è¯‘</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Nv42127HS">ä¸€ä¸ªå¾ˆä¸é”™çš„å…³äº</a>GASç³»ç»Ÿå®æ“è®²è§£</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1K7421Z7vm/">ä¸€ä¸ªå¾ˆä¸é”™çš„Lyraç¤ºä¾‹çš„è®²è§£</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1934717850632823338">æ–‡å­—è®²è§£Lyraç»“æ„</a>é€‚åˆä½œä¸ºç ”ç©¶åŸºç¡€ï¼Œç„¶åé…åˆä¸Šé¢çš„è§†é¢‘çœ‹ã€‚</p>
</li>
</ol>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Unreal-Engine/">Unreal Engine</a> <a href="/tags/Game-Development/">Game Development</a> <a href="/tags/Gameplay-Ability-System/">Gameplay Ability System</a> <a href="/tags/GAS/">GAS</a> <a href="/tags/C/">C++</a> <a href="/tags/Network-Programming/">Network Programming</a> <a href="/tags/RPG/">RPG</a> <a href="/tags/Game-Framework/">Game Framework</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>

    <!-- Table of Contents will be generated by toc-collapse.js -->

</section><!-- end main -->

<!-- After footer scripts -->

<!-- åŠ è½½æ‰“åŒ…åçš„æ¨¡å—åŒ–ä»£ç  -->

<script src="/dist/js/main.js"></script>


<!-- ä¿ç•™åŸæœ‰çš„ toc-collapse.js ç›´åˆ°å®Œå…¨é‡æ„ -->

<script src="/js/toc-collapse.js"></script>


<!-- Language Switcher -->

<script src="/js/i18n-data.js"></script>


<script src="/js/language-switcher.js"></script>


<!-- ç¬¬ä¸‰æ–¹åº“ (CDN) -->
<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<!-- Featherlight (å›¾åº“) -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Mermaid åˆå§‹åŒ– -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
  if (typeof mermaid !== 'undefined') {
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      securityLevel: 'loose'
    });

    // Find and process mermaid code blocks
    const codeBlocks = document.querySelectorAll('figure.highlight.plaintext .code');

    codeBlocks.forEach((codeElement, index) => {
      let code = codeElement.textContent || codeElement.innerText;

      // Check if it's a mermaid diagram
      if (code.trim().match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|journey|pie|gitgraph|erDiagram)/)) {
        code = code.trim().replace(/^\s+|\s+$/g, '');

        const mermaidDiv = document.createElement('div');
        mermaidDiv.className = 'mermaid';
        mermaidDiv.textContent = code;
        mermaidDiv.id = 'mermaid-diagram-' + index;

        const figureElement = codeElement.closest('figure');
        if (figureElement) {
          figureElement.parentNode.replaceChild(mermaidDiv, figureElement);
        }
      }
    });

    setTimeout(() => {
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    }, 100);
  }
});
</script>

<!-- ShaderToy Placeholder Processing -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(function() {
    const elements = document.querySelectorAll('.shadertoy-placeholder[data-id]');

    elements.forEach(element => {
      const shaderID = element.getAttribute('data-id');

      if (shaderID) {
        const container = document.createElement('div');
        container.style.cssText = `
          position: relative;
          width: 100%;
          height: 400px;
          margin: 20px 0;
          border: 2px solid #bfbbbb;
          border-radius: 8px;
          overflow: hidden;
          background-color: #f6f6f6;
        `;

        const iframe = document.createElement('iframe');
        iframe.src = \`https://www.shadertoy.com/embed/\${shaderID}?gui=true&t=10&paused=false&muted=false\`;
        iframe.style.cssText = `
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border: none;
        `;
        iframe.allowFullscreen = true;
        iframe.loading = 'lazy';

        container.appendChild(iframe);
        element.parentNode.insertBefore(container, element);
        element.parentNode.removeChild(element);
      }
    });
  }, 1000);
});
</script>

<!-- Disqus Comments -->


<!-- Google Analytics -->



</body>

</html>