<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Unreal GAS系统及网络使用学习前置知识UE网络架构
简介Gameplay Ability System，简称(GAS)是一个健壮的、高度可扩展的、gameplay框架,通常用于构建RPG、MOBA等游戏的完整战斗逻辑框架。通过GAS,可以快速地制作游戏中的主动&amp;#x2F;被动技能、各种效果b">
    

    <!--Author-->
    
        <meta name="author" content="Eugene Hsuan">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="UE5 GAS Learning Notes"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Eugene&#39;s Page"/>

    <!--Article Language-->
    
        <meta name="article:lang" content="en"/>
    

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>UE5 GAS Learning Notes - Eugene&#39;s Page</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="/css/table.css">

    
<link rel="stylesheet" href="/css/image-zoom.css">

    
<link rel="stylesheet" href="/css/language-switcher.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Mermaid Support -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>

    <!-- Google Analytics -->
    


    <!--Favicon-->
    
        <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    

    
        <link rel="alternate" type="application/atom+xml" title="Eugene&#39;s Page" href="/atom.xml">
    
        <link rel="alternate" type="application/rss+xml" title="Eugene&#39;s Page" href="/rss.xml">
    

<meta name="generator" content="Hexo 8.1.1"></head>


<body class="layout-post path-2025-09-21-Notes-UE5-GAS-Learning-Notes-">

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">Eugene's Page</a>
        <div class="subtitle"></div>
        <div class="description"></div>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/" data-i18n-key="Home">Home</a>
            </li>
            
            <li>
                <a href="/archives" data-i18n-key="Archives">Archives</a>
            </li>
            
            <li>
                <a href="/about" data-i18n-key="About">About</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
                <li><a href="https://space.bilibili.com/29291963" class="behance" target="_blank" data-title="Bilibili"></a></li>
            
            
                <li><a href="https://www.instagram.com/yu_chinghsuan?igsh=Mm54ajloc3c1NW5m&utm_source=qr" class="instagram" target="_blank" data-title="Instagram"></a></li>
            
            
                <li><a href="https://www.douban.com/people/Youdrew_Xuan/" class="dribble" target="_blank" data-title="Douban"></a></li>
            
            
                <li><a href="mailto:youdrewxuan@icloud.com" class="google" target="_blank" data-title="Email"></a></li>
            
            
                <li><a href="/rss.xml" class="rss" target="_blank" data-title="RSS"></a></li>
            
            <li><a href="javascript:void(0);" class="language" id="langSwitch" data-title="Language"></a></li>
        </ul><!-- end social -->

        <div class="rights">
            <p><span data-i18n="Copyright">Copyright</span> © 2026 Eugene Hsuan</p>
            <p><span data-i18n="Powered by">Powered by</span> <a href="https://hexo.io/" target="_blank">Hexo</a></p>
            <p><span data-i18n="Modified based on">Modified based on</span> <a href="https://github.com/klugjo/hexo-theme-magnetic" target="_blank">Magnetic</a> <span data-i18n="theme">theme</span></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('https://s2.loli.net/2025/11/11/5G9HF8xIluUj7Nt.jpg');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2025/11/21/Notes/Unreal%20RemoteControl%20Note/" class="previous" data-title="Unreal RemoteControl Note"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio" data-i18n="Portfolio"></a></li>
        
        <li><a href="/2025/09/13/Notes/Aximmetry/" class="next" data-title="Aximmetry Learnin..."></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">UE5 GAS Learning Notes</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="Unreal-GAS系统及网络使用学习"><a href="#Unreal-GAS系统及网络使用学习" class="headerlink" title="Unreal GAS系统及网络使用学习"></a>Unreal GAS系统及网络使用学习</h1><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ud4y1y7a8/">UE网络架构</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Gameplay Ability System，简称(GAS)是一个健壮的、高度可扩展的、gameplay框架,通常用于构建RPG、MOBA等游戏的完整战斗逻辑框架。通过GAS,可以快速地制作游戏中的主动&#x2F;被动技能、各种效果buff、计算属性伤害、处理玩家各种战斗状态逻辑。</p>
<p>GAS试图<u>将机制提取为通用的游戏设计模式</u>，并提供框架来解决常见的Gameplay实现问题，同时使上下文因项目而异。</p>
<h3 id="GAS提供了哪些功能"><a href="#GAS提供了哪些功能" class="headerlink" title="GAS提供了哪些功能?"></a>GAS提供了哪些功能?</h3><ol>
<li>实现了带有消耗和冷却功能的角色技能</li>
<li>处理数值属性(生命、魔法、攻击力、防御力)</li>
<li>应用状态效果(击飞、着火、眩晕)</li>
<li>应用游戏标签(GameplayTags)</li>
<li>生成特效和音效</li>
<li>完整的网络复制、预测功能</li>
</ol>
<h3 id="适合使用GAS的项目"><a href="#适合使用GAS的项目" class="headerlink" title="适合使用GAS的项目"></a>适合使用GAS的项目</h3><ol>
<li><p>C++项目,开发人员有充足的C++开发经验</p>
</li>
<li><p>使用Dedicated Server专用服务器的联机游戏（单纯的游戏逻辑服务端，与Dedicated Server相对的是Listen Server，其中一位玩家充当服务器，容易出现“主机优势”）</p>
</li>
<li><p>项目有大量且复杂的技能逻辑设计需求</p>
</li>
</ol>
<h3 id="GAS的主要优势"><a href="#GAS的主要优势" class="headerlink" title="GAS的主要优势"></a>GAS的主要优势</h3><ul>
<li><strong>网络复制（Network Replication）：</strong> 不必担心你的属性或减益效果得不到妥善地应用或复制。GAS会为你处理内部逻辑。</li>
<li><strong>模块化（Modularity）：</strong> 添加或更改游戏机制通常与实现和赋予新技能一样简单。通过将Gameplay功能分解为单独的资产，技能系统可以在完全不同的游戏对象或机制之间提供通用的通信层。例如，生命值（Health）可以划分到自己的属性集，并通过来自各种系统的Gameplay效果进行交互。</li>
<li><strong>快速迭代（Fast iteration）：</strong> GAS可以轻松更改单个游戏规则，而无需修改整个系统。用于计算游戏的数据源可以轻松交换，并且可以从相应的Gameplay效果中修改动作效果。</li>
</ul>
<h3 id="我为什么学习GAS"><a href="#我为什么学习GAS" class="headerlink" title="我为什么学习GAS"></a>我为什么学习GAS</h3><p>编写样板代码通常易出错且耗时，尤其是对于多人游戏而言。例如，你不希望花费大量时间来确保你的生命（Health）值正确复制，或者在你决定具有相同行为的能量（Energy）值时，复制相同的代码行。</p>
<p>GAS通过提供尽可能实现常见Gameplay功能的基础来解决这些问题，同时保持机制中立。GAS并非强制使用诸如生命值（Health）、弹药（Ammo）、近战攻击（Melee Attack）或毒药减益（Poison Debuff）之类的概念，而是提供了能够定义、复制和使用 <strong>属性（Attributes）</strong> 、 <strong>技能（Abilities）</strong> 和 <strong>效果（Effects）</strong> 的工具，然后你可以将这些工具专用于满足给定Gameplay机制的需求。</p>
<p><u>于我而言</u>：公司的项目需要使用到联网的游戏服务。所以你会在我的笔记中看到一些斜体的备注，这些备注意味着对我自己项目的备注。可以忽略。</p>
<h2 id="GAS的组件"><a href="#GAS的组件" class="headerlink" title="GAS的组件"></a>GAS的组件</h2><h3 id="ASC：who谁能放技能？"><a href="#ASC：who谁能放技能？" class="headerlink" title="ASC：who谁能放技能？"></a>ASC：who谁能放技能？</h3><p>Ability System Component（ASC）是整个 GAS 的基础组件。ASC 本质上是一个 UActorComponent，用于处理整个框架下的交互逻辑，包括使用技能（GameplayAbility）、包含属性（AttributeSet）、处理各种效果（GameplayEffect）。所有需要应用 GAS 的对象（Actor），都必须拥有 GAS 组件。（即所有有技能交互的角色都是ASC）。</p>
<ul>
<li>ASC是一种角色组件，负责和GA、GE、AS打交道。</li>
<li>一般只放在Character or PlayerState上。</li>
<li>拥有 ASC 的 Actor 被称为 ASC 的 OwnerActor，ASC 实际作用的 Actor 叫做 AvatarActor。</li>
</ul>
<h3 id="GA：How-技能的逻辑？"><a href="#GA：How-技能的逻辑？" class="headerlink" title="GA：How:技能的逻辑？"></a><strong>GA</strong>：How:技能的逻辑？</h3><p>Gameplay Ability（GA）<u>标识了游戏中一个对象（Actor）可以做的行为或技能</u>。它代表角色可以执行的任何技能或行为。<br>能力（Ability）可以是普通攻击或者吟唱技能，可以是角色被击飞倒地，还可以是使用某种道具，交互某个物件，甚至跳跃、飞行等角色行为也可以是Ability。<br>Ability可以被赋予对象或从对象的ASC中移除，对象同时可以激活多个GameplayAbility。</p>
<ul>
<li>基本的移动输入、UI交互行为则不能或不建议通过GA来实现。</li>
<li>通过蓝图继承GamePlay Ability来实现</li>
</ul>
<h4 id="GA的执行流程"><a href="#GA的执行流程" class="headerlink" title="GA的执行流程"></a>GA的执行流程</h4><div class="mermaid" style="background: white; border: 1px solid #e1e1e1; border-radius: 4px; padding: 20px;">
graph TD
    A[TryActivateAbility] --> B{CanActivateAbility}
    B -->|Yes| C[ActivateAbility]
    B -->|No| D[EndAbility]
    C --> E[Start AbilityTask]
    E -->|Some Time Later| F[CommitAbility]
    F -->|Can't Afford| D
    F --> G[Start AbilityTask]
    G -->|Some Time Later| H[Apply GameplayEffects]
    G --> I[Start AbilityTask]
    I -->|Some Time Later| J[Apply GameplayEffects]
    I -->|Some Time Later| K[End Ability]
    D --> L[OnEndAbility]
    K --> L
    L --> M[Cleanup]
</div>

<ol>
<li><span style="color: blue;">TryActivateAbility</span> ：首先判断一下能不能执行。</li>
<li><span style="color: green;">ActivateAbility</span>：执行一套技能（有技能动画，比如发射一个火焰）。</li>
<li><span style="color: #9C27B0;">CommitAbility</span>：技能释放了成功了，要扣蓝。</li>
<li><span style="color: #ffeb3b;">Start AbilityTask</span> * 2:技能执行中…技能执行结束。然后应用对应效果。</li>
</ol>
<p>其中ActivateAbility和End Ability是类似于BeginPlay和EndPlay这样的函数，在蓝图中调用。</p>
<h4 id="蓝图中的设置"><a href="#蓝图中的设置" class="headerlink" title="蓝图中的设置"></a>蓝图中的设置</h4><h4 id="主要选项解释"><a href="#主要选项解释" class="headerlink" title="主要选项解释"></a>主要选项解释</h4><h5 id="常见蓝图"><a href="#常见蓝图" class="headerlink" title="常见蓝图"></a>常见蓝图</h5><ul>
<li>EndAbility 结束这个能力</li>
</ul>
<h5 id="高级设置"><a href="#高级设置" class="headerlink" title="高级设置"></a>高级设置</h5><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/Ndl5QoW8hUkyKrw.png" alt="image-20251028173049722" width="50%" />
</div>

<ul>
<li><p><strong>Replication Policy</strong>（复制策略）： 决定该Ability的激活、执行等信息是否在网络上传播。常见选项有：</p>
<ul>
<li>Not Replicated：仅本地执行，不同步到其他客户端&#x2F;服务器。</li>
<li>Replicated：在服务器和客户端之间同步。</li>
</ul>
</li>
<li><p><strong>Instancing Policy</strong>（实例化策略）： 决定Ability的实例化方式。</p>
<ul>
<li>Non-Instanced：所有激活者共享同一个Ability对象，适合无状态逻辑。</li>
<li>Instanced Per Actor：每个拥有者有独立实例，适合有状态逻辑。</li>
<li>Instanced Per Execution：每次激活都新建实例，适合需要隔离状态的复杂技能。</li>
</ul>
</li>
<li><p><strong>Server Respects Remote Ability Cancellation</strong>（服务器尊重远端取消）：勾选后，服务器会响应客户端请求取消Ability的操作。适合需要客户端主动取消技能的场景。</p>
</li>
<li><p><strong>Retrigger Instanced Ability</strong>（可重复触发实例化Ability）：允许Ability在已激活时再次被激活（会重新实例化），适合可叠加或可重复释放的技能。</p>
</li>
<li><p><strong>Net Execution Policy</strong>（网络执行策略）：决定Ability的激活和执行在哪端进行。</p>
<ul>
<li>Local Predicted：客户端预测执行，服务器校验。</li>
<li>Local Only：仅本地执行。</li>
<li>Server Only：仅服务器执行。</li>
<li>Server Initiated：服务器发起，客户端可参与。</li>
</ul>
</li>
<li><p><strong>Net Security Policy</strong>（网络安全策略）：控制Ability的安全等级，防止被恶意客户端滥用。</p>
<ul>
<li>Client Or Server：客户端和服务器都可激活。</li>
<li>Server Only Execution：只有服务器可激活。</li>
<li>Server Only Execution and Data：只有服务器可激活且数据仅在服务器。</li>
</ul>
</li>
</ul>
<h4 id="GA要做的事情"><a href="#GA要做的事情" class="headerlink" title="GA要做的事情"></a>GA要做的事情</h4><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/jaloAZzDKkq5fx2.png" alt="image-20251028200009953" width="50%" />
</div>

<p>一般GA要做的事有：</p>
<ul>
<li>设置GA的Tag、CD、Cost等属性。</li>
<li>获取必要信息，主要通过Get Actor Info。如果是通过Event调用的GA（使用Activate Ability From Event节点作为输入），还可以通过Gameplay Event Data获取。</li>
<li>编写逻辑，如播放动画、应用GE、应用冲量等。</li>
<li>一定不要忘了EndAbility。</li>
</ul>
<h4 id="GA的调用"><a href="#GA的调用" class="headerlink" title="GA的调用"></a>GA的调用</h4><p>GA的调用分成了主动调用（释放技能）和被动调用（挨打）两类，下面依次介绍不同的调用方法。</p>
<h5 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h5><p>在蓝图中主要有by Class和by Tag 两种调用方法。</p>
<div style="text-align: center;">
  <img src="https://pic4.zhimg.com/v2-0671623b3bf57f42b92903bfc3acb667_1440w.jpg" alt="img" width="50%" />
</div>

<p>byClass一次只能Activate一个GA，byTag可以Activate任意多个GA，配合Tag容器使用。</p>
<p>如果使用EnhancedInputAction插件来管理输入，要注意在某些设置下trigger会每帧都进行输出。</p>
<p>只要能获取ASC，就可以在任何地方调用GA，比如行为树Task蓝图，甚至在GA蓝图中调用其他GA。</p>
<h5 id="被动调用"><a href="#被动调用" class="headerlink" title="被动调用"></a>被动调用</h5><p>Trigger可以理解为一个Tag，当ASC组件收到一个Trigger时，就会自动调用所有拥有该Trigger的GA。</p>
<p>Trigger的Tag在GA的details面板中设置。</p>
<div style="text-align: center;">
  <img src="https://pic2.zhimg.com/v2-9fdb393dae4753b3539245b335c3a531_1440w.jpg" alt="img" width="50%" />
</div>

<p>Trigger的触发方式有三种，分别是：</p>
<ul>
<li>Gameplay Event: 当Owner收到一个带有Tag的Gameplay Event（<strong>不是Gameplay Effect的GE！</strong>）时<strong>调用一次</strong>GA，此时Owner<strong>不会拥有对应的Tag</strong>。</li>
<li>Owner Tag Added: 当Owner<strong>获取对应Tag</strong>的时候<strong>调用一次</strong>GA。</li>
<li>Owner Tag Present: 当Owner<strong>拥有Tag</strong>时调用GA，失去Tag时移除。</li>
</ul>
<p>一般使用第一种方法，并配合SendGameplayEventToActor节点使用，如下图所示。（这张图是很久以前截的，Tag建议以Event开头）</p>
<div style="text-align: center;">
<img src="https://pica.zhimg.com/v2-0759f3f09591c5a808113d8841733b38_1440w.jpg" alt="img" style="zoom: 50%;" / width="50%" />
</div>

<p>受击效果的例子，发送一个Tag为Hit的Event给碰撞检测到的Actor</p>
<p>使用Gameplay Event调用的好处是，可以传入数据（Payload），是除了Get Actor Info外的另一种信息传递方法。</p>
<p>此时应该删除ActiveAbility节点，转而使用ActivateAbilityFromEvent事件。（<strong>不要通过在左上角重载函数的方式，右键空白处搜索才是对的</strong>）</p>
<h3 id="GE：What技能改变的属性？"><a href="#GE：What技能改变的属性？" class="headerlink" title="GE：What技能改变的属性？"></a>GE：What技能改变的属性？</h3><p>Gameplay Effect（GE）是Ability对<strong>自己或他人产生影响的途径</strong>。<br>GE通常可以被理解为我们游戏中的buff。比如增益&#x2F;减益效果（修改属性）。<br>但是GAS中的GE也更加广义，释放技能时候的伤害结算，施加特殊效果的控制、霸体效果（修改GameplayTag）都是通过GE来实现的。</p>
<ul>
<li><u>GE只是一个可配置的*<em>数据表</em> *</u>，不可以添加逻辑。开发者创建一个UGameplayEffect的派生蓝图，就可以根据需求制作想要的效果。</li>
<li>GE是纯蓝图</li>
</ul>
<h3 id="GT：if技能改变的条件？"><a href="#GT：if技能改变的条件？" class="headerlink" title="GT：if技能改变的条件？"></a>GT：if技能改变的条件？</h3><p>FGameplayTags是一种层级标签，如Parent.Child.GrandChild。<br>通过GameplayTagManager进行注册。<br>替代了原来的Bool，或Enum的结构，可以在玩法设计中更高效的<strong>标记对象的行为或状态</strong>（比如一个灼烧效果，GE完成之后，便可以取消标签）。<br>我理解是一个在Actor下的Json。</p>
<ul>
<li>Tag的<strong>层级关系</strong>也需要合理设计，到了后期修改成本比较大。</li>
</ul>
<h3 id="Attribute-Set"><a href="#Attribute-Set" class="headerlink" title="Attribute Set"></a>Attribute Set</h3><p>负责定义和持有属性，并且管理属性的<u>变化</u>，包括<u>网络同步</u>。<br>需要在Actor中被添加为成员变量，并注册到ASC（C++）。<br>一个ASC可以拥有一个或多个（不同的）AttributeSet，因此可以角色共享一个很大的Attribute Set，也可以每个角色按需添加Attribute Set。<br>可以在属性变化前（PreAttributeChange）后（PostGameplayEffectExecute）处理相关逻辑，可以通过委托的方式绑定属性变化。</p>
<h3 id="Player-State"><a href="#Player-State" class="headerlink" title="Player State"></a>Player State</h3><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/11/21/N17ULdln2Ako5cI.png" alt="Player State 架构示意图" width="50%" />
</div>
PlayerState 是 Unreal Engine 中用于存储玩家相关信息的特殊 Actor 类。在多人游戏中，PlayerState 会自动在服务器和所有客户端之间复制，非常适合存储需要跨网络同步的玩家数据。

<p>在 GAS 系统中，<u>ASC 可以选择挂载在 PlayerState 上而不是 Character 上</u>。这样做的好处是：</p>
<ul>
<li><strong>持久性</strong>：当角色死亡或重生时，PlayerState 依然存在，技能和属性数据不会丢失</li>
<li><strong>网络复制</strong>：PlayerState 天然支持网络复制，适合多人游戏场景</li>
<li><strong>UI 访问</strong>：UI 可以更方便地访问玩家的技能和属性信息，无需依赖具体的 Character 实例</li>
<li><strong>观察者模式</strong>：即使玩家处于观察者状态（没有 Character），也能保持技能系统的状态</li>
</ul>
<p>常见的做法是：</p>
<ul>
<li><strong>玩家控制的角色</strong>：ASC 放在 PlayerState 上</li>
<li><strong>AI 控制的角色</strong>：ASC 直接放在 Character 上</li>
</ul>
<h3 id="组件总结"><a href="#组件总结" class="headerlink" title="组件总结"></a>组件总结</h3><p>Visual：技能的视觉效果？GameplayCue<br>Async：技能的长时行动？(异步)GameplayTask<br>Send：技能的消息事件？GamePplayEvent<br>这俩是同一个东西</p>
<h3 id="其他背景概念"><a href="#其他背景概念" class="headerlink" title="其他背景概念"></a>其他背景概念</h3><h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h4><p>RPC &#x3D; Remote Procedure Call，远程过程调用。</p>
<p>在 UE 网络里，它的意思是：</p>
<ul>
<li>你在客户端调用一个函数，但这个函数的实现会在服务器执行（Server RPC）；</li>
<li>或者在服务器调用一个函数，但它会在某些&#x2F;所有客户端执行（Client&#x2F;NetMulticast RPC）。</li>
</ul>
<p><strong>它本质是：</strong></p>
<ol>
<li>把“函数名 + 参数”打包成一段网络消息（通过 actor channel）</li>
<li>发送到网络对端</li>
<li>对端收到后，再去调用对应的 _Implementation 函数</li>
</ol>
<p><strong>RPC 成功需要两个条件：</strong></p>
<ul>
<li>你调用的对象在网络上“有通道&#x2F;可发送”（通常是 Actor 或挂在 Actor 上的东西）</li>
<li>引擎知道这条网络消息应该发给谁（服务器 or 某个客户端）</li>
</ul>
<h4 id="“路由”-routing"><a href="#“路由”-routing" class="headerlink" title="“路由”(routing)"></a>“路由”(routing)</h4><p>你可以把“路由”理解成一句话：这条 RPC 消息到底通过哪个网络连接发出去？发给谁？引擎怎么知道？<br>在 UE 里，RPC 最终是靠 Actor 的网络连接&#x2F;通道发送的（actor channel + owning connection）。<br>而 UTCGGameplayAbility这种 UObject（不是 Actor）它自己没有网络连接，它的 RPC 需要“借道”</p>
<p>借谁的道？<br>答案：借它所属的&#x2F;可追溯到的 Actor 通道（通常是 ASC 的 OwnerActor &#x2F; AvatarActor &#x2F; PlayerController 这条链）。</p>
<p>最典型的归属链（客户端玩家）应该是：<br>PlayerController（拥有网络连接 owning connection）<br>	👆owns Pawn&#x2F;Character<br>				👆Pawn 上有 ASC（或者 ASC 的 OwnerActor 是 Pawn&#x2F;PlayerState）<br>							👆Ability 从 ASC 拿 ActorInfo</p>
<p>所以当你在 Ability（UObject）里调用 Server RPC 时，UE 会尝试沿着 Ability 的 ActorInfo 找到：<br>哪个 Actor 有 owning connection（通常是 PlayerController 或被它拥有的 Pawn）再通过那条连接把 RPC 发到服务器。</p>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><h3 id="开启插件"><a href="#开启插件" class="headerlink" title="开启插件"></a>开启插件</h3><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/PxXeVshqdbliFYQ.png" alt="image-20251027203033649" width="50%" />
  <img src="https://s2.loli.net/2025/10/29/TmQHkou6jg5PzSN.png" alt="image-20251027203540226" width="50%" />
</div>





<ol>
<li><u>C++项目</u>，安装Gameplay Ability插件。</li>
<li>在Tools菜单下面有GameplayCue Editor有了，就说明开启成功了。</li>
<li>在新建的蓝图的页面可以看到GamePlay相关的东西</li>
</ol>
<h3 id="使用Rider快速添加Unreal类"><a href="#使用Rider快速添加Unreal类" class="headerlink" title="使用Rider快速添加Unreal类"></a>使用Rider快速添加Unreal类</h3><div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/kqL2KOeURij69dr.png" alt="image-20251027215401030" width="50%" />
</div>

<p>通过这里创建一个Character。可以快速拥有一些头文件。</p>
<h3 id="ASC组件架构"><a href="#ASC组件架构" class="headerlink" title="ASC组件架构"></a>ASC组件架构</h3><div class="mermaid" style="background: white; border: 1px solid #e1e1e1; border-radius: 4px; padding: 20px;">
classDiagram
  class ACharacter
  class ARPGCharacterBase {
    +AbilitySystemComponent
  }
  class BP_Character {
    +公共逻辑
  }
  class BP_PlayerCharacter {
    -组装Camera等组件
    -输入绑定
  }
  class BP_NPCCharacter
  ACharacter <|-- ARPGCharacterBase
  ARPGCharacterBase <|-- BP_Character
  BP_Character <|-- BP_PlayerCharacter
  BP_Character <|-- BP_NPCCharacter
</div>

<p>你需要自己创建一个继承自ACharacter的C++类。</p>
<p>之后想用蓝图，就从这个自定义的C++Character类派生就可以了。 </p>
<h3 id="写一个Base-GAS-ACharacter文件"><a href="#写一个Base-GAS-ACharacter文件" class="headerlink" title="写一个Base GAS ACharacter文件"></a>写一个Base GAS ACharacter文件</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PublicDependencyModuleNames.AddRange(<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Core&quot;</span>, <span class="string">&quot;CoreUObject&quot;</span>, <span class="string">&quot;Engine&quot;</span>, <span class="string">&quot;InputCore&quot;</span>, <span class="string">&quot;EnhancedInput&quot;</span>,</span><br><span class="line">    <span class="string">&quot;GameplayAbilities&quot;</span>,<span class="string">&quot;GameplayTags&quot;</span>,<span class="string">&quot;GameplayTasks&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在Build文件里添加如下的内容GameplayAbilities、GameplayTags、GameplayTasks。</p>
<p>在头文件里面添加一个AbilitySystemComponent，直接在角色上挂载 AbilitySystemComponent（ASC），可以适配多人游戏。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TObjectPtr&lt;UTCGAbilitySystemComponent&gt; AbilitySystemComponent;</span><br></pre></td></tr></table></figure>

<p>在.cpp中构造函数部分实例化AbilitySystemComponent（ASC）。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例化ASC</span></span><br><span class="line">AbilitySystemComponent = <span class="built_in">CreateDefaultSubobject</span>&lt;UAbilitySystemComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;AbilitySystem&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>角色类继承IAbilitySystemInterface接口，并实现GetASC函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemInterface.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ARPG_UNREAL_API</span> ACharacterBase : <span class="keyword">public</span> ACharacter, <span class="keyword">public</span> IAbilitySystemInterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">UAbilitySystemComponent* <span class="title">GetAbilitySystemComponent</span><span class="params">()</span><span class="type">const</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure>

<p>在CPP中实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UAbilitySystemComponent* <span class="title">ACharacterBase::GetAbilitySystemComponent</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AbilitySystemComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👆这里的return即使写为null，也可能可能调用</p>
<p><em>这个在项目中的路径在：Source&#x2F;TCG_AwesomeLive&#x2F;CharacterSystem&#x2F;TCGCharacterBase.h</em></p>
<h3 id="把GA数组加入到Actor中"><a href="#把GA数组加入到Actor中" class="headerlink" title="把GA数组加入到Actor中"></a>把GA数组加入到Actor中</h3><p>可以将UE原生的UGameplayAbility直接加入到需要Ability的Actor中（也是加到这个Base GAS ACharacter文件中）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(BlueprintReadOnly, EditAnywhere, Category = <span class="string">&quot;Test|Abilities&quot;</span>)</span><br><span class="line">TArray&lt;TSubclassOf&lt;UGameplayAbility&gt;&gt; CharacterAbilities;</span><br></pre></td></tr></table></figure>

<p><strong>在C++中赋予GA</strong>：我们可以将我们所有的技能储存在一张DA表之中，然后从DA表里读取数据，并使用AbilitySystemComponent-&gt;GiveAbility将数据赋予ASC。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加能力</span></span><br><span class="line"><span class="keyword">for</span>(FTCGAblityInfo&amp; Info : AllAbilitiesInfo)&#123;</span><br><span class="line">    <span class="keyword">if</span> (Info.AbilityClass == <span class="literal">nullptr</span>)</span><br><span class="line">       <span class="keyword">continue</span>;</span><br><span class="line">    CharacterAbilities.<span class="built_in">Add</span>(Info.AbilityClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> StartupAbility : CharacterAbilities)</span><br><span class="line">&#123;</span><br><span class="line">    AbilitySystemComponent-&gt;<span class="built_in">GiveAbility</span>(</span><br><span class="line">       <span class="built_in">FGameplayAbilitySpec</span>(StartupAbility, <span class="number">1</span>, INDEX_NONE, <span class="keyword">this</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就可以在继承了Base Character的子类中，看到Ability的选项了。</p>
<div style="text-align: center;">
  <img src="https://s2.loli.net/2025/10/29/KYsEzGVCQ1Ibwre.png" alt="image-20251028184812916" width="50%" />
</div>
赋予GA的方式有很多，比如在需要的蓝图中调用<u>Give Ability</u>节点。还可以使用GE赋予GA。

<p>在官方的Lyra案例里面使用AbilitySet来储存一类Ability，通过加载来实现赋予。参看下文Unreal官方案例“赋予GA”部分。</p>
<h2 id="Unreal官方案例"><a href="#Unreal官方案例" class="headerlink" title="Unreal官方案例"></a>Unreal官方案例</h2><p>UE中有一个非常不错的官方示例<a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/lyra-sample-game-in-unreal-engine?application_version=5.0">Lyra</a>里面展示了一个完整的GAS系统。</p>
<h3 id="项目里的设置"><a href="#项目里的设置" class="headerlink" title="项目里的设置"></a>项目里的设置</h3><div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/zWIduBsAxTriGkX.png" alt="image-20251111183652281" width="50%" />
</div>

<p>这个项目里开发者设置了一些调整选项，可以设定一些debug的参数。</p>
<p>比如子弹射击停留时间，生成的bot的数量。</p>
<h3 id="项目蓝图常见前缀标识"><a href="#项目蓝图常见前缀标识" class="headerlink" title="项目蓝图常见前缀标识"></a>项目蓝图常见前缀标识</h3><p><strong>WID_</strong><br>全称可理解为 Weapon Item Definition。<br>用途：武器类的“物品定义”蓝图资产，继承自 ULyraInventoryItemDefinition（你在代码里看到的基类）。<br><strong>ID_</strong><br>可理解为（Generic）Item Definition。<br>用途：非武器的一般物品定义（比如消耗品、弹药、包裹、可堆叠资源等）也继承 ULyraInventoryItemDefinition，用 ID_ 前缀区分与 WID_（武器专用）资产。<br><strong>B</strong>_<br>B_ 前缀在 Lyra 中通常代表一个 Blueprint 类资产（等同很多团队常用的 BP_，Lyra 项目里取了更短的 B_）。</p>
<h3 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h3><ul>
<li>这一部分我主要参考的是<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1934717850632823338">这里</a>加上了一些我自己的补充。整体结构采用了原本的结构，但是有我自己的删减，可以对照地看。</li>
</ul>
<h4 id="初始化Ability-System"><a href="#初始化Ability-System" class="headerlink" title="初始化Ability System"></a>初始化Ability System</h4><h5 id="创建ASC"><a href="#创建ASC" class="headerlink" title="创建ASC"></a>创建ASC</h5><p>ASC用于总体控制GAS功能，可以挂在Character上或者PlayerState上，对于角色会死亡重生的场景，挂在PlayerState上更合适，不会因Character销毁而丢失数据。因此Lyra选择把ASC挂在了PlayerState上，这样还有额外作用，就是按Tab键显示计分板这种战斗无关的功能，也可以用GA实现，以往的习惯都是硬编码。</p>
<p>ULyraAbilitySystemComponent本身是一个Manager，与数据无关，所以PlayerState直接New了一个对象即可：</p>
<blockquote>
<p>Source&#x2F;LyraGame&#x2F;GameModes&#x2F;LyraGameState.h&#x2F;cpp</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(VisibleAnywhere, Category = <span class="string">&quot;Lyra|PlayerState&quot;</span>)</span><br><span class="line">TObjectPtr&lt;ULyraAbilitySystemComponent&gt; AbilitySystemComponent;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建</span></span><br><span class="line">AbilitySystemComponent = ObjectInitializer.<span class="built_in">CreateDefaultSubobject</span>&lt;ULyraAbilitySystemComponent&gt;(<span class="keyword">this</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;AbilitySystemComponent&quot;</span>));</span><br><span class="line">AbilitySystemComponent-&gt;<span class="built_in">SetIsReplicated</span>(<span class="literal">true</span>);</span><br><span class="line">AbilitySystemComponent-&gt;<span class="built_in">SetReplicationMode</span>(EGameplayEffectReplicationMode::Mixed);</span><br></pre></td></tr></table></figure>

<h5 id="ASC里面也会记录Actor"><a href="#ASC里面也会记录Actor" class="headerlink" title="ASC里面也会记录Actor"></a>ASC里面也会记录Actor</h5><blockquote>
<p>Plugins&#x2F;Runtime&#x2F;GameplayAbilities&#x2F;Source&#x2F;GameplayAbilities&#x2F;Public&#x2F;AbilitySystemComponent.h</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The actor that owns this component logically */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_OwningActor)</span><br><span class="line">    TObjectPtr&lt;AActor&gt; OwnerActor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The actor that is the physical representation used for abilities. Can be NULL */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_OwningActor)</span><br><span class="line">    TObjectPtr&lt;AActor&gt; AvatarActor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Cached off data about the owning actor that abilities will need to frequently access (movement component, mesh component, anim instance, etc) */</span></span><br><span class="line">    TSharedPtr&lt;FGameplayAbilityActorInfo&gt;  AbilityActorInfo;</span><br></pre></td></tr></table></figure>

<p>ASC也会记录关联Actor的信息：</p>
<p><strong>OwnerActor</strong>挂在哪个Actor上，这里是PlayerState；</p>
<p><strong>AvatarActor</strong>是使用Ability实体，这里是Character。</p>
<p>这两个属性是ASC经常要获取的变量，除此之外，还有多个与Actor关联的属性会被高频读取，为了提高读取性能，ASC索性把它们复制了一份，集中存储在<strong>AbilityActorInfo</strong>变量中，包括了PlayerController，SkeletalMeshComponent，AnimInstance，MovementComponent，AffectedAnimInstanceTag。</p>
<h5 id="赋予GA（前建立Experience做数据衔接）"><a href="#赋予GA（前建立Experience做数据衔接）" class="headerlink" title="赋予GA（前建立Experience做数据衔接）"></a>赋予GA（前建立Experience做数据衔接）</h5><p>创建完ASC后，要往这个容器里赋予GA了，表示Actor有这些能力。</p>
<p>Lyra工程高度模块化，配置比较分散，使用AbilitySet来储存一类Ability，通过加载来实现自动化配置和赋予GA。</p>
<p>首先创建一个Experience，<u>首先什么是Experience？</u></p>
<ul>
<li><p>定义角色： Experience（通过 ULyraExperienceDefinition）把一组运行时行为、资源和规则打包成一个可切换的体验（例如不同模式、地图或玩法配置）。</p>
</li>
<li><p>主要用途：在游戏启动或切换体验时告诉引擎“要启用哪些 GameFeatures、默认的 Pawn 数据、以及需要执行哪些动作&#x2F;赋能”</p>
</li>
<li><p>原因</p>
<ul>
<li>统一配置与可切换性：把调表（技能、效果、默认 pawn 等）放到 Experience 里，便于在不同玩法&#x2F;模式间切换和复用，不用把能力写死在代码里。</li>
<li>数据驱动与延迟加载：Experience 可以在运行时启&#x2F;停 GameFeatures、注入资源，再把需要的能力&#x2F;效果批量下发。</li>
<li>作用域与生命周期可控：通过 Experience 可以在启用时授予、停用时撤销，方便整体管理和热加载。</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>(BlueprintType, Const)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ULyraExperienceDefinition</span> : <span class="keyword">public</span> UPrimaryDataAsset</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category = Gameplay)</span><br><span class="line">    TArray&lt;FString&gt; GameFeaturesToEnable;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category=Gameplay)</span><br><span class="line">    TObjectPtr&lt;<span class="type">const</span> ULyraPawnData&gt; DefaultPawnData;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Instanced, Category=<span class="string">&quot;Actions&quot;</span>)</span><br><span class="line">    TArray&lt;TObjectPtr&lt;UGameFeatureAction&gt;&gt; Actions;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category=Gameplay)</span><br><span class="line">    TArray&lt;TObjectPtr&lt;ULyraExperienceActionSet&gt;&gt; ActionSets;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如图Lyra的结构。</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/jlbEy7vf4z2D6xF.png" alt="image-20251111172739503" width="50%" />
</div>

<p>继承自ULyraExperienceDefinition的：B_BasicShooterTestB_BasicShooterTest这个数据类里的Action分组里面，有需要授予的GA的DA表。</p>
<p>比如：**AbilitySet_<strong>Elimination（下面那个） 和 HeroData_ShooterGame里面的</strong>AbilitySet_**ShooterHero。</p>
<ul>
<li>首先看AbilitySet_Elimination  DA表（它继承自LyraAbilitySet）。</li>
</ul>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/khSfJeNB3I5Fvcq.png" alt="image-20251111171556976" width="50%" />
</div>

<p>  打开这个AbilitySet_Elimination，里面包含两个GA。<br>  GA_ShowLeaderboard_TDM用于按Tab显示计分板。<br>  GA_AutoRespawn用于死亡复活，这两个GA与Character战斗无关，在没用Character时也能执行。</p>
<ul>
<li>然后看AbilitySet_ShooterPistol DA表（储存在总表的HeroData_ShooterGame里面 它继承自ULyraPawnData）</li>
</ul>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/abXfUKiehOG3lHs.png" alt="image-20251111174500121" width="50%" />
</div>

<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/4Zt68goQNHmdsOk.png" alt="AbilitySet_ShooterHero" width="50%" />
</div>

<p>  包含Character相关的GA，数量较多。比如GA_Hero_Jump实现了跳跃，GA_Emote实现了跳舞。</p>
<ul>
<li>然后还有一个AbilitySet_ShooterPisto</li>
</ul>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/ls8hrwJVOjfkMZF.png" alt="image-20251111181356512" width="50%" />
</div>

<p>  它不是定义在B_BasicShooterTestB_BasicShooterTest这张大表里面的。</p>
<p>  而是通过WID_Pistol被具体的蓝图调用。</p>
<p>然后对每个GA，调用UAbilitySystemComponent::GiveAbility函数进行赋予。</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/Je2w7BSxbQEapTV.png" alt="image-20251111185235151" style="zoom:25%;" / width="50%" />
</div>

<p>会在很多地方调用。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FGameplayAbilitySpecHandle <span class="title">UAbilitySystemComponent::GiveAbility</span><span class="params">(<span class="type">const</span> FGameplayAbilitySpec&amp; Spec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ABILITYLIST_SCOPE_LOCK</span>();</span><br><span class="line">    FGameplayAbilitySpec&amp; OwnedSpec = ActivatableAbilities.Items[ActivatableAbilities.Items.<span class="built_in">Add</span>(Spec)];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (OwnedSpec.Ability-&gt;<span class="built_in">GetInstancingPolicy</span>() == EGameplayAbilityInstancingPolicy::InstancedPerActor)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment">// Create the instance at creation time</span></span><br><span class="line">       <span class="built_in">CreateNewInstanceOfAbility</span>(OwnedSpec, Spec.Ability);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">OnGiveAbility</span>(OwnedSpec);</span><br><span class="line">    <span class="built_in">MarkAbilitySpecDirty</span>(OwnedSpec, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UE_LOG</span>(LogAbilitySystem, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: GiveAbility %s [%s] Level: %d Source: %s&quot;</span>), *<span class="built_in">GetNameSafe</span>(<span class="built_in">GetOwner</span>()), *<span class="built_in">GetNameSafe</span>(Spec.Ability), *Spec.Handle.<span class="built_in">ToString</span>(), Spec.Level, *<span class="built_in">GetNameSafe</span>(Spec.SourceObject.<span class="built_in">Get</span>()));</span><br><span class="line">    <span class="built_in">UE_VLOG</span>(<span class="built_in">GetOwner</span>(), VLogAbilitySystem, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;GiveAbility %s [%s] Level: %d Source: %s&quot;</span>), *<span class="built_in">GetNameSafe</span>(Spec.Ability), *Spec.Handle.<span class="built_in">ToString</span>(), Spec.Level, *<span class="built_in">GetNameSafe</span>(Spec.SourceObject.<span class="built_in">Get</span>()));</span><br><span class="line">    <span class="keyword">return</span> OwnedSpec.Handle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数参数为FGameplayAbilitySpec，表示“这次赋予”的描述信息。</p>
<p>不仅包含这次赋予的描述信息，比如GA的Class，指定GA的等级，GA绑定的输入Tag。而且也是GA在ASC上的runtime表示，有很多runtime信息。每个Spec都有唯一的ID，称为Handle，通过自增赋予，各系统间Spec的传递都通过Handle实现。</p>
<p>值得注意的是Spec.SourceObject属性，表示这个GA所关联的最“密切”的Object，在创建时由我们指定。<br>比如GA_Weapon_Fire_Pistol，是枪开火的GA，SourceObject就是武器B_WeaponInstance_Pistol；<br>GA_Hero_Jump是角色跳跃的GA，SourceObejct就是Character；<br>GA_ShowLeaderboard_TDM则是与战斗无关的打开计分板的GA，OurceObject就是PlayerStat。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">USTRUCT(BlueprintType)</span><br><span class="line">struct GAMEPLAYABILITIES_API FGameplayAbilitySpec : public FFastArraySerializerItem</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_USTRUCT_BODY()</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    UPROPERTY(NotReplicated)</span><br><span class="line">    TArray&lt;TObjectPtr&lt;UGameplayAbility&gt;&gt; NonReplicatedInstances;</span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">    TArray&lt;TObjectPtr&lt;UGameplayAbility&gt;&gt; ReplicatedInstances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加时，首先把Spec加入到ActivatableAbilities数组中，然后根据Policy创建一个GA的实例，默认的InstancedPerActor是要创建的。创建完成后，如果GA设置为网络同步，就加入到Spec.ReplicatedInstances中，否则加入Spec.NonReplicatedInstances。</p>
<h5 id="注册Trigger"><a href="#注册Trigger" class="headerlink" title="注册Trigger"></a>注册Trigger</h5><p>GA可以绑定一些Trigger，实际是Tag，当发出GamePlayEvent，并指定对应Tag后，就能激活GA了。</p>
<p>所以这里的Tag为了更方便做判断具体的GA。</p>
<ul>
<li>首先是InputTag，它本身非GAS框架内的，是Lyra自己做的一套输入和GA的映射。InputTag在AbilitySet中指定</li>
</ul>
<p><img src="https://s2.loli.net/2025/11/21/DQgqibLETr14JHR.png" alt="image-20251111191635777">AbilitySet_ShooterPisto</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/FAmWtpUSy94lQez.png" alt="image-20251111191708052" width="50%" />
</div>

<p>AbilitySet_ShooterPistol </p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/1yWC6gVZHb38UPz.png" alt="image-20251111191718509" width="50%" />
</div>

<p>AbilitySet_ShooterPisto</p>
<p>创建Spec时会把InputTag添加到其DynamicSpecSourceTags，DynamicSpecSourceTags是一个通用Tag容器。<br>该Tags在结构体FGameplayAbilitySpec里面，<u>也就是说，一个FGameplayAbilitySpec代表的是传递的一个Ability的能力，然后里面有很多DynamicAbilityTags</u>。</p>
<p>注册的路径如下：</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/AzSXP7UNWFsfot1.png" alt="image-20251111205815528" width="50%" />
</div>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ULyraAbilitySet::GiveToAbilitySystem</span><span class="params">(ULyraAbilitySystemComponent* LyraASC, FLyraAbilitySet_GrantedHandles* OutGrantedHandles, UObject* SourceObject)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Grant the attribute sets.</span></span><br><span class="line">    <span class="keyword">for</span> (int32 SetIndex = <span class="number">0</span>; SetIndex &lt; GrantedAttributes.<span class="built_in">Num</span>(); ++SetIndex)</span><br><span class="line">    &#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grant the gameplay abilities.</span></span><br><span class="line">    <span class="keyword">for</span> (int32 AbilityIndex = <span class="number">0</span>; AbilityIndex &lt; GrantedGameplayAbilities.<span class="built_in">Num</span>(); ++AbilityIndex)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="type">const</span> FLyraAbilitySet_GameplayAbility&amp; AbilityToGrant = GrantedGameplayAbilities[AbilityIndex];</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!<span class="built_in">IsValid</span>(AbilityToGrant.Ability))</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="built_in">UE_LOG</span>(LogLyraAbilitySystem, Error, <span class="built_in">TEXT</span>(<span class="string">&quot;GrantedGameplayAbilities[%d] on ability set [%s] is not valid.&quot;</span>), AbilityIndex, *<span class="built_in">GetNameSafe</span>(<span class="keyword">this</span>));</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       ULyraGameplayAbility* AbilityCDO = AbilityToGrant.Ability-&gt;<span class="built_in">GetDefaultObject</span>&lt;ULyraGameplayAbility&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="function">FGameplayAbilitySpec <span class="title">AbilitySpec</span><span class="params">(AbilityCDO, AbilityToGrant.AbilityLevel)</span></span>;</span><br><span class="line">       AbilitySpec.SourceObject = SourceObject;</span><br><span class="line">       AbilitySpec.<span class="built_in">GetDynamicSpecSourceTags</span>().<span class="built_in">AddTag</span>(AbilityToGrant.InputTag);</span><br><span class="line"></span><br><span class="line">       <span class="type">const</span> FGameplayAbilitySpecHandle AbilitySpecHandle = LyraASC-&gt;<span class="built_in">GiveAbility</span>(AbilitySpec);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (OutGrantedHandles)</span><br><span class="line">       &#123;</span><br><span class="line">          OutGrantedHandles-&gt;<span class="built_in">AddAbilitySpecHandle</span>(AbilitySpecHandle);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grant the gameplay effects.</span></span><br><span class="line">    <span class="keyword">for</span> (int32 EffectIndex = <span class="number">0</span>; EffectIndex &lt; GrantedGameplayEffects.<span class="built_in">Num</span>(); ++EffectIndex)</span><br><span class="line">    &#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在授予ASC Ability的时候，将Tags Effect等信息一并传入。</p>
<p>授予GA的逻辑，以上就是服务器初始化ASC并赋予GA的全部过程。</p>
<div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/4H9xKOcQBbezAFY.png" alt="image-20251111210326498" width="50%" />
</div>



<h4 id="同步客户端"><a href="#同步客户端" class="headerlink" title="同步客户端"></a>同步客户端</h4><h5 id="ASC"><a href="#ASC" class="headerlink" title="ASC"></a>ASC</h5><p>首先，ASC作为一个Component挂在PlayerState上，是可以同步的。</p>
<p>由于AvatarActor是Character，因此OwnerActor和AvatarActor的最终设置，需要客户端的Character创建后才能执行。</p>
<p>具体为Character创建后，触发LyraHeroComponent的加载资源流程，当加载完成并且客户端获取到PlayerState后，就把当前阶段设置为DataAvailabe，并最终设置OwnerActor和AvatarActor。</p>
<h5 id="GASpec"><a href="#GASpec" class="headerlink" title="GASpec"></a>GASpec</h5><p>Spec存于ActivatableAbilities容器中，本身是FastArray，标记了Replicated，可正常网络同步</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(ReplicatedUsing = OnRep_ActivateAbilities, BlueprintReadOnly, Transient, Category = <span class="string">&quot;Abilities&quot;</span>)</span><br><span class="line">FGameplayAbilitySpecContainer ActivatableAbilities;</span><br></pre></td></tr></table></figure>

<p>Spec同步到客户端后，FastArray会触发FGameplayAbilitySpec::PostReplicatedAdd()方法，里面再和服务器同样的UAbilitySystemComponent::OnGiveAbility()方法来注册Spec。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FGameplayAbilitySpec::PostReplicatedAdd</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> FGameplayAbilitySpecContainer&amp; InArraySerializer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (InArraySerializer.Owner)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        InArraySerializer.Owner-&gt;<span class="built_in">OnGiveAbility</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于不同步但InstancedPerActor的GA，会在此时创建实例，加入到NonReplicatedInstances数组，然后再注册AbilityTriggers。</p>
<h5 id="Spec的GA实例"><a href="#Spec的GA实例" class="headerlink" title="Spec的GA实例"></a>Spec的GA实例</h5><p>首先，GA实例只同步给Autonomous客户端，不会同步给SimulateProxy。然后，会把GA实例作为ASC的SubObject进行同步，这是SubObject同步是UE自身支持的机制。</p>
<p>主要代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步GA</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAbilitySystemComponent::AddReplicatedInstancedAbility</span><span class="params">(UGameplayAbility* GameplayAbility)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="type">const</span> ELifetimeCondition LifetimeCondition = bReplicateAbilitiesToSimulatedProxies ? COND_None : COND_ReplayOrOwner;</span><br><span class="line">    <span class="built_in">AddReplicatedSubObject</span>(GameplayAbility, LifetimeCondition);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//SubObject同步</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UActorComponent::AddReplicatedSubObject</span><span class="params">(UObject* SubObject, ELifetimeCondition NetCondition)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (AActor* MyOwner=<span class="built_in">GetOwner</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        MyOwner-&gt;<span class="built_in">AddActorComponentReplicatedSubObject</span>(<span class="keyword">this</span>, SubObject, NetCondition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同步到客户端后表现如下：</p>
<div style="text-align: center;">
<img src="https://pic2.zhimg.com/v2-64548e8ebc3b26b89cb095f2c552d39d_1440w.jpg" alt="img" width="50%" />
</div>



<h2 id="常用调整命令行"><a href="#常用调整命令行" class="headerlink" title="常用调整命令行"></a>常用调整命令行</h2><p>ShowDebug AbilitySystem 展示Ability相关的内容</p>
<h2 id="自己实现方案"><a href="#自己实现方案" class="headerlink" title="自己实现方案"></a>自己实现方案</h2><h3 id="通过自定义GA实现复杂参数GAS传递"><a href="#通过自定义GA实现复杂参数GAS传递" class="headerlink" title="通过自定义GA实现复杂参数GAS传递"></a>通过自定义GA实现复杂参数GAS传递</h3><h4 id="模块与分层（结构图）"><a href="#模块与分层（结构图）" class="headerlink" title="模块与分层（结构图）"></a>模块与分层（结构图）</h4><p>它可以直接从UI层调用。且一个GA可以做多个事情。有回调回UI。</p>
<p>主要关键字：GAS的逻辑 通过创建子GA蓝图 通过蓝图被experience管理 然后被GAS触发 通过RPC传递复杂的设置参数 ServerOnly创建Actor 然后通过Replicated赋值属性回客户端）</p>
<p><img src="C:\Users\Eugene\AppData\Roaming\Typora\typora-user-images\image-20260121160114457.png" alt="image-20260121160114457"></p>
<h4 id="通用层（可复用）"><a href="#通用层（可复用）" class="headerlink" title="通用层（可复用）"></a><strong>通用层（可复用）</strong></h4><ul>
<li><ul>
<li><code>SubGameAbility/RequestBridge/UTCGRequestCallbackSubsystem</code>：客户端请求回调桥接器（<code>RequestId</code> 精确匹配）</li>
</ul>
</li>
<li><strong>3DText 特有层</strong><ul>
<li><code>UTCG3DTextModifierLibrary</code>：对外接口（蓝图&#x2F;UMG 调用入口）</li>
<li><code>UTCGAbility_Create3DText</code>：服务器创建&#x2F;修改入口（GAS Ability）</li>
<li><code>ATCGReplicatedText3DActor</code>：复制“显示参数”并在客户端应用</li>
</ul>
</li>
</ul>
<hr>
<h4 id="核心数据与关键字段"><a href="#核心数据与关键字段" class="headerlink" title="核心数据与关键字段"></a>核心数据与关键字段</h4><h5 id="2-1-FTCG3DTextParams"><a href="#2-1-FTCG3DTextParams" class="headerlink" title="2.1 FTCG3DTextParams"></a>2.1 <code>FTCG3DTextParams</code></h5><p>用于 Create&#x2F;Modify 的统一参数结构：</p>
<ul>
<li><code>Header.RequestId</code>：一次请求的唯一标识（客户端发起时生成）</li>
<li><code>Header.RequestingActor</code>：请求来源（通常是 PC）</li>
<li><code>bIsModify</code>：<code>false=Create</code>，<code>true=Modify</code></li>
<li><code>TargetActor</code>：Modify 时目标 Actor</li>
<li>文本显示参数：<code>bVisible / SpawnLocation / SpawnRotation / InitialText / TextSize / bOutLine / ...</code></li>
</ul>
<h5 id="2-2-ATCGReplicatedText3DActor-ReplicatedParams"><a href="#2-2-ATCGReplicatedText3DActor-ReplicatedParams" class="headerlink" title="2.2 ATCGReplicatedText3DActor::ReplicatedParams"></a>2.2 <code>ATCGReplicatedText3DActor::ReplicatedParams</code></h5><ul>
<li><code>ReplicatedUsing=OnRep_TextParams</code></li>
<li>服务器写入 → 客户端收到后触发 <code>OnRep_TextParams()</code></li>
</ul>
<hr>
<h4 id="Create：完整网络时序（时序图）"><a href="#Create：完整网络时序（时序图）" class="headerlink" title="Create：完整网络时序（时序图）"></a>Create：完整网络时序（时序图）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Client                                             Server                                          Client</span><br><span class="line">  |                                                  |                                               |</span><br><span class="line">  | UI 调用 `UTCG3DTextModifierLibrary`               |                                               |</span><br><span class="line">  | 生成 Params.Header.RequestId                      |                                               |</span><br><span class="line">  | 在 `UTCGRequestCallbackSubsystem` 注册回调          |                                               |</span><br><span class="line">  | TryActivateAbility                                |                                               |</span><br><span class="line">  |--------------------------------------------------&gt;| (GAS 触发 Ability 激活)                         |</span><br><span class="line">  |                                                  | `UTCGAbility_Create3DText::ActivateAbility()`  |</span><br><span class="line">  |                                                  |  1) CommitAbility                               |</span><br><span class="line">  |                                                  |  2) ServerOnly: 服务器侧执行 Spawn              |</span><br><span class="line">  |                                                  |  3) Spawn `ATCGReplicatedText3DActor`           |</span><br><span class="line">  |                                                  |  4) `InitializeFromParams_Server(Params)`       |</span><br><span class="line">  |                                                  |     - ReplicatedParams = Params                 |</span><br><span class="line">  |                                                  |     - ApplyParamsToComponents(服务器本地)        |</span><br><span class="line">  |                                                  |     - ForceNetUpdate()                          |</span><br><span class="line">  |                                                  |-------------------------- Replicate -----------&gt;|</span><br><span class="line">  |                                                  |                                               | `OnRep_TextParams()`</span><br><span class="line">  |                                                  |                                               |  ApplyParamsToComponents(客户端)</span><br><span class="line">  |                                                  |                                               |  `NotifyClientCompleted(RequestId, Actor)`</span><br><span class="line">  |                                                  |                                               |  回调触发：把 Actor 传给 UI</span><br></pre></td></tr></table></figure>

<p>关键点：</p>
<ul>
<li>服务器端负责 <strong>Spawn Actor</strong>。</li>
<li>客户端看到“完整显示效果”主要依赖：<ul>
<li><code>ReplicatedParams</code> 复制 + <code>OnRep_TextParams()</code> 应用</li>
<li><code>ForceNetUpdate()</code> 用于加速把新参数推送出去（不是“应用参数”本身）</li>
</ul>
</li>
</ul>
<hr>
<h4 id="Modify：完整网络时序（简图）"><a href="#Modify：完整网络时序（简图）" class="headerlink" title="Modify：完整网络时序（简图）"></a>Modify：完整网络时序（简图）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client                     Server                                  Client</span><br><span class="line">  |                          |                                       |</span><br><span class="line">  | 组 Params(bIsModify=true)|                                       |</span><br><span class="line">  |  TargetActor=要修改的Actor|                                       |</span><br><span class="line">  |-------------------------&gt;| `ServerText3DActor(Params)`            |</span><br><span class="line">  |                          | `UpdateFromParams_Server(Params)`      |</span><br><span class="line">  |                          |  -&gt; ReplicatedParams = Params          |</span><br><span class="line">  |                          |  -&gt; ForceNetUpdate()                   |</span><br><span class="line">  |                          |-------------------- Replicate --------&gt;|</span><br><span class="line">  |                          |                                       | `OnRep_TextParams()` Apply</span><br></pre></td></tr></table></figure>

<h4 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h4><h5 id="FTcg3dTextParams-h"><a href="#FTcg3dTextParams-h" class="headerlink" title="FTcg3dTextParams.h"></a>FTcg3dTextParams.h</h5><p><strong>文件路径</strong>: <code>3DText\Struct\FTcg3dTextParams.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/SubGameAbility/RequestBridge/TCGRequestBridgeTypes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Materials/MaterialInterface.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Extensions/Text3DDefaultMaterialExtension.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FTcg3dTextParams.generated.h&quot;</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建3DText的Gameplay Ability</span></span><br><span class="line"><span class="comment"> * 在Ability激活时动态创建Text3D Actor，并自动网络同步</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建/修改 3DText 的参数（统一结构）</span></span><br><span class="line">USTRUCT(BlueprintType)</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FTcg3dTextParams</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 通用请求头：承载 RequestId / RequestType / RequestingActor */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FTCGRequestHeaderBase Header;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Modify 时目标 Actor；Create 时可为空 */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TObjectPtr&lt;AActor&gt; TargetActor = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 是否为修改请求（true=Modify, false=Create） 该结构体参数在GA的修改和创建的时候都会调用 所以以此来判断管道*/</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">bool</span> bIsModify = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 是否显示</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">bool</span> bVisible = <span class="literal">true</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 创建位置</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FVector SpawnLocation = FVector::ZeroVector;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建旋转</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FRotator SpawnRotation = FRotator::ZeroRotator;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 文字内容</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	FText InitialText = FText::FromString(TEXT(<span class="string">&quot;New Text&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 文字大小</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">float</span> TextSize = <span class="number">50.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 是否使用线框</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	<span class="type">bool</span> bOutLine = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 字体的4个材质参数</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; FrontMaterial = nullptr;</span><br><span class="line"></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; BevelMaterial = nullptr;</span><br><span class="line"></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; ExtrudeMaterial = nullptr;</span><br><span class="line"></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category = <span class="string">&quot;TCG|3DText|Material&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;UMaterialInterface&gt; BackMaterial = nullptr;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 要使用的3DText Actor类（如果为空则使用默认AActor+TextRenderComponent）</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TSubclassOf&lt;AActor&gt; Text3DActorClass = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 可选：指定该3DText的Owner（通常传入 PlayerController 或 Pawn）。</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TObjectPtr&lt;AActor&gt; OwnerActor = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 可选：指定Instigator（通常是 Pawn）。</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere)</span><br><span class="line">	TObjectPtr&lt;APawn&gt; InstigatorPawn = nullptr;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将当前参数应用到 `UText3DComponent`。</span></span><br><span class="line"><span class="comment">	 * 备注：这是纯工具函数，不依赖 Actor/World，方便在服务器/客户端复用。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">ApplyToComponent</span><span class="params">(UText3DComponent* Text3DComponent, <span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!Text3DComponent)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		Text3DComponent-&gt;SetVisibility(InParams.bVisible);</span><br><span class="line">		Text3DComponent-&gt;SetText(InParams.InitialText);</span><br><span class="line">		Text3DComponent-&gt;SetWorldScale3D(FVector(InParams.TextSize, InParams.TextSize, InParams.TextSize));</span><br><span class="line">		Text3DComponent-&gt;SetHasOutline(InParams.bOutLine);</span><br><span class="line">		Text3DComponent-&gt;SetWorldLocation(InParams.SpawnLocation);</span><br><span class="line">		Text3DComponent-&gt;SetWorldRotation(InParams.SpawnRotation);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 若使用自定义材质，需将 Text3D 材质样式切到 Custom（UE5.6 Text3D 插件）</span></span><br><span class="line">		<span class="keyword">if</span> (InParams.FrontMaterial || InParams.BevelMaterial || InParams.ExtrudeMaterial || InParams.BackMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (UText3DDefaultMaterialExtension* DefaultMaterialExt = Cast&lt;UText3DDefaultMaterialExtension&gt;(Text3DComponent-&gt;GetMaterialExtension()))</span><br><span class="line">			&#123;</span><br><span class="line">				DefaultMaterialExt-&gt;SetStyle(EText3DMaterialStyle::Custom);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 材质应用：Text3D 插件提供具名 API（UE5.6）</span></span><br><span class="line">		<span class="keyword">if</span> (InParams.FrontMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetFrontMaterial(InParams.FrontMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (InParams.BevelMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetBevelMaterial(InParams.BevelMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (InParams.ExtrudeMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetExtrudeMaterial(InParams.ExtrudeMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (InParams.BackMaterial)</span><br><span class="line">		&#123;</span><br><span class="line">			Text3DComponent-&gt;SetBackMaterial(InParams.BackMaterial);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构造函数 - 创建参数</span></span><br><span class="line">	FTcg3dTextParams() &#123;&#125;;</span><br><span class="line">	FTcg3dTextParams(</span><br><span class="line">		AActor* RequestingActor,</span><br><span class="line">		<span class="type">const</span> <span class="type">bool</span>&amp; bIsModify,</span><br><span class="line">		<span class="type">const</span> <span class="type">bool</span>&amp; bInVisible,</span><br><span class="line">		<span class="type">const</span> FVector&amp; InSpawnLocation,</span><br><span class="line">		<span class="type">const</span> FRotator&amp; InSpawnRotation,</span><br><span class="line">		<span class="type">const</span> FText&amp; InInitialText,</span><br><span class="line">		<span class="type">float</span> InTextSize,</span><br><span class="line">		<span class="type">bool</span> bInOutLine,</span><br><span class="line">		AActor* InOwnerActor,</span><br><span class="line">		APawn* InInstigatorPawn,</span><br><span class="line">		UMaterialInterface* InFrontMaterial,</span><br><span class="line">		UMaterialInterface* InBevelMaterial,</span><br><span class="line">		UMaterialInterface* InExtrudeMaterial,</span><br><span class="line">		UMaterialInterface* InBackMaterial,</span><br><span class="line">		AActor* TargetActor = nullptr)</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;Header.RequestingActor = RequestingActor;</span><br><span class="line"></span><br><span class="line">		this-&gt;bIsModify = bIsModify;</span><br><span class="line">		this-&gt;bVisible = bInVisible;</span><br><span class="line">		this-&gt;SpawnLocation = InSpawnLocation;</span><br><span class="line">		this-&gt;SpawnRotation = InSpawnRotation;</span><br><span class="line">		this-&gt;InitialText = InInitialText;</span><br><span class="line">		this-&gt;TextSize = InTextSize;</span><br><span class="line">		this-&gt;bOutLine = bInOutLine;</span><br><span class="line"></span><br><span class="line">		this-&gt;FrontMaterial = InFrontMaterial;</span><br><span class="line">		this-&gt;BevelMaterial = InBevelMaterial;</span><br><span class="line">		this-&gt;ExtrudeMaterial = InExtrudeMaterial;</span><br><span class="line">		this-&gt;BackMaterial = InBackMaterial;</span><br><span class="line"></span><br><span class="line">		this-&gt;OwnerActor = InOwnerActor;</span><br><span class="line">		this-&gt;InstigatorPawn = InInstigatorPawn;</span><br><span class="line">		this-&gt;TargetActor = TargetActor;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCG3DTextModifierLibrary-cpp"><a href="#TCG3DTextModifierLibrary-cpp" class="headerlink" title="TCG3DTextModifierLibrary.cpp"></a>TCG3DTextModifierLibrary.cpp</h5><p><strong>文件路径</strong>: <code>3DText\TCG3DTextModifierLibrary.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCG3DTextModifierLibrary.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/SubGameAbility/RequestBridge/TCGRequestCallbackSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">TMap&lt;FGuid, TWeakObjectPtr&lt;AActor&gt;&gt; GPendingModifyTargets;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::ValidateASCAndPC</span><span class="params">(UAbilitySystemComponent* ASC, APlayerController* OwningPC, <span class="type">const</span> TCHAR* Context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!ASC)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: ASC is null!&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!OwningPC)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: OwningPC is null!&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> TAbility&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::FindAbilitySpec</span><span class="params">(UAbilitySystemComponent* ASC, FGameplayAbilitySpec*&amp; OutSpec, TAbility*&amp; OutInstance)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	OutSpec = <span class="literal">nullptr</span>;</span><br><span class="line">	OutInstance = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (FGameplayAbilitySpec&amp; AbilitySpec : ASC-&gt;<span class="built_in">GetActivatableAbilities</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (AbilitySpec.Ability &amp;&amp; AbilitySpec.Ability-&gt;<span class="built_in">IsA</span>(TAbility::<span class="built_in">StaticClass</span>()))</span><br><span class="line">		&#123;</span><br><span class="line">			OutSpec = &amp;AbilitySpec;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!OutSpec)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OutInstance = <span class="built_in">Cast</span>&lt;TAbility&gt;(OutSpec-&gt;<span class="built_in">GetPrimaryInstance</span>());</span><br><span class="line">	<span class="keyword">if</span> (!OutInstance)</span><br><span class="line">	&#123;</span><br><span class="line">		OutInstance = <span class="built_in">Cast</span>&lt;TAbility&gt;(OutSpec-&gt;Ability);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> OutInstance != <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::RegisterRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId, UObject* CallbackObject, FName CallbackFunctionName, <span class="type">const</span> TCHAR* Context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!CallbackObject || CallbackFunctionName.<span class="built_in">IsNone</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: CallbackObject/CallbackFunctionName invalid. Request will still be sent but no callback will be executed.&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UFunction* CallbackFunc = CallbackObject-&gt;<span class="built_in">FindFunction</span>(CallbackFunctionName);</span><br><span class="line">	<span class="keyword">if</span> (!CallbackFunc)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Callback function &#x27;%s&#x27; not found on object &#x27;%s&#x27;. Request will still be sent but no callback will be executed.&quot;</span>),</span><br><span class="line">			Context, *CallbackFunctionName.<span class="built_in">ToString</span>(), *<span class="built_in">GetNameSafe</span>(CallbackObject));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FProperty* FirstParam = <span class="literal">nullptr</span>;</span><br><span class="line">	FProperty* SecondParam = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">for</span> (TFieldIterator&lt;FProperty&gt; <span class="built_in">It</span>(CallbackFunc); It &amp;&amp; (It-&gt;PropertyFlags &amp; CPF_Parm); ++It)</span><br><span class="line">	&#123;</span><br><span class="line">		FProperty* Prop = *It;</span><br><span class="line">		<span class="keyword">if</span> (Prop-&gt;<span class="built_in">HasAnyPropertyFlags</span>(CPF_ReturnParm))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!FirstParam)</span><br><span class="line">		&#123;</span><br><span class="line">			FirstParam = Prop;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			SecondParam = Prop;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> bSignatureOk = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">if</span> (FirstParam &amp;&amp; !SecondParam)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="type">const</span> FObjectPropertyBase* ObjProp = <span class="built_in">CastField</span>&lt;FObjectPropertyBase&gt;(FirstParam))</span><br><span class="line">		&#123;</span><br><span class="line">			UClass* ParamClass = ObjProp-&gt;PropertyClass;</span><br><span class="line">			bSignatureOk = ParamClass &amp;&amp; ParamClass-&gt;<span class="built_in">IsChildOf</span>(AActor::<span class="built_in">StaticClass</span>());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!bSignatureOk)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Callback function &#x27;%s&#x27; on &#x27;%s&#x27; has invalid signature. Expected exactly one param: (AActor*). Request will still be sent but no callback will be executed.&quot;</span>),</span><br><span class="line">			Context, *CallbackFunctionName.<span class="built_in">ToString</span>(), *<span class="built_in">GetNameSafe</span>(CallbackObject));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (UWorld* World = ASC-&gt;<span class="built_in">GetWorld</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UGameInstance* GI = World-&gt;<span class="built_in">GetGameInstance</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (UTCGRequestCallbackSubsystem* RequestCallbackSubsystem = GI-&gt;<span class="built_in">GetSubsystem</span>&lt;UTCGRequestCallbackSubsystem&gt;())</span><br><span class="line">			&#123;</span><br><span class="line">				UTCGRequestCallbackSubsystem::FTCGOnRequestCompleted Wrapper;</span><br><span class="line">				Wrapper.<span class="built_in">BindUFunction</span>(CallbackObject, CallbackFunctionName);</span><br><span class="line">				RequestCallbackSubsystem-&gt;<span class="built_in">RegisterPendingCallback</span>(RequestId, Wrapper);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCG3DTextModifierLibrary::CancelRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (UWorld* World = ASC ? ASC-&gt;<span class="built_in">GetWorld</span>() : <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UGameInstance* GI = World-&gt;<span class="built_in">GetGameInstance</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (UTCGRequestCallbackSubsystem* RequestCallbackSubsystem = GI-&gt;<span class="built_in">GetSubsystem</span>&lt;UTCGRequestCallbackSubsystem&gt;())</span><br><span class="line">			&#123;</span><br><span class="line">				RequestCallbackSubsystem-&gt;<span class="built_in">Cancel</span>(RequestId);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::Create3DTextAsyncWithPC</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	UAbilitySystemComponent* ASC,</span></span></span><br><span class="line"><span class="params"><span class="function">	APlayerController* OwningPC,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FVector&amp; SpawnLocation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FText&amp; InitialText,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">float</span>&amp; TextSize,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bOutLine,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* FrontMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BevelMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* ExtrudeMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BackMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UObject* CallbackObject,</span></span></span><br><span class="line"><span class="params"><span class="function">	FName CallbackFunctionName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> TCHAR* Context = <span class="built_in">TEXT</span>(<span class="string">&quot;RequestCreate3DTextAsyncWithPC&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">ValidateASCAndPC</span>(ASC, OwningPC, Context))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FGameplayAbilitySpec* Spec = <span class="literal">nullptr</span>;</span><br><span class="line">	UTCGAbility_Create3DText* AbilityInstance = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">FindAbilitySpec</span>&lt;UTCGAbility_Create3DText&gt;(ASC, Spec, AbilityInstance))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Player does not have Create3DText Ability! Please grant it first.&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	AbilityInstance-&gt;LastCreatedActor = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> FTcg3dTextParams Params = <span class="built_in">FTcg3dTextParams</span>(</span><br><span class="line">		OwningPC,</span><br><span class="line">		<span class="literal">false</span>,</span><br><span class="line">		bVisible,</span><br><span class="line">		SpawnLocation,</span><br><span class="line">		SpawnRotation,</span><br><span class="line">		InitialText,</span><br><span class="line">		TextSize,</span><br><span class="line">		bOutLine,</span><br><span class="line">		OwningPC,</span><br><span class="line">		OwningPC-&gt;<span class="built_in">GetPawn</span>(),</span><br><span class="line">		FrontMaterial,</span><br><span class="line">		BevelMaterial,</span><br><span class="line">		ExtrudeMaterial,</span><br><span class="line">		BackMaterial,</span><br><span class="line">		<span class="literal">nullptr</span>);</span><br><span class="line">	</span><br><span class="line">	AbilityInstance-&gt;CurrentParams = Params;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">RegisterRequestCallback</span>(ASC, Params.Header.RequestId, CallbackObject, CallbackFunctionName, Context);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">bool</span> bSuccess = ASC-&gt;<span class="built_in">TryActivateAbility</span>(Spec-&gt;Handle);</span><br><span class="line">	<span class="keyword">if</span> (!bSuccess)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Failed to activate ability!&quot;</span>), Context);</span><br><span class="line">		<span class="built_in">CancelRequestCallback</span>(ASC, Params.Header.RequestId);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bSuccess;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UTCG3DTextModifierLibrary::Modify3DTextAsyncWithPC</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	UAbilitySystemComponent* ASC,</span></span></span><br><span class="line"><span class="params"><span class="function">	APlayerController* OwningPC,</span></span></span><br><span class="line"><span class="params"><span class="function">	AActor* TargetText3DActor,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FVector&amp; SpawnLocation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FText&amp; NewText,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">float</span>&amp; NewTextSize,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bNewOutLine,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* FrontMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BevelMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* ExtrudeMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UMaterialInterface* BackMaterial,</span></span></span><br><span class="line"><span class="params"><span class="function">	UObject* CallbackObject,</span></span></span><br><span class="line"><span class="params"><span class="function">	FName CallbackFunctionName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> TCHAR* Context = <span class="built_in">TEXT</span>(<span class="string">&quot;Modify3DTextAsyncWithPC&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">ValidateASCAndPC</span>(ASC, OwningPC, Context))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!TargetText3DActor)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: TargetText3DActor is null!&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FGameplayAbilitySpec* Spec = <span class="literal">nullptr</span>;</span><br><span class="line">	UTCGAbility_Create3DText* AbilityInstance = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">FindAbilitySpec</span>&lt;UTCGAbility_Create3DText&gt;(ASC, Spec, AbilityInstance))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Player does not have 3DText Ability! Please grant it first.&quot;</span>), Context);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> FTcg3dTextParams Params = <span class="built_in">FTcg3dTextParams</span>(</span><br><span class="line">		OwningPC,</span><br><span class="line">		<span class="literal">true</span>,</span><br><span class="line">		bVisible,</span><br><span class="line">		SpawnLocation,</span><br><span class="line">		SpawnRotation,</span><br><span class="line">		NewText,</span><br><span class="line">		NewTextSize,</span><br><span class="line">		bNewOutLine,</span><br><span class="line">		OwningPC,</span><br><span class="line">		OwningPC-&gt;<span class="built_in">GetPawn</span>(),</span><br><span class="line">		FrontMaterial,</span><br><span class="line">		BevelMaterial,</span><br><span class="line">		ExtrudeMaterial,</span><br><span class="line">		BackMaterial,</span><br><span class="line">		TargetText3DActor);</span><br><span class="line">	</span><br><span class="line">	AbilityInstance-&gt;CurrentParams = Params;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">RegisterRequestCallback</span>(ASC, Params.Header.RequestId, CallbackObject, CallbackFunctionName, Context);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">bool</span> bSuccess = ASC-&gt;<span class="built_in">TryActivateAbility</span>(Spec-&gt;Handle);</span><br><span class="line">	<span class="keyword">if</span> (!bSuccess)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;%s: Failed to activate ability!&quot;</span>), Context);</span><br><span class="line">		<span class="built_in">CancelRequestCallback</span>(ASC, Params.Header.RequestId);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> bSuccess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="TCG3DTextModifierLibrary-h"><a href="#TCG3DTextModifierLibrary-h" class="headerlink" title="TCG3DTextModifierLibrary.h"></a>TCG3DTextModifierLibrary.h</h5><p><strong>文件路径</strong>: <code>3DText\TCG3DTextModifierLibrary.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Kismet/BlueprintFunctionLibrary.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCG3DTextModifierLibrary.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UMaterialInterface</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 委托：当3DText Actor创建完成时回调</span></span><br><span class="line">DECLARE_DYNAMIC_DELEGATE_OneParam(FOnText3DCreatedCallback, AActor*, CreatedActor);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 蓝图函数库 - 简化UI调用3DText创建Ability的接口</span></span><br><span class="line"><span class="comment"> * 提供动态创建3DText Actor的功能 【不具有复用性】</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">UTCG3DTextModifierLibrary</span> :</span> public UBlueprintFunctionLibrary</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	<span class="comment">// 创建</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>, meta = (AutoCreateRefTerm = <span class="string">&quot;SpawnLocation,SpawnRotation,InitialText&quot;</span>))</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">Create3DTextAsyncWithPC</span><span class="params">(</span></span><br><span class="line"><span class="params">		UAbilitySystemComponent* ASC,</span></span><br><span class="line"><span class="params">		APlayerController* OwningPC,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FVector&amp; SpawnLocation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FText&amp; InitialText,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">float</span>&amp; TextSize,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bOutLine,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span><br><span class="line"><span class="params">		UMaterialInterface* FrontMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BevelMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* ExtrudeMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BackMaterial,</span></span><br><span class="line"><span class="params">		UObject* CallbackObject,</span></span><br><span class="line"><span class="params">		FName CallbackFunctionName)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 修改</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>, meta = (AutoCreateRefTerm = <span class="string">&quot;SpawnLocation,SpawnRotation,NewText&quot;</span>))</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">Modify3DTextAsyncWithPC</span><span class="params">(</span></span><br><span class="line"><span class="params">		UAbilitySystemComponent* ASC,</span></span><br><span class="line"><span class="params">		APlayerController* OwningPC,</span></span><br><span class="line"><span class="params">		AActor* TargetText3DActor,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FVector&amp; SpawnLocation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FRotator&amp; SpawnRotation,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FText&amp; NewText,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">float</span>&amp; NewTextSize,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bNewOutLine,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">bool</span>&amp; bVisible,</span></span><br><span class="line"><span class="params">		UMaterialInterface* FrontMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BevelMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* ExtrudeMaterial,</span></span><br><span class="line"><span class="params">		UMaterialInterface* BackMaterial,</span></span><br><span class="line"><span class="params">		UObject* CallbackObject,</span></span><br><span class="line"><span class="params">		FName CallbackFunctionName)</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">ValidateASCAndPC</span><span class="params">(UAbilitySystemComponent* ASC, APlayerController* OwningPC, <span class="type">const</span> TCHAR* Context)</span>;</span><br><span class="line">	template&lt;typename TAbility&gt;</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">FindAbilitySpec</span><span class="params">(UAbilitySystemComponent* ASC, FGameplayAbilitySpec*&amp; OutSpec, TAbility*&amp; OutInstance)</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> <span class="title function_">RegisterRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId, UObject* CallbackObject, FName CallbackFunctionName, <span class="type">const</span> TCHAR* Context)</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">CancelRequestCallback</span><span class="params">(UAbilitySystemComponent* ASC, <span class="type">const</span> FGuid&amp; RequestId)</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGAbility-Create3DText-cpp"><a href="#TCGAbility-Create3DText-cpp" class="headerlink" title="TCGAbility_Create3DText.cpp"></a>TCGAbility_Create3DText.cpp</h5><p><strong>文件路径</strong>: <code>3DText\TCGAbility_Create3DText.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AbilitySystemComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine/World.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TimerManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, off)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGAbility_Create3DText::ActivateAbility</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayAbilitySpecHandle Handle,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayAbilityActorInfo* ActorInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayAbilityActivationInfo ActivationInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">const</span> FGameplayEventData* TriggerEventData)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">ActivateAbility</span>(Handle, ActorInfo, ActivationInfo, TriggerEventData);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// GAS逻辑检测</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">CommitAbility</span>(Handle, ActorInfo, ActivationInfo))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">EndAbility</span>(Handle, ActorInfo, ActivationInfo, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 检查是否在服务器上</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">GetOwningActorFromActorInfo</span>()-&gt;<span class="built_in">HasAuthority</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 客户端：发送到服务器</span></span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][ActivateAbility] Calling ServerCreateText3DActor (Client side). RequestId=%s Params: Text=&#x27;%s&#x27; Loc=%s OwnerActor=%s InstigatorPawn=%s&quot;</span>),</span><br><span class="line">			*CurrentParams.Header.RequestId.<span class="built_in">ToString</span>(),</span><br><span class="line">			*CurrentParams.InitialText.<span class="built_in">ToString</span>(), *CurrentParams.SpawnLocation.<span class="built_in">ToString</span>(),</span><br><span class="line">			*<span class="built_in">GetNameSafe</span>(CurrentParams.OwnerActor.<span class="built_in">Get</span>()), *<span class="built_in">GetNameSafe</span>(CurrentParams.InstigatorPawn.<span class="built_in">Get</span>()));</span><br><span class="line">		<span class="built_in">ServerText3DActor</span>(CurrentParams);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 服务器：直接创建</span></span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][ActivateAbility] Spawning directly on server (Authority side).&quot;</span>));</span><br><span class="line">		<span class="keyword">if</span> (AActor* CreatedActor = <span class="built_in">SpawnText3DActor</span>(CurrentParams))</span><br><span class="line">		&#123;</span><br><span class="line">			LastCreatedActor = CreatedActor;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 触发创建时候的回调委托</span></span><br><span class="line">			OnText3DActorCreated.<span class="built_in">Broadcast</span>(CreatedActor);</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">UE_LOG</span>(LogTemp, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Successfully created Text3D Actor on server: %s&quot;</span>), </span><br><span class="line">				*CreatedActor-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">EndAbility</span>(Handle, ActorInfo, ActivationInfo, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGAbility_Create3DText::ServerText3DActor_Implementation</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 统一入口：Create/Modify 都走同一个 Server RPC</span></span><br><span class="line">	<span class="keyword">if</span> (Params.bIsModify)</span><br><span class="line">	&#123;</span><br><span class="line">		ATCGReplicatedText3DActor* RepTextActor = <span class="built_in">Cast</span>&lt;ATCGReplicatedText3DActor&gt;(Params.TargetActor);</span><br><span class="line">		<span class="keyword">if</span> (RepTextActor &amp;&amp; RepTextActor-&gt;<span class="built_in">HasAuthority</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			RepTextActor-&gt;<span class="built_in">UpdateFromParams_Server</span>(Params);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create</span></span><br><span class="line">	<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][ServerRPC] Enter ServerCreateText3DActor_Implementation. RequestId=%s This=%s OwningActor=%s Avatar=%s PC=%s Params: Text=&#x27;%s&#x27; Loc=%s OwnerActor=%s InstigatorPawn=%s&quot;</span>),</span><br><span class="line">		*Params.Header.RequestId.<span class="built_in">ToString</span>(),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="keyword">this</span>),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetOwningActorFromActorInfo</span>()),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetAvatarActorFromActorInfo</span>()),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(CurrentActorInfo ? CurrentActorInfo-&gt;PlayerController.<span class="built_in">Get</span>() : <span class="literal">nullptr</span>),</span><br><span class="line">		*Params.InitialText.<span class="built_in">ToString</span>(), *Params.SpawnLocation.<span class="built_in">ToString</span>(),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(Params.OwnerActor.<span class="built_in">Get</span>()), *<span class="built_in">GetNameSafe</span>(Params.InstigatorPawn.<span class="built_in">Get</span>()));</span><br><span class="line"></span><br><span class="line">	AActor* CreatedActor = <span class="built_in">SpawnText3DActor</span>(Params);</span><br><span class="line">	<span class="keyword">if</span> (CreatedActor)</span><br><span class="line">	&#123;</span><br><span class="line">		LastCreatedActor = CreatedActor;</span><br><span class="line">		OnText3DActorCreated.<span class="built_in">Broadcast</span>(CreatedActor);</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Log, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Successfully created Text3D Actor via RPC: %s&quot;</span>), *CreatedActor-&gt;<span class="built_in">GetName</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">AActor* <span class="title">UTCGAbility_Create3DText::SpawnText3DActor</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;[Create3DText][SpawnOnServer] Enter. RequestId=%s Avatar=%s (Auth=%d, Role=%d) Owning=%s (Auth=%d, Role=%d) Params.OwnerActor=%s Params.InstigatorPawn=%s&quot;</span>),</span><br><span class="line">		*Params.Header.RequestId.<span class="built_in">ToString</span>(),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetAvatarActorFromActorInfo</span>()),</span><br><span class="line">		<span class="built_in">GetAvatarActorFromActorInfo</span>() ? (<span class="built_in">GetAvatarActorFromActorInfo</span>()-&gt;<span class="built_in">HasAuthority</span>() ? <span class="number">1</span> : <span class="number">0</span>) : <span class="number">-1</span>,</span><br><span class="line">		<span class="built_in">GetAvatarActorFromActorInfo</span>() ? (int32)<span class="built_in">GetAvatarActorFromActorInfo</span>()-&gt;<span class="built_in">GetLocalRole</span>() : <span class="number">-1</span>,</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(<span class="built_in">GetOwningActorFromActorInfo</span>()),</span><br><span class="line">		<span class="built_in">GetOwningActorFromActorInfo</span>() ? (<span class="built_in">GetOwningActorFromActorInfo</span>()-&gt;<span class="built_in">HasAuthority</span>() ? <span class="number">1</span> : <span class="number">0</span>) : <span class="number">-1</span>,</span><br><span class="line">		<span class="built_in">GetOwningActorFromActorInfo</span>() ? (int32)<span class="built_in">GetOwningActorFromActorInfo</span>()-&gt;<span class="built_in">GetLocalRole</span>() : <span class="number">-1</span>,</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(Params.OwnerActor.<span class="built_in">Get</span>()),</span><br><span class="line">		*<span class="built_in">GetNameSafe</span>(Params.InstigatorPawn.<span class="built_in">Get</span>()));</span><br><span class="line"></span><br><span class="line">	AActor* AvatarActor = <span class="built_in">GetAvatarActorFromActorInfo</span>();</span><br><span class="line">	<span class="keyword">if</span> (!AvatarActor)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Avatar Actor is null!&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UWorld* World = <span class="built_in">GetWorld</span>();</span><br><span class="line">	<span class="keyword">if</span> (!World)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: World is null!&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 只在服务器上执行</span></span><br><span class="line">	<span class="keyword">if</span> (!AvatarActor-&gt;<span class="built_in">HasAuthority</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">UE_LOG</span>(LogTemp, Warning, <span class="built_in">TEXT</span>(<span class="string">&quot;UTCGAbility_Create3DText: Not on server!&quot;</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 准备生成参数</span></span><br><span class="line">	FActorSpawnParameters SpawnParams;</span><br><span class="line">	SpawnParams.Owner = AvatarActor;</span><br><span class="line">	SpawnParams.Instigator = <span class="built_in">Cast</span>&lt;APawn&gt;(AvatarActor);</span><br><span class="line">	SpawnParams.SpawnCollisionHandlingOverride = ESpawnActorCollisionHandlingMethod::AlwaysSpawn;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果调用侧显式提供了Owner/Instigator（通常来自 PlayerController），优先使用它</span></span><br><span class="line">	<span class="keyword">if</span> (Params.OwnerActor)</span><br><span class="line">	&#123;</span><br><span class="line">		SpawnParams.Owner = Params.OwnerActor;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (Params.InstigatorPawn)</span><br><span class="line">	&#123;</span><br><span class="line">		SpawnParams.Instigator = Params.InstigatorPawn;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果没有指定类，使用带RepNotify同步的默认实现</span></span><br><span class="line">	TSubclassOf&lt;AActor&gt; ActorClassToSpawn = Params.Text3DActorClass;</span><br><span class="line">	<span class="keyword">if</span> (!ActorClassToSpawn)</span><br><span class="line">	&#123;</span><br><span class="line">		ActorClassToSpawn = ATCGReplicatedText3DActor::<span class="built_in">StaticClass</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果指定了Actor类，使用指定的类</span></span><br><span class="line">	AActor* SpawnedActor = World-&gt;<span class="built_in">SpawnActor</span>&lt;AActor&gt;(</span><br><span class="line">		ActorClassToSpawn,</span><br><span class="line">		Params.SpawnLocation,</span><br><span class="line">		Params.SpawnRotation,</span><br><span class="line">		SpawnParams</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置Replicate（关键！）</span></span><br><span class="line">	SpawnedActor-&gt;<span class="built_in">SetReplicates</span>(<span class="literal">true</span>);</span><br><span class="line">	SpawnedActor-&gt;<span class="built_in">SetReplicateMovement</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果有Owner，使用Owner相关性（更省带宽，也更符合“归属到某个玩家”的语义）</span></span><br><span class="line">	<span class="keyword">if</span> (SpawnParams.Owner)</span><br><span class="line">	&#123;</span><br><span class="line">		SpawnedActor-&gt;<span class="built_in">SetOwner</span>(SpawnParams.Owner);</span><br><span class="line">		SpawnedActor-&gt;bNetUseOwnerRelevancy = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果是我们自定义的可复制Text3D Actor，把参数写进RepNotify变量，确保客户端也应用一遍</span></span><br><span class="line">	<span class="keyword">if</span> (ATCGReplicatedText3DActor* RepTextActor = <span class="built_in">Cast</span>&lt;ATCGReplicatedText3DActor&gt;(SpawnedActor))</span><br><span class="line">	&#123;</span><br><span class="line">		RepTextActor-&gt;<span class="built_in">InitializeFromParams_Server</span>(Params);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> SpawnedActor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, on)</span></span><br></pre></td></tr></table></figure>

<h5 id="TCGAbility-Create3DText-h"><a href="#TCGAbility-Create3DText-h" class="headerlink" title="TCGAbility_Create3DText.h"></a>TCGAbility_Create3DText.h</h5><p><strong>文件路径</strong>: <code>3DText\TCGAbility_Create3DText.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/TCGGameplayAbility.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Struct/FTcg3dTextParams.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UText3DComponent</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建并管理动态3DText Actor的Ability</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 工作流程：</span></span><br><span class="line"><span class="comment"> * 1. 客户端UI调用 → 激活Ability</span></span><br><span class="line"><span class="comment"> * 2. Ability在服务器上创建Actor</span></span><br><span class="line"><span class="comment"> * 3. Actor自动Replicate到所有客户端</span></span><br><span class="line"><span class="comment"> * 4. 返回创建的Actor引用给调用者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">UTCGAbility_Create3DText</span> :</span> public UTCGGameplayAbility</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	<span class="comment">/* 调用链条：</span></span><br><span class="line"><span class="comment">	 * ActivateAbility -&gt; ServerText3DActor -&gt; SpawnText3DActorOnServer(实际创建)</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">ActivateAbility</span><span class="params">(</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayAbilitySpecHandle Handle,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayAbilityActorInfo* ActorInfo,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayAbilityActivationInfo ActivationInfo,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> FGameplayEventData* TriggerEventData)</span> override;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Server RPC - 在服务器上创建Actor</span></span><br><span class="line">	UFUNCTION(Server, Reliable)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">ServerText3DActor</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在服务器上实际创建Actor的函数（只在服务器上调用）</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	AActor* <span class="title function_">SpawnText3DActor</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; Params)</span>;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	<span class="comment">// 当前创建参数</span></span><br><span class="line">	UPROPERTY()</span><br><span class="line">	FTcg3dTextParams CurrentParams;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 最近创建的Actor引用（用于返回给调用者）</span></span><br><span class="line">	UPROPERTY()</span><br><span class="line">	AActor* LastCreatedActor;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 委托：当Actor创建完成时触发（可在蓝图中绑定）</span></span><br><span class="line">	DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FOnText3DActorCreated, AActor*, CreatedActor);</span><br><span class="line">	</span><br><span class="line">	UPROPERTY(BlueprintAssignable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	FOnText3DActorCreated OnText3DActorCreated;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGReplicatedText3DActor-cpp"><a href="#TCGReplicatedText3DActor-cpp" class="headerlink" title="TCGReplicatedText3DActor.cpp"></a>TCGReplicatedText3DActor.cpp</h5><p><strong>文件路径</strong>: <code>3DText\TCGReplicatedText3DActor.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Net/UnrealNetwork.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine/GameInstance.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayAbilitySystem/SubGameAbility/RequestBridge/TCGRequestCallbackSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, off)</span></span><br><span class="line">ATCGReplicatedText3DActor::<span class="built_in">ATCGReplicatedText3DActor</span>()</span><br><span class="line">&#123;</span><br><span class="line">	bReplicates = <span class="literal">true</span>;</span><br><span class="line">	<span class="built_in">SetReplicateMovement</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 默认就允许用Owner相关性（如果Ability那边设置了Owner的话）</span></span><br><span class="line">	bNetUseOwnerRelevancy = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::InitializeFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">HasAuthority</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ReplicatedParams = InParams;</span><br><span class="line">	<span class="built_in">ApplyParamsToComponents</span>(ReplicatedParams);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 让本帧就尝试把新参数推给客户端</span></span><br><span class="line">	<span class="built_in">ForceNetUpdate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::OnRep_TextParams</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">ApplyParamsToComponents</span>(ReplicatedParams);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 客户端：参数已就绪并应用，通知监听者</span></span><br><span class="line">	OnText3DInitialized.<span class="built_in">Broadcast</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (UWorld* World = <span class="built_in">GetWorld</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UGameInstance* GI = World-&gt;<span class="built_in">GetGameInstance</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 新：通用请求回调（RequestId 精确匹配）</span></span><br><span class="line">			<span class="keyword">if</span> (ReplicatedParams.Header.RequestId.<span class="built_in">IsValid</span>())</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (UTCGRequestCallbackSubsystem* RequestCallbackSubsystem = GI-&gt;<span class="built_in">GetSubsystem</span>&lt;UTCGRequestCallbackSubsystem&gt;())</span><br><span class="line">				&#123;</span><br><span class="line">					RequestCallbackSubsystem-&gt;<span class="built_in">NotifyClientCompleted</span>(ReplicatedParams.Header.RequestId, <span class="keyword">this</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::UpdateFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">InitializeFromParams_Server</span>(InParams);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::ApplyParamsToComponents</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (UText3DComponent* LocalText3DComponent = <span class="built_in">GetText3DComponent</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		FTcg3dTextParams::<span class="built_in">ApplyToComponent</span>(LocalText3DComponent, InParams);</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span> 颜色/材质：将 InParams 的字段在这里完整应用，确保回调语义成立</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATCGReplicatedText3DActor::GetLifetimeReplicatedProps</span><span class="params">(TArray&lt;FLifetimeProperty&gt;&amp; OutLifetimeProps)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">GetLifetimeReplicatedProps</span>(OutLifetimeProps);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DOREPLIFETIME</span>(ATCGReplicatedText3DActor, ReplicatedParams);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> optimize(<span class="string">&quot;&quot;</span>, on)</span></span><br></pre></td></tr></table></figure>

<h5 id="TCGReplicatedText3DActor-h"><a href="#TCGReplicatedText3DActor-h" class="headerlink" title="TCGReplicatedText3DActor.h"></a>TCGReplicatedText3DActor.h</h5><p><strong>文件路径</strong>: <code>3DText\TCGReplicatedText3DActor.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Text3DActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGAbility_Create3DText.h&quot;</span> <span class="comment">// for FTCG3DTextParams</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGReplicatedText3DActor.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个可复制“显示参数”的Text3D Actor。</span></span><br><span class="line"><span class="comment"> * 说明：UE默认只复制Actor/组件的Transform与Movement，</span></span><br><span class="line"><span class="comment"> * Text3DComponent 的文本/材质等通常不会自动复制。</span></span><br><span class="line"><span class="comment"> * 这里用 RepNotify 把服务器上的参数同步到客户端，再在客户端应用到组件。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FTCGOnText3DInitialized, AActor*, Text3DActor);</span><br><span class="line"></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">ATCGReplicatedText3DActor</span> :</span> public AText3DActor</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	ATCGReplicatedText3DActor();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当客户端通过OnRep收到参数并完成Apply后，会广播该事件</span></span><br><span class="line">	UPROPERTY(BlueprintAssignable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	FTCGOnText3DInitialized OnText3DInitialized;   </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 服务器调用：设置初始参数并立即应用一次，随后通过复制同步给客户端。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">InitializeFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 服务器：在已存在 Actor 上更新复制参数，并 ForceNetUpdate 与客户端回调 */</span></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category = <span class="string">&quot;TCG|3DText&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">UpdateFromParams_Server</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 读取当前复制参数（只读） */</span></span><br><span class="line">	<span class="type">const</span> FTcg3dTextParams&amp; <span class="title function_">GetReplicatedParams</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> ReplicatedParams; &#125;</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	UPROPERTY(ReplicatedUsing = OnRep_TextParams)</span><br><span class="line">	FTcg3dTextParams ReplicatedParams;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** RepNotify 回调：当 ReplicatedParams 变化时调用 👆有宏在UE网络框架中实现调用*/</span></span><br><span class="line">	UFUNCTION()</span><br><span class="line">	<span class="type">void</span> <span class="title function_">OnRep_TextParams</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span> <span class="title function_">ApplyParamsToComponents</span><span class="params">(<span class="type">const</span> FTcg3dTextParams&amp; InParams)</span>;</span><br><span class="line"></span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">GetLifetimeReplicatedProps</span><span class="params">(TArray&lt;FLifetimeProperty&gt;&amp; OutLifetimeProps)</span> <span class="type">const</span> override;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGRequestBridgeTypes-h"><a href="#TCGRequestBridgeTypes-h" class="headerlink" title="TCGRequestBridgeTypes.h"></a>TCGRequestBridgeTypes.h</h5><p><strong>文件路径</strong>: <code>RequestBridge\TCGRequestBridgeTypes.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameplayTagContainer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestBridgeTypes.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用请求头（Base）：用于把一次“请求”和未来的回调精确关联。</span></span><br><span class="line"><span class="comment"> * 建议各业务 Params 内包含一个 `Header` 字段来统一承载 RequestId / RequestType / RequestingActor。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">USTRUCT(BlueprintType)</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">FTCGRequestHeaderBase</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 唯一请求ID（客户端生成） */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	FGuid RequestId = FGuid::NewGuid();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 可选：发起者（通常是 PlayerController 或 Pawn） */</span></span><br><span class="line">	UPROPERTY(BlueprintReadWrite, EditAnywhere, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	TObjectPtr&lt;AActor&gt; RequestingActor = nullptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="TCGRequestCallbackSubsystem-cpp"><a href="#TCGRequestCallbackSubsystem-cpp" class="headerlink" title="TCGRequestCallbackSubsystem.cpp"></a>TCGRequestCallbackSubsystem.cpp</h5><p><strong>文件路径</strong>: <code>RequestBridge\TCGRequestCallbackSubsystem.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestCallbackSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGRequestCallbackSubsystem::RegisterPendingCallback</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, <span class="type">const</span> FTCGOnRequestCompleted&amp; Callback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!RequestId.<span class="built_in">IsValid</span>() || !Callback.<span class="built_in">IsBound</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PendingCallbacks.<span class="built_in">Add</span>(RequestId, Callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGRequestCallbackSubsystem::NotifyClientCompleted</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, AActor* ResultActor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!RequestId.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FTCGOnRequestCompleted* Callback = PendingCallbacks.<span class="built_in">Find</span>(RequestId);</span><br><span class="line">	<span class="keyword">if</span> (!Callback)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FTCGOnRequestCompleted Copy = *Callback;</span><br><span class="line">	PendingCallbacks.<span class="built_in">Remove</span>(RequestId);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Copy.<span class="built_in">IsBound</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		Copy.<span class="built_in">Execute</span>(ResultActor);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UTCGRequestCallbackSubsystem::Cancel</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!RequestId.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PendingCallbacks.<span class="built_in">Remove</span>(RequestId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="TCGRequestCallbackSubsystem-h"><a href="#TCGRequestCallbackSubsystem-h" class="headerlink" title="TCGRequestCallbackSubsystem.h"></a>TCGRequestCallbackSubsystem.h</h5><p><strong>文件路径</strong>: <code>RequestBridge\TCGRequestCallbackSubsystem.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Subsystems/GameInstanceSubsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestBridgeTypes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TCGRequestCallbackSubsystem.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCG_AWESOMELIVE_API</span> <span class="title">UTCGRequestCallbackSubsystem</span> :</span> public UGameInstanceSubsystem</span><br><span class="line">&#123;</span><br><span class="line">	GENERATED_BODY()</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	DECLARE_DYNAMIC_DELEGATE_OneParam(FTCGOnRequestCompleted, AActor*, ResultActor);</span><br><span class="line"></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">RegisterPendingCallback</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, <span class="type">const</span> FTCGOnRequestCompleted&amp; Callback)</span>;</span><br><span class="line"></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">NotifyClientCompleted</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId, AActor* ResultActor)</span>;</span><br><span class="line"></span><br><span class="line">	UFUNCTION(BlueprintCallable, Category=<span class="string">&quot;TCG|Request&quot;</span>)</span><br><span class="line">	<span class="type">void</span> <span class="title function_">Cancel</span><span class="params">(<span class="type">const</span> FGuid&amp; RequestId)</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	UPROPERTY()</span><br><span class="line">	TMap&lt;FGuid, FTCGOnRequestCompleted&gt; PendingCallbacks;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>







<h2 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h2><h3 id="GAS网络生成的BP需要考虑所有者"><a href="#GAS网络生成的BP需要考虑所有者" class="headerlink" title="GAS网络生成的BP需要考虑所有者"></a>GAS网络生成的BP需要考虑所有者</h3><p><img src="https://s2.loli.net/2025/11/21/YdyXqrBw7hKoGuT.png" alt="image-20251114160307855" style="zoom:25%;" /><img src="https://s2.loli.net/2025/11/21/KmIpqniL5s7ESuj.png" alt="image-20251114160401410" style="zoom: 33%;" /></p>
<p>如果是在Server端生成的BP，一定要指定“Owner”，它意味着是这个生成的东西在各网络设备之间指定的所有者。<br>当这个所有者内部需要执行一个网络的Event的时候，它需要通知一个客户端，如果没有Owner，这个Event会被拒绝执行。</p>
<h3 id="随机数问题"><a href="#随机数问题" class="headerlink" title="随机数问题"></a>随机数问题</h3><p>注意网络端和服务端生成随机数会不一样。</p>
<h3 id="在GE里拿到“事件触发者”和“事件被影响者”"><a href="#在GE里拿到“事件触发者”和“事件被影响者”" class="headerlink" title="在GE里拿到“事件触发者”和“事件被影响者”"></a>在GE里拿到“事件触发者”和“事件被影响者”</h3><div style="text-align: center;">
<img src="https://s2.loli.net/2025/11/21/D9VA2s5EpevFXxL.png" alt="image-20251120172105945" width="50%" />
</div>

<p>如上图，我有一个需求，投掷物。<br>需要给GE传递“投掷物这个物体”和“被撞的人”。<br>其中，在我这里，“被撞的人”是要执行的ASC的所有者（即这里的Instigator），在应用GE的时候必须提供。</p>
<p>调用 BP_ApplyGameplayEffectToTarget 时，它内部会：</p>
<ul>
<li>用「作为 Target 的 ASC 的 Owner &#x2F; Avatar Actor」来构造 FGameplayEffectContextHandle；</li>
<li>在这个 EffectContext 里自动填好 Instigator、EffectCauser 等字段；</li>
<li>把这个 EffectContext 放进 FGameplayEffectSpec，最后应用到 Target；</li>
</ul>
<p>（正如图上所示，它其实有两个Target节点，上面那个是调用这个事件的Target（蓝图中常见），下面那个是被命中的“被撞的人”，因为碰巧都叫Target所以在这里重复了）</p>
<p>这个比较好理解。但，实际上GC一个内部结构里，有三个储存用来表达“事件责任相关人”的变量：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType, meta = (HasNativeBreak = <span class="string">&quot;/Script/GameplayAbilities.AbilitySystemBlueprintLibrary.BreakGameplayCueParameters&quot;</span>, HasNativeMake = <span class="string">&quot;/Script/GameplayAbilities.AbilitySystemBlueprintLibrary.MakeGameplayCueParameters&quot;</span>))</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FGameplayCueParameters</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_USTRUCT_BODY</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Instigator actor, the actor that owns the ability system component */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadWrite, Category=GameplayCue)</span><br><span class="line">    TWeakObjectPtr&lt;AActor&gt; Instigator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The physical actor that actually did the damage, can be a weapon or projectile */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadWrite, Category=GameplayCue)</span><br><span class="line">    TWeakObjectPtr&lt;AActor&gt; EffectCauser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Object this effect was created from, can be an actor or static object. Useful to bind an effect to a gameplay object */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadWrite, Category=GameplayCue)</span><br><span class="line">    TWeakObjectPtr&lt;<span class="type">const</span> UObject&gt; SourceObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在文件UE_5.6\Engine\Plugins\Runtime\GameplayAbilities\Source\GameplayAbilities\Public\GameplayEffectTypes.h中</p>
<p>这三个分别是：Instigator、EffectCauser、SourceObject。</p>
<p>按照说明，他们“责任”分别的作用是</p>
<ul>
<li>Instigator：谁是「施加这个效果的控制者」，通常是 Pawn&#x2F;Character。</li>
<li>EffectCauser：是哪一个 Actor&#x2F;Component「具体造成了这次效果」，比如武器、投掷物。</li>
<li>SourceObject：一个完全开放给你用的 UObject*，可以是武器实例、技能实例、DataAsset、投掷物等。</li>
</ul>
<p>这三个字段的值，不一定都有，是否自动填，取决于你走的 GAS 调用路径。通常应用的路径上，Instigator和EffectCauser都是同一个值，都是这个ASC的拥有者。但是SourceObject通常是空的（通过GA主动和触发的GE有机会把GA的SourceObejct传入进去），所以可以自己指定，用作自己的参数。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1X5411V7jh/">官方教学视频</a>:我看着这个视频作为最初的入门</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/486808688">知乎GAS系统快速入门</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/gameplay-ability-system-for-unreal-engine">Unreal官方的GAS讲解</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1vj4vzkELp?spm_id_from=333.788.player.switch&vd_source=60b376a57ab956cf81ad81ef20747a92&p=14">关于GA的讲解</a>：别忘了可以点开B站的AI翻译</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Nv42127HS">一个很不错的关于</a>GAS系统实操讲解</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1K7421Z7vm/">一个很不错的Lyra示例的讲解</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1934717850632823338">文字讲解Lyra结构</a>适合作为研究基础，然后配合上面的视频看。</p>
</li>
</ol>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Unreal-Engine/">Unreal Engine</a> <a href="/tags/Game-Development/">Game Development</a> <a href="/tags/Gameplay-Ability-System/">Gameplay Ability System</a> <a href="/tags/GAS/">GAS</a> <a href="/tags/C/">C++</a> <a href="/tags/Network-Programming/">Network Programming</a> <a href="/tags/RPG/">RPG</a> <a href="/tags/Game-Framework/">Game Framework</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>

    <!-- Table of Contents will be generated by toc-collapse.js -->

</section><!-- end main -->

<!-- After footer scripts -->

<!-- 加载打包后的模块化代码 -->

<script src="/dist/js/main.js"></script>


<!-- 保留原有的 toc-collapse.js 直到完全重构 -->

<script src="/js/toc-collapse.js"></script>


<!-- Language Switcher -->

<script src="/js/i18n-data.js"></script>


<script src="/js/language-switcher.js"></script>


<!-- 第三方库 (CDN) -->
<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<!-- Featherlight (图库) -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Mermaid 初始化 -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
  if (typeof mermaid !== 'undefined') {
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      securityLevel: 'loose'
    });

    // Find and process mermaid code blocks
    const codeBlocks = document.querySelectorAll('figure.highlight.plaintext .code');

    codeBlocks.forEach((codeElement, index) => {
      let code = codeElement.textContent || codeElement.innerText;

      // Check if it's a mermaid diagram
      if (code.trim().match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|journey|pie|gitgraph|erDiagram)/)) {
        code = code.trim().replace(/^\s+|\s+$/g, '');

        const mermaidDiv = document.createElement('div');
        mermaidDiv.className = 'mermaid';
        mermaidDiv.textContent = code;
        mermaidDiv.id = 'mermaid-diagram-' + index;

        const figureElement = codeElement.closest('figure');
        if (figureElement) {
          figureElement.parentNode.replaceChild(mermaidDiv, figureElement);
        }
      }
    });

    setTimeout(() => {
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    }, 100);
  }
});
</script>

<!-- ShaderToy Placeholder Processing -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(function() {
    const elements = document.querySelectorAll('.shadertoy-placeholder[data-id]');

    elements.forEach(element => {
      const shaderID = element.getAttribute('data-id');

      if (shaderID) {
        const container = document.createElement('div');
        container.style.cssText = `
          position: relative;
          width: 100%;
          height: 400px;
          margin: 20px 0;
          border: 2px solid #bfbbbb;
          border-radius: 8px;
          overflow: hidden;
          background-color: #f6f6f6;
        `;

        const iframe = document.createElement('iframe');
        iframe.src = \`https://www.shadertoy.com/embed/\${shaderID}?gui=true&t=10&paused=false&muted=false\`;
        iframe.style.cssText = `
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border: none;
        `;
        iframe.allowFullscreen = true;
        iframe.loading = 'lazy';

        container.appendChild(iframe);
        element.parentNode.insertBefore(container, element);
        element.parentNode.removeChild(element);
      }
    });
  }, 1000);
});
</script>

<!-- Disqus Comments -->


<!-- Google Analytics -->



</body>

</html>