<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="This is a space where I can share my thoughts and works with freely.">
    

    <!--Author-->
    
        <meta name="author" content="Eugene Hsuan">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Shader Learning Notes"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Eugene&#39;s Page"/>

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>Shader Learning Notes - Eugene&#39;s Page</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="/css/table.css">

    
<link rel="stylesheet" href="/css/image-zoom.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Mermaid Support -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>

    <!-- Google Analytics -->
    


    <!--Favicon-->
    
        <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    

<meta name="generator" content="Hexo 7.3.0"></head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">Eugene's Page</a>
        <div class="subtitle">Filmmaker / Developer</div>
        <div class="description">This is a space where I can share my thoughts and works with freely.</div>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
                <li><a href="https://space.bilibili.com/29291963" class="behance" target="_blank" data-title="Bilibili"></a></li>
            
            
                <li><a href="https://www.instagram.com/yu_chinghsuan?igsh=Mm54ajloc3c1NW5m&utm_source=qr" class="instagram" target="_blank" data-title="Instagram"></a></li>
            
            
                <li><a href="https://www.douban.com/people/Youdrew_Xuan/" class="dribble" target="_blank" data-title="Douban"></a></li>
            
            
                <li><a href="mailto:youdrewxuan@icloud.com" class="google" target="_blank" data-title="Email"></a></li>
            
            
                <li><a href="/atom.xml" class="rss" target="_blank" data-title="RSS"></a></li>
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2025 Eugene Hsuan</p>
            <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p>
            <p>Modified based on <a href="https://github.com/klugjo/hexo-theme-magnetic" target="_blank">Magnetic</a> theme</p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('https://s2.loli.net/2025/09/13/vlTKo196wnDypC2.png');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2025/09/13/Aximmetry/" class="previous" data-title="Aximmetry Learning Notes"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a class="next disabled"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">Shader Learning Notes</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="Unreal-Shader学习"><a href="#Unreal-Shader学习" class="headerlink" title="Unreal Shader学习"></a>Unreal Shader学习</h1><h2 id="安装及基础概念"><a href="#安装及基础概念" class="headerlink" title="安装及基础概念"></a>安装及基础概念</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7164635658084941837">知乎 《Shader从入门到放弃》 在VS中可以安装ShaderToy来观测GLSL</a><br>👆这个文字教程也是很不错的</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7089771936271564807">Unreal 5.0 材质中添加自定义 Shader 代码</a>  在UE中需要设置Shder文件的位置</p>
<p>&lt;img src&#x3D;”<a target="_blank" rel="noopener" href="https://s2.loli.net/2025/09/13/CxzRNf1Witu69IU.png">https://s2.loli.net/2025/09/13/CxzRNf1Witu69IU.png</a>“ alt&#x3D;”Unreal Sha原本的3D流程应该是：”原画师绘制场景图（将3D场景画下来） -&gt; 建模师根据原画构建场景模型（产出3D模型）-&gt; 程序渲染（将3D模型导入到引擎中，或者其他3D渲染库），然后渲染成画面”。</p>
<p><img src="https://s2.loli.net/2025/09/13/bGh2JSUj4oK1WVI.png" alt="img" style="width: 30%;">学习” style&#x3D;”width: 30%;”&gt;</p>
<p>主要是两种着色器：</p>
<ol>
<li><p><strong>Fragment Shader</strong>（片元shader）：输入插值后的顶点数据，输出最终像素颜色（<code>fragColor</code>）。</p>
</li>
<li><p><strong>Vertex Shader</strong>（顶点Shader）：输入单个顶点数据（位置&#x2F;法线等），输出处理后的顶点位置（<code>gl_Position</code>）和其他插值数据。</p>
</li>
<li><p>compute shader 计算着色器</p>
</li>
<li><p>geometry shader 几何着色器</p>
</li>
<li><p>….</p>
</li>
</ol>
<h1 id="HLSL"><a href="#HLSL" class="headerlink" title="HLSL"></a>HLSL</h1><h2 id="基础的语法"><a href="#基础的语法" class="headerlink" title="基础的语法"></a>基础的语法</h2><table>
<thead>
<tr>
<th>min max<br/></th>
<th>最大最小<br/></th>
</tr>
</thead>
<tbody><tr>
<td>abs<br/></td>
<td>绝对值<br/></td>
</tr>
<tr>
<td>fmod<br/></td>
<td>取余操作<br/></td>
</tr>
<tr>
<td>round<br/></td>
<td>四舍五入<br/></td>
</tr>
<tr>
<td>pow<br/></td>
<td>指数<br/></td>
</tr>
<tr>
<td>sqrt rsqrt<br/></td>
<td>平方根 和 倒数平方根<br/></td>
</tr>
<tr>
<td>degrees（x） redians<br/></td>
<td>弧度转角度 角度转弧度<br/></td>
</tr>
<tr>
<td>length<br/></td>
<td>向量到原点的距离<br/></td>
</tr>
<tr>
<td>frac(sin(dot(uv, float2(12.9898, 78.233))) * 43758.5453);<br/></td>
<td>噪声算法<br/></td>
</tr>
<tr>
<td>sin cos tan<br/></td>
<td>三角函数<br/></td>
</tr>
<tr>
<td>asin acos atan<br/></td>
<td>他们的反函数<br/></td>
</tr>
<tr>
<td>sinh cosh tanh<br/></td>
<td>双曲线函数<br/></td>
</tr>
<tr>
<td>ceil<br/></td>
<td>数值范围函数<br/></td>
</tr>
</tbody></table>
<img src="https://s2.loli.net/2025/09/13/Db5ArJdyQv7E9YG.png" alt="Unreal Shader学习-1" style="width: 30%;">

<h2 id="UV坐标系说明"><a href="#UV坐标系说明" class="headerlink" title="UV坐标系说明:"></a><strong>UV坐标系说明:</strong></h2><ul>
<li>原点 <strong>(0,0)</strong> 位于左下角</li>
<li>(0,1) 左上角，(1,1) 右上角，(1,0) 右下角</li>
</ul>
<h1 id="GLSL"><a href="#GLSL" class="headerlink" title="GLSL"></a>GLSL</h1><h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><h3 id="step"><a href="#step" class="headerlink" title="step"></a>step</h3><blockquote>
<p>如果x 小于某个值，则返回 0，如果大于等于这个值，则返回1。</p>
</blockquote>
<p>所以上面的代码可以简化成：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if(abs(uv.x) &lt;= 2. * fwidth(uv.x)) &#123;</span></span><br><span class="line"><span class="comment">//     color = vec3(0.0, 1.0, 0.0);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// ===&gt;</span></span><br><span class="line"></span><br><span class="line">color = <span class="built_in">step</span>(<span class="built_in">abs</span>(uv.x), <span class="number">2.0</span> * <span class="built_in">fwidth</span>(uv.x)) * <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="mix"><a href="#mix" class="headerlink" title="mix"></a>mix</h3><blockquote>
<p>该函数的实际上执行的就是一个简单的 <em><strong>线性差值</strong></em>。 简单的说就是：当a &#x3D; 1时，返回的值为y, 但a &#x3D; 0时，返回x的值，如果返回的值为0.5，则返回 <code>0.5x + 0.5y</code>的值，同理，如果a &#x3D; 0.2, 返回 <code>0.8 * a + 0.2 * y</code>。</p>
</blockquote>
<p>我们可以利用这个函数来做颜色叠加，颜色叠加的公式可以写为：<br>$$<br>Color&#x3D;Src.color∗(1−Dst.a)+Dst.color∗Dst.a<br>$$</p>
<h3 id="smoothstep"><a href="#smoothstep" class="headerlink" title="smoothstep"></a>smoothstep</h3><img src="https://s2.loli.net/2025/09/13/serIA7TCWUdJnBY.png" alt="ShaderSmoothstep" style="width: 30%;">

<p>我们可以直观的看出：当x &lt; 0时，返回0，当 x &gt; 1时，返回1，如果 x 处于0~1之间时，则有一个类似于线性插值的过渡，但是请注意，这里并不是线性插值，因为在接近两端的值的时候，该函数有一个平滑的过渡。所以我们可以通过这一点来对 <code>step</code> 函数进行替换以解决锯齿的问题。</p>
<h3 id="floor"><a href="#floor" class="headerlink" title="floor"></a>floor</h3><p> 作用是<strong>向下取整</strong>，它会返回不大于输入值的最大整数。例如：对 <code>uv</code> 向量的每个分量（x和y）分别执行向下取整</p>
<p>例如：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">floor</span>(<span class="number">3.7</span>)` → `<span class="number">3.0</span></span><br><span class="line"><span class="built_in">floor</span>(<span class="number">-1.2</span>)` → `<span class="number">-2.0</span></span><br></pre></td></tr></table></figure>

<h2 id="核心步骤（渲染管线）"><a href="#核心步骤（渲染管线）" class="headerlink" title="核心步骤（渲染管线）"></a>核心步骤（渲染管线）</h2><ol>
<li>顶点变换的过程（顶点着色器）</li>
<li>图元装配（按哪种方式装配图元，装配为点，线还是三角形）</li>
<li>光栅化（将上述的图元从矢量图形转换为像素组成的图形）</li>
<li>着色（片段着色器）</li>
<li>测试（Alpha测试，深度测试，模板测试等）&amp; 混合</li>
</ol>
<img src="https://s2.loli.net/2025/09/13/oXpMmr2g5wUtbyP.png" alt="WXWorkCapture_17531696303010" style="width: 30%;">

<h2 id="坐标系"><a href="#坐标系" class="headerlink" title="坐标系"></a>坐标系</h2><div style="display: flex; gap: 20px; align-items: flex-start;">
<img src="https://s2.loli.net/2025/09/13/d1zabnP8quoMp3F.png" alt="image-20250722154307710" style="width: 30%;">
<img src="https://s2.loli.net/2025/09/13/hxSrfLa5FeM7UnD.png" alt="image-20250722154418915" style="width: 30%;">
</div>

<p>这是左手坐标系 反之是右手坐标系</p>
<p>OpenGL是右手坐标系</p>
<h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><h3 id="1-最初始的实例代码-（实现一个坐标轴）"><a href="#1-最初始的实例代码-（实现一个坐标轴）" class="headerlink" title="1. 最初始的实例代码  （实现一个坐标轴）:"></a>1. 最初始的实例代码  （实现一个坐标轴）:</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 归一化uv坐标到[-1,1]范围，保持宽高比</span></span><br><span class="line"><span class="type">vec2</span> fixUV(<span class="type">vec2</span> coord) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2.0</span> * (coord - <span class="number">0.5</span> * iResolution.xy) / <span class="built_in">min</span>(iResolution.x, iResolution.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制网格线</span></span><br><span class="line"><span class="type">bool</span> drawGrid(<span class="type">vec2</span> uv, <span class="type">float</span> scale) &#123;</span><br><span class="line">    <span class="comment">// fract(uv * scale)：将坐标按比例缩放后取小数部分，得到每个网格内的相对坐标</span></span><br><span class="line">    <span class="comment">// fwidth(f_uv.x)：计算片段着色器中相邻像素的梯度，即当前像素到下一像素的变化率</span></span><br><span class="line">    <span class="type">vec2</span> f_uv = <span class="built_in">fract</span>(uv * scale);</span><br><span class="line">    <span class="comment">// abs(f_uv.x) &lt; fwidth(f_uv.x)：当相对坐标接近 0 时（即网格线位置），返回 true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(f_uv.x) &lt; <span class="built_in">fwidth</span>(f_uv.x) || <span class="built_in">abs</span>(f_uv.y) &lt; <span class="built_in">fwidth</span>(f_uv.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制坐标轴</span></span><br><span class="line"><span class="type">vec3</span> drawAxis(<span class="type">vec2</span> uv) &#123;</span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(uv.x) &lt; <span class="built_in">fwidth</span>(uv.x)) &#123;</span><br><span class="line">        color = <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>); <span class="comment">// x轴为绿色</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(uv.y) &lt; <span class="built_in">fwidth</span>(uv.y)) &#123;</span><br><span class="line">        color = <span class="type">vec3</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>); <span class="comment">// y轴为红色</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="comment">// 归一化坐标</span></span><br><span class="line">    <span class="type">vec2</span> uv = fixUV(fragCoord);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基础背景色</span></span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制网格</span></span><br><span class="line">    <span class="keyword">if</span>(drawGrid(uv, <span class="number">3.0</span>)) &#123;</span><br><span class="line">        color = <span class="type">vec3</span>(<span class="number">1.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制坐标轴（会覆盖网格线）</span></span><br><span class="line">    <span class="type">vec3</span> axisColor = drawAxis(uv);</span><br><span class="line">    <span class="keyword">if</span>(axisColor != <span class="type">vec3</span>(<span class="number">0.0</span>)) &#123;</span><br><span class="line">        color = axisColor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    fragColor = <span class="type">vec4</span>(color, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.shadertoy.com/view/Wf2fRw">https://www.shadertoy.com/view/Wf2fRw</a><br>这个shader创建了一个坐标系统，包含网格线和彩色坐标轴。</p>
<h3 id="2-实现函数的y-kx的绘制"><a href="#2-实现函数的y-kx的绘制" class="headerlink" title="2. 实现函数的y&#x3D;kx的绘制"></a>2. 实现函数的y&#x3D;kx的绘制</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 归一化uv坐标到[-1,1]范围，保持宽高比</span></span><br><span class="line"><span class="type">vec2</span> fixUV(<span class="type">vec2</span> coord) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2.0</span> * (coord - <span class="number">0.5</span> * iResolution.xy) / <span class="built_in">min</span>(iResolution.x, iResolution.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制网格线</span></span><br><span class="line"><span class="type">bool</span> drawGrid(<span class="type">vec2</span> uv, <span class="type">float</span> scale) &#123;</span><br><span class="line">    <span class="type">vec2</span> f_uv = <span class="built_in">fract</span>(uv * scale);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(f_uv.x) &lt; <span class="built_in">fwidth</span>(f_uv.x) || <span class="built_in">abs</span>(f_uv.y) &lt; <span class="built_in">fwidth</span>(f_uv.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制坐标轴</span></span><br><span class="line"><span class="type">vec3</span> drawAxis(<span class="type">vec2</span> uv) &#123;</span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(uv.x) &lt; <span class="built_in">fwidth</span>(uv.x)) &#123;</span><br><span class="line">        color = <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>); <span class="comment">// x轴为绿色</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(uv.y) &lt; <span class="built_in">fwidth</span>(uv.y)) &#123;</span><br><span class="line">        color = <span class="type">vec3</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>); <span class="comment">// y轴为红色</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算点到直线距离的向量实现</span></span><br><span class="line"><span class="comment">// 这个函数计算点p到线段ab的最短距离</span></span><br><span class="line"><span class="comment">// a、b是线段的两个端点</span></span><br><span class="line"><span class="type">float</span> distLine(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">vec2</span> ab = b - a;</span><br><span class="line">    <span class="type">vec2</span> ap = p - a;</span><br><span class="line">    <span class="type">vec2</span> ad = <span class="built_in">dot</span>(ab, ap) / <span class="built_in">dot</span>(ab, ab) * ab;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">length</span>(ap - ad);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="comment">// 旧的部分</span></span><br><span class="line">    <span class="type">vec2</span> uv = fixUV(fragCoord);</span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">if</span>(drawGrid(uv, <span class="number">10.0</span>)) &#123;</span><br><span class="line">        color = <span class="type">vec3</span>(<span class="number">1.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">vec3</span> axisColor = drawAxis(uv);</span><br><span class="line">    <span class="keyword">if</span>(axisColor != <span class="type">vec3</span>(<span class="number">0.0</span>)) &#123;</span><br><span class="line">        color = axisColor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> d = distLine(uv, <span class="type">vec2</span>(<span class="number">0.0</span>), <span class="type">vec2</span>(<span class="number">1.0</span>));</span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>), <span class="built_in">smoothstep</span>(<span class="number">0.002</span>, <span class="number">0.001</span>, d));</span><br><span class="line">    fragColor = <span class="type">vec4</span>(color, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.shadertoy.com/view/3c2fzw">https://www.shadertoy.com/view/3c2fzw</a></p>
<h3 id="3-实现一段复杂函数的绘制（分段绘制）"><a href="#3-实现一段复杂函数的绘制（分段绘制）" class="headerlink" title="3. 实现一段复杂函数的绘制（分段绘制）"></a>3. 实现一段复杂函数的绘制（分段绘制）</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define PI 3.1415926</span></span><br><span class="line"><span class="meta">#define STEP 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> fixUV(<span class="type">vec2</span> coord) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3.0</span> * (<span class="number">2.</span> * (coord.xy - <span class="number">0.5</span> * iResolution.xy) / <span class="built_in">min</span>(iResolution.x, iResolution.y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec3</span> grid(<span class="type">vec2</span> uv) &#123;</span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.95</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">vec2</span> cell = <span class="number">1.0</span> - <span class="number">2.0</span> * <span class="built_in">abs</span>(<span class="built_in">fract</span>(uv) - <span class="number">0.5</span>);</span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.7</span>), <span class="built_in">step</span>(cell.x, <span class="number">4.0</span> * <span class="built_in">fwidth</span>(uv.x)));</span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.7</span>), <span class="built_in">smoothstep</span>(<span class="number">4.0</span> * <span class="built_in">fwidth</span>(uv.y), <span class="number">3.9</span> * <span class="built_in">fwidth</span>(uv.y), cell.y));</span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.3</span>, <span class="number">0.7</span>, <span class="number">0.8</span>), <span class="built_in">smoothstep</span>(<span class="number">2.0</span> * <span class="built_in">fwidth</span>(uv.x), <span class="number">1.9</span> * <span class="built_in">fwidth</span>(uv.x), <span class="built_in">abs</span>(uv.x)));</span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">1.0</span>, <span class="number">0.5</span>, <span class="number">0.0</span>), <span class="built_in">smoothstep</span>(<span class="number">2.0</span> * <span class="built_in">fwidth</span>(uv.x), <span class="number">1.9</span> * <span class="built_in">fwidth</span>(uv.y), <span class="built_in">abs</span>(uv.y)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> func(<span class="keyword">in</span> <span class="type">float</span> x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sin</span>(x + <span class="built_in">sin</span>(x + <span class="built_in">sin</span>(x) * <span class="number">0.8</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> distLine(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">vec2</span> ab = b - a;</span><br><span class="line">    <span class="type">vec2</span> ap = p - a;</span><br><span class="line">    <span class="type">vec2</span> ad = <span class="built_in">clamp</span>(<span class="built_in">dot</span>(ab, ap) / <span class="built_in">dot</span>(ab, ab), <span class="number">0.0</span>, <span class="number">1.0</span>) * ab;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">length</span>(ap - ad);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 它是一个数学计算函数，返回的是一个表示&quot;线段影响值&quot;的浮点数。</span></span><br><span class="line"><span class="comment">// 返回的 float 值表示当前像素(uv)与线段的接近程度</span></span><br><span class="line"><span class="comment">// 值范围在 0.0 到 1.0 之间：</span></span><br><span class="line"><span class="comment">// 0.0 表示像素完全在线段之外</span></span><br><span class="line"><span class="comment">// 1.0 表示像素正好在线段上</span></span><br><span class="line"><span class="comment">// 中间值表示像素在线段附近(有抗锯齿效果)</span></span><br><span class="line"><span class="type">float</span> segment(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b, <span class="type">float</span> w) &#123;</span><br><span class="line">    <span class="type">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">vec2</span> ab = b - a;</span><br><span class="line">    <span class="type">vec2</span> ap = p - a;</span><br><span class="line">    <span class="type">float</span> proj = <span class="built_in">clamp</span>(<span class="built_in">dot</span>(ab, ap) / <span class="built_in">dot</span>(ab, ab), <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="type">float</span> d = <span class="built_in">length</span>(ap - proj * ab);</span><br><span class="line">    f = <span class="built_in">smoothstep</span>(w, w * <span class="number">0.2</span>, d);</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> plotFunc(<span class="keyword">in</span> <span class="type">vec2</span> uv) &#123;</span><br><span class="line">    <span class="type">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    <span class="comment">// 这是一个从 0 到屏幕宽度(iResolution.x)的循环</span></span><br><span class="line">    <span class="comment">// STEP 是步长(已定义为 1.0)，控制采样点的密度</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> x = <span class="number">0.0</span>; x &lt;= iResolution.x; x += STEP) &#123;</span><br><span class="line">        <span class="comment">// 上一个点的坐标</span></span><br><span class="line">        <span class="type">float</span> fx = fixUV(<span class="type">vec2</span>(x, <span class="number">0.0</span>)).x;</span><br><span class="line">        <span class="comment">// 下一个点的坐标</span></span><br><span class="line">        <span class="type">float</span> nfx = fixUV(<span class="type">vec2</span>(x + STEP, <span class="number">0.0</span>)).x;</span><br><span class="line">        f += segment(uv, <span class="type">vec2</span>(fx, func(fx)), <span class="type">vec2</span>(nfx, func(nfx)), <span class="number">0.006</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="comment">// old</span></span><br><span class="line">    <span class="type">vec2</span> uv = fixUV(fragCoord.xy);</span><br><span class="line">    <span class="type">vec3</span> color = grid(uv);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> f = plotFunc(uv);</span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>), f);</span><br><span class="line">    fragColor = <span class="type">vec4</span>(color, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.shadertoy.com/view/Wc2fzw">https://www.shadertoy.com/view/Wc2fzw</a></p>
<h3 id="4-实现一个（静态）星芒效果"><a href="#4-实现一个（静态）星芒效果" class="headerlink" title="4. 实现一个（静态）星芒效果"></a>4. 实现一个（静态）星芒效果</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define PI 3.1415926</span></span><br><span class="line"><span class="meta">#define STEP 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> fixUV(<span class="type">vec2</span> coord) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4.0</span> * (<span class="number">2.</span> * (coord.xy - <span class="number">0.5</span> * iResolution.xy) / <span class="built_in">min</span>(iResolution.x, iResolution.y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec3</span> grid(<span class="type">vec2</span> uv) &#123;</span><br><span class="line">    <span class="comment">// 坐标外其他颜色绘制改变</span></span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    color.rg = <span class="built_in">fract</span>(uv);</span><br><span class="line"></span><br><span class="line">    <span class="type">vec2</span> cell = <span class="number">1.0</span> - <span class="number">2.0</span> * <span class="built_in">abs</span>(<span class="built_in">fract</span>(uv) - <span class="number">0.5</span>);</span><br><span class="line">    <span class="comment">// 网格纵向</span></span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.7</span>), <span class="built_in">step</span>(cell.x, <span class="number">4.0</span> * <span class="built_in">fwidth</span>(uv.x)));</span><br><span class="line">    <span class="comment">// 网格横向</span></span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.7</span>), <span class="built_in">smoothstep</span>(<span class="number">4.0</span> * <span class="built_in">fwidth</span>(uv.y), <span class="number">3.9</span> * <span class="built_in">fwidth</span>(uv.y), cell.y));</span><br><span class="line">    <span class="comment">// 纵向坐标轴</span></span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">0.3</span>, <span class="number">0.7</span>, <span class="number">0.8</span>), <span class="built_in">smoothstep</span>(<span class="number">2.0</span> * <span class="built_in">fwidth</span>(uv.x), <span class="number">1.9</span> * <span class="built_in">fwidth</span>(uv.x), <span class="built_in">abs</span>(uv.x)));</span><br><span class="line">    <span class="comment">// 横向坐标轴</span></span><br><span class="line">    color = <span class="built_in">mix</span>(color, <span class="type">vec3</span>(<span class="number">1.0</span>, <span class="number">0.5</span>, <span class="number">0.0</span>), <span class="built_in">smoothstep</span>(<span class="number">2.0</span> * <span class="built_in">fwidth</span>(uv.x), <span class="number">1.9</span> * <span class="built_in">fwidth</span>(uv.y), <span class="built_in">abs</span>(uv.y)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> func(<span class="keyword">in</span> <span class="type">float</span> x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sin</span>(x + <span class="built_in">sin</span>(x + <span class="built_in">sin</span>(x) * <span class="number">0.8</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> distLine(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">vec2</span> ab = b - a;</span><br><span class="line">    <span class="type">vec2</span> ap = p - a;</span><br><span class="line">    <span class="type">vec2</span> ad = <span class="built_in">clamp</span>(<span class="built_in">dot</span>(ab, ap) / <span class="built_in">dot</span>(ab, ab), <span class="number">0.0</span>, <span class="number">1.0</span>) * ab;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">length</span>(ap - ad);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> Line(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">float</span> d = distLine(p, a, b);</span><br><span class="line">    <span class="type">float</span> m = <span class="built_in">smoothstep</span>(<span class="number">0.02</span>, <span class="number">0.01</span>, d);</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> segment(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b, <span class="type">float</span> w) &#123;</span><br><span class="line">    <span class="type">float</span> f = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">vec2</span> ab = b - a;</span><br><span class="line">    <span class="type">vec2</span> ap = p - a;</span><br><span class="line">    <span class="type">float</span> proj = <span class="built_in">clamp</span>(<span class="built_in">dot</span>(ab, ap) / <span class="built_in">dot</span>(ab, ab), <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="type">float</span> d = <span class="built_in">length</span>(ap - proj * ab);</span><br><span class="line">    f = <span class="built_in">smoothstep</span>(w, w * <span class="number">0.2</span>, d);</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="type">vec2</span> uv = fixUV(fragCoord.xy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改了绘制坐标的函数</span></span><br><span class="line">    <span class="type">vec3</span> Basecolor = grid(uv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小坐标位置中心点弄到方块的中心</span></span><br><span class="line">    <span class="type">vec2</span> st = <span class="built_in">fract</span>(uv) - <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建3x3点阵</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">vec2</span> p[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> y = <span class="number">-1.0</span>; y &lt;= <span class="number">1.0</span>; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">float</span> x = <span class="number">-1.0</span>; x &lt;= <span class="number">1.0</span>; x++) &#123;</span><br><span class="line">            <span class="type">vec2</span> offs = <span class="type">vec2</span>(x, y);</span><br><span class="line">            p[i++] = offs;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连线绘制 (使用蓝色)</span></span><br><span class="line">    <span class="type">float</span> m2 = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">        m2 += Line(st, p[i], p[<span class="number">4</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    Basecolor = <span class="built_in">mix</span>(Basecolor, <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>), m2); <span class="comment">// 绘制连线</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制每个区域中间的点 (使用红色)</span></span><br><span class="line">    <span class="type">float</span> d = <span class="built_in">length</span>(st);</span><br><span class="line">    <span class="type">float</span> m1 = <span class="built_in">smoothstep</span>(<span class="number">0.1</span>, <span class="number">0.09</span>, d);</span><br><span class="line">    Basecolor = <span class="built_in">mix</span>(Basecolor, <span class="type">vec3</span>(<span class="number">1.0</span>), m1); <span class="comment">// 绘制点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fragColor = <span class="type">vec4</span>(Basecolor, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://s2.loli.net/2025/09/13/6obpL7qJrvcfXka.png" alt="shadertoy4" style="width: 30%;">

<h3 id="5-随机数生成办法"><a href="#5-随机数生成办法" class="headerlink" title="5. 随机数生成办法"></a>5. 随机数生成办法</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">vec2</span> N22(<span class="type">vec2</span> p) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 任意的大数字 但还是有一些要求：</span></span><br><span class="line">    <span class="comment">// 你可以替换为其他大数（如 vec2(123.45, 678.90)）</span></span><br><span class="line">    <span class="comment">// 但需要避免：</span></span><br><span class="line">    <span class="comment">// 过于简单的数字（如 100.0, 200.0）</span></span><br><span class="line">    <span class="comment">// 互为倍数的数字（如 50.0, 100.0）</span></span><br><span class="line">    <span class="comment">// 与后续魔法数字（123.34等）有简单数学关系的数字</span></span><br><span class="line">    p += <span class="type">vec2</span>(<span class="number">434.67</span>, <span class="number">534.23</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将2D坐标扩展为3D向量 p.xyx（如输入(x,y)变为(x,y,x)）</span></span><br><span class="line">    <span class="comment">// 乘以精心选择的&quot;魔法数字&quot;向量（这些质数增加混乱度）</span></span><br><span class="line">    <span class="comment">// fract() 取小数部分，确保数值在[0,1)范围内</span></span><br><span class="line">    <span class="type">vec3</span> a = <span class="built_in">fract</span>(p.xyx * <span class="type">vec3</span>(<span class="number">123.34</span>, <span class="number">234.34</span>, <span class="number">345.65</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算向量点积并叠加到自身（dot(a,a)计算自相关）</span></span><br><span class="line">    <span class="comment">// 添加34.45偏移避免对称性</span></span><br><span class="line">    <span class="comment">// 这步大幅增加输出的随机性</span></span><br><span class="line">    a += <span class="built_in">dot</span>(a, a + <span class="number">34.45</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fract</span>(<span class="type">vec2</span>(a.x * a.y, a.y * a.z));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> fixUV(<span class="type">vec2</span> coord) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3.0</span> * (<span class="number">2.</span> * (coord.xy - <span class="number">0.5</span> * iResolution.xy) / <span class="built_in">min</span>(iResolution.x, iResolution.y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="type">vec2</span> uv = fixUV(fragCoord.xy);</span><br><span class="line"></span><br><span class="line">    <span class="type">vec2</span> n = N22(uv);</span><br><span class="line">    fragColor = <span class="type">vec4</span>(n, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://s2.loli.net/2025/09/13/s9ievPKCbrxIj3n.png" alt="shadertoy5" style="width: 30%;">

<h3 id="6-星星连线效果"><a href="#6-星星连线效果" class="headerlink" title="6. 星星连线效果"></a>6. 星星连线效果</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define PI 3.1415926</span></span><br><span class="line"><span class="meta">#define STEP 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> fixUV(<span class="type">vec2</span> coord) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5.0</span> * (<span class="number">2.</span> * (coord.xy - <span class="number">0.5</span> * iResolution.xy) / <span class="built_in">min</span>(iResolution.x, iResolution.y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> distLine(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">vec2</span> ab = b - a;</span><br><span class="line">    <span class="type">vec2</span> ap = p - a;</span><br><span class="line">    <span class="type">vec2</span> ad = <span class="built_in">clamp</span>(<span class="built_in">dot</span>(ab, ap) / <span class="built_in">dot</span>(ab, ab), <span class="number">0.0</span>, <span class="number">1.0</span>) * ab;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">length</span>(ap - ad);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> Line(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">float</span> d = distLine(p, a, b);  <span class="comment">// 计算点p到线段ab的距离</span></span><br><span class="line">    <span class="type">float</span> m = <span class="built_in">smoothstep</span>(<span class="number">0.02</span>, <span class="number">0.01</span>, d); <span class="comment">// 第一次渐变：生成线宽</span></span><br><span class="line">    <span class="type">float</span> d2 = <span class="built_in">length</span>(a - b);     <span class="comment">// 计算线段ab的长度</span></span><br><span class="line">    m *= <span class="built_in">smoothstep</span>(<span class="number">1.2</span>, <span class="number">1.1</span>, d2);<span class="comment">// 第二次渐变：控制线段显隐</span></span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> N22(<span class="type">vec2</span> p) &#123;</span><br><span class="line">    p += <span class="type">vec2</span>(<span class="number">434.67</span>, <span class="number">534.23</span>);</span><br><span class="line">    <span class="type">vec3</span> a = <span class="built_in">fract</span>(p.xyx * <span class="type">vec3</span>(<span class="number">123.34</span>, <span class="number">234.34</span>, <span class="number">345.65</span>));</span><br><span class="line">    a += <span class="built_in">dot</span>(a, a + <span class="number">34.45</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fract</span>(<span class="type">vec2</span>(a.x * a.y, a.y * a.z));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec3</span> N23_to_3(<span class="type">vec2</span> p) &#123;</span><br><span class="line">    <span class="comment">// First layer hash</span></span><br><span class="line">    <span class="type">vec3</span> a = <span class="built_in">fract</span>(p.xyx * <span class="type">vec3</span>(<span class="number">123.34</span>, <span class="number">234.34</span>, <span class="number">345.65</span>));</span><br><span class="line">    a += <span class="built_in">dot</span>(a, a.yxz + <span class="number">34.45</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Second layer hash (using rotated coordinates)</span></span><br><span class="line">    <span class="type">vec3</span> b = <span class="built_in">fract</span>(p.yxy * <span class="type">vec3</span>(<span class="number">456.78</span>, <span class="number">567.89</span>, <span class="number">678.91</span>)); </span><br><span class="line">    b += <span class="built_in">dot</span>(b, b.zxy + <span class="number">45.67</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Combine layers</span></span><br><span class="line">    <span class="type">vec3</span> r = <span class="built_in">fract</span>(<span class="type">vec3</span>(</span><br><span class="line">        a.x * b.y,</span><br><span class="line">        a.y * b.z,</span><br><span class="line">        a.z * b.x</span><br><span class="line">    ));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Final mixing</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fract</span>(r * <span class="number">0.5</span> + <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> GetPos(<span class="type">vec2</span> id, <span class="type">vec2</span> offs) &#123;</span><br><span class="line">    <span class="comment">// 根据格子的 id和offs 产生一个随机数，</span></span><br><span class="line">    <span class="comment">// 乘上iTime使其根据时间发生变化</span></span><br><span class="line">    <span class="type">vec2</span> n = N22(id + offs) * iTime * <span class="number">6.11</span>; <span class="comment">// 6.11是一个调节速度的数值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sin</span>(n) * <span class="number">0.4</span> + offs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">vec2</span> uv = fixUV(fragCoord.xy);</span><br><span class="line">    <span class="comment">// 修改了绘制坐标的函数</span></span><br><span class="line">    <span class="type">vec3</span> Basecolor = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    <span class="comment">// 小坐标位置中心点弄到方块的中心</span></span><br><span class="line">    <span class="type">vec2</span> st = <span class="built_in">fract</span>(uv) - <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取到格子的中心轴点</span></span><br><span class="line">    <span class="type">vec2</span> id = <span class="built_in">floor</span>(uv);</span><br><span class="line">    <span class="type">vec3</span> idcolor = N23_to_3(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建3x3点阵</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">vec2</span> p[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> y = <span class="number">-1.0</span>; y &lt;= <span class="number">1.0</span>; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">float</span> x = <span class="number">-1.0</span>; x &lt;= <span class="number">1.0</span>; x++) &#123;</span><br><span class="line">            <span class="type">vec2</span> offs = <span class="type">vec2</span>(x, y);</span><br><span class="line">            p[i++] = GetPos(id, offs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连线绘制 (使用蓝色)</span></span><br><span class="line">    <span class="type">float</span> m2 = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">        m2 += Line(st, p[i], p[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line">        <span class="comment">// 画星星 中间闪烁部分</span></span><br><span class="line">        <span class="type">float</span> d = <span class="built_in">length</span>(st - p[i]);</span><br><span class="line">        <span class="type">float</span> spark = <span class="number">1.0</span> / (d * d * <span class="number">200.0</span>) * (<span class="built_in">sin</span>(iTime * <span class="number">13.0</span> + p[i].x * <span class="number">17.0</span>) * <span class="number">0.4</span> + <span class="number">0.6</span>);</span><br><span class="line">        m2 += spark;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这一部分会断开 重新连接</span></span><br><span class="line">        m2 += Line(st, p[<span class="number">1</span>], p[<span class="number">3</span>]);</span><br><span class="line">        m2 += Line(st, p[<span class="number">1</span>], p[<span class="number">5</span>]);</span><br><span class="line">        m2 += Line(st, p[<span class="number">7</span>], p[<span class="number">3</span>]);</span><br><span class="line">        m2 += Line(st, p[<span class="number">7</span>], p[<span class="number">5</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Basecolor = <span class="built_in">mix</span>(Basecolor, idcolor, m2); <span class="comment">// 绘制连线</span></span><br><span class="line">    </span><br><span class="line">    fragColor = <span class="type">vec4</span>(Basecolor, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://s2.loli.net/2025/09/13/VbQwM4mTfhA92B3.png" alt="shadertoy6" style="width: 30%;">

<h3 id="7-星星推进（博主的版本）"><a href="#7-星星推进（博主的版本）" class="headerlink" title="7. 星星推进（博主的版本）"></a>7. 星星推进（博主的版本）</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">vec2</span> N22(<span class="type">vec2</span> p) &#123;</span><br><span class="line">    p += <span class="type">vec2</span>(<span class="number">434.67</span>, <span class="number">534.23</span>);</span><br><span class="line">    <span class="type">vec3</span> a = <span class="built_in">fract</span>(p.xyx * <span class="type">vec3</span>(<span class="number">123.34</span>, <span class="number">234.34</span>, <span class="number">345.65</span>));</span><br><span class="line">    a += <span class="built_in">dot</span>(a, a + <span class="number">34.45</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fract</span>(<span class="type">vec2</span>(a.x * a.y, a.y * a.z));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> DistLine(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">vec2</span> pa = p - a;</span><br><span class="line">    <span class="type">vec2</span> ba = b - a;</span><br><span class="line">    <span class="type">float</span> t = <span class="built_in">clamp</span>(<span class="built_in">dot</span>(pa, ba) / <span class="built_in">dot</span>(ba, ba), <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">length</span>(pa - ba * t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> GetPos(<span class="type">vec2</span> id, <span class="type">vec2</span> offs) &#123;</span><br><span class="line">    <span class="type">vec2</span> n = N22(id + offs) * iTime;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sin</span>(n) * <span class="number">0.4</span> + offs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> Line(<span class="type">vec2</span> p, <span class="type">vec2</span> a, <span class="type">vec2</span> b) &#123;</span><br><span class="line">    <span class="type">float</span> d = DistLine(p, a, b);</span><br><span class="line">    <span class="type">float</span> m = <span class="built_in">smoothstep</span>(<span class="number">0.02</span>, <span class="number">0.01</span>, d);</span><br><span class="line">    <span class="type">float</span> d2 = <span class="built_in">length</span>(a - b);</span><br><span class="line">    m *= <span class="built_in">smoothstep</span>(<span class="number">1.2</span>, <span class="number">0.8</span>, d2) + <span class="built_in">smoothstep</span>(<span class="number">0.05</span>, <span class="number">0.03</span>, <span class="built_in">abs</span>(d2 - <span class="number">0.75</span>));</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> Layer(<span class="type">vec2</span> uv) &#123;</span><br><span class="line">    <span class="type">vec2</span> st = <span class="built_in">fract</span>(uv) - <span class="number">0.5</span>;</span><br><span class="line">    <span class="type">vec2</span> id = <span class="built_in">floor</span>(uv);</span><br><span class="line">    <span class="type">float</span> m = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">vec2</span> p[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> y = <span class="number">-1.0</span>; y &lt;= <span class="number">1.0</span>; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">float</span> x = <span class="number">-1.0</span>; x &lt;= <span class="number">1.0</span>; x++) &#123;</span><br><span class="line">            <span class="type">vec2</span> offs = <span class="type">vec2</span>(x, y);</span><br><span class="line">            p[i++] = GetPos(id, offs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> t = iTime;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">        m += Line(st, p[i], p[<span class="number">4</span>]);</span><br><span class="line">        <span class="comment">// vec2 j = (st - p[i]) * 20.0;</span></span><br><span class="line">        <span class="type">float</span> d = <span class="built_in">length</span>(st - p[i]);</span><br><span class="line">        <span class="type">float</span> spark = <span class="number">1.0</span> / (d * d * <span class="number">200.0</span>) * (<span class="built_in">sin</span>(t * <span class="number">13.0</span> + p[i].x * <span class="number">17.0</span>) * <span class="number">0.4</span> + <span class="number">0.6</span>);</span><br><span class="line">        m += spark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m += Line(st, p[<span class="number">1</span>], p[<span class="number">3</span>]);</span><br><span class="line">    m += Line(st, p[<span class="number">1</span>], p[<span class="number">5</span>]);</span><br><span class="line">    m += Line(st, p[<span class="number">7</span>], p[<span class="number">3</span>]);</span><br><span class="line">    m += Line(st, p[<span class="number">7</span>], p[<span class="number">5</span>]);</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="type">vec2</span> uv = (fragCoord.xy - <span class="number">.5</span> * iResolution.xy) / iResolution.y;</span><br><span class="line">    <span class="type">vec3</span> col = <span class="type">vec3</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">float</span> m = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">float</span> t = iTime * <span class="number">0.1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> i = <span class="number">0.0</span>; i &lt;= <span class="number">1.0</span>; i += <span class="number">1.</span> / <span class="number">4.</span>) &#123;</span><br><span class="line">        <span class="type">float</span> depth = <span class="built_in">fract</span>(i + t);</span><br><span class="line">        <span class="type">float</span> size = <span class="built_in">mix</span>(<span class="number">15.0</span>, <span class="number">0.5</span>, depth);</span><br><span class="line">        <span class="type">float</span> fade = <span class="built_in">smoothstep</span>(<span class="number">0.0</span>, <span class="number">0.2</span>, depth) * <span class="built_in">smoothstep</span>(<span class="number">0.9</span>, <span class="number">0.8</span>, depth);</span><br><span class="line">        m += Layer(uv * size + i * <span class="number">20.0</span>) * fade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    t *= <span class="number">5.0</span>;</span><br><span class="line">    <span class="type">float</span> gradinet = uv.y;</span><br><span class="line">    <span class="type">vec3</span> baseCol = <span class="type">vec3</span>(<span class="number">0.323</span>, <span class="number">0.456</span>, <span class="number">0.567</span>);</span><br><span class="line">    col = m * baseCol * (<span class="built_in">sin</span>(t) * <span class="number">0.4</span> + <span class="number">0.8</span>);</span><br><span class="line">    col -= baseCol * gradinet;</span><br><span class="line">    fragColor = <span class="type">vec4</span>(col, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://s2.loli.net/2025/09/13/IsbLwT7aziglYm4.png" alt="shadertoy7" style="width: 30%;">

<h3 id="8-一个最简单的3D点"><a href="#8-一个最简单的3D点" class="headerlink" title="8.一个最简单的3D点"></a>8.一个最简单的3D点</h3><p>原本的3D流程应该是：“原画师绘制场景图（将3D场景画下来） -&gt; 建模师根据原画构建场景模型（产出3D模型）-&gt; 程序渲染（将3D模型导入到引擎中，或者其他3D渲染库），然后渲染成画面”。</p>
<img src="https://s2.loli.net/2025/09/13/bGh2JSUj4oK1WVI.png" alt="img" style="width: 30%;">

<p>我们简要回顾一下：</p>
<ol>
<li>顶点变换的过程（顶点着色器）</li>
<li>图元装配（按哪种方式装配图元，装配为点，线还是三角形）</li>
<li>光栅化（将上述的图元从矢量图形转换为像素组成的图形）</li>
<li>着色（片段着色器）</li>
<li>测试（Alpha测试，深度测试，模板测试等）&amp; 混合</li>
</ol>
<p>通过上述方式渲染的3D模型的方式我们通常称为<strong>光栅化的方法</strong></p>
<p>而在我们的shadertoy中，我们是直接在片段着色器中进行编程，我们只有上述的第四与第五步的过程。其实相当于我们现在变成了原画师，我们需要在一张纸上做画，而且画的是3D场景。好在我们还有另一种构建3D场景的方式，就是<strong>光线追踪或光线步进</strong>。</p>
<img src="https://s2.loli.net/2025/09/13/1GixOetfmgXlwNq.jpg" alt="img" style="width: 30%;">



<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7362059823662432306">https://juejin.cn/post/7362059823662432306</a></p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点p到直线ro到rd的距离</span></span><br><span class="line"><span class="type">float</span> DistLine(<span class="type">vec3</span> ro, <span class="type">vec3</span> rd, <span class="type">vec3</span> p) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">length</span>(<span class="built_in">cross</span>(p - ro, rd) / <span class="built_in">length</span>(rd));      <span class="comment">// 使用向量叉积公式计算点到直线的距离：(p-ro)与rd的叉积长度除以rd的长度</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> mainImage(<span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord) &#123;</span><br><span class="line">    <span class="type">vec2</span> uv = fragCoord.xy / iResolution.xy;<span class="comment">// 将像素坐标归一化到[0,1]范围</span></span><br><span class="line">    uv -= <span class="number">0.5</span>;<span class="comment">// 将坐标原点移到屏幕中心(范围变为[-0.5,0.5])</span></span><br><span class="line">    uv.x *= iResolution.x / iResolution.y;<span class="comment">// 修正宽高比，防止图像变形</span></span><br><span class="line"></span><br><span class="line">    <span class="type">vec3</span> ro = <span class="type">vec3</span>(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">-1.</span>);<span class="comment">// 定义摄像机（观察点）位置(ray origin)在z=-1处</span></span><br><span class="line">    <span class="type">vec3</span> rd = <span class="type">vec3</span>(uv.x, uv.y, <span class="number">0.0</span>) - ro;<span class="comment">// 计算从摄像机到当前像素的射线方向(ray direction)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> t = iGlobalTime; <span class="comment">//定义一个变量，方便让球动起来</span></span><br><span class="line">    <span class="type">vec3</span> p = <span class="type">vec3</span>(<span class="built_in">sin</span>(t), <span class="number">0.</span>, <span class="number">3.0</span>); <span class="comment">// 定义球的位置</span></span><br><span class="line">    <span class="type">float</span> r = <span class="number">0.01</span>; <span class="comment">// 定义球的半径</span></span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> d = DistLine(ro, rd, p); <span class="comment">// 计算球心与观察射线之间的距离</span></span><br><span class="line">    d = <span class="built_in">smoothstep</span>(r + <span class="number">0.01</span>, r, d); <span class="comment">// 若距离小于半径，d 则等于1。</span></span><br><span class="line">    fragColor = <span class="type">vec4</span>(d, d, d, <span class="number">1.0</span>); <span class="comment">// 将球着色为白色</span></span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<img src="https://s2.loli.net/2025/09/13/6ZnjRWTHq9Go4lp.png" alt="shadertoy9" style="width: 30%;">



<h3 id="100-一个海Shader（优化版本）"><a href="#100-一个海Shader（优化版本）" class="headerlink" title="100.一个海Shader（优化版本）"></a>100.一个海Shader（优化版本）</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * &quot;Seascape&quot; by Alexander Alekseev aka TDM - 2014</span></span><br><span class="line"><span class="comment"> * License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.</span></span><br><span class="line"><span class="comment"> * Contact: tdmaav@gmail.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="type">int</span> NUM_STEPS = <span class="number">32</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> PI	 	= <span class="number">3.141592</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> EPSILON	= <span class="number">1e-3</span>;</span><br><span class="line"><span class="meta">#define EPSILON_NRM (0.1 / iResolution.x)</span></span><br><span class="line"><span class="comment">//#define AA</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sea</span></span><br><span class="line"><span class="keyword">const</span> <span class="type">int</span> ITER_GEOMETRY = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">int</span> ITER_FRAGMENT = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> SEA_HEIGHT = <span class="number">0.6</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> SEA_CHOPPY = <span class="number">4.0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> SEA_SPEED = <span class="number">0.8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> SEA_FREQ = <span class="number">0.16</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="type">vec3</span> SEA_BASE = <span class="type">vec3</span>(<span class="number">0.0</span>,<span class="number">0.09</span>,<span class="number">0.18</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="type">vec3</span> SEA_WATER_COLOR = <span class="type">vec3</span>(<span class="number">0.8</span>,<span class="number">0.9</span>,<span class="number">0.6</span>)*<span class="number">0.6</span>;</span><br><span class="line"><span class="meta">#define SEA_TIME (1.0 + iTime * SEA_SPEED)</span></span><br><span class="line"><span class="keyword">const</span> <span class="type">mat2</span> octave_m = <span class="type">mat2</span>(<span class="number">1.6</span>,<span class="number">1.2</span>,<span class="number">-1.2</span>,<span class="number">1.6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// math</span></span><br><span class="line"><span class="type">mat3</span> fromEuler(<span class="type">vec3</span> ang) &#123;</span><br><span class="line">	<span class="type">vec2</span> a1 = <span class="type">vec2</span>(<span class="built_in">sin</span>(ang.x),<span class="built_in">cos</span>(ang.x));</span><br><span class="line">    <span class="type">vec2</span> a2 = <span class="type">vec2</span>(<span class="built_in">sin</span>(ang.y),<span class="built_in">cos</span>(ang.y));</span><br><span class="line">    <span class="type">vec2</span> a3 = <span class="type">vec2</span>(<span class="built_in">sin</span>(ang.z),<span class="built_in">cos</span>(ang.z));</span><br><span class="line">    <span class="type">mat3</span> m;</span><br><span class="line">    m[<span class="number">0</span>] = <span class="type">vec3</span>(a1.y*a3.y+a1.x*a2.x*a3.x,a1.y*a2.x*a3.x+a3.y*a1.x,-a2.y*a3.x);</span><br><span class="line">	m[<span class="number">1</span>] = <span class="type">vec3</span>(-a2.y*a1.x,a1.y*a2.y,a2.x);</span><br><span class="line">	m[<span class="number">2</span>] = <span class="type">vec3</span>(a3.y*a1.x*a2.x+a1.y*a3.x,a1.x*a3.x-a1.y*a3.y*a2.x,a2.y*a3.y);</span><br><span class="line">	<span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">float</span> hash( <span class="type">vec2</span> p ) &#123;</span><br><span class="line">	<span class="type">float</span> h = <span class="built_in">dot</span>(p,<span class="type">vec2</span>(<span class="number">127.1</span>,<span class="number">311.7</span>));	</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fract</span>(<span class="built_in">sin</span>(h)*<span class="number">43758.5453123</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">float</span> noise( <span class="keyword">in</span> <span class="type">vec2</span> p ) &#123;</span><br><span class="line">    <span class="type">vec2</span> i = <span class="built_in">floor</span>( p );</span><br><span class="line">    <span class="type">vec2</span> f = <span class="built_in">fract</span>( p );</span><br><span class="line">    <span class="comment">// Add distance-based smoothing</span></span><br><span class="line">    <span class="type">float</span> dist = <span class="built_in">length</span>(p);</span><br><span class="line">    <span class="type">float</span> smoothFactor = <span class="built_in">smoothstep</span>(<span class="number">0.0</span>, <span class="number">5.0</span>, dist);</span><br><span class="line">    <span class="type">vec2</span> u = <span class="built_in">mix</span>(f, f*f*(<span class="number">3.0</span><span class="number">-2.0</span>*f), smoothFactor);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1.0</span>+<span class="number">2.0</span>*<span class="built_in">mix</span>( <span class="built_in">mix</span>( hash( i + <span class="type">vec2</span>(<span class="number">0.0</span>,<span class="number">0.0</span>) ), </span><br><span class="line">                     hash( i + <span class="type">vec2</span>(<span class="number">1.0</span>,<span class="number">0.0</span>) ), u.x),</span><br><span class="line">                <span class="built_in">mix</span>( hash( i + <span class="type">vec2</span>(<span class="number">0.0</span>,<span class="number">1.0</span>) ), </span><br><span class="line">                     hash( i + <span class="type">vec2</span>(<span class="number">1.0</span>,<span class="number">1.0</span>) ), u.x), u.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lighting</span></span><br><span class="line"><span class="type">float</span> diffuse(<span class="type">vec3</span> n,<span class="type">vec3</span> l,<span class="type">float</span> p) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="built_in">dot</span>(n,l) * <span class="number">0.4</span> + <span class="number">0.6</span>,p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">float</span> specular(<span class="type">vec3</span> n,<span class="type">vec3</span> l,<span class="type">vec3</span> e,<span class="type">float</span> s) &#123;    </span><br><span class="line">    <span class="type">float</span> nrm = (s + <span class="number">8.0</span>) / (PI * <span class="number">8.0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="built_in">dot</span>(<span class="built_in">reflect</span>(e,n),l),<span class="number">0.0</span>),s) * nrm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// sky</span></span><br><span class="line"><span class="type">vec3</span> getSkyColor(<span class="type">vec3</span> e) &#123;</span><br><span class="line">    e.y = (<span class="built_in">max</span>(e.y,<span class="number">0.0</span>)*<span class="number">0.8</span>+<span class="number">0.2</span>)*<span class="number">0.8</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">vec3</span>(<span class="built_in">pow</span>(<span class="number">1.0</span>-e.y,<span class="number">2.0</span>), <span class="number">1.0</span>-e.y, <span class="number">0.6</span>+(<span class="number">1.0</span>-e.y)*<span class="number">0.4</span>) * <span class="number">1.1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// sea</span></span><br><span class="line"><span class="type">float</span> sea_octave(<span class="type">vec2</span> uv, <span class="type">float</span> choppy) &#123;</span><br><span class="line">    uv += noise(uv);        </span><br><span class="line">    <span class="type">vec2</span> wv = <span class="number">1.0</span>-<span class="built_in">abs</span>(<span class="built_in">sin</span>(uv));</span><br><span class="line">    <span class="type">vec2</span> swv = <span class="built_in">abs</span>(<span class="built_in">cos</span>(uv));    </span><br><span class="line">    wv = <span class="built_in">mix</span>(wv,swv,wv);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">1.0</span>-<span class="built_in">pow</span>(wv.x * wv.y,<span class="number">0.65</span>),choppy);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> map(<span class="type">vec3</span> p) &#123;</span><br><span class="line">    <span class="type">float</span> freq = SEA_FREQ;</span><br><span class="line">    <span class="type">float</span> amp = SEA_HEIGHT;</span><br><span class="line">    <span class="type">float</span> choppy = SEA_CHOPPY;</span><br><span class="line">    <span class="type">vec2</span> uv = p.xz; uv.x *= <span class="number">0.75</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> d, h = <span class="number">0.0</span>;    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ITER_GEOMETRY; i++) &#123;        </span><br><span class="line">    	d = sea_octave((uv+SEA_TIME)*freq,choppy);</span><br><span class="line">    	d += sea_octave((uv-SEA_TIME)*freq,choppy);</span><br><span class="line">        h += d * amp;        </span><br><span class="line">    	uv *= octave_m; freq *= <span class="number">1.9</span>; amp *= <span class="number">0.22</span>;</span><br><span class="line">        choppy = <span class="built_in">mix</span>(choppy,<span class="number">1.0</span>,<span class="number">0.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p.y - h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> map_detailed(<span class="type">vec3</span> p) &#123;</span><br><span class="line">    <span class="type">float</span> freq = SEA_FREQ;</span><br><span class="line">    <span class="type">float</span> amp = SEA_HEIGHT;</span><br><span class="line">    <span class="type">float</span> choppy = SEA_CHOPPY;</span><br><span class="line">    <span class="type">vec2</span> uv = p.xz; uv.x *= <span class="number">0.75</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> d, h = <span class="number">0.0</span>;    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ITER_FRAGMENT; i++) &#123;        </span><br><span class="line">    	d = sea_octave((uv+SEA_TIME)*freq,choppy);</span><br><span class="line">    	d += sea_octave((uv-SEA_TIME)*freq,choppy);</span><br><span class="line">        h += d * amp;        </span><br><span class="line">    	uv *= octave_m; freq *= <span class="number">1.9</span>; amp *= <span class="number">0.22</span>;</span><br><span class="line">        choppy = <span class="built_in">mix</span>(choppy,<span class="number">1.0</span>,<span class="number">0.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p.y - h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec3</span> getSeaColor(<span class="type">vec3</span> p, <span class="type">vec3</span> n, <span class="type">vec3</span> l, <span class="type">vec3</span> eye, <span class="type">vec3</span> dist) &#123;  </span><br><span class="line">    <span class="type">float</span> fresnel = <span class="built_in">clamp</span>(<span class="number">1.0</span> - <span class="built_in">dot</span>(n, -eye), <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    fresnel = <span class="built_in">min</span>(fresnel * fresnel * fresnel, <span class="number">0.5</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">vec3</span> reflected = getSkyColor(<span class="built_in">reflect</span>(eye, n));    </span><br><span class="line">    <span class="type">vec3</span> refracted = SEA_BASE + diffuse(n, l, <span class="number">80.0</span>) * SEA_WATER_COLOR * <span class="number">0.12</span>; </span><br><span class="line">    </span><br><span class="line">    <span class="type">vec3</span> color = <span class="built_in">mix</span>(refracted, reflected, fresnel);</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> atten = <span class="built_in">max</span>(<span class="number">1.0</span> - <span class="built_in">dot</span>(dist, dist) * <span class="number">0.001</span>, <span class="number">0.0</span>);</span><br><span class="line">    color += SEA_WATER_COLOR * (p.y - SEA_HEIGHT) * <span class="number">0.18</span> * atten;</span><br><span class="line">    </span><br><span class="line">    color += specular(n, l, eye, <span class="number">60.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// tracing</span></span><br><span class="line"><span class="type">vec3</span> getNormal(<span class="type">vec3</span> p, <span class="type">float</span> eps) &#123;</span><br><span class="line">        <span class="comment">// Distance-based eps adjustment</span></span><br><span class="line">    <span class="type">float</span> dist = <span class="built_in">length</span>(p);</span><br><span class="line">    eps = <span class="built_in">mix</span>(eps*<span class="number">0.5</span>, eps*<span class="number">2.0</span>, <span class="built_in">smoothstep</span>(<span class="number">0.0</span>, <span class="number">10.0</span>, dist));</span><br><span class="line">    </span><br><span class="line">    <span class="type">vec3</span> n;</span><br><span class="line">    n.y = map_detailed(p);    </span><br><span class="line">    n.x = map_detailed(<span class="type">vec3</span>(p.x+eps,p.y,p.z)) - n.y;</span><br><span class="line">    n.z = map_detailed(<span class="type">vec3</span>(p.x,p.y,p.z+eps)) - n.y;</span><br><span class="line">    n.y = eps;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Smooth normal</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">normalize</span>(<span class="built_in">mix</span>(n, <span class="type">vec3</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>), <span class="number">0.1</span> * <span class="built_in">smoothstep</span>(<span class="number">0.0</span>, <span class="number">5.0</span>, dist)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> heightMapTracing(<span class="type">vec3</span> ori, <span class="type">vec3</span> dir, <span class="keyword">out</span> <span class="type">vec3</span> p) &#123;  </span><br><span class="line">    <span class="type">float</span> tm = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">float</span> tx = <span class="number">1000.0</span>;    </span><br><span class="line">    <span class="type">float</span> hx = map(ori + dir * tx);</span><br><span class="line">    <span class="keyword">if</span>(hx &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">        p = ori + dir * tx;</span><br><span class="line">        <span class="keyword">return</span> tx;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> hm = map(ori);    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_STEPS; i++) &#123;</span><br><span class="line">        <span class="type">float</span> tmid = <span class="built_in">mix</span>(tm, tx, hm / (hm - hx));</span><br><span class="line">        p = ori + dir * tmid;</span><br><span class="line">        <span class="type">float</span> hmid = map(p);        </span><br><span class="line">        <span class="keyword">if</span>(hmid &lt; <span class="number">0.0</span>) &#123;</span><br><span class="line">            tx = tmid;</span><br><span class="line">            hx = hmid;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tm = tmid;</span><br><span class="line">            hm = hmid;</span><br><span class="line">        &#125;        </span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(hmid) &lt; EPSILON) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mix</span>(tm, tx, hm / (hm - hx));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec3</span> getPixel(<span class="keyword">in</span> <span class="type">vec2</span> coord, <span class="type">float</span> time) &#123;    </span><br><span class="line">    <span class="type">vec2</span> uv = coord / iResolution.xy;</span><br><span class="line">    uv = uv * <span class="number">2.0</span> - <span class="number">1.0</span>;</span><br><span class="line">    uv.x *= iResolution.x / iResolution.y;    </span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ray</span></span><br><span class="line">    <span class="type">vec3</span> ang = <span class="type">vec3</span>(<span class="built_in">sin</span>(time*<span class="number">3.0</span>)*<span class="number">0.1</span>,<span class="built_in">sin</span>(time)*<span class="number">0.2</span>+<span class="number">0.3</span>,time);    </span><br><span class="line">    <span class="type">vec3</span> ori = <span class="type">vec3</span>(<span class="number">0.0</span>,<span class="number">3.5</span>,time*<span class="number">5.0</span>);</span><br><span class="line">    <span class="type">vec3</span> dir = <span class="built_in">normalize</span>(<span class="type">vec3</span>(uv.xy,<span class="number">-2.0</span>)); dir.z += <span class="built_in">length</span>(uv) * <span class="number">0.14</span>;</span><br><span class="line">    dir = <span class="built_in">normalize</span>(dir) * fromEuler(ang);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// tracing</span></span><br><span class="line">    <span class="type">vec3</span> p;</span><br><span class="line">    heightMapTracing(ori,dir,p);</span><br><span class="line">    <span class="type">vec3</span> dist = p - ori;</span><br><span class="line">    <span class="type">vec3</span> n = getNormal(p, <span class="built_in">dot</span>(dist,dist) * EPSILON_NRM);</span><br><span class="line">    <span class="type">vec3</span> light = <span class="built_in">normalize</span>(<span class="type">vec3</span>(<span class="number">0.0</span>,<span class="number">1.0</span>,<span class="number">0.8</span>)); </span><br><span class="line">             </span><br><span class="line">    <span class="comment">// color</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mix</span>(</span><br><span class="line">        getSkyColor(dir),</span><br><span class="line">        getSeaColor(p,n,light,dir,dist),</span><br><span class="line">    	<span class="built_in">pow</span>(<span class="built_in">smoothstep</span>(<span class="number">0.0</span>,<span class="number">-0.02</span>,dir.y),<span class="number">0.2</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="type">void</span> mainImage( <span class="keyword">out</span> <span class="type">vec4</span> fragColor, <span class="keyword">in</span> <span class="type">vec2</span> fragCoord ) &#123;</span><br><span class="line">    <span class="type">float</span> time = iTime * <span class="number">0.3</span> + iMouse.x*<span class="number">0.01</span>;</span><br><span class="line">	</span><br><span class="line"><span class="meta">#ifdef AA</span></span><br><span class="line">    <span class="type">vec3</span> color = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">-1</span>; i &lt;= <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">-1</span>; j &lt;= <span class="number">1</span>; j++) &#123;</span><br><span class="line">        	<span class="type">vec2</span> uv = fragCoord+<span class="type">vec2</span>(i,j)/<span class="number">3.0</span>;</span><br><span class="line">    		color += getPixel(uv, time);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    color /= <span class="number">9.0</span>;</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">    <span class="type">vec3</span> color = getPixel(fragCoord, time);</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// post</span></span><br><span class="line">	fragColor = <span class="type">vec4</span>(<span class="built_in">pow</span>(color,<span class="type">vec3</span>(<span class="number">0.65</span>)), <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://s2.loli.net/2025/09/13/vlTKo196wnDypC2.png" alt="shadertoy100" style="width: 30%;">

<h1 id="ShaderToy"><a href="#ShaderToy" class="headerlink" title="ShaderToy"></a>ShaderToy</h1><h2 id="常用的全局变量"><a href="#常用的全局变量" class="headerlink" title="常用的全局变量"></a>常用的全局变量</h2><img src="https://s2.loli.net/2025/09/13/8dSoxBrp2OcWekl.png" alt="UnrealShader学习-2" style="width: 30%;">



<h1 id="⚠️警告"><a href="#⚠️警告" class="headerlink" title="* ⚠️警告"></a>* ⚠️警告</h1><ol>
<li>尽可能不要在Shader中写 If 逻辑代码，因为不能<a target="_blank" rel="noopener" href="https://juejin.cn/post/7069209226568007688">充分发挥SIMD的性能</a></li>
</ol>
<h1 id="其他专有名词解释"><a href="#其他专有名词解释" class="headerlink" title="* 其他专有名词解释"></a>* 其他专有名词解释</h1><ol>
<li><strong>齐次坐标</strong>：用 n + 1 维向量来表示 n 维向量。比如在 2D 中，点 (x, y) 用 (x, y, w) 表示，w 通常为 1，若 w &#x3D; 0 则表示无穷远点；在 3D 里，点 (x, y, z) 表示为 (x, y, z, w) 。它能简化图形学计算，还可表示无穷远点 。</li>
</ol>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Shader/">Shader</a> <a href="/tags/GLSL/">GLSL</a> <a href="/tags/HLSL/">HLSL</a> <a href="/tags/Unreal-Engine/">Unreal Engine</a> <a href="/tags/Graphics-Programming/">Graphics Programming</a> <a href="/tags/Computer-Graphics/">Computer Graphics</a> <a href="/tags/Game-Development-Shader-001/">Game Development Shader 001</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>

    <!-- Table of Contents will be generated by toc-collapse.js -->

</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->

<script src="/js/jquery.js"></script>


<!-- Custom Code -->

<script src="/js/main.js"></script>


<script src="/js/article-collapse.js"></script>


<script src="/js/toc-collapse.js"></script>


<script src="/js/shadertoy-embed.js"></script>


<script src="/js/image-zoom.js"></script>


<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Code Block Expansion Script -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Initialize code block expansion
    function initCodeBlockExpansion() {
        const codeBlocks = document.querySelectorAll('figure.highlight');
        
        codeBlocks.forEach(function(codeBlock) {
            // Skip if already processed
            if (codeBlock.closest('.code-block-container')) return;
            
            // Remove table structure and keep only code content
            const table = codeBlock.querySelector('table');
            if (table) {
                const codeCell = table.querySelector('td.code');
                if (codeCell) {
                    // Create a new pre element with code content
                    const newPre = document.createElement('pre');
                    newPre.className = 'code';
                    newPre.innerHTML = codeCell.innerHTML;
                    
                    // Replace table with pre element
                    codeBlock.innerHTML = '';
                    codeBlock.appendChild(newPre);
                }
            }
            
            // Get the code content height
            const codeContent = codeBlock.querySelector('pre.code');
            if (!codeContent) return;
            
            const actualHeight = codeContent.scrollHeight;
            const maxHeight = 400; // Same as CSS max-height
            
            // Only add expansion if content is taller than max height
            if (actualHeight > maxHeight) {
                // Wrap the code block in a container
                const container = document.createElement('div');
                container.className = 'code-block-container collapsed';
                codeBlock.parentNode.insertBefore(container, codeBlock);
                container.appendChild(codeBlock);
                
                // Create expand button
                const expandButton = document.createElement('button');
                expandButton.className = 'expand-button';
                expandButton.textContent = '展开代码';
                container.appendChild(expandButton);
                
                // Add click handler
                expandButton.addEventListener('click', function() {
                    if (container.classList.contains('collapsed')) {
                        // Expand to full screen
                        showFullscreenCode(codeBlock, expandButton);
                    }
                });
            }
        });
    }
    
    function showFullscreenCode(codeBlock, button) {
        // Create fullscreen modal
        const modal = document.createElement('div');
        modal.className = 'code-fullscreen-modal active';
        
        const content = document.createElement('div');
        content.className = 'code-fullscreen-content';
        
        // Clone the code block and remove any expansion restrictions
        const clonedBlock = codeBlock.cloneNode(true);
        
        // Remove any size restrictions from cloned block
        clonedBlock.style.maxHeight = 'none';
        clonedBlock.style.overflow = 'visible';
        
        // Find and update the pre.code element in cloned block
        const clonedPre = clonedBlock.querySelector('pre.code');
        if (clonedPre) {
            clonedPre.style.maxHeight = 'none';
            clonedPre.style.height = '100%';
            clonedPre.style.overflowY = 'scroll';
            clonedPre.style.overflowX = 'auto';
            clonedPre.style.minHeight = '0';
            // 确保内容完全可见
            clonedPre.scrollTop = 0;
        }
        
        content.appendChild(clonedBlock);
        
        // Create close button
        const closeButton = document.createElement('button');
        closeButton.className = 'close-fullscreen';
        closeButton.textContent = '关闭';
        content.appendChild(closeButton);
        
        modal.appendChild(content);
        document.body.appendChild(modal);
        
        // Prevent body scrolling
        document.body.style.overflow = 'hidden';
        
        // Close handlers
        function closeModal() {
            document.body.removeChild(modal);
            document.body.style.overflow = '';
        }
        
        closeButton.addEventListener('click', closeModal);
        
        // Close on backdrop click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
        
        // Close on escape key
        function handleKeydown(e) {
            if (e.key === 'Escape') {
                closeModal();
                document.removeEventListener('keydown', handleKeydown);
            }
        }
        document.addEventListener('keydown', handleKeydown);
    }
    
    // Initialize on page load
    initCodeBlockExpansion();
    
    // Re-initialize if new content is loaded (for SPA-like behavior)
    const observer = new MutationObserver(function(mutations) {
        let needsReinit = false;
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (node.matches('figure.highlight') || node.querySelector('figure.highlight'))) {
                        needsReinit = true;
                    }
                });
            }
        });
        if (needsReinit) {
            setTimeout(initCodeBlockExpansion, 100);
        }
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});
</script>

<!-- Mermaid Initialization -->
<script type="text/javascript">
    // Wait for document ready
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof mermaid !== 'undefined') {
            // Initialize with proper configuration
            mermaid.initialize({ 
                startOnLoad: false,
                theme: 'default',
                securityLevel: 'loose'
            });
            
            // Find and process mermaid code blocks
            const codeBlocks = document.querySelectorAll('figure.highlight.plaintext .code');
            
            codeBlocks.forEach((codeElement, index) => {
                let code = codeElement.textContent || codeElement.innerText;
                
                // Check if it's a mermaid diagram
                if (code.trim().match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|journey|pie|gitgraph|erDiagram)/)) {
                    // Critical fix: Remove ALL leading/trailing whitespace and newlines
                    code = code.trim().replace(/^\s+|\s+$/g, '');
                    
                    // Create mermaid div
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    // Set the cleaned code without any extra whitespace
                    mermaidDiv.textContent = code;
                    mermaidDiv.id = 'mermaid-diagram-' + index;
                    
                    // Replace the entire figure element
                    const figureElement = codeElement.closest('figure');
                    if (figureElement) {
                        figureElement.parentNode.replaceChild(mermaidDiv, figureElement);
                    }
                }
            });
            
            // Initialize mermaid diagrams with explicit selector
            setTimeout(() => {
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }, 100);
        }
    });
</script>

<!-- ShaderToy Placeholder Processing -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit for other scripts to load
    setTimeout(function() {
        // Find all elements with shadertoy-placeholder class
        const elements = document.querySelectorAll('.shadertoy-placeholder[data-id]');
        
        console.log('Found shadertoy-placeholder elements:', elements.length);

        elements.forEach(element => {
            const shaderID = element.getAttribute('data-id');
            console.log('Processing shadertoy-placeholder element with ID:', shaderID);
            
            if (shaderID) {
                // Create iframe container
                const container = document.createElement('div');
                container.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 400px;
                    margin: 20px 0;
                    border: 2px solid #bfbbbb;
                    border-radius: 8px;
                    overflow: hidden;
                    background-color: #f6f6f6;
                `;

                // Create iframe
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.shadertoy.com/embed/${shaderID}?gui=true&t=10&paused=false&muted=false`;
                iframe.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    border: none;
                `;
                iframe.allowFullscreen = true;
                iframe.loading = 'lazy';

                container.appendChild(iframe);
                element.parentNode.insertBefore(container, element);
                element.parentNode.removeChild(element);
            }
        });
    }, 1000); // Wait a full second for everything to load
});
</script>

<!-- Disqus Comments -->


</body>

</html>