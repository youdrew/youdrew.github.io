<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="This is a space where I can share my thoughts and works with freely.">
    

    <!--Author-->
    
        <meta name="author" content="Eugene Hsuan">
    

    <!--Open Graph Title-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Eugene&#39;s Page"/>

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>Eugene&#39;s Page</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="/css/table.css">

    
<link rel="stylesheet" href="/css/image-zoom.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Mermaid Support -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>

    <!-- Google Analytics -->
    


    <!--Favicon-->
    
        <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    

<meta name="generator" content="Hexo 7.3.0"></head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">Eugene's Page</a>
        <div class="subtitle">Filmmaker / Developer</div>
        <div class="description">This is a space where I can share my thoughts and works with freely.</div>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
                <li><a href="https://space.bilibili.com/29291963" class="behance" target="_blank" data-title="Bilibili"></a></li>
            
            
                <li><a href="https://www.instagram.com/yu_chinghsuan?igsh=Mm54ajloc3c1NW5m&utm_source=qr" class="instagram" target="_blank" data-title="Instagram"></a></li>
            
            
                <li><a href="https://www.douban.com/people/Youdrew_Xuan/" class="dribble" target="_blank" data-title="Douban"></a></li>
            
            
                <li><a href="mailto:youdrewxuan@icloud.com" class="google" target="_blank" data-title="Email"></a></li>
            
            
                <li><a href="/atom.xml" class="rss" target="_blank" data-title="RSS"></a></li>
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2025 Eugene Hsuan</p>
            <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p>
            <p>Modified based on <a href="https://github.com/klugjo/hexo-theme-magnetic" target="_blank">Magnetic</a> theme</p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('/img/default_cover_detail.jpg');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a class="previous disabled"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2025/11/04/Aximmetry%20-%20%E5%89%AF%E6%9C%AC/" class="next" data-title="Untitled"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">Untitled</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><h3 id="STcgXRViewport-cpp"><a href="#STcgXRViewport-cpp" class="headerlink" title="STcgXRViewport.cpp"></a>STcgXRViewport.cpp</h3><p><strong>文件路径</strong>: <code>Private\STcgXRViewport.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;STcgXRViewport.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRViewportClient.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PreviewScene.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Editor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LevelEditor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine/World.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine/Level.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameFramework/Actor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CineCameraActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CineCameraComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LevelEditorViewport.h&quot;</span> <span class="comment">// FLevelEditorViewportClient</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXR.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数，初始化自定义Viewport</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::Construct</span><span class="params">(<span class="type">const</span> FArguments&amp; InArgs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SEditorViewport::<span class="built_in">Construct</span>(SEditorViewport::<span class="built_in">FArguments</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义ViewportClient</span></span><br><span class="line"><span class="function">TSharedRef&lt;FEditorViewportClient&gt; <span class="title">STcgXRViewport::MakeEditorViewportClient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!PreviewScene.<span class="built_in">IsValid</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        PreviewScene = <span class="built_in">MakeUnique</span>&lt;FPreviewScene&gt;(FPreviewScene::<span class="built_in">ConstructionValues</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ViewportClient = <span class="built_in">MakeShared</span>&lt;FTcgXRViewportClient&gt;(PreviewScene.<span class="built_in">Get</span>(), <span class="built_in">StaticCastSharedRef</span>&lt;SEditorViewport&gt;(<span class="built_in">SharedThis</span>(<span class="keyword">this</span>)));</span><br><span class="line">    ViewportClient-&gt;<span class="built_in">SetViewMode</span>(VMI_Lit);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从第一个主编辑器视口复制相机参数</span></span><br><span class="line">    <span class="keyword">if</span> (GEditor)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (FEditorViewportClient* VC : GEditor-&gt;<span class="built_in">GetAllViewportClients</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (VC &amp;&amp; VC-&gt;<span class="built_in">IsPerspective</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">const</span> FVector Loc = VC-&gt;<span class="built_in">GetViewLocation</span>();</span><br><span class="line">                <span class="type">const</span> FRotator Rot = VC-&gt;<span class="built_in">GetViewRotation</span>();</span><br><span class="line">                <span class="type">const</span> <span class="type">bool</span> bIsOrtho = VC-&gt;<span class="built_in">IsOrtho</span>();</span><br><span class="line">                <span class="type">const</span> <span class="type">float</span> FOV = VC-&gt;ViewFOV; <span class="comment">// 使用源视口FOV</span></span><br><span class="line">                <span class="type">const</span> <span class="type">float</span> OrthoWidth = <span class="number">2048.f</span>; <span class="comment">// 默认正交宽度</span></span><br><span class="line">                ViewportClient-&gt;<span class="built_in">SetCameraFrom</span>(Loc, Rot, FOV, OrthoWidth, bIsOrtho);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用缓存参数（如果UI在Client创建前触发了设置，不会崩溃）</span></span><br><span class="line">    <span class="built_in">ApplyCachedParams</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ViewportClient.<span class="built_in">ToSharedRef</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::ApplyCachedParams</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!ViewportClient.<span class="built_in">IsValid</span>()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (CachedFOV.<span class="built_in">IsSet</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetFOV</span>(CachedFOV.<span class="built_in">GetValue</span>()); CachedFOV.<span class="built_in">Reset</span>(); &#125;</span><br><span class="line">    <span class="keyword">if</span> (CachedExposure.<span class="built_in">IsSet</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetExposure</span>(CachedExposure.<span class="built_in">GetValue</span>()); CachedExposure.<span class="built_in">Reset</span>(); &#125;</span><br><span class="line">    <span class="keyword">if</span> (CachedFocalLength.<span class="built_in">IsSet</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetFocalLength</span>(CachedFocalLength.<span class="built_in">GetValue</span>()); CachedFocalLength.<span class="built_in">Reset</span>(); &#125;</span><br><span class="line">    <span class="keyword">if</span> (CachedAperture.<span class="built_in">IsSet</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetAperture</span>(CachedAperture.<span class="built_in">GetValue</span>()); CachedAperture.<span class="built_in">Reset</span>(); &#125;</span><br><span class="line">    <span class="keyword">if</span> (CachedFocusDistance.<span class="built_in">IsSet</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetFocusDistance</span>(CachedFocusDistance.<span class="built_in">GetValue</span>()); CachedFocusDistance.<span class="built_in">Reset</span>(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// XR状态控制接口</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetShowKeyed</span><span class="params">(<span class="type">bool</span> b)</span> </span>&#123; <span class="keyword">if</span> (ViewportClient) ViewportClient-&gt;<span class="built_in">SetShowKeyed</span>(b); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetVirtualCamMove</span><span class="params">(<span class="type">bool</span> b)</span> </span>&#123; <span class="keyword">if</span> (ViewportClient) ViewportClient-&gt;<span class="built_in">SetVirtualCamMove</span>(b); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetMixedRealityBlend</span><span class="params">(<span class="type">bool</span> b)</span> </span>&#123; <span class="keyword">if</span> (ViewportClient) ViewportClient-&gt;<span class="built_in">SetMixedRealityBlend</span>(b); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">STcgXRViewport::IsShowKeyed</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> ViewportClient ? ViewportClient-&gt;<span class="built_in">IsShowKeyed</span>() : <span class="literal">false</span>; &#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">STcgXRViewport::IsVirtualCamMove</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> ViewportClient ? ViewportClient-&gt;<span class="built_in">IsVirtualCamMove</span>() : <span class="literal">false</span>; &#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">STcgXRViewport::IsMixedRealityBlend</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> ViewportClient ? ViewportClient-&gt;<span class="built_in">IsMixedRealityBlend</span>() : <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工具：获取当前锁定的电影相机（如果任何一个关卡视口处于Pilot/锁定状态）</span></span><br><span class="line"><span class="function"><span class="type">static</span> UCineCameraComponent* <span class="title">GetLockedCineCamera</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!GEditor) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">const</span> TArray&lt;FLevelEditorViewportClient*&gt;&amp; Clients = GEditor-&gt;<span class="built_in">GetLevelViewportClients</span>();</span><br><span class="line">    <span class="keyword">for</span> (FLevelEditorViewportClient* LVC : Clients)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!LVC || !LVC-&gt;<span class="built_in">IsPerspective</span>()) <span class="keyword">continue</span>;</span><br><span class="line">        AActor* LockedActor = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">if</span> (AActor* CineLock = LVC-&gt;<span class="built_in">GetCinematicActorLock</span>().<span class="built_in">GetLockedActor</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            LockedActor = CineLock;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (LVC-&gt;<span class="built_in">GetActiveActorLock</span>().<span class="built_in">IsValid</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            LockedActor = LVC-&gt;<span class="built_in">GetActiveActorLock</span>().<span class="built_in">Get</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (LockedActor)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ACineCameraActor* Cine = <span class="built_in">Cast</span>&lt;ACineCameraActor&gt;(LockedActor))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Cine-&gt;<span class="built_in">GetCineCameraComponent</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捕获键盘输入并分发给模块做相机切换</span></span><br><span class="line"><span class="function">FReply <span class="title">STcgXRViewport::OnKeyDown</span><span class="params">(<span class="type">const</span> FGeometry&amp; MyGeometry, <span class="type">const</span> FKeyEvent&amp; InKeyEvent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (FTcgXRModule* Mod = FModuleManager::<span class="built_in">GetModulePtr</span>&lt;FTcgXRModule&gt;(<span class="string">&quot;TcgXR&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Mod-&gt;<span class="built_in">HandleKeyDown</span>(InKeyEvent.<span class="built_in">GetKey</span>()))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> FReply::<span class="built_in">Handled</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> SEditorViewport::<span class="built_in">OnKeyDown</span>(MyGeometry, InKeyEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 安全设置接口（优先修改锁定到关卡视口的相机，否则本地缓存/ViewportClient）</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetFOVParam</span><span class="params">(<span class="type">float</span> InFOV)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UCineCameraComponent* CineComp = <span class="built_in">GetLockedCineCamera</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        CineComp-&gt;<span class="built_in">SetFieldOfView</span>(InFOV);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ViewportClient.<span class="built_in">IsValid</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetFOV</span>(InFOV); &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; CachedFOV = InFOV; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetExposureParam</span><span class="params">(<span class="type">float</span> InExposure)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UCineCameraComponent* CineComp = <span class="built_in">GetLockedCineCamera</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        FPostProcessSettings&amp; PPS = CineComp-&gt;PostProcessSettings;</span><br><span class="line">        PPS.bOverride_AutoExposureBias = <span class="literal">true</span>;</span><br><span class="line">        PPS.AutoExposureBias = InExposure;</span><br><span class="line">        CineComp-&gt;PostProcessBlendWeight = <span class="number">1.0f</span>;</span><br><span class="line">        CineComp-&gt;<span class="built_in">MarkRenderStateDirty</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ViewportClient.<span class="built_in">IsValid</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetExposure</span>(InExposure); &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; CachedExposure = InExposure; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetFocalLengthParam</span><span class="params">(<span class="type">float</span> InFocal)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UCineCameraComponent* CineComp = <span class="built_in">GetLockedCineCamera</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        CineComp-&gt;<span class="built_in">SetCurrentFocalLength</span>(InFocal);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ViewportClient.<span class="built_in">IsValid</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetFocalLength</span>(InFocal); &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; CachedFocalLength = InFocal; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetApertureParam</span><span class="params">(<span class="type">float</span> InAperture)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UCineCameraComponent* CineComp = <span class="built_in">GetLockedCineCamera</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        CineComp-&gt;<span class="built_in">SetCurrentAperture</span>(InAperture);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ViewportClient.<span class="built_in">IsValid</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetAperture</span>(InAperture); &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; CachedAperture = InAperture; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">STcgXRViewport::SetFocusDistanceParam</span><span class="params">(<span class="type">float</span> InFocus)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (UCineCameraComponent* CineComp = <span class="built_in">GetLockedCineCamera</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        CineComp-&gt;FocusSettings.ManualFocusDistance = InFocus;</span><br><span class="line">        CineComp-&gt;<span class="built_in">SetFocusSettings</span>(CineComp-&gt;FocusSettings);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ViewportClient.<span class="built_in">IsValid</span>()) &#123; ViewportClient-&gt;<span class="built_in">SetFocusDistance</span>(InFocus); &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; CachedFocusDistance = InFocus; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TcgXR-cpp"><a href="#TcgXR-cpp" class="headerlink" title="TcgXR.cpp"></a>TcgXR.cpp</h3><p><strong>文件路径</strong>: <code>Private\TcgXR.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"><span class="comment">// 本文件为TcgXR插件主模块，负责插件的初始化、UI布局和命令注册。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXR.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRStyle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRCommands.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ToolMenus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Framework/Docking/TabManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Docking/SDockTab.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Layout/SBorder.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/SBoxPanel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Input/SCheckBox.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Input/SButton.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Input/SComboBox.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Input/SSlider.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Input/SSpinBox.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Input/SComboButton.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/Text/STextBlock.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widgets/SWindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Framework/Application/SlateApplication.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;STcgXRViewport.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRViewportClient.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LevelEditor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;LevelEditorViewport.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SLevelViewport.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EngineUtils.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Camera/CameraActor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Editor.h&quot;</span> <span class="comment">// FEditorDelegates</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">const</span> FName <span class="title">TcgXRTabName</span><span class="params">(<span class="string">&quot;TcgXRWindow&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOCTEXT_NAMESPACE <span class="string">&quot;FTcgXRModule&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::StartupModule</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FTcgXRStyle::<span class="built_in">Initialize</span>();</span><br><span class="line">	FTcgXRStyle::<span class="built_in">ReloadTextures</span>();</span><br><span class="line"></span><br><span class="line">	FTcgXRCommands::<span class="built_in">Register</span>();</span><br><span class="line">	</span><br><span class="line">	PluginCommands = <span class="built_in">MakeShareable</span>(<span class="keyword">new</span> FUICommandList);</span><br><span class="line">	PluginCommands-&gt;<span class="built_in">MapAction</span>(</span><br><span class="line">		FTcgXRCommands::<span class="built_in">Get</span>().PluginAction,</span><br><span class="line">		FExecuteAction::<span class="built_in">CreateRaw</span>(<span class="keyword">this</span>, &amp;FTcgXRModule::PluginButtonClicked),</span><br><span class="line">		<span class="built_in">FCanExecuteAction</span>());</span><br><span class="line"></span><br><span class="line">	FGlobalTabmanager::<span class="built_in">Get</span>()-&gt;<span class="built_in">RegisterNomadTabSpawner</span>(TcgXRTabName,</span><br><span class="line">		FOnSpawnTab::<span class="built_in">CreateRaw</span>(<span class="keyword">this</span>, &amp;FTcgXRModule::OnSpawnPluginTab))</span><br><span class="line">		.<span class="built_in">SetDisplayName</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;TcgXRTabTitle&quot;</span>, <span class="string">&quot;TcgXR&quot;</span>))</span><br><span class="line">		.<span class="built_in">SetMenuType</span>(ETabSpawnerMenuType::Hidden);</span><br><span class="line"></span><br><span class="line">	UToolMenus::<span class="built_in">RegisterStartupCallback</span>(FSimpleMulticastDelegate::FDelegate::<span class="built_in">CreateRaw</span>(<span class="keyword">this</span>, &amp;FTcgXRModule::RegisterMenus));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (GEngine)</span><br><span class="line">	&#123;</span><br><span class="line">		ActorAddedHandle = GEngine-&gt;<span class="built_in">OnLevelActorAdded</span>().<span class="built_in">AddLambda</span>([<span class="keyword">this</span>](AActor* <span class="comment">/*Actor*/</span>)&#123; <span class="built_in">RefreshCameraList</span>(); &#125;);</span><br><span class="line">		ActorDeletedHandle = GEngine-&gt;<span class="built_in">OnLevelActorDeleted</span>().<span class="built_in">AddLambda</span>([<span class="keyword">this</span>](AActor* <span class="comment">/*Actor*/</span>)&#123; <span class="built_in">RefreshCameraList</span>(); &#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 当编辑器相机移动或切换锁定时，刷新“当前控制”文本</span></span><br><span class="line">	FEditorDelegates::OnEditorCameraMoved.<span class="built_in">AddLambda</span>([<span class="keyword">this</span>](<span class="type">const</span> FVector&amp;, <span class="type">const</span> FRotator&amp;, ELevelViewportType, int32)&#123; <span class="built_in">RebuildCameraHotkeyUI</span>(); &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::ShutdownModule</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	UToolMenus::<span class="built_in">UnRegisterStartupCallback</span>(<span class="keyword">this</span>);</span><br><span class="line">	UToolMenus::<span class="built_in">UnregisterOwner</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">	FGlobalTabmanager::<span class="built_in">Get</span>()-&gt;<span class="built_in">UnregisterNomadTabSpawner</span>(TcgXRTabName);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (GEngine)</span><br><span class="line">	&#123;</span><br><span class="line">		GEngine-&gt;<span class="built_in">OnLevelActorAdded</span>().<span class="built_in">Remove</span>(ActorAddedHandle);</span><br><span class="line">		GEngine-&gt;<span class="built_in">OnLevelActorDeleted</span>().<span class="built_in">Remove</span>(ActorDeletedHandle);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	FTcgXRStyle::<span class="built_in">Shutdown</span>();</span><br><span class="line">	FTcgXRCommands::<span class="built_in">Unregister</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::PluginButtonClicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FGlobalTabmanager::<span class="built_in">Get</span>()-&gt;<span class="built_in">TryInvokeTab</span>(TcgXRTabName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::RegisterMenus</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">FToolMenuOwnerScoped <span class="title">OwnerScoped</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (UToolMenu* Menu = UToolMenus::<span class="built_in">Get</span>()-&gt;<span class="built_in">ExtendMenu</span>(<span class="string">&quot;LevelEditor.MainMenu.Window&quot;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		FToolMenuSection&amp; Section = Menu-&gt;<span class="built_in">FindOrAddSection</span>(<span class="string">&quot;WindowLayout&quot;</span>);</span><br><span class="line">		Section.<span class="built_in">AddMenuEntryWithCommandList</span>(FTcgXRCommands::<span class="built_in">Get</span>().PluginAction, PluginCommands);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (UToolMenu* ToolbarMenu = UToolMenus::<span class="built_in">Get</span>()-&gt;<span class="built_in">ExtendMenu</span>(<span class="string">&quot;LevelEditor.LevelEditorToolBar.PlayToolBar&quot;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		FToolMenuSection&amp; Section = ToolbarMenu-&gt;<span class="built_in">FindOrAddSection</span>(<span class="string">&quot;PluginTools&quot;</span>);</span><br><span class="line">		FToolMenuEntry&amp; Entry = Section.<span class="built_in">AddEntry</span>(FToolMenuEntry::<span class="built_in">InitToolBarButton</span>(FTcgXRCommands::<span class="built_in">Get</span>().PluginAction));</span><br><span class="line">		Entry.<span class="built_in">SetCommandList</span>(PluginCommands);</span><br><span class="line">		Entry.Icon = <span class="built_in">FSlateIcon</span>(FTcgXRStyle::<span class="built_in">GetStyleSetName</span>(), <span class="built_in">TEXT</span>(<span class="string">&quot;TcgXR.PluginAction.Small&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;TcgXR.PluginAction&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FTcgXRModule::HandleKeyDown</span><span class="params">(<span class="type">const</span> FKey&amp; Key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (TWeakObjectPtr&lt;ACameraActor&gt;* Found = CameraHotkeyMap.<span class="built_in">Find</span>(Key))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">SwitchToCamera</span>(*Found);</span><br><span class="line">		<span class="built_in">RebuildCameraHotkeyUI</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::BindCameraHotkey</span><span class="params">(TWeakObjectPtr&lt;ACameraActor&gt; Camera, <span class="type">const</span> FKey&amp; Key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 确保一个相机只绑定一个键：先移除旧绑定</span></span><br><span class="line">	TArray&lt;FKey&gt; KeysToRemove;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; Pair : CameraHotkeyMap)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Pair.Value == Camera)</span><br><span class="line">		&#123;</span><br><span class="line">			KeysToRemove.<span class="built_in">Add</span>(Pair.Key);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">const</span> FKey&amp; OldKey : KeysToRemove)</span><br><span class="line">	&#123;</span><br><span class="line">		CameraHotkeyMap.<span class="built_in">Remove</span>(OldKey);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 同一按键重新绑定到新相机</span></span><br><span class="line">	CameraHotkeyMap.<span class="built_in">Add</span>(Key, Camera);</span><br><span class="line">	<span class="built_in">RebuildCameraHotkeyUI</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::SwitchToCamera</span><span class="params">(TWeakObjectPtr&lt;ACameraActor&gt; Camera)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!Camera.<span class="built_in">IsValid</span>()) <span class="keyword">return</span>;</span><br><span class="line">	FLevelEditorModule&amp; LevelEditorModule = FModuleManager::<span class="built_in">LoadModuleChecked</span>&lt;FLevelEditorModule&gt;(<span class="string">&quot;LevelEditor&quot;</span>);</span><br><span class="line">	TSharedPtr&lt;SLevelViewport&gt; ActiveViewport = LevelEditorModule.<span class="built_in">GetFirstActiveLevelViewport</span>();</span><br><span class="line">	<span class="keyword">if</span> (!ActiveViewport.<span class="built_in">IsValid</span>()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	FLevelEditorViewportClient&amp; LVC = ActiveViewport-&gt;<span class="built_in">GetLevelViewportClient</span>();</span><br><span class="line">	LVC.<span class="built_in">SetActorLock</span>(Camera.<span class="built_in">Get</span>());</span><br><span class="line">	LVC.<span class="built_in">UpdateViewForLockedActor</span>();</span><br><span class="line">	<span class="keyword">if</span> (!ActiveViewport-&gt;<span class="built_in">IsLockedCameraViewEnabled</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		ActiveViewport-&gt;<span class="built_in">ToggleActorPilotCameraView</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	LVC.<span class="built_in">Invalidate</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">FText <span class="title">FTcgXRModule::GetCurrentControlledCameraText</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!GEditor) <span class="keyword">return</span> <span class="built_in">LOCTEXT</span>(<span class="string">&quot;NoEditor&quot;</span>, <span class="string">&quot;当前控制: 无（未找到编辑器）&quot;</span>);</span><br><span class="line">	<span class="type">const</span> TArray&lt;FLevelEditorViewportClient*&gt;&amp; Clients = GEditor-&gt;<span class="built_in">GetLevelViewportClients</span>();</span><br><span class="line">	<span class="keyword">for</span> (FLevelEditorViewportClient* LVC : Clients)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!LVC || !LVC-&gt;<span class="built_in">IsPerspective</span>()) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span> (AActor* CineLock = LVC-&gt;<span class="built_in">GetCinematicActorLock</span>().<span class="built_in">GetLockedActor</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> FText::<span class="built_in">Format</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;ControllingCam&quot;</span>,<span class="string">&quot;当前控制: &#123;0&#125;&quot;</span>), FText::<span class="built_in">FromString</span>(CineLock-&gt;<span class="built_in">GetActorLabel</span>()));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (LVC-&gt;<span class="built_in">GetActiveActorLock</span>().<span class="built_in">IsValid</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			AActor* Locked = LVC-&gt;<span class="built_in">GetActiveActorLock</span>().<span class="built_in">Get</span>();</span><br><span class="line">			<span class="keyword">return</span> FText::<span class="built_in">Format</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;ControllingActor&quot;</span>,<span class="string">&quot;当前控制: &#123;0&#125;&quot;</span>), FText::<span class="built_in">FromString</span>(Locked-&gt;<span class="built_in">GetActorLabel</span>()));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">LOCTEXT</span>(<span class="string">&quot;NoCam&quot;</span>,<span class="string">&quot;当前控制: 无（未锁定相机）&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">FText <span class="title">FTcgXRModule::GetBoundKeyTextForCamera</span><span class="params">(TWeakObjectPtr&lt;ACameraActor&gt; Camera)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; Pair : CameraHotkeyMap)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Pair.Value == Camera)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> FText::<span class="built_in">Format</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;BoundKeyFmt&quot;</span>,<span class="string">&quot;已绑定: &#123;0&#125;&quot;</span>), Pair.Key.<span class="built_in">GetDisplayName</span>());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">LOCTEXT</span>(<span class="string">&quot;NoKeyBound&quot;</span>,<span class="string">&quot;未绑定&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::RefreshCameraList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CachedCameras.<span class="built_in">Reset</span>();</span><br><span class="line">	<span class="keyword">if</span> (GEditor)</span><br><span class="line">	&#123;</span><br><span class="line">		UWorld* World = GEditor-&gt;<span class="built_in">GetEditorWorldContext</span>().<span class="built_in">World</span>();</span><br><span class="line">		<span class="keyword">if</span> (World)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (TActorIterator&lt;ACameraActor&gt; <span class="built_in">It</span>(World); It; ++It)</span><br><span class="line">			&#123;</span><br><span class="line">				CachedCameras.<span class="built_in">Add</span>(*It);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">RebuildCameraHotkeyUI</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::RebuildCameraHotkeyUI</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	TSharedPtr&lt;SVerticalBox&gt; Panel = CameraListPanel.<span class="built_in">Pin</span>();</span><br><span class="line">	<span class="keyword">if</span> (!Panel.<span class="built_in">IsValid</span>()) <span class="keyword">return</span>;</span><br><span class="line">	Panel-&gt;<span class="built_in">ClearChildren</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 顶部显示当前控制的相机</span></span><br><span class="line">	Panel-&gt;<span class="built_in">AddSlot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">	[</span><br><span class="line">		<span class="built_in">SNew</span>(STextBlock)</span><br><span class="line">		.<span class="built_in">Text_Lambda</span>([<span class="keyword">this</span>]()&#123; <span class="keyword">return</span> <span class="built_in">GetCurrentControlledCameraText</span>(); &#125;)</span><br><span class="line">	];</span><br><span class="line"></span><br><span class="line">	int32 Index = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (TWeakObjectPtr&lt;ACameraActor&gt; Cam : CachedCameras)</span><br><span class="line">	&#123;</span><br><span class="line">		TWeakObjectPtr&lt;ACameraActor&gt; LocalCam = Cam;</span><br><span class="line">		FText Label = FText::<span class="built_in">FromString</span>(FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;相机%d: %s&quot;</span>), Index, LocalCam.<span class="built_in">IsValid</span>() ? *LocalCam-&gt;<span class="built_in">GetActorLabel</span>() : <span class="built_in">TEXT</span>(<span class="string">&quot;(无)&quot;</span>)));</span><br><span class="line">		Panel-&gt;<span class="built_in">AddSlot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">		[</span><br><span class="line">			<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">			+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">			[</span><br><span class="line">				<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(Label)</span><br><span class="line">			]</span><br><span class="line">			+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">			[</span><br><span class="line">				<span class="built_in">SNew</span>(STextBlock)</span><br><span class="line">				.<span class="built_in">Text_Lambda</span>([<span class="keyword">this</span>, LocalCam]()&#123; <span class="keyword">return</span> <span class="built_in">GetBoundKeyTextForCamera</span>(LocalCam); &#125;)</span><br><span class="line">			]</span><br><span class="line">			+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">			[</span><br><span class="line">				<span class="built_in">SNew</span>(SComboButton)</span><br><span class="line">				.<span class="built_in">ButtonContent</span>()[ <span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;BindKey&quot;</span>, <span class="string">&quot;绑定按键&quot;</span>)) ]</span><br><span class="line">				.<span class="built_in">OnGetMenuContent_Lambda</span>([<span class="keyword">this</span>, LocalCam]()</span><br><span class="line">				&#123;</span><br><span class="line">					FMenuBuilder <span class="built_in">MenuBuilder</span>(<span class="literal">true</span>, <span class="literal">nullptr</span>);</span><br><span class="line">					TArray&lt;FKey&gt; Keys; Keys.<span class="built_in">Reserve</span>(<span class="number">9</span>);</span><br><span class="line">					Keys.<span class="built_in">Add</span>(EKeys::One); Keys.<span class="built_in">Add</span>(EKeys::Two); Keys.<span class="built_in">Add</span>(EKeys::Three); Keys.<span class="built_in">Add</span>(EKeys::Four);</span><br><span class="line">					Keys.<span class="built_in">Add</span>(EKeys::Five); Keys.<span class="built_in">Add</span>(EKeys::Six); Keys.<span class="built_in">Add</span>(EKeys::Seven); Keys.<span class="built_in">Add</span>(EKeys::Eight); Keys.<span class="built_in">Add</span>(EKeys::Nine);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">const</span> FKey&amp; K : Keys)</span><br><span class="line">					&#123;</span><br><span class="line">						FText KeyName = K.<span class="built_in">GetDisplayName</span>();</span><br><span class="line">						MenuBuilder.<span class="built_in">AddMenuEntry</span>(KeyName, <span class="built_in">LOCTEXT</span>(<span class="string">&quot;BindKeyTip&quot;</span>,<span class="string">&quot;绑定到该键&quot;</span>), <span class="built_in">FSlateIcon</span>(), <span class="built_in">FUIAction</span>(FExecuteAction::<span class="built_in">CreateLambda</span>([<span class="keyword">this</span>, LocalCam, K]()&#123; <span class="built_in">BindCameraHotkey</span>(LocalCam, K); &#125;)));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">return</span> MenuBuilder.<span class="built_in">MakeWidget</span>();</span><br><span class="line">				&#125;)</span><br><span class="line">			]</span><br><span class="line">			+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">			[</span><br><span class="line">				<span class="built_in">SNew</span>(SButton)</span><br><span class="line">				.<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;SwitchNow&quot;</span>,<span class="string">&quot;切换到该相机&quot;</span>))</span><br><span class="line">				.<span class="built_in">OnClicked_Lambda</span>([<span class="keyword">this</span>, LocalCam]()</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">SwitchToCamera</span>(LocalCam);</span><br><span class="line">					<span class="built_in">RebuildCameraHotkeyUI</span>();</span><br><span class="line">					<span class="keyword">return</span> FReply::<span class="built_in">Handled</span>();</span><br><span class="line">				&#125;)</span><br><span class="line">			]</span><br><span class="line">		];</span><br><span class="line">		++Index;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRModule::CloseAllFullscreenWindows</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (TWeakPtr&lt;SWindow&gt;&amp; W : FullscreenWindows)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (TSharedPtr&lt;SWindow&gt; SW = W.<span class="built_in">Pin</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			SW-&gt;<span class="built_in">RequestDestroyWindow</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FullscreenWindows.<span class="built_in">Reset</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成主窗口Tab，包括Viewport、右侧摄影机控制面板、底部全屏按钮</span></span><br><span class="line"><span class="function">TSharedRef&lt;SDockTab&gt; <span class="title">FTcgXRModule::OnSpawnPluginTab</span><span class="params">(<span class="type">const</span> FSpawnTabArgs&amp; Args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	TSharedPtr&lt;STcgXRViewport&gt; ViewportWidget;</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ManualExposure = <span class="number">0.0f</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ManualFOV = <span class="number">90.0f</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ManualFocal = <span class="number">35.0f</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ManualAperture = <span class="number">2.8f</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ManualFocus = <span class="number">1000.0f</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">bool</span> bUseLiveLink = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">static</span> TArray&lt;TSharedPtr&lt;FString&gt;&gt; ResolutionOptions;</span><br><span class="line">	ResolutionOptions.<span class="built_in">Reset</span>();</span><br><span class="line">	ResolutionOptions.<span class="built_in">Add</span>(<span class="built_in">MakeShared</span>&lt;FString&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;1920x1080&quot;</span>)));</span><br><span class="line">	ResolutionOptions.<span class="built_in">Add</span>(<span class="built_in">MakeShared</span>&lt;FString&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;2560x1440&quot;</span>)));</span><br><span class="line">	ResolutionOptions.<span class="built_in">Add</span>(<span class="built_in">MakeShared</span>&lt;FString&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;3840x2160&quot;</span>)));</span><br><span class="line">	<span class="type">static</span> TArray&lt;TSharedPtr&lt;FString&gt;&gt; MonitorOptions;</span><br><span class="line">	<span class="type">static</span> int32 SelectedMonitorIndex = <span class="number">0</span>;</span><br><span class="line">	<span class="type">static</span> TSharedPtr&lt;FString&gt; SelectedResolution = ResolutionOptions.<span class="built_in">Num</span>() &gt; <span class="number">0</span> ? ResolutionOptions[<span class="number">0</span>] : <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">	MonitorOptions.<span class="built_in">Reset</span>();</span><br><span class="line">	&#123;</span><br><span class="line">		FDisplayMetrics Metrics;</span><br><span class="line">		FSlateApplication::<span class="built_in">Get</span>().<span class="built_in">GetDisplayMetrics</span>(Metrics);</span><br><span class="line">		MonitorOptions.<span class="built_in">Add</span>(<span class="built_in">MakeShared</span>&lt;FString&gt;(FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;主显示器 %dx%d&quot;</span>), Metrics.PrimaryDisplayWidth, Metrics.PrimaryDisplayHeight)));</span><br><span class="line">		<span class="keyword">for</span> (int32 i = <span class="number">0</span>; i &lt; Metrics.MonitorInfo.<span class="built_in">Num</span>(); ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">const</span> <span class="keyword">auto</span>&amp; M = Metrics.MonitorInfo[i];</span><br><span class="line">			FPlatformRect Rect = M.WorkArea;</span><br><span class="line">			MonitorOptions.<span class="built_in">Add</span>(<span class="built_in">MakeShared</span>&lt;FString&gt;(FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;显示器%d %dx%d @(%d,%d)&quot;</span>), i, Rect.Right-Rect.Left, Rect.Bottom-Rect.Top, Rect.Left, Rect.Top)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (MonitorOptions.<span class="built_in">Num</span>() == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			MonitorOptions.<span class="built_in">Add</span>(<span class="built_in">MakeShared</span>&lt;FString&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;显示器0&quot;</span>)));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	TSharedRef&lt;SDockTab&gt; Tab = <span class="built_in">SNew</span>(SDockTab)</span><br><span class="line">		.<span class="built_in">TabRole</span>(ETabRole::NomadTab)</span><br><span class="line">		[</span><br><span class="line">			<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">			+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">FillWidth</span>(<span class="number">1.f</span>)</span><br><span class="line">			[</span><br><span class="line">				<span class="built_in">SAssignNew</span>(ViewportWidget, STcgXRViewport)</span><br><span class="line">			]</span><br><span class="line">			+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">8.f</span>,<span class="number">0.f</span>)</span><br><span class="line">			[</span><br><span class="line">				<span class="built_in">SNew</span>(SVerticalBox)</span><br><span class="line">				+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">				[</span><br><span class="line">					<span class="built_in">SAssignNew</span>(CameraListPanel, SVerticalBox)</span><br><span class="line">				]</span><br><span class="line">				<span class="comment">// 顶部快速参数行：移除FOV和曝光</span></span><br><span class="line">				+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">				[</span><br><span class="line">					<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">					<span class="comment">// 焦距</span></span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;Focal&quot;</span>, <span class="string">&quot;焦距&quot;</span>))</span><br><span class="line">					]</span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SSpinBox&lt;<span class="type">float</span>&gt;).<span class="built_in">MinValue</span>(<span class="number">1.f</span>).<span class="built_in">MaxValue</span>(<span class="number">300.f</span>)</span><br><span class="line">						.<span class="built_in">Value_Lambda</span>([&amp;]&#123; <span class="keyword">return</span> ManualFocal; &#125;)</span><br><span class="line">						.<span class="built_in">OnValueChanged_Lambda</span>([&amp;](<span class="type">float</span> V)&#123; ManualFocal = V; <span class="keyword">if</span>(ViewportWidget.<span class="built_in">IsValid</span>()) ViewportWidget-&gt;<span class="built_in">SetFocalLengthParam</span>(V); &#125;)</span><br><span class="line">					]</span><br><span class="line">					<span class="comment">// 光圈</span></span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;Aperture&quot;</span>, <span class="string">&quot;光圈&quot;</span>))</span><br><span class="line">					]</span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SSpinBox&lt;<span class="type">float</span>&gt;).<span class="built_in">MinValue</span>(<span class="number">0.7f</span>).<span class="built_in">MaxValue</span>(<span class="number">32.f</span>)</span><br><span class="line">						.<span class="built_in">Value_Lambda</span>([&amp;]&#123; <span class="keyword">return</span> ManualAperture; &#125;)</span><br><span class="line">						.<span class="built_in">OnValueChanged_Lambda</span>([&amp;](<span class="type">float</span> V)&#123; ManualAperture = V; <span class="keyword">if</span>(ViewportWidget.<span class="built_in">IsValid</span>()) ViewportWidget-&gt;<span class="built_in">SetApertureParam</span>(V); &#125;)</span><br><span class="line">					]</span><br><span class="line">					<span class="comment">// 对焦</span></span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;Focus&quot;</span>, <span class="string">&quot;对焦&quot;</span>))</span><br><span class="line">					]</span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SSpinBox&lt;<span class="type">float</span>&gt;).<span class="built_in">MinValue</span>(<span class="number">1.f</span>).<span class="built_in">MaxValue</span>(<span class="number">100000.f</span>)</span><br><span class="line">						.<span class="built_in">Value_Lambda</span>([&amp;]&#123; <span class="keyword">return</span> ManualFocus; &#125;)</span><br><span class="line">						.<span class="built_in">OnValueChanged_Lambda</span>([&amp;](<span class="type">float</span> V)&#123; ManualFocus = V; <span class="keyword">if</span>(ViewportWidget.<span class="built_in">IsValid</span>()) ViewportWidget-&gt;<span class="built_in">SetFocusDistanceParam</span>(V); &#125;)</span><br><span class="line">					]</span><br><span class="line">				]</span><br><span class="line"></span><br><span class="line">				+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">				[</span><br><span class="line">					<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2.f</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SCheckBox)</span><br><span class="line">						.<span class="built_in">IsChecked_Lambda</span>([] &#123; <span class="keyword">return</span> bUseLiveLink ? ECheckBoxState::Checked : ECheckBoxState::Unchecked; &#125;)</span><br><span class="line">						.<span class="built_in">OnCheckStateChanged_Lambda</span>([](ECheckBoxState State) &#123; bUseLiveLink = (State == ECheckBoxState::Checked); &#125;)</span><br><span class="line">					]</span><br><span class="line">					+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2.f</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;LiveLinkSwitch&quot;</span>, <span class="string">&quot;使用LiveLink外部相机&quot;</span>))</span><br><span class="line">					]</span><br><span class="line">				]</span><br><span class="line"></span><br><span class="line">				+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">				[</span><br><span class="line">					<span class="built_in">SNew</span>(SVerticalBox)</span><br><span class="line">					.<span class="built_in">Visibility_Lambda</span>([] &#123; <span class="keyword">return</span> bUseLiveLink ? EVisibility::Visible : EVisibility::Collapsed; &#125;)</span><br><span class="line">					+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>()</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;LiveLinkTitle&quot;</span>, <span class="string">&quot;LiveLink外部相机参数&quot;</span>))</span><br><span class="line">					]</span><br><span class="line">					+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;LiveLinkStatus&quot;</span>, <span class="string">&quot;状态: 未连接/已连接&quot;</span>))</span><br><span class="line">					]</span><br><span class="line">				]</span><br><span class="line"></span><br><span class="line">				+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">VAlign</span>(VAlign_Bottom).<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">				[</span><br><span class="line">					<span class="built_in">SNew</span>(SVerticalBox)</span><br><span class="line">					+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">						+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2.f</span>)</span><br><span class="line">						[</span><br><span class="line">							<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;MonitorLabel&quot;</span>, <span class="string">&quot;屏幕&quot;</span>))</span><br><span class="line">						]</span><br><span class="line">						+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2.f</span>)</span><br><span class="line">						[</span><br><span class="line">							<span class="built_in">SNew</span>(SComboBox&lt;TSharedPtr&lt;FString&gt;&gt;)</span><br><span class="line">							.<span class="built_in">OptionsSource</span>(&amp;MonitorOptions)</span><br><span class="line">							.<span class="built_in">OnSelectionChanged_Lambda</span>([&amp;](TSharedPtr&lt;FString&gt; NewItem, ESelectInfo::Type)&#123; SelectedMonitorIndex = FMath::<span class="built_in">Clamp</span>(MonitorOptions.<span class="built_in">IndexOfByKey</span>(NewItem), <span class="number">0</span>, MonitorOptions.<span class="built_in">Num</span>()<span class="number">-1</span>); &#125;)</span><br><span class="line">							.<span class="built_in">OnGenerateWidget_Lambda</span>([](TSharedPtr&lt;FString&gt; InItem)&#123; <span class="keyword">return</span> <span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(FText::<span class="built_in">FromString</span>(*InItem)); &#125;)</span><br><span class="line">							[</span><br><span class="line">								<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text_Lambda</span>([&amp;]&#123; <span class="keyword">return</span> MonitorOptions.<span class="built_in">IsValidIndex</span>(SelectedMonitorIndex) ? FText::<span class="built_in">FromString</span>(*MonitorOptions[SelectedMonitorIndex]) : <span class="built_in">LOCTEXT</span>(<span class="string">&quot;MonitorUnknown&quot;</span>,<span class="string">&quot;未知屏幕&quot;</span>); &#125;)</span><br><span class="line">							]</span><br><span class="line">						]</span><br><span class="line">					]</span><br><span class="line">					+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">						+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2.f</span>)</span><br><span class="line">						[</span><br><span class="line">							<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;ResolutionLabel&quot;</span>, <span class="string">&quot;输出分辨率&quot;</span>))</span><br><span class="line">						]</span><br><span class="line">						+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2.f</span>)</span><br><span class="line">						[</span><br><span class="line">							<span class="built_in">SNew</span>(SComboBox&lt;TSharedPtr&lt;FString&gt;&gt;)</span><br><span class="line">							.<span class="built_in">OptionsSource</span>(&amp;ResolutionOptions)</span><br><span class="line">							.<span class="built_in">OnSelectionChanged_Lambda</span>([&amp;](TSharedPtr&lt;FString&gt; NewItem, ESelectInfo::Type) &#123; SelectedResolution = NewItem; &#125;)</span><br><span class="line">							.<span class="built_in">OnGenerateWidget_Lambda</span>([](TSharedPtr&lt;FString&gt; InItem) &#123; <span class="keyword">return</span> <span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text</span>(FText::<span class="built_in">FromString</span>(*InItem)); &#125;)</span><br><span class="line">							[</span><br><span class="line">								<span class="built_in">SNew</span>(STextBlock).<span class="built_in">Text_Lambda</span>([&amp;] &#123; <span class="keyword">return</span> SelectedResolution.<span class="built_in">IsValid</span>() ? FText::<span class="built_in">FromString</span>(*SelectedResolution) : <span class="built_in">LOCTEXT</span>(<span class="string">&quot;ResUnknown&quot;</span>,<span class="string">&quot;未知&quot;</span>); &#125;)</span><br><span class="line">							]</span><br><span class="line">						]</span><br><span class="line">					]</span><br><span class="line">					+ SVerticalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoHeight</span>().<span class="built_in">Padding</span>(<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">					[</span><br><span class="line">						<span class="built_in">SNew</span>(SHorizontalBox)</span><br><span class="line">						+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">						[</span><br><span class="line">							<span class="built_in">SNew</span>(SButton)</span><br><span class="line">							.<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;FullscreenBtn&quot;</span>, <span class="string">&quot;全屏显示&quot;</span>))</span><br><span class="line">							.<span class="built_in">OnClicked_Lambda</span>([<span class="keyword">this</span>, ViewportWidget]() &#123;</span><br><span class="line">								<span class="keyword">if</span>(!ViewportWidget.<span class="built_in">IsValid</span>()) <span class="keyword">return</span> FReply::<span class="built_in">Handled</span>();</span><br><span class="line">								TSharedPtr&lt;FString&gt; LocalSelectedResolution = SelectedResolution;</span><br><span class="line">								int32 LocalSelectedMonitorIndex = SelectedMonitorIndex;</span><br><span class="line">								int32 W=<span class="number">1920</span>, H=<span class="number">1080</span>;</span><br><span class="line">								&#123;</span><br><span class="line">									FString Res= LocalSelectedResolution.<span class="built_in">IsValid</span>() ? *LocalSelectedResolution : <span class="built_in">FString</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;1920x1080&quot;</span>));</span><br><span class="line">									FString LW, LH;</span><br><span class="line">									<span class="keyword">if</span>(Res.<span class="built_in">Split</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;x&quot;</span>), &amp;LW, &amp;LH)) &#123; W = FCString::<span class="built_in">Atoi</span>(*LW); H = FCString::<span class="built_in">Atoi</span>(*LH); &#125;</span><br><span class="line">								&#125;</span><br><span class="line">								TSharedPtr&lt;SWindow&gt; FullscreenWindow = <span class="built_in">SNew</span>(SWindow)</span><br><span class="line">									.<span class="built_in">Title</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;XRFullscreen&quot;</span>, <span class="string">&quot;XR全屏输出&quot;</span>))</span><br><span class="line">									.<span class="built_in">ClientSize</span>(<span class="built_in">FVector2D</span>(W, H))</span><br><span class="line">									.<span class="built_in">SizingRule</span>(ESizingRule::FixedSize)</span><br><span class="line">									.<span class="built_in">SupportsMaximize</span>(<span class="literal">false</span>)</span><br><span class="line">									.<span class="built_in">SupportsMinimize</span>(<span class="literal">false</span>)</span><br><span class="line">									.<span class="built_in">HasCloseButton</span>(<span class="literal">true</span>)</span><br><span class="line">									.<span class="built_in">UseOSWindowBorder</span>(<span class="literal">false</span>)</span><br><span class="line">									.<span class="built_in">CreateTitleBar</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">								TSharedPtr&lt;STcgXRViewport&gt; FSViewport;</span><br><span class="line">								FullscreenWindow-&gt;<span class="built_in">SetContent</span>(<span class="built_in">SAssignNew</span>(FSViewport, STcgXRViewport));</span><br><span class="line"></span><br><span class="line">								<span class="keyword">if</span> (FSlateApplication::<span class="built_in">IsInitialized</span>())</span><br><span class="line">								&#123;</span><br><span class="line">									FSlateApplication::<span class="built_in">Get</span>().<span class="built_in">AddWindow</span>(FullscreenWindow.<span class="built_in">ToSharedRef</span>());</span><br><span class="line">									FDisplayMetrics Metrics; FSlateApplication::<span class="built_in">Get</span>().<span class="built_in">GetDisplayMetrics</span>(Metrics);</span><br><span class="line">									FVector2D <span class="built_in">TargetPos</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">									<span class="keyword">if</span> (Metrics.MonitorInfo.<span class="built_in">IsValidIndex</span>(LocalSelectedMonitorIndex))</span><br><span class="line">									&#123;</span><br><span class="line">										<span class="type">const</span> <span class="keyword">auto</span>&amp; M = Metrics.MonitorInfo[LocalSelectedMonitorIndex];</span><br><span class="line">										TargetPos = <span class="built_in">FVector2D</span>(M.WorkArea.Left, M.WorkArea.Top);</span><br><span class="line">									&#125;</span><br><span class="line">									FullscreenWindow-&gt;<span class="built_in">MoveWindowTo</span>(TargetPos);</span><br><span class="line">								&#125;</span><br><span class="line"></span><br><span class="line">								FullscreenWindows.<span class="built_in">Add</span>(FullscreenWindow);</span><br><span class="line"></span><br><span class="line">								<span class="keyword">if</span> (ViewportWidget-&gt;<span class="built_in">GetClient</span>().<span class="built_in">IsValid</span>() &amp;&amp; FSViewport.<span class="built_in">IsValid</span>())</span><br><span class="line">								&#123;</span><br><span class="line">									<span class="keyword">auto</span> Src = ViewportWidget-&gt;<span class="built_in">GetClient</span>();</span><br><span class="line">									<span class="keyword">auto</span> Dst = FSViewport-&gt;<span class="built_in">GetClient</span>();</span><br><span class="line">									Dst-&gt;<span class="built_in">SetCameraFrom</span>(Src-&gt;<span class="built_in">GetViewLocation</span>(), Src-&gt;<span class="built_in">GetViewRotation</span>(), Src-&gt;<span class="built_in">GetFOV</span>(), <span class="number">2048.f</span>, <span class="literal">false</span>);</span><br><span class="line">									Dst-&gt;<span class="built_in">SetFOV</span>(Src-&gt;<span class="built_in">GetFOV</span>());</span><br><span class="line">									Dst-&gt;<span class="built_in">SetExposure</span>(Src-&gt;<span class="built_in">GetExposure</span>());</span><br><span class="line">									Dst-&gt;<span class="built_in">SetFocalLength</span>(Src-&gt;<span class="built_in">GetFocalLength</span>());</span><br><span class="line">									Dst-&gt;<span class="built_in">SetAperture</span>(Src-&gt;<span class="built_in">GetAperture</span>());</span><br><span class="line">									Dst-&gt;<span class="built_in">SetFocusDistance</span>(Src-&gt;<span class="built_in">GetFocusDistance</span>());</span><br><span class="line">								&#125;</span><br><span class="line"></span><br><span class="line">								<span class="keyword">return</span> FReply::<span class="built_in">Handled</span>();</span><br><span class="line">							&#125;)</span><br><span class="line">						]</span><br><span class="line">						+ SHorizontalBox::<span class="built_in">Slot</span>().<span class="built_in">AutoWidth</span>().<span class="built_in">Padding</span>(<span class="number">2</span>)</span><br><span class="line">						[</span><br><span class="line">							<span class="built_in">SNew</span>(SButton)</span><br><span class="line">							.<span class="built_in">Text</span>(<span class="built_in">LOCTEXT</span>(<span class="string">&quot;CloseFullscreenBtn&quot;</span>, <span class="string">&quot;关闭所有全屏&quot;</span>))</span><br><span class="line">							.<span class="built_in">OnClicked_Lambda</span>([<span class="keyword">this</span>]()</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="built_in">CloseAllFullscreenWindows</span>();</span><br><span class="line">								<span class="keyword">return</span> FReply::<span class="built_in">Handled</span>();</span><br><span class="line">							&#125;)</span><br><span class="line">						]</span><br><span class="line">					]</span><br><span class="line">				]</span><br><span class="line">			]</span><br><span class="line">		];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">RefreshCameraList</span>();</span><br><span class="line">	<span class="keyword">return</span> Tab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> LOCTEXT_NAMESPACE</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">IMPLEMENT_MODULE</span>(FTcgXRModule, TcgXR)</span><br></pre></td></tr></table></figure>

<h3 id="TcgXRCommands-cpp"><a href="#TcgXRCommands-cpp" class="headerlink" title="TcgXRCommands.cpp"></a>TcgXRCommands.cpp</h3><p><strong>文件路径</strong>: <code>Private\TcgXRCommands.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRCommands.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOCTEXT_NAMESPACE <span class="string">&quot;FTcgXRModule&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRCommands::RegisterCommands</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">UI_COMMAND</span>(PluginAction, <span class="string">&quot;TcgXR&quot;</span>, <span class="string">&quot;Execute TcgXR action&quot;</span>, EUserInterfaceActionType::Button, <span class="built_in">FInputChord</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> LOCTEXT_NAMESPACE</span></span><br></pre></td></tr></table></figure>

<h3 id="TcgXRStyle-cpp"><a href="#TcgXRStyle-cpp" class="headerlink" title="TcgXRStyle.cpp"></a>TcgXRStyle.cpp</h3><p><strong>文件路径</strong>: <code>Private\TcgXRStyle.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRStyle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXR.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Framework/Application/SlateApplication.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Styling/SlateStyleRegistry.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Slate/SlateGameResources.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Interfaces/IPluginManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Styling/SlateStyleMacros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RootToContentDir Style-&gt;RootToContentDir</span></span><br><span class="line"></span><br><span class="line">TSharedPtr&lt;FSlateStyleSet&gt; FTcgXRStyle::StyleInstance = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRStyle::Initialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!StyleInstance.<span class="built_in">IsValid</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		StyleInstance = <span class="built_in">Create</span>();</span><br><span class="line">		FSlateStyleRegistry::<span class="built_in">RegisterSlateStyle</span>(*StyleInstance);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRStyle::Shutdown</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FSlateStyleRegistry::<span class="built_in">UnRegisterSlateStyle</span>(*StyleInstance);</span><br><span class="line">	<span class="built_in">ensure</span>(StyleInstance.<span class="built_in">IsUnique</span>());</span><br><span class="line">	StyleInstance.<span class="built_in">Reset</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">FName <span class="title">FTcgXRStyle::GetStyleSetName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function"><span class="type">static</span> FName <span class="title">StyleSetName</span><span class="params">(TEXT(<span class="string">&quot;TcgXRStyle&quot;</span>))</span></span>;</span><br><span class="line">	<span class="keyword">return</span> StyleSetName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> FVector2D <span class="title">Icon16x16</span><span class="params">(<span class="number">16.0f</span>, <span class="number">16.0f</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">const</span> FVector2D <span class="title">Icon20x20</span><span class="params">(<span class="number">20.0f</span>, <span class="number">20.0f</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">const</span> FVector2D <span class="title">Icon40x40</span><span class="params">(<span class="number">40.0f</span>, <span class="number">40.0f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">TSharedRef&lt; FSlateStyleSet &gt; <span class="title">FTcgXRStyle::Create</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	TSharedRef&lt; FSlateStyleSet &gt; Style = <span class="built_in">MakeShareable</span>(<span class="keyword">new</span> <span class="built_in">FSlateStyleSet</span>(<span class="string">&quot;TcgXRStyle&quot;</span>));</span><br><span class="line">	Style-&gt;<span class="built_in">SetContentRoot</span>(IPluginManager::<span class="built_in">Get</span>().<span class="built_in">FindPlugin</span>(<span class="string">&quot;TcgXR&quot;</span>)-&gt;<span class="built_in">GetBaseDir</span>() / <span class="built_in">TEXT</span>(<span class="string">&quot;Resources&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use vector image brushes from Resources/TcgXR.svg for toolbar/menu icons</span></span><br><span class="line">	Style-&gt;<span class="built_in">Set</span>(<span class="string">&quot;TcgXR.PluginAction&quot;</span>, <span class="keyword">new</span> <span class="built_in">IMAGE_BRUSH_SVG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;TcgXR&quot;</span>), Icon40x40));</span><br><span class="line">	Style-&gt;<span class="built_in">Set</span>(<span class="string">&quot;TcgXR.PluginAction.Small&quot;</span>, <span class="keyword">new</span> <span class="built_in">IMAGE_BRUSH_SVG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;TcgXR&quot;</span>), Icon20x20));</span><br><span class="line">	<span class="keyword">return</span> Style;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FTcgXRStyle::ReloadTextures</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (FSlateApplication::<span class="built_in">IsInitialized</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		FSlateApplication::<span class="built_in">Get</span>().<span class="built_in">GetRenderer</span>()-&gt;<span class="built_in">ReloadTextureResources</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> ISlateStyle&amp; <span class="title">FTcgXRStyle::Get</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> *StyleInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TcgXRViewportClient-cpp"><a href="#TcgXRViewportClient-cpp" class="headerlink" title="TcgXRViewportClient.cpp"></a>TcgXRViewportClient.cpp</h3><p><strong>文件路径</strong>: <code>Private\TcgXRViewportClient.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FTcgXRViewportClient implementation has been moved inline to TcgXRViewportClient.h</span></span><br><span class="line"><span class="comment">// This translation unit is intentionally left empty to avoid duplicate definitions.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="STcgXRViewport-h"><a href="#STcgXRViewport-h" class="headerlink" title="STcgXRViewport.h"></a>STcgXRViewport.h</h3><p><strong>文件路径</strong>: <code>Public\STcgXRViewport.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SEditorViewport.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTcgXRViewportClient</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FPreviewScene</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TcgXR自定义Viewport控件，支持XR场景显示和相机控制</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">STcgXRViewport</span> :</span> public SEditorViewport</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    SLATE_BEGIN_ARGS(STcgXRViewport) &#123;&#125;</span><br><span class="line">    SLATE_END_ARGS()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">Construct</span><span class="params">(<span class="type">const</span> FArguments&amp; InArgs)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// XR状态控制接口</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetShowKeyed</span><span class="params">(<span class="type">bool</span> b)</span>; <span class="comment">// 设置是否显示抠像</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetVirtualCamMove</span><span class="params">(<span class="type">bool</span> b)</span>; <span class="comment">// 设置是否虚拟相机运动</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetMixedRealityBlend</span><span class="params">(<span class="type">bool</span> b)</span>; <span class="comment">// 设置是否虚实融合</span></span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="title function_">IsShowKeyed</span><span class="params">()</span> <span class="type">const</span>; <span class="comment">// 是否显示抠像</span></span><br><span class="line">    <span class="type">bool</span> <span class="title function_">IsVirtualCamMove</span><span class="params">()</span> <span class="type">const</span>; <span class="comment">// 是否虚拟相机运动</span></span><br><span class="line">    <span class="type">bool</span> <span class="title function_">IsMixedRealityBlend</span><span class="params">()</span> <span class="type">const</span>; <span class="comment">// 是否虚实融合</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问底层ViewportClient（用于复制相机/参数到其它视口）</span></span><br><span class="line">    TSharedPtr&lt;FTcgXRViewportClient&gt; <span class="title function_">GetClient</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> ViewportClient; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 安全设置相机参数：若Client尚未就绪，则缓存稍后应用</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetFOVParam</span><span class="params">(<span class="type">float</span> InFOV)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetExposureParam</span><span class="params">(<span class="type">float</span> InExposure)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetFocalLengthParam</span><span class="params">(<span class="type">float</span> InFocal)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetApertureParam</span><span class="params">(<span class="type">float</span> InAperture)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetFocusDistanceParam</span><span class="params">(<span class="type">float</span> InFocus)</span>;</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">    <span class="comment">// 创建自定义ViewportClient</span></span><br><span class="line">    virtual TSharedRef&lt;FEditorViewportClient&gt; <span class="title function_">MakeEditorViewportClient</span><span class="params">()</span> override;</span><br><span class="line">    <span class="comment">// 不显示默认工具栏</span></span><br><span class="line">    virtual TSharedPtr&lt;SWidget&gt; <span class="title function_">MakeViewportToolbar</span><span class="params">()</span> override &#123; <span class="keyword">return</span> SNullWidget::NullWidget; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 捕获键盘输入分发到模块（用于热键切换相机）</span></span><br><span class="line">    virtual FReply <span class="title function_">OnKeyDown</span><span class="params">(<span class="type">const</span> FGeometry&amp; MyGeometry, <span class="type">const</span> FKeyEvent&amp; InKeyEvent)</span> override;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    <span class="comment">// 应用所有缓存的相机参数</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">ApplyCachedParams</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    TSharedPtr&lt;FTcgXRViewportClient&gt; ViewportClient; <span class="comment">// 视口客户端</span></span><br><span class="line">    TUniquePtr&lt;FPreviewScene&gt; PreviewScene; <span class="comment">// 预览场景</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 缓存相机参数（在Client未就绪时临时保存）</span></span><br><span class="line">    TOptional&lt;<span class="type">float</span>&gt; CachedFOV;</span><br><span class="line">    TOptional&lt;<span class="type">float</span>&gt; CachedExposure;</span><br><span class="line">    TOptional&lt;<span class="type">float</span>&gt; CachedFocalLength;</span><br><span class="line">    TOptional&lt;<span class="type">float</span>&gt; CachedAperture;</span><br><span class="line">    TOptional&lt;<span class="type">float</span>&gt; CachedFocusDistance;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="TcgXR-h"><a href="#TcgXR-h" class="headerlink" title="TcgXR.h"></a>TcgXR.h</h3><p><strong>文件路径</strong>: <code>Public\TcgXR.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Modules/ModuleManager.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FToolBarBuilder</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FMenuBuilder</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ACinemaCameraActor</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ACameraActor</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SWindow</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SVerticalBox</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTcgXRModule</span> :</span> public IModuleInterface</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	<span class="comment">/** IModuleInterface implementation */</span></span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">StartupModule</span><span class="params">()</span> override;</span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">ShutdownModule</span><span class="params">()</span> override;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** This function will be bound to Command. */</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">PluginButtonClicked</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 热键：处理按键（由STcgXRViewport调用），返回是否已处理</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">HandleKeyDown</span><span class="params">(<span class="type">const</span> FKey&amp; Key)</span>;</span><br><span class="line">	<span class="comment">// 热键：绑定某个相机到某个按键</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">BindCameraHotkey</span><span class="params">(TWeakObjectPtr&lt;ACameraActor&gt; Camera, <span class="type">const</span> FKey&amp; Key)</span>;</span><br><span class="line">	<span class="comment">// 切换关卡视口到指定相机</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">SwitchToCamera</span><span class="params">(TWeakObjectPtr&lt;ACameraActor&gt; Camera)</span>;</span><br><span class="line">	<span class="comment">// 刷新相机列表并重建UI</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">RefreshCameraList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭所有全屏窗口</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">CloseAllFullscreenWindows</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示当前控制的相机名称</span></span><br><span class="line">	FText <span class="title function_">GetCurrentControlledCameraText</span><span class="params">()</span> <span class="type">const</span>;</span><br><span class="line">	<span class="comment">// 获取相机已绑定的按键显示文本</span></span><br><span class="line">	FText <span class="title function_">GetBoundKeyTextForCamera</span><span class="params">(TWeakObjectPtr&lt;ACameraActor&gt; Camera)</span> <span class="type">const</span>;</span><br><span class="line">	</span><br><span class="line">private:</span><br><span class="line">	<span class="type">void</span> <span class="title function_">RegisterMenus</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Spawn the XR viewport tab</span></span><br><span class="line">	TSharedRef&lt;class SDockTab&gt; <span class="title function_">OnSpawnPluginTab</span><span class="params">(<span class="type">const</span> class FSpawnTabArgs&amp; Args)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 重建相机热键绑定UI</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">RebuildCameraHotkeyUI</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	TSharedPtr&lt;<span class="class"><span class="keyword">class</span> <span class="title">FUICommandList</span>&gt;</span> PluginCommands;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 相机与热键映射</span></span><br><span class="line">	TMap&lt;FKey, TWeakObjectPtr&lt;ACameraActor&gt;&gt; CameraHotkeyMap;</span><br><span class="line">	TArray&lt;TWeakObjectPtr&lt;ACameraActor&gt;&gt; CachedCameras;</span><br><span class="line">	TWeakPtr&lt;SVerticalBox&gt; CameraListPanel;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听句柄</span></span><br><span class="line">	FDelegateHandle ActorAddedHandle;</span><br><span class="line">	FDelegateHandle ActorDeletedHandle;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 全屏窗口列表</span></span><br><span class="line">	TArray&lt;TWeakPtr&lt;SWindow&gt;&gt; FullscreenWindows;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="TcgXRCommands-h"><a href="#TcgXRCommands-h" class="headerlink" title="TcgXRCommands.h"></a>TcgXRCommands.h</h3><p><strong>文件路径</strong>: <code>Public\TcgXRCommands.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Framework/Commands/Commands.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TcgXRStyle.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTcgXRCommands</span> :</span> public TCommands&lt;FTcgXRCommands&gt;</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">	FTcgXRCommands()</span><br><span class="line">		: TCommands&lt;FTcgXRCommands&gt;(TEXT(<span class="string">&quot;TcgXR&quot;</span>), NSLOCTEXT(<span class="string">&quot;Contexts&quot;</span>, <span class="string">&quot;TcgXR&quot;</span>, <span class="string">&quot;TcgXR Plugin&quot;</span>), NAME_None, FTcgXRStyle::GetStyleSetName())</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// TCommands&lt;&gt; interface</span></span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">RegisterCommands</span><span class="params">()</span> override;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	TSharedPtr&lt; FUICommandInfo &gt; PluginAction;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="TcgXRStyle-h"><a href="#TcgXRStyle-h" class="headerlink" title="TcgXRStyle.h"></a>TcgXRStyle.h</h3><p><strong>文件路径</strong>: <code>Public\TcgXRStyle.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Styling/SlateStyle.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTcgXRStyle</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">Initialize</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">Shutdown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** reloads textures used by slate renderer */</span></span><br><span class="line">	<span class="type">static</span> <span class="type">void</span> <span class="title function_">ReloadTextures</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** @return The Slate style set for the Shooter game */</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> ISlateStyle&amp; <span class="title function_">Get</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> FName <span class="title function_">GetStyleSetName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> TSharedRef&lt; class FSlateStyleSet &gt; <span class="title function_">Create</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> TSharedPtr&lt; <span class="class"><span class="keyword">class</span> <span class="title">FSlateStyleSet</span> &gt;</span> StyleInstance;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="TcgXRViewportClient-h"><a href="#TcgXRViewportClient-h" class="headerlink" title="TcgXRViewportClient.h"></a>TcgXRViewportClient.h</h3><p><strong>文件路径</strong>: <code>Public\TcgXRViewportClient.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EditorViewportClient.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PreviewScene.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SEditorViewport.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Editor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SceneView.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TcgXR自定义ViewportClient，负责相机控制、XR显示等</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTcgXRViewportClient</span> :</span> public FEditorViewportClient</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    <span class="comment">// 构造函数，初始化视口参数</span></span><br><span class="line">    FTcgXRViewportClient(FPreviewScene* InPreviewScene, <span class="type">const</span> TSharedRef&lt;SEditorViewport&gt;&amp; InEditorViewport)</span><br><span class="line">        : FEditorViewportClient(nullptr, InPreviewScene, InEditorViewport)</span><br><span class="line">    &#123;</span><br><span class="line">        SetViewLocation(FVector(<span class="number">0</span>, <span class="number">-300</span>, <span class="number">200</span>));</span><br><span class="line">        SetViewRotation(FRotator(<span class="number">-10</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">        SetRealtime(<span class="literal">true</span>);</span><br><span class="line">        EngineShowFlags.SetGrid(<span class="literal">true</span>);</span><br><span class="line">        EngineShowFlags.EnableAdvancedFeatures();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染主编辑器世界，保证视口内容与主场景一致</span></span><br><span class="line">    virtual UWorld* <span class="title function_">GetWorld</span><span class="params">()</span> <span class="type">const</span> override</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (GEditor) ? GEditor-&gt;GetEditorWorldContext().World() : nullptr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// XR相关切换</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetShowKeyed</span><span class="params">(<span class="type">bool</span> bValue)</span></span><br><span class="line">    &#123;</span><br><span class="line">        bShowKeyed = bValue;</span><br><span class="line">        EngineShowFlags.PostProcessing = bShowKeyed; <span class="comment">// 示例：切换后处理</span></span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetVirtualCamMove</span><span class="params">(<span class="type">bool</span> bValue)</span></span><br><span class="line">    &#123;</span><br><span class="line">        bVirtualCamMove = bValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetMixedRealityBlend</span><span class="params">(<span class="type">bool</span> bValue)</span></span><br><span class="line">    &#123;</span><br><span class="line">        bMixedRealityBlend = bValue;</span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 相机参数控制</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetFOV</span><span class="params">(<span class="type">float</span> InFOV)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ViewFOV = FMath::Clamp(InFOV, <span class="number">15.f</span>, <span class="number">170.f</span>);</span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> <span class="title function_">GetFOV</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> ViewFOV; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetExposure</span><span class="params">(<span class="type">float</span> InExposure)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ManualExposureBias = FMath::Clamp(InExposure, <span class="number">-10.f</span>, <span class="number">10.f</span>);</span><br><span class="line">        bApplyExposureBias = <span class="literal">true</span>; <span class="comment">// 启用曝光补偿</span></span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> <span class="title function_">GetExposure</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> ManualExposureBias; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetFocalLength</span><span class="params">(<span class="type">float</span> InFocalLength)</span></span><br><span class="line">    &#123;</span><br><span class="line">        FocalLength = FMath::Max(<span class="number">1.f</span>, InFocalLength);</span><br><span class="line">        <span class="comment">// 使用默认胶片宽度36mm将焦距映射到FOV</span></span><br><span class="line">        <span class="type">const</span> <span class="type">float</span> SensorWidth = <span class="number">36.0f</span>; <span class="comment">// mm</span></span><br><span class="line">        <span class="type">const</span> <span class="type">float</span> HFOVRadians = <span class="number">2.f</span> * FMath::Atan((SensorWidth * <span class="number">0.5f</span>) / FocalLength);</span><br><span class="line">        SetFOV(FMath::RadiansToDegrees(HFOVRadians));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> <span class="title function_">GetFocalLength</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> FocalLength; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetAperture</span><span class="params">(<span class="type">float</span> InAperture)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Aperture = FMath::Clamp(InAperture, <span class="number">0.7f</span>, <span class="number">32.f</span>);</span><br><span class="line">        bApplyDOF = <span class="literal">true</span>; <span class="comment">// 启用景深覆盖</span></span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> <span class="title function_">GetAperture</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> Aperture; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetFocusDistance</span><span class="params">(<span class="type">float</span> InDistance)</span></span><br><span class="line">    &#123;</span><br><span class="line">        FocusDistance = FMath::Max(<span class="number">1.f</span>, InDistance);</span><br><span class="line">        bApplyDOF = <span class="literal">true</span>;</span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> <span class="title function_">GetFocusDistance</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> FocusDistance; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从外部视口复制相机参数</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">SetCameraFrom</span><span class="params">(<span class="type">const</span> FVector&amp; InLoc, <span class="type">const</span> FRotator&amp; InRot, <span class="type">float</span> InFOV, <span class="type">float</span> InOrthoWidth, <span class="type">bool</span> bInIsOrtho)</span></span><br><span class="line">    &#123;</span><br><span class="line">        SetViewLocation(InLoc);</span><br><span class="line">        SetViewRotation(InRot);</span><br><span class="line">        <span class="keyword">if</span> (bInIsOrtho)</span><br><span class="line">        &#123;</span><br><span class="line">            SetViewportType(LVT_OrthoFreelook);</span><br><span class="line">            SetOrthoZoom(InOrthoWidth);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            SetViewportType(LVT_Perspective);</span><br><span class="line">            ViewFOV = InFOV;</span><br><span class="line">        &#125;</span><br><span class="line">        Invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual <span class="type">void</span> <span class="title function_">Tick</span><span class="params">(<span class="type">float</span> DeltaSeconds)</span> override</span><br><span class="line">    &#123;</span><br><span class="line">        FEditorViewportClient::Tick(DeltaSeconds);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!bVirtualCamMove &amp;&amp; GEditor)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (FEditorViewportClient* VC : GEditor-&gt;GetAllViewportClients())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (VC &amp;&amp; VC-&gt;IsPerspective())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">const</span> FVector Loc = VC-&gt;GetViewLocation();</span><br><span class="line">                    <span class="type">const</span> FRotator Rot = VC-&gt;GetViewRotation();</span><br><span class="line">                    <span class="type">const</span> <span class="type">bool</span> bIsOrtho = VC-&gt;IsOrtho();</span><br><span class="line">                    <span class="type">const</span> <span class="type">float</span> FOV = ViewFOV; <span class="comment">// 使用当前FOV</span></span><br><span class="line">                    <span class="type">const</span> <span class="type">float</span> OrthoWidth = <span class="number">2048.f</span>;</span><br><span class="line">                    SetCameraFrom(Loc, Rot, FOV, OrthoWidth, bIsOrtho);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bVirtualCamMove)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">const</span> <span class="type">float</span> Speed = <span class="number">15.f</span>;</span><br><span class="line">            FRotator R = GetViewRotation();</span><br><span class="line">            R.Yaw += Speed * DeltaSeconds;</span><br><span class="line">            SetViewRotation(R);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 覆盖后处理参数：仅在需要时设置曝光补偿/景深，尽量保持与编辑器视口一致</span></span><br><span class="line">    virtual <span class="type">void</span> <span class="title function_">OverridePostProcessSettings</span><span class="params">(FSceneView&amp; View)</span> override</span><br><span class="line">    &#123;</span><br><span class="line">        FEditorViewportClient::OverridePostProcessSettings(View);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bApplyExposureBias)</span><br><span class="line">        &#123;</span><br><span class="line">            View.FinalPostProcessSettings.bOverride_AutoExposureBias = <span class="literal">true</span>;</span><br><span class="line">            View.FinalPostProcessSettings.AutoExposureBias = ManualExposureBias;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bApplyDOF)</span><br><span class="line">        &#123;</span><br><span class="line">            View.FinalPostProcessSettings.bOverride_DepthOfFieldFstop = <span class="literal">true</span>;</span><br><span class="line">            View.FinalPostProcessSettings.DepthOfFieldFstop = Aperture;</span><br><span class="line">            View.FinalPostProcessSettings.bOverride_DepthOfFieldFocalDistance = <span class="literal">true</span>;</span><br><span class="line">            View.FinalPostProcessSettings.DepthOfFieldFocalDistance = FocusDistance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// XR状态查询</span></span><br><span class="line">    <span class="type">bool</span> <span class="title function_">IsShowKeyed</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> bShowKeyed; &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">IsVirtualCamMove</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> bVirtualCamMove; &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">IsMixedRealityBlend</span><span class="params">()</span> <span class="type">const</span> &#123; <span class="keyword">return</span> bMixedRealityBlend; &#125;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    <span class="type">bool</span> bShowKeyed = <span class="literal">false</span>; <span class="comment">// 是否显示抠像</span></span><br><span class="line">    <span class="type">bool</span> bVirtualCamMove = <span class="literal">false</span>; <span class="comment">// 是否虚拟相机运动</span></span><br><span class="line">    <span class="type">bool</span> bMixedRealityBlend = <span class="literal">true</span>; <span class="comment">// 是否虚实融合</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 相机可调参数</span></span><br><span class="line">    <span class="type">float</span> ManualExposureBias = <span class="number">0.f</span>; <span class="comment">// 曝光补偿（log2EV）</span></span><br><span class="line">    <span class="type">bool</span>  bApplyExposureBias = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">float</span> FocalLength = <span class="number">35.f</span>;   <span class="comment">// 焦距（mm）</span></span><br><span class="line">    <span class="type">float</span> Aperture = <span class="number">2.8f</span>;      <span class="comment">// 光圈（F）</span></span><br><span class="line">    <span class="type">float</span> FocusDistance = <span class="number">1000.f</span>; <span class="comment">// 对焦距离</span></span><br><span class="line">    <span class="type">bool</span>  bApplyDOF = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="TcgXR-Build-cs"><a href="#TcgXR-Build-cs" class="headerlink" title="TcgXR.Build.cs"></a>TcgXR.Build.cs</h3><p><strong>文件路径</strong>: <code>TcgXR.Build.cs</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnrealBuildTool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TcgXR</span> : <span class="title">ModuleRules</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TcgXR</span>(<span class="params">ReadOnlyTargetRules Target</span>) : <span class="title">base</span>(<span class="params">Target</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		PCHUsage = ModuleRules.PCHUsageMode.UseExplicitOrSharedPCHs;</span><br><span class="line">		</span><br><span class="line">		PublicIncludePaths.AddRange(</span><br><span class="line">			<span class="keyword">new</span> <span class="built_in">string</span>[] &#123;</span><br><span class="line">				<span class="comment">// ... add public include paths required here ...</span></span><br><span class="line">			&#125;</span><br><span class="line">			);</span><br><span class="line">				</span><br><span class="line">		</span><br><span class="line">		PrivateIncludePaths.AddRange(</span><br><span class="line">			<span class="keyword">new</span> <span class="built_in">string</span>[] &#123;</span><br><span class="line">				<span class="comment">// ... add other private include paths required here ...</span></span><br><span class="line">			&#125;</span><br><span class="line">			);</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">		PublicDependencyModuleNames.AddRange(</span><br><span class="line">			<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;Core&quot;</span>,</span><br><span class="line">				<span class="comment">// ... add other public dependencies that you statically link with here ...</span></span><br><span class="line">			&#125;</span><br><span class="line">			);</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">		PrivateDependencyModuleNames.AddRange(</span><br><span class="line">			<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;Projects&quot;</span>,</span><br><span class="line">				<span class="string">&quot;InputCore&quot;</span>,</span><br><span class="line">				<span class="string">&quot;EditorFramework&quot;</span>,</span><br><span class="line">				<span class="string">&quot;UnrealEd&quot;</span>,</span><br><span class="line">				<span class="string">&quot;ToolMenus&quot;</span>,</span><br><span class="line">				<span class="string">&quot;CoreUObject&quot;</span>,</span><br><span class="line">				<span class="string">&quot;Engine&quot;</span>,</span><br><span class="line">				<span class="string">&quot;Slate&quot;</span>,</span><br><span class="line">				<span class="string">&quot;SlateCore&quot;</span>,</span><br><span class="line">				<span class="string">&quot;AppFramework&quot;</span>,</span><br><span class="line">				<span class="string">&quot;LevelEditor&quot;</span>,</span><br><span class="line">				<span class="string">&quot;CinematicCamera&quot;</span>, <span class="comment">// 使用电影相机</span></span><br><span class="line">				<span class="comment">// ... add private dependencies that you statically link with here ...	</span></span><br><span class="line">			&#125;</span><br><span class="line">			);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		DynamicallyLoadedModuleNames.AddRange(</span><br><span class="line">			<span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// ... add any modules that your module loads dynamically here ...</span></span><br><span class="line">			&#125;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id=""><a href="#" class="headerlink" title=""></a></h2>

            <!-- Tags -->
            


<div class="tags">
    
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>

    <!-- Table of Contents will be generated by toc-collapse.js -->

</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->

<script src="/js/jquery.js"></script>


<!-- Custom Code -->

<script src="/js/main.js"></script>


<script src="/js/article-collapse.js"></script>


<script src="/js/toc-collapse.js"></script>


<script src="/js/shadertoy-embed.js"></script>


<script src="/js/image-zoom.js"></script>


<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Code Block Expansion Script -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Initialize code block expansion
    function initCodeBlockExpansion() {
        const codeBlocks = document.querySelectorAll('figure.highlight');
        
        codeBlocks.forEach(function(codeBlock) {
            // Skip if already processed
            if (codeBlock.closest('.code-block-container')) return;
            
            // Remove table structure and keep only code content
            const table = codeBlock.querySelector('table');
            if (table) {
                const codeCell = table.querySelector('td.code');
                if (codeCell) {
                    // Create a new pre element with code content
                    const newPre = document.createElement('pre');
                    newPre.className = 'code';
                    newPre.innerHTML = codeCell.innerHTML;
                    
                    // Replace table with pre element
                    codeBlock.innerHTML = '';
                    codeBlock.appendChild(newPre);
                }
            }
            
            // Get the code content height
            const codeContent = codeBlock.querySelector('pre.code');
            if (!codeContent) return;
            
            const actualHeight = codeContent.scrollHeight;
            const maxHeight = 400; // Same as CSS max-height
            
            // Create button container and copy button for all code blocks
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'code-buttons';
            
            // Create copy button (for all code blocks)
            const copyButton = document.createElement('button');
            copyButton.className = 'copy-code-button';
            copyButton.textContent = '复制代码';
            copyButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                copyCodeToClipboard(codeContent, copyButton);
            });
            buttonsContainer.appendChild(copyButton);

            // Only add expansion if content is taller than max height
            if (actualHeight > maxHeight) {
                // Wrap the code block in a container
                const container = document.createElement('div');
                container.className = 'code-block-container collapsed';
                codeBlock.parentNode.insertBefore(container, codeBlock);
                container.appendChild(codeBlock);

                // Create expand button
                const expandButton = document.createElement('button');
                expandButton.className = 'expand-button';
                expandButton.textContent = '展开代码';
                buttonsContainer.appendChild(expandButton);

                // Add buttons container to the wrapper
                container.appendChild(buttonsContainer);

                // Add click handler
                expandButton.addEventListener('click', function() {
                    if (container.classList.contains('collapsed')) {
                        // Expand to full screen
                        showFullscreenCode(codeBlock, expandButton);
                    }
                });
            } else {
                // For code blocks that don't need expansion, just add copy button
                const container = document.createElement('div');
                container.className = 'code-block-container';
                codeBlock.parentNode.insertBefore(container, codeBlock);
                container.appendChild(codeBlock);
                container.appendChild(buttonsContainer);
            }
        });
    }
    
    function showFullscreenCode(codeBlock, button) {
        // Create fullscreen modal
        const modal = document.createElement('div');
        modal.className = 'code-fullscreen-modal active';
        
        const content = document.createElement('div');
        content.className = 'code-fullscreen-content';
        
        // Clone the code block and remove any expansion restrictions
        const clonedBlock = codeBlock.cloneNode(true);
        
        // Remove any size restrictions from cloned block
        clonedBlock.style.maxHeight = 'none';
        clonedBlock.style.overflow = 'visible';
        
        // Find and update the pre.code element in cloned block
        const clonedPre = clonedBlock.querySelector('pre.code');
        if (clonedPre) {
            clonedPre.style.maxHeight = 'none';
            clonedPre.style.height = '100%';
            clonedPre.style.overflowY = 'scroll';
            clonedPre.style.overflowX = 'auto';
            clonedPre.style.minHeight = '0';
            // 确保内容完全可见
            clonedPre.scrollTop = 0;
        }
        
        content.appendChild(clonedBlock);
        
        // Create close button
        const closeButton = document.createElement('button');
        closeButton.className = 'close-fullscreen';
        closeButton.textContent = '关闭';
        content.appendChild(closeButton);
        
        modal.appendChild(content);
        document.body.appendChild(modal);
        
        // Prevent body scrolling
        document.body.style.overflow = 'hidden';
        
        // Close handlers
        function closeModal() {
            document.body.removeChild(modal);
            document.body.style.overflow = '';
        }
        
        closeButton.addEventListener('click', closeModal);
        
        // Close on backdrop click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
        
        // Close on escape key
        function handleKeydown(e) {
            if (e.key === 'Escape') {
                closeModal();
                document.removeEventListener('keydown', handleKeydown);
            }
        }
        document.addEventListener('keydown', handleKeydown);
    }
    
    // Initialize on page load
    initCodeBlockExpansion();
    
    // Re-initialize if new content is loaded (for SPA-like behavior)
    const observer = new MutationObserver(function(mutations) {
        let needsReinit = false;
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length > 0) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (node.matches('figure.highlight') || node.querySelector('figure.highlight'))) {
                        needsReinit = true;
                    }
                });
            }
        });
        if (needsReinit) {
            setTimeout(initCodeBlockExpansion, 100);
        }
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});
</script>

<!-- Mermaid Initialization -->
<script type="text/javascript">
    // Wait for document ready
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof mermaid !== 'undefined') {
            // Initialize with proper configuration
            mermaid.initialize({ 
                startOnLoad: false,
                theme: 'default',
                securityLevel: 'loose'
            });
            
            // Find and process mermaid code blocks
            const codeBlocks = document.querySelectorAll('figure.highlight.plaintext .code');
            
            codeBlocks.forEach((codeElement, index) => {
                let code = codeElement.textContent || codeElement.innerText;
                
                // Check if it's a mermaid diagram
                if (code.trim().match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|journey|pie|gitgraph|erDiagram)/)) {
                    // Critical fix: Remove ALL leading/trailing whitespace and newlines
                    code = code.trim().replace(/^\s+|\s+$/g, '');
                    
                    // Create mermaid div
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    // Set the cleaned code without any extra whitespace
                    mermaidDiv.textContent = code;
                    mermaidDiv.id = 'mermaid-diagram-' + index;
                    
                    // Replace the entire figure element
                    const figureElement = codeElement.closest('figure');
                    if (figureElement) {
                        figureElement.parentNode.replaceChild(mermaidDiv, figureElement);
                    }
                }
            });
            
            // Initialize mermaid diagrams with explicit selector
            setTimeout(() => {
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
            }, 100);
        }
    });
</script>

<!-- ShaderToy Placeholder Processing -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit for other scripts to load
    setTimeout(function() {
        // Find all elements with shadertoy-placeholder class
        const elements = document.querySelectorAll('.shadertoy-placeholder[data-id]');
        
        console.log('Found shadertoy-placeholder elements:', elements.length);

        elements.forEach(element => {
            const shaderID = element.getAttribute('data-id');
            console.log('Processing shadertoy-placeholder element with ID:', shaderID);
            
            if (shaderID) {
                // Create iframe container
                const container = document.createElement('div');
                container.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 400px;
                    margin: 20px 0;
                    border: 2px solid #bfbbbb;
                    border-radius: 8px;
                    overflow: hidden;
                    background-color: #f6f6f6;
                `;

                // Create iframe
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.shadertoy.com/embed/${shaderID}?gui=true&t=10&paused=false&muted=false`;
                iframe.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    border: none;
                `;
                iframe.allowFullscreen = true;
                iframe.loading = 'lazy';

                container.appendChild(iframe);
                element.parentNode.insertBefore(container, element);
                element.parentNode.removeChild(element);
            }
        });
    }, 1000); // Wait a full second for everything to load
});
</script>

<!-- Disqus Comments -->


</body>

</html>